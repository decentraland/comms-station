var An=Object.defineProperty;var In=(e,t,n)=>t in e?An(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var pt=(e,t,n)=>(In(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();const normalize="",style="";var commonjsGlobal$1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs$1(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function i(){if(this instanceof i){var a=[null];a.push.apply(a,arguments);var o=Function.bind.apply(t,a);return new o}return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var a=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(n,i,a.get?a:{enumerable:!0,get:function(){return e[i]}})}),n}var dist$3={},Authenticator={},ethConnectExports={},ethConnect={get exports(){return ethConnectExports},set exports(e){ethConnectExports=e}};/*! eth-connect {
  "date": "2023-01-31T03:15:57.691Z",
  "commit": "3e0ab15b1216563d34015025d6228ddd389f79aa",
  "ref": "refs/tags/6.1.0"
} */(function(e,t){(function(n,i){i(t)})(commonjsGlobal$1,function(n){function i(w){if(w.jsonrpc="2.0",!w.id||typeof w.id!="number"||Math.floor(w.id)!==w.id)throw new Error(`Invalid RPC message(invalid id) message: ${JSON.stringify(w)}`);if(!w.method||typeof w.method!="string"||w.method.trim().length===0)throw new Error(`Invalid RPC message(invalid method) message: ${JSON.stringify(w)}`);if(!w.params||typeof w.params!="object")throw new Error(`Invalid RPC message(invalid params) message: ${JSON.stringify(w)}`);return w}function a(w,P){return w(P={exports:{}},P.exports),P.exports}var o,c=a(function(w,P){function D(){let ne,de;const ue=new Promise((Ie,it)=>{ne=ft=>{Ie(ft),ue.isPending=!1},de=ft=>{it(ft),ue.isPending=!1}}).catch(Ie=>Promise.reject(Ie));return ue.resolve=ne,ue.reject=de,"finally"in ue||(ue.finally=Ie=>{ue.then(Ie),ue.catch(Ie)}),ue.isPending=!0,ue}Object.defineProperty(P,"__esModule",{value:!0}),P.future=D,P.default=D});(o=c)&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")&&o.default;var d=c.future,u=typeof commonjsGlobal$1<"u"?commonjsGlobal$1:typeof self<"u"?self:typeof window<"u"?window:{};function l(){throw new Error("setTimeout has not been defined")}function h(){throw new Error("clearTimeout has not been defined")}var p=l,y=h;function E(w){if(p===setTimeout)return setTimeout(w,0);if((p===l||!p)&&setTimeout)return p=setTimeout,setTimeout(w,0);try{return p(w,0)}catch{try{return p.call(null,w,0)}catch{return p.call(this,w,0)}}}typeof u.setTimeout=="function"&&(p=setTimeout),typeof u.clearTimeout=="function"&&(y=clearTimeout);var x,S=[],k=!1,T=-1;function L(){k&&x&&(k=!1,x.length?S=x.concat(S):T=-1,S.length&&q())}function q(){if(!k){var w=E(L);k=!0;for(var P=S.length;P;){for(x=S,S=[];++T<P;)x&&x[T].run();T=-1,P=S.length}x=null,k=!1,function(D){if(y===clearTimeout)return clearTimeout(D);if((y===h||!y)&&clearTimeout)return y=clearTimeout,clearTimeout(D);try{y(D)}catch{try{return y.call(null,D)}catch{return y.call(this,D)}}}(w)}}function U(w,P){this.fun=w,this.array=P}U.prototype.run=function(){this.fun.apply(null,this.array)};function ee(){}var W=ee,ie=ee,fe=ee,ce=ee,ye=ee,xe=ee,Oe=ee,F=u.performance||{},v=F.now||F.mozNow||F.msNow||F.oNow||F.webkitNow||function(){return new Date().getTime()},C=new Date,I={nextTick:function(w){var P=new Array(arguments.length-1);if(arguments.length>1)for(var D=1;D<arguments.length;D++)P[D-1]=arguments[D];S.push(new U(w,P)),S.length!==1||k||E(q)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:W,addListener:ie,once:fe,off:ce,removeListener:ye,removeAllListeners:xe,emit:Oe,binding:function(w){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(w){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(w){var P=.001*v.call(F),D=Math.floor(P),ne=Math.floor(P%1*1e9);return w&&(D-=w[0],(ne-=w[1])<0&&(D--,ne+=1e9)),[D,ne]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-C)/1e3}},B=a(function(w){/**
   * [js-sha3]{@link https://github.com/emn178/js-sha3}
   *
   * @version 0.8.0
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2015-2018
   * @license MIT
   */(function(){var P="input is invalid type",D=typeof window=="object",ne=D?window:{};ne.JS_SHA3_NO_WINDOW&&(D=!1);var de=!D&&typeof self=="object";!ne.JS_SHA3_NO_NODE_JS&&typeof I=="object"&&I.versions&&I.versions.node?ne=u:de&&(ne=self);var ue=!ne.JS_SHA3_NO_COMMON_JS&&w.exports,Ie=!ne.JS_SHA3_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",it="0123456789abcdef".split(""),ft=[4,1024,262144,67108864],Fe=[0,8,16,24],nr=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],ar=[224,256,384,512],qt=[128,256],Wt=["hex","buffer","arrayBuffer","array","digest"],ir={128:168,256:136};!ne.JS_SHA3_NO_NODE_JS&&Array.isArray||(Array.isArray=function(A){return Object.prototype.toString.call(A)==="[object Array]"}),!Ie||!ne.JS_SHA3_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(A){return typeof A=="object"&&A.buffer&&A.buffer.constructor===ArrayBuffer});for(var Xt=function(A,Be,Ue){return function(Re){return new Ft(A,Be,A).update(Re)[Ue]()}},fr=function(A,Be,Ue){return function(Re,Xe){return new Ft(A,Be,Xe).update(Re)[Ue]()}},Dt=function(A,Be,Ue){return function(Re,Xe,tt,ht){return xt["cshake"+A].update(Re,Xe,tt,ht)[Ue]()}},Jr=function(A,Be,Ue){return function(Re,Xe,tt,ht){return xt["kmac"+A].update(Re,Xe,tt,ht)[Ue]()}},Mr=function(A,Be,Ue,Re){for(var Xe=0;Xe<Wt.length;++Xe){var tt=Wt[Xe];A[tt]=Be(Ue,Re,tt)}return A},kr=function(A,Be){var Ue=Xt(A,Be,"hex");return Ue.create=function(){return new Ft(A,Be,A)},Ue.update=function(Re){return Ue.create().update(Re)},Mr(Ue,Xt,A,Be)},_t=[{name:"keccak",padding:[1,256,65536,16777216],bits:ar,createMethod:kr},{name:"sha3",padding:[6,1536,393216,100663296],bits:ar,createMethod:kr},{name:"shake",padding:[31,7936,2031616,520093696],bits:qt,createMethod:function(A,Be){var Ue=fr(A,Be,"hex");return Ue.create=function(Re){return new Ft(A,Be,Re)},Ue.update=function(Re,Xe){return Ue.create(Xe).update(Re)},Mr(Ue,fr,A,Be)}},{name:"cshake",padding:ft,bits:qt,createMethod:function(A,Be){var Ue=ir[A],Re=Dt(A,0,"hex");return Re.create=function(Xe,tt,ht){return tt||ht?new Ft(A,Be,Xe).bytepad([tt,ht],Ue):xt["shake"+A].create(Xe)},Re.update=function(Xe,tt,ht,Et){return Re.create(tt,ht,Et).update(Xe)},Mr(Re,Dt,A,Be)}},{name:"kmac",padding:ft,bits:qt,createMethod:function(A,Be){var Ue=ir[A],Re=Jr(A,0,"hex");return Re.create=function(Xe,tt,ht){return new Kr(A,Be,tt).bytepad(["KMAC",ht],Ue).bytepad([Xe],Ue)},Re.update=function(Xe,tt,ht,Et){return Re.create(Xe,ht,Et).update(tt)},Mr(Re,Jr,A,Be)}}],xt={},Ct=[],Ht=0;Ht<_t.length;++Ht)for(var Bt=_t[Ht],cr=Bt.bits,sr=0;sr<cr.length;++sr){var Pr=Bt.name+"_"+cr[sr];if(Ct.push(Pr),xt[Pr]=Bt.createMethod(cr[sr],Bt.padding),Bt.name!=="sha3"){var Cr=Bt.name+cr[sr];Ct.push(Cr),xt[Cr]=xt[Pr]}}function Ft(A,Be,Ue){this.blocks=[],this.s=[],this.padding=Be,this.outputBits=Ue,this.reset=!0,this.finalized=!1,this.block=0,this.start=0,this.blockCount=1600-(A<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=Ue>>5,this.extraBytes=(31&Ue)>>3;for(var Re=0;Re<50;++Re)this.s[Re]=0}function Kr(A,Be,Ue){Ft.call(this,A,Be,Ue)}Ft.prototype.update=function(A){if(this.finalized)throw new Error("finalize already called");var Be,Ue=typeof A;if(Ue!=="string"){if(Ue!=="object")throw new Error(P);if(A===null)throw new Error(P);if(Ie&&A.constructor===ArrayBuffer)A=new Uint8Array(A);else if(!(Array.isArray(A)||Ie&&ArrayBuffer.isView(A)))throw new Error(P);Be=!0}for(var Re,Xe,tt=this.blocks,ht=this.byteCount,Et=A.length,Gt=this.blockCount,lr=0,br=this.s;lr<Et;){if(this.reset)for(this.reset=!1,tt[0]=this.block,Re=1;Re<Gt+1;++Re)tt[Re]=0;if(Be)for(Re=this.start;lr<Et&&Re<ht;++lr)tt[Re>>2]|=A[lr]<<Fe[3&Re++];else for(Re=this.start;lr<Et&&Re<ht;++lr)(Xe=A.charCodeAt(lr))<128?tt[Re>>2]|=Xe<<Fe[3&Re++]:Xe<2048?(tt[Re>>2]|=(192|Xe>>6)<<Fe[3&Re++],tt[Re>>2]|=(128|63&Xe)<<Fe[3&Re++]):Xe<55296||Xe>=57344?(tt[Re>>2]|=(224|Xe>>12)<<Fe[3&Re++],tt[Re>>2]|=(128|Xe>>6&63)<<Fe[3&Re++],tt[Re>>2]|=(128|63&Xe)<<Fe[3&Re++]):(Xe=65536+((1023&Xe)<<10|1023&A.charCodeAt(++lr)),tt[Re>>2]|=(240|Xe>>18)<<Fe[3&Re++],tt[Re>>2]|=(128|Xe>>12&63)<<Fe[3&Re++],tt[Re>>2]|=(128|Xe>>6&63)<<Fe[3&Re++],tt[Re>>2]|=(128|63&Xe)<<Fe[3&Re++]);if(this.lastByteIndex=Re,Re>=ht){for(this.start=Re-ht,this.block=tt[Gt],Re=0;Re<Gt;++Re)br[Re]^=tt[Re];Br(br),this.reset=!0}else this.start=Re}return this},Ft.prototype.encode=function(A,Be){var Ue=255&A,Re=1,Xe=[Ue];for(Ue=255&(A>>=8);Ue>0;)Xe.unshift(Ue),Ue=255&(A>>=8),++Re;return Be?Xe.push(Re):Xe.unshift(Re),this.update(Xe),Xe.length},Ft.prototype.encodeString=function(A){var Be,Ue=typeof A;if(Ue!=="string"){if(Ue!=="object")throw new Error(P);if(A===null)throw new Error(P);if(Ie&&A.constructor===ArrayBuffer)A=new Uint8Array(A);else if(!(Array.isArray(A)||Ie&&ArrayBuffer.isView(A)))throw new Error(P);Be=!0}var Re=0,Xe=A.length;if(Be)Re=Xe;else for(var tt=0;tt<A.length;++tt){var ht=A.charCodeAt(tt);ht<128?Re+=1:ht<2048?Re+=2:ht<55296||ht>=57344?Re+=3:(ht=65536+((1023&ht)<<10|1023&A.charCodeAt(++tt)),Re+=4)}return Re+=this.encode(8*Re),this.update(A),Re},Ft.prototype.bytepad=function(A,Be){for(var Ue=this.encode(Be),Re=0;Re<A.length;++Re)Ue+=this.encodeString(A[Re]);var Xe=Be-Ue%Be,tt=[];return tt.length=Xe,this.update(tt),this},Ft.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var A=this.blocks,Be=this.lastByteIndex,Ue=this.blockCount,Re=this.s;if(A[Be>>2]|=this.padding[3&Be],this.lastByteIndex===this.byteCount)for(A[0]=A[Ue],Be=1;Be<Ue+1;++Be)A[Be]=0;for(A[Ue-1]|=2147483648,Be=0;Be<Ue;++Be)Re[Be]^=A[Be];Br(Re)}},Ft.prototype.toString=Ft.prototype.hex=function(){this.finalize();for(var A,Be=this.blockCount,Ue=this.s,Re=this.outputBlocks,Xe=this.extraBytes,tt=0,ht=0,Et="";ht<Re;){for(tt=0;tt<Be&&ht<Re;++tt,++ht)A=Ue[tt],Et+=it[A>>4&15]+it[15&A]+it[A>>12&15]+it[A>>8&15]+it[A>>20&15]+it[A>>16&15]+it[A>>28&15]+it[A>>24&15];ht%Be==0&&(Br(Ue),tt=0)}return Xe&&(A=Ue[tt],Et+=it[A>>4&15]+it[15&A],Xe>1&&(Et+=it[A>>12&15]+it[A>>8&15]),Xe>2&&(Et+=it[A>>20&15]+it[A>>16&15])),Et},Ft.prototype.arrayBuffer=function(){this.finalize();var A,Be=this.blockCount,Ue=this.s,Re=this.outputBlocks,Xe=this.extraBytes,tt=0,ht=0,Et=this.outputBits>>3;A=Xe?new ArrayBuffer(Re+1<<2):new ArrayBuffer(Et);for(var Gt=new Uint32Array(A);ht<Re;){for(tt=0;tt<Be&&ht<Re;++tt,++ht)Gt[ht]=Ue[tt];ht%Be==0&&Br(Ue)}return Xe&&(Gt[tt]=Ue[tt],A=A.slice(0,Et)),A},Ft.prototype.buffer=Ft.prototype.arrayBuffer,Ft.prototype.digest=Ft.prototype.array=function(){this.finalize();for(var A,Be,Ue=this.blockCount,Re=this.s,Xe=this.outputBlocks,tt=this.extraBytes,ht=0,Et=0,Gt=[];Et<Xe;){for(ht=0;ht<Ue&&Et<Xe;++ht,++Et)A=Et<<2,Be=Re[ht],Gt[A]=255&Be,Gt[A+1]=Be>>8&255,Gt[A+2]=Be>>16&255,Gt[A+3]=Be>>24&255;Et%Ue==0&&Br(Re)}return tt&&(A=Et<<2,Be=Re[ht],Gt[A]=255&Be,tt>1&&(Gt[A+1]=Be>>8&255),tt>2&&(Gt[A+2]=Be>>16&255)),Gt},Kr.prototype=new Ft,Kr.prototype.finalize=function(){return this.encode(this.outputBits,!0),Ft.prototype.finalize.call(this)};var Br=function(A){var Be,Ue,Re,Xe,tt,ht,Et,Gt,lr,br,Ur,Ar,Ve,Fr,zr,qr,mr,wr,z,re,le,we,he,ge,_e,me,$e,Pe,Se,je,lt,mt,It,Kt,Yt,Tt,Mt,or,Dr,Vr,Hr,_r,Or,gr,dr,Jt,Xr,en,tn,rn,nn,an,sn,on,cn,dn,un,ln,fn,hn,pn,mn,gn;for(Re=0;Re<48;Re+=2)Xe=A[0]^A[10]^A[20]^A[30]^A[40],tt=A[1]^A[11]^A[21]^A[31]^A[41],ht=A[2]^A[12]^A[22]^A[32]^A[42],Et=A[3]^A[13]^A[23]^A[33]^A[43],Gt=A[4]^A[14]^A[24]^A[34]^A[44],lr=A[5]^A[15]^A[25]^A[35]^A[45],br=A[6]^A[16]^A[26]^A[36]^A[46],Ur=A[7]^A[17]^A[27]^A[37]^A[47],Be=(Ar=A[8]^A[18]^A[28]^A[38]^A[48])^(ht<<1|Et>>>31),Ue=(Ve=A[9]^A[19]^A[29]^A[39]^A[49])^(Et<<1|ht>>>31),A[0]^=Be,A[1]^=Ue,A[10]^=Be,A[11]^=Ue,A[20]^=Be,A[21]^=Ue,A[30]^=Be,A[31]^=Ue,A[40]^=Be,A[41]^=Ue,Be=Xe^(Gt<<1|lr>>>31),Ue=tt^(lr<<1|Gt>>>31),A[2]^=Be,A[3]^=Ue,A[12]^=Be,A[13]^=Ue,A[22]^=Be,A[23]^=Ue,A[32]^=Be,A[33]^=Ue,A[42]^=Be,A[43]^=Ue,Be=ht^(br<<1|Ur>>>31),Ue=Et^(Ur<<1|br>>>31),A[4]^=Be,A[5]^=Ue,A[14]^=Be,A[15]^=Ue,A[24]^=Be,A[25]^=Ue,A[34]^=Be,A[35]^=Ue,A[44]^=Be,A[45]^=Ue,Be=Gt^(Ar<<1|Ve>>>31),Ue=lr^(Ve<<1|Ar>>>31),A[6]^=Be,A[7]^=Ue,A[16]^=Be,A[17]^=Ue,A[26]^=Be,A[27]^=Ue,A[36]^=Be,A[37]^=Ue,A[46]^=Be,A[47]^=Ue,Be=br^(Xe<<1|tt>>>31),Ue=Ur^(tt<<1|Xe>>>31),A[8]^=Be,A[9]^=Ue,A[18]^=Be,A[19]^=Ue,A[28]^=Be,A[29]^=Ue,A[38]^=Be,A[39]^=Ue,A[48]^=Be,A[49]^=Ue,Fr=A[0],zr=A[1],Jt=A[11]<<4|A[10]>>>28,Xr=A[10]<<4|A[11]>>>28,Pe=A[20]<<3|A[21]>>>29,Se=A[21]<<3|A[20]>>>29,hn=A[31]<<9|A[30]>>>23,pn=A[30]<<9|A[31]>>>23,_r=A[40]<<18|A[41]>>>14,Or=A[41]<<18|A[40]>>>14,Kt=A[2]<<1|A[3]>>>31,Yt=A[3]<<1|A[2]>>>31,qr=A[13]<<12|A[12]>>>20,mr=A[12]<<12|A[13]>>>20,en=A[22]<<10|A[23]>>>22,tn=A[23]<<10|A[22]>>>22,je=A[33]<<13|A[32]>>>19,lt=A[32]<<13|A[33]>>>19,mn=A[42]<<2|A[43]>>>30,gn=A[43]<<2|A[42]>>>30,on=A[5]<<30|A[4]>>>2,cn=A[4]<<30|A[5]>>>2,Tt=A[14]<<6|A[15]>>>26,Mt=A[15]<<6|A[14]>>>26,wr=A[25]<<11|A[24]>>>21,z=A[24]<<11|A[25]>>>21,rn=A[34]<<15|A[35]>>>17,nn=A[35]<<15|A[34]>>>17,mt=A[45]<<29|A[44]>>>3,It=A[44]<<29|A[45]>>>3,ge=A[6]<<28|A[7]>>>4,_e=A[7]<<28|A[6]>>>4,dn=A[17]<<23|A[16]>>>9,un=A[16]<<23|A[17]>>>9,or=A[26]<<25|A[27]>>>7,Dr=A[27]<<25|A[26]>>>7,re=A[36]<<21|A[37]>>>11,le=A[37]<<21|A[36]>>>11,an=A[47]<<24|A[46]>>>8,sn=A[46]<<24|A[47]>>>8,gr=A[8]<<27|A[9]>>>5,dr=A[9]<<27|A[8]>>>5,me=A[18]<<20|A[19]>>>12,$e=A[19]<<20|A[18]>>>12,ln=A[29]<<7|A[28]>>>25,fn=A[28]<<7|A[29]>>>25,Vr=A[38]<<8|A[39]>>>24,Hr=A[39]<<8|A[38]>>>24,we=A[48]<<14|A[49]>>>18,he=A[49]<<14|A[48]>>>18,A[0]=Fr^~qr&wr,A[1]=zr^~mr&z,A[10]=ge^~me&Pe,A[11]=_e^~$e&Se,A[20]=Kt^~Tt&or,A[21]=Yt^~Mt&Dr,A[30]=gr^~Jt&en,A[31]=dr^~Xr&tn,A[40]=on^~dn&ln,A[41]=cn^~un&fn,A[2]=qr^~wr&re,A[3]=mr^~z&le,A[12]=me^~Pe&je,A[13]=$e^~Se&lt,A[22]=Tt^~or&Vr,A[23]=Mt^~Dr&Hr,A[32]=Jt^~en&rn,A[33]=Xr^~tn&nn,A[42]=dn^~ln&hn,A[43]=un^~fn&pn,A[4]=wr^~re&we,A[5]=z^~le&he,A[14]=Pe^~je&mt,A[15]=Se^~lt&It,A[24]=or^~Vr&_r,A[25]=Dr^~Hr&Or,A[34]=en^~rn&an,A[35]=tn^~nn&sn,A[44]=ln^~hn&mn,A[45]=fn^~pn&gn,A[6]=re^~we&Fr,A[7]=le^~he&zr,A[16]=je^~mt&ge,A[17]=lt^~It&_e,A[26]=Vr^~_r&Kt,A[27]=Hr^~Or&Yt,A[36]=rn^~an&gr,A[37]=nn^~sn&dr,A[46]=hn^~mn&on,A[47]=pn^~gn&cn,A[8]=we^~Fr&qr,A[9]=he^~zr&mr,A[18]=mt^~ge&me,A[19]=It^~_e&$e,A[28]=_r^~Kt&Tt,A[29]=Or^~Yt&Mt,A[38]=an^~gr&Jt,A[39]=sn^~dr&Xr,A[48]=mn^~on&dn,A[49]=gn^~cn&un,A[0]^=nr[Re],A[1]^=nr[Re+1]};if(ue)w.exports=xt;else for(Ht=0;Ht<Ct.length;++Ht)ne[Ct[Ht]]=xt[Ct[Ht]]})()});B.keccak_224,B.keccak224,B.keccak_256;var J=B.keccak256;B.keccak_384,B.keccak384,B.keccak_512,B.keccak512,B.sha3_224,B.sha3_256,B.sha3_384,B.sha3_512,B.shake_128,B.shake128,B.shake_256,B.shake256,B.cshake_128,B.cshake128,B.cshake_256,B.cshake256,B.kmac_128,B.kmac128,B.kmac_256,B.kmac256;var Y=a(function(w){(function(P){var D,ne=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,de=Math.ceil,ue=Math.floor,Ie="[BigNumber Error] ",it=Ie+"Number primitive has more than 15 significant digits: ",ft=1e14,Fe=14,nr=9007199254740991,ar=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],qt=1e7,Wt=1e9;function ir(_t){var xt=0|_t;return _t>0||_t===xt?xt:xt-1}function Xt(_t){for(var xt,Ct,Ht=1,Bt=_t.length,cr=_t[0]+"";Ht<Bt;){for(xt=_t[Ht++]+"",Ct=Fe-xt.length;Ct--;xt="0"+xt);cr+=xt}for(Bt=cr.length;cr.charCodeAt(--Bt)===48;);return cr.slice(0,Bt+1||1)}function fr(_t,xt){var Ct,Ht,Bt=_t.c,cr=xt.c,sr=_t.s,Pr=xt.s,Cr=_t.e,Ft=xt.e;if(!sr||!Pr)return null;if(Ct=Bt&&!Bt[0],Ht=cr&&!cr[0],Ct||Ht)return Ct?Ht?0:-Pr:sr;if(sr!=Pr)return sr;if(Ct=sr<0,Ht=Cr==Ft,!Bt||!cr)return Ht?0:!Bt^Ct?1:-1;if(!Ht)return Cr>Ft^Ct?1:-1;for(Pr=(Cr=Bt.length)<(Ft=cr.length)?Cr:Ft,sr=0;sr<Pr;sr++)if(Bt[sr]!=cr[sr])return Bt[sr]>cr[sr]^Ct?1:-1;return Cr==Ft?0:Cr>Ft^Ct?1:-1}function Dt(_t,xt,Ct,Ht){if(_t<xt||_t>Ct||_t!==ue(_t))throw Error(Ie+(Ht||"Argument")+(typeof _t=="number"?_t<xt||_t>Ct?" out of range: ":" not an integer: ":" not a primitive number: ")+String(_t))}function Jr(_t){var xt=_t.c.length-1;return ir(_t.e/Fe)==xt&&_t.c[xt]%2!=0}function Mr(_t,xt){return(_t.length>1?_t.charAt(0)+"."+_t.slice(1):_t)+(xt<0?"e":"e+")+xt}function kr(_t,xt,Ct){var Ht,Bt;if(xt<0){for(Bt=Ct+".";++xt;Bt+=Ct);_t=Bt+_t}else if(++xt>(Ht=_t.length)){for(Bt=Ct,xt-=Ht;--xt;Bt+=Ct);_t+=Bt}else xt<Ht&&(_t=_t.slice(0,xt)+"."+_t.slice(xt));return _t}(D=function _t(xt){var Ct,Ht,Bt,cr,sr,Pr,Cr,Ft,Kr,Br,A=Ve.prototype={constructor:Ve,toString:null,valueOf:null},Be=new Ve(1),Ue=20,Re=4,Xe=-7,tt=21,ht=-1e7,Et=1e7,Gt=!1,lr=1,br=0,Ur={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},Ar="0123456789abcdefghijklmnopqrstuvwxyz";function Ve(z,re){var le,we,he,ge,_e,me,$e,Pe,Se=this;if(!(Se instanceof Ve))return new Ve(z,re);if(re==null){if(z&&z._isBigNumber===!0)return Se.s=z.s,void(!z.c||z.e>Et?Se.c=Se.e=null:z.e<ht?Se.c=[Se.e=0]:(Se.e=z.e,Se.c=z.c.slice()));if((me=typeof z=="number")&&0*z==0){if(Se.s=1/z<0?(z=-z,-1):1,z===~~z){for(ge=0,_e=z;_e>=10;_e/=10,ge++);return void(ge>Et?Se.c=Se.e=null:(Se.e=ge,Se.c=[z]))}Pe=String(z)}else{if(!ne.test(Pe=String(z)))return Bt(Se,Pe,me);Se.s=Pe.charCodeAt(0)==45?(Pe=Pe.slice(1),-1):1}(ge=Pe.indexOf("."))>-1&&(Pe=Pe.replace(".","")),(_e=Pe.search(/e/i))>0?(ge<0&&(ge=_e),ge+=+Pe.slice(_e+1),Pe=Pe.substring(0,_e)):ge<0&&(ge=Pe.length)}else{if(Dt(re,2,Ar.length,"Base"),re==10)return mr(Se=new Ve(z),Ue+Se.e+1,Re);if(Pe=String(z),me=typeof z=="number"){if(0*z!=0)return Bt(Se,Pe,me,re);if(Se.s=1/z<0?(Pe=Pe.slice(1),-1):1,Ve.DEBUG&&Pe.replace(/^0\.0*|\./,"").length>15)throw Error(it+z)}else Se.s=Pe.charCodeAt(0)===45?(Pe=Pe.slice(1),-1):1;for(le=Ar.slice(0,re),ge=_e=0,$e=Pe.length;_e<$e;_e++)if(le.indexOf(we=Pe.charAt(_e))<0){if(we=="."){if(_e>ge){ge=$e;continue}}else if(!he&&(Pe==Pe.toUpperCase()&&(Pe=Pe.toLowerCase())||Pe==Pe.toLowerCase()&&(Pe=Pe.toUpperCase()))){he=!0,_e=-1,ge=0;continue}return Bt(Se,String(z),me,re)}me=!1,(ge=(Pe=Ht(Pe,re,10,Se.s)).indexOf("."))>-1?Pe=Pe.replace(".",""):ge=Pe.length}for(_e=0;Pe.charCodeAt(_e)===48;_e++);for($e=Pe.length;Pe.charCodeAt(--$e)===48;);if(Pe=Pe.slice(_e,++$e)){if($e-=_e,me&&Ve.DEBUG&&$e>15&&(z>nr||z!==ue(z)))throw Error(it+Se.s*z);if((ge=ge-_e-1)>Et)Se.c=Se.e=null;else if(ge<ht)Se.c=[Se.e=0];else{if(Se.e=ge,Se.c=[],_e=(ge+1)%Fe,ge<0&&(_e+=Fe),_e<$e){for(_e&&Se.c.push(+Pe.slice(0,_e)),$e-=Fe;_e<$e;)Se.c.push(+Pe.slice(_e,_e+=Fe));_e=Fe-(Pe=Pe.slice(_e)).length}else _e-=$e;for(;_e--;Pe+="0");Se.c.push(+Pe)}}else Se.c=[Se.e=0]}function Fr(z,re,le,we){var he,ge,_e,me,$e;if(le==null?le=Re:Dt(le,0,8),!z.c)return z.toString();if(he=z.c[0],_e=z.e,re==null)$e=Xt(z.c),$e=we==1||we==2&&(_e<=Xe||_e>=tt)?Mr($e,_e):kr($e,_e,"0");else if(ge=(z=mr(new Ve(z),re,le)).e,me=($e=Xt(z.c)).length,we==1||we==2&&(re<=ge||ge<=Xe)){for(;me<re;$e+="0",me++);$e=Mr($e,ge)}else if(re-=_e,$e=kr($e,ge,"0"),ge+1>me){if(--re>0)for($e+=".";re--;$e+="0");}else if((re+=ge-me)>0)for(ge+1==me&&($e+=".");re--;$e+="0");return z.s<0&&he?"-"+$e:$e}function zr(z,re){for(var le,we=1,he=new Ve(z[0]);we<z.length;we++){if(!(le=new Ve(z[we])).s){he=le;break}re.call(he,le)&&(he=le)}return he}function qr(z,re,le){for(var we=1,he=re.length;!re[--he];re.pop());for(he=re[0];he>=10;he/=10,we++);return(le=we+le*Fe-1)>Et?z.c=z.e=null:le<ht?z.c=[z.e=0]:(z.e=le,z.c=re),z}function mr(z,re,le,we){var he,ge,_e,me,$e,Pe,Se,je=z.c,lt=ar;if(je){e:{for(he=1,me=je[0];me>=10;me/=10,he++);if((ge=re-he)<0)ge+=Fe,_e=re,Se=($e=je[Pe=0])/lt[he-_e-1]%10|0;else if((Pe=de((ge+1)/Fe))>=je.length){if(!we)break e;for(;je.length<=Pe;je.push(0));$e=Se=0,he=1,_e=(ge%=Fe)-Fe+1}else{for($e=me=je[Pe],he=1;me>=10;me/=10,he++);Se=(_e=(ge%=Fe)-Fe+he)<0?0:$e/lt[he-_e-1]%10|0}if(we=we||re<0||je[Pe+1]!=null||(_e<0?$e:$e%lt[he-_e-1]),we=le<4?(Se||we)&&(le==0||le==(z.s<0?3:2)):Se>5||Se==5&&(le==4||we||le==6&&(ge>0?_e>0?$e/lt[he-_e]:0:je[Pe-1])%10&1||le==(z.s<0?8:7)),re<1||!je[0])return je.length=0,we?(re-=z.e+1,je[0]=lt[(Fe-re%Fe)%Fe],z.e=-re||0):je[0]=z.e=0,z;if(ge==0?(je.length=Pe,me=1,Pe--):(je.length=Pe+1,me=lt[Fe-ge],je[Pe]=_e>0?ue($e/lt[he-_e]%lt[_e])*me:0),we)for(;;){if(Pe==0){for(ge=1,_e=je[0];_e>=10;_e/=10,ge++);for(_e=je[0]+=me,me=1;_e>=10;_e/=10,me++);ge!=me&&(z.e++,je[0]==ft&&(je[0]=1));break}if(je[Pe]+=me,je[Pe]!=ft)break;je[Pe--]=0,me=1}for(ge=je.length;je[--ge]===0;je.pop());}z.e>Et?z.c=z.e=null:z.e<ht&&(z.c=[z.e=0])}return z}function wr(z){var re,le=z.e;return le===null?z.toString():(re=Xt(z.c),re=le<=Xe||le>=tt?Mr(re,le):kr(re,le,"0"),z.s<0?"-"+re:re)}return Ve.clone=_t,Ve.ROUND_UP=0,Ve.ROUND_DOWN=1,Ve.ROUND_CEIL=2,Ve.ROUND_FLOOR=3,Ve.ROUND_HALF_UP=4,Ve.ROUND_HALF_DOWN=5,Ve.ROUND_HALF_EVEN=6,Ve.ROUND_HALF_CEIL=7,Ve.ROUND_HALF_FLOOR=8,Ve.EUCLID=9,Ve.config=Ve.set=function(z){var re,le;if(z!=null){if(typeof z!="object")throw Error(Ie+"Object expected: "+z);if(z.hasOwnProperty(re="DECIMAL_PLACES")&&(Dt(le=z[re],0,Wt,re),Ue=le),z.hasOwnProperty(re="ROUNDING_MODE")&&(Dt(le=z[re],0,8,re),Re=le),z.hasOwnProperty(re="EXPONENTIAL_AT")&&((le=z[re])&&le.pop?(Dt(le[0],-Wt,0,re),Dt(le[1],0,Wt,re),Xe=le[0],tt=le[1]):(Dt(le,-Wt,Wt,re),Xe=-(tt=le<0?-le:le))),z.hasOwnProperty(re="RANGE"))if((le=z[re])&&le.pop)Dt(le[0],-Wt,-1,re),Dt(le[1],1,Wt,re),ht=le[0],Et=le[1];else{if(Dt(le,-Wt,Wt,re),!le)throw Error(Ie+re+" cannot be zero: "+le);ht=-(Et=le<0?-le:le)}if(z.hasOwnProperty(re="CRYPTO")){if((le=z[re])!==!!le)throw Error(Ie+re+" not true or false: "+le);if(le){if(typeof crypto>"u"||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw Gt=!le,Error(Ie+"crypto unavailable");Gt=le}else Gt=le}if(z.hasOwnProperty(re="MODULO_MODE")&&(Dt(le=z[re],0,9,re),lr=le),z.hasOwnProperty(re="POW_PRECISION")&&(Dt(le=z[re],0,Wt,re),br=le),z.hasOwnProperty(re="FORMAT")){if(typeof(le=z[re])!="object")throw Error(Ie+re+" not an object: "+le);Ur=le}if(z.hasOwnProperty(re="ALPHABET")){if(typeof(le=z[re])!="string"||/^.?$|[+\-.\s]|(.).*\1/.test(le))throw Error(Ie+re+" invalid: "+le);Ar=le}}return{DECIMAL_PLACES:Ue,ROUNDING_MODE:Re,EXPONENTIAL_AT:[Xe,tt],RANGE:[ht,Et],CRYPTO:Gt,MODULO_MODE:lr,POW_PRECISION:br,FORMAT:Ur,ALPHABET:Ar}},Ve.isBigNumber=function(z){if(!z||z._isBigNumber!==!0)return!1;if(!Ve.DEBUG)return!0;var re,le,we=z.c,he=z.e,ge=z.s;e:if({}.toString.call(we)=="[object Array]"){if((ge===1||ge===-1)&&he>=-Wt&&he<=Wt&&he===ue(he)){if(we[0]===0){if(he===0&&we.length===1)return!0;break e}if((re=(he+1)%Fe)<1&&(re+=Fe),String(we[0]).length==re){for(re=0;re<we.length;re++)if((le=we[re])<0||le>=ft||le!==ue(le))break e;if(le!==0)return!0}}}else if(we===null&&he===null&&(ge===null||ge===1||ge===-1))return!0;throw Error(Ie+"Invalid BigNumber: "+z)},Ve.maximum=Ve.max=function(){return zr(arguments,A.lt)},Ve.minimum=Ve.min=function(){return zr(arguments,A.gt)},Ve.random=(cr=9007199254740992,sr=Math.random()*cr&2097151?function(){return ue(Math.random()*cr)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(z){var re,le,we,he,ge,_e=0,me=[],$e=new Ve(Be);if(z==null?z=Ue:Dt(z,0,Wt),he=de(z/Fe),Gt)if(crypto.getRandomValues){for(re=crypto.getRandomValues(new Uint32Array(he*=2));_e<he;)(ge=131072*re[_e]+(re[_e+1]>>>11))>=9e15?(le=crypto.getRandomValues(new Uint32Array(2)),re[_e]=le[0],re[_e+1]=le[1]):(me.push(ge%1e14),_e+=2);_e=he/2}else{if(!crypto.randomBytes)throw Gt=!1,Error(Ie+"crypto unavailable");for(re=crypto.randomBytes(he*=7);_e<he;)(ge=281474976710656*(31&re[_e])+1099511627776*re[_e+1]+4294967296*re[_e+2]+16777216*re[_e+3]+(re[_e+4]<<16)+(re[_e+5]<<8)+re[_e+6])>=9e15?crypto.randomBytes(7).copy(re,_e):(me.push(ge%1e14),_e+=7);_e=he/7}if(!Gt)for(;_e<he;)(ge=sr())<9e15&&(me[_e++]=ge%1e14);for(he=me[--_e],z%=Fe,he&&z&&(ge=ar[Fe-z],me[_e]=ue(he/ge)*ge);me[_e]===0;me.pop(),_e--);if(_e<0)me=[we=0];else{for(we=-1;me[0]===0;me.splice(0,1),we-=Fe);for(_e=1,ge=me[0];ge>=10;ge/=10,_e++);_e<Fe&&(we-=Fe-_e)}return $e.e=we,$e.c=me,$e}),Ve.sum=function(){for(var z=1,re=arguments,le=new Ve(re[0]);z<re.length;)le=le.plus(re[z++]);return le},Ht=function(){var z="0123456789";function re(le,we,he,ge){for(var _e,me,$e=[0],Pe=0,Se=le.length;Pe<Se;){for(me=$e.length;me--;$e[me]*=we);for($e[0]+=ge.indexOf(le.charAt(Pe++)),_e=0;_e<$e.length;_e++)$e[_e]>he-1&&($e[_e+1]==null&&($e[_e+1]=0),$e[_e+1]+=$e[_e]/he|0,$e[_e]%=he)}return $e.reverse()}return function(le,we,he,ge,_e){var me,$e,Pe,Se,je,lt,mt,It,Kt=le.indexOf("."),Yt=Ue,Tt=Re;for(Kt>=0&&(Se=br,br=0,le=le.replace(".",""),lt=(It=new Ve(we)).pow(le.length-Kt),br=Se,It.c=re(kr(Xt(lt.c),lt.e,"0"),10,he,z),It.e=It.c.length),Pe=Se=(mt=re(le,we,he,_e?(me=Ar,z):(me=z,Ar))).length;mt[--Se]==0;mt.pop());if(!mt[0])return me.charAt(0);if(Kt<0?--Pe:(lt.c=mt,lt.e=Pe,lt.s=ge,mt=(lt=Ct(lt,It,Yt,Tt,he)).c,je=lt.r,Pe=lt.e),Kt=mt[$e=Pe+Yt+1],Se=he/2,je=je||$e<0||mt[$e+1]!=null,je=Tt<4?(Kt!=null||je)&&(Tt==0||Tt==(lt.s<0?3:2)):Kt>Se||Kt==Se&&(Tt==4||je||Tt==6&&1&mt[$e-1]||Tt==(lt.s<0?8:7)),$e<1||!mt[0])le=je?kr(me.charAt(1),-Yt,me.charAt(0)):me.charAt(0);else{if(mt.length=$e,je)for(--he;++mt[--$e]>he;)mt[$e]=0,$e||(++Pe,mt=[1].concat(mt));for(Se=mt.length;!mt[--Se];);for(Kt=0,le="";Kt<=Se;le+=me.charAt(mt[Kt++]));le=kr(le,Pe,me.charAt(0))}return le}}(),Ct=function(){function z(we,he,ge){var _e,me,$e,Pe,Se=0,je=we.length,lt=he%qt,mt=he/qt|0;for(we=we.slice();je--;)Se=((me=lt*($e=we[je]%qt)+(_e=mt*$e+(Pe=we[je]/qt|0)*lt)%qt*qt+Se)/ge|0)+(_e/qt|0)+mt*Pe,we[je]=me%ge;return Se&&(we=[Se].concat(we)),we}function re(we,he,ge,_e){var me,$e;if(ge!=_e)$e=ge>_e?1:-1;else for(me=$e=0;me<ge;me++)if(we[me]!=he[me]){$e=we[me]>he[me]?1:-1;break}return $e}function le(we,he,ge,_e){for(var me=0;ge--;)we[ge]-=me,me=we[ge]<he[ge]?1:0,we[ge]=me*_e+we[ge]-he[ge];for(;!we[0]&&we.length>1;we.splice(0,1));}return function(we,he,ge,_e,me){var $e,Pe,Se,je,lt,mt,It,Kt,Yt,Tt,Mt,or,Dr,Vr,Hr,_r,Or,gr=we.s==he.s?1:-1,dr=we.c,Jt=he.c;if(!(dr&&dr[0]&&Jt&&Jt[0]))return new Ve(we.s&&he.s&&(dr?!Jt||dr[0]!=Jt[0]:Jt)?dr&&dr[0]==0||!Jt?0*gr:gr/0:NaN);for(Yt=(Kt=new Ve(gr)).c=[],gr=ge+(Pe=we.e-he.e)+1,me||(me=ft,Pe=ir(we.e/Fe)-ir(he.e/Fe),gr=gr/Fe|0),Se=0;Jt[Se]==(dr[Se]||0);Se++);if(Jt[Se]>(dr[Se]||0)&&Pe--,gr<0)Yt.push(1),je=!0;else{for(Vr=dr.length,_r=Jt.length,Se=0,gr+=2,(lt=ue(me/(Jt[0]+1)))>1&&(Jt=z(Jt,lt,me),dr=z(dr,lt,me),_r=Jt.length,Vr=dr.length),Dr=_r,Mt=(Tt=dr.slice(0,_r)).length;Mt<_r;Tt[Mt++]=0);Or=Jt.slice(),Or=[0].concat(Or),Hr=Jt[0],Jt[1]>=me/2&&Hr++;do{if(lt=0,($e=re(Jt,Tt,_r,Mt))<0){if(or=Tt[0],_r!=Mt&&(or=or*me+(Tt[1]||0)),(lt=ue(or/Hr))>1)for(lt>=me&&(lt=me-1),It=(mt=z(Jt,lt,me)).length,Mt=Tt.length;re(mt,Tt,It,Mt)==1;)lt--,le(mt,_r<It?Or:Jt,It,me),It=mt.length,$e=1;else lt==0&&($e=lt=1),It=(mt=Jt.slice()).length;if(It<Mt&&(mt=[0].concat(mt)),le(Tt,mt,Mt,me),Mt=Tt.length,$e==-1)for(;re(Jt,Tt,_r,Mt)<1;)lt++,le(Tt,_r<Mt?Or:Jt,Mt,me),Mt=Tt.length}else $e===0&&(lt++,Tt=[0]);Yt[Se++]=lt,Tt[0]?Tt[Mt++]=dr[Dr]||0:(Tt=[dr[Dr]],Mt=1)}while((Dr++<Vr||Tt[0]!=null)&&gr--);je=Tt[0]!=null,Yt[0]||Yt.splice(0,1)}if(me==ft){for(Se=1,gr=Yt[0];gr>=10;gr/=10,Se++);mr(Kt,ge+(Kt.e=Se+Pe*Fe-1)+1,_e,je)}else Kt.e=Pe,Kt.r=+je;return Kt}}(),Pr=/^(-?)0([xbo])(?=\w[\w.]*$)/i,Cr=/^([^.]+)\.$/,Ft=/^\.([^.]+)$/,Kr=/^-?(Infinity|NaN)$/,Br=/^\s*\+(?=[\w.])|^\s+|\s+$/g,Bt=function(z,re,le,we){var he,ge=le?re:re.replace(Br,"");if(Kr.test(ge))z.s=isNaN(ge)?null:ge<0?-1:1;else{if(!le&&(ge=ge.replace(Pr,function(_e,me,$e){return he=($e=$e.toLowerCase())=="x"?16:$e=="b"?2:8,we&&we!=he?_e:me}),we&&(he=we,ge=ge.replace(Cr,"$1").replace(Ft,"0.$1")),re!=ge))return new Ve(ge,he);if(Ve.DEBUG)throw Error(Ie+"Not a"+(we?" base "+we:"")+" number: "+re);z.s=null}z.c=z.e=null},A.absoluteValue=A.abs=function(){var z=new Ve(this);return z.s<0&&(z.s=1),z},A.comparedTo=function(z,re){return fr(this,new Ve(z,re))},A.decimalPlaces=A.dp=function(z,re){var le,we,he,ge=this;if(z!=null)return Dt(z,0,Wt),re==null?re=Re:Dt(re,0,8),mr(new Ve(ge),z+ge.e+1,re);if(!(le=ge.c))return null;if(we=((he=le.length-1)-ir(this.e/Fe))*Fe,he=le[he])for(;he%10==0;he/=10,we--);return we<0&&(we=0),we},A.dividedBy=A.div=function(z,re){return Ct(this,new Ve(z,re),Ue,Re)},A.dividedToIntegerBy=A.idiv=function(z,re){return Ct(this,new Ve(z,re),0,1)},A.exponentiatedBy=A.pow=function(z,re){var le,we,he,ge,_e,me,$e,Pe,Se=this;if((z=new Ve(z)).c&&!z.isInteger())throw Error(Ie+"Exponent not an integer: "+wr(z));if(re!=null&&(re=new Ve(re)),_e=z.e>14,!Se.c||!Se.c[0]||Se.c[0]==1&&!Se.e&&Se.c.length==1||!z.c||!z.c[0])return Pe=new Ve(Math.pow(+wr(Se),_e?2-Jr(z):+wr(z))),re?Pe.mod(re):Pe;if(me=z.s<0,re){if(re.c?!re.c[0]:!re.s)return new Ve(NaN);(we=!me&&Se.isInteger()&&re.isInteger())&&(Se=Se.mod(re))}else{if(z.e>9&&(Se.e>0||Se.e<-1||(Se.e==0?Se.c[0]>1||_e&&Se.c[1]>=24e7:Se.c[0]<8e13||_e&&Se.c[0]<=9999975e7)))return ge=Se.s<0&&Jr(z)?-0:0,Se.e>-1&&(ge=1/ge),new Ve(me?1/ge:ge);br&&(ge=de(br/Fe+2))}for(_e?(le=new Ve(.5),me&&(z.s=1),$e=Jr(z)):$e=(he=Math.abs(+wr(z)))%2,Pe=new Ve(Be);;){if($e){if(!(Pe=Pe.times(Se)).c)break;ge?Pe.c.length>ge&&(Pe.c.length=ge):we&&(Pe=Pe.mod(re))}if(he){if((he=ue(he/2))===0)break;$e=he%2}else if(mr(z=z.times(le),z.e+1,1),z.e>14)$e=Jr(z);else{if((he=+wr(z))==0)break;$e=he%2}Se=Se.times(Se),ge?Se.c&&Se.c.length>ge&&(Se.c.length=ge):we&&(Se=Se.mod(re))}return we?Pe:(me&&(Pe=Be.div(Pe)),re?Pe.mod(re):ge?mr(Pe,br,Re,void 0):Pe)},A.integerValue=function(z){var re=new Ve(this);return z==null?z=Re:Dt(z,0,8),mr(re,re.e+1,z)},A.isEqualTo=A.eq=function(z,re){return fr(this,new Ve(z,re))===0},A.isFinite=function(){return!!this.c},A.isGreaterThan=A.gt=function(z,re){return fr(this,new Ve(z,re))>0},A.isGreaterThanOrEqualTo=A.gte=function(z,re){return(re=fr(this,new Ve(z,re)))===1||re===0},A.isInteger=function(){return!!this.c&&ir(this.e/Fe)>this.c.length-2},A.isLessThan=A.lt=function(z,re){return fr(this,new Ve(z,re))<0},A.isLessThanOrEqualTo=A.lte=function(z,re){return(re=fr(this,new Ve(z,re)))===-1||re===0},A.isNaN=function(){return!this.s},A.isNegative=function(){return this.s<0},A.isPositive=function(){return this.s>0},A.isZero=function(){return!!this.c&&this.c[0]==0},A.minus=function(z,re){var le,we,he,ge,_e=this,me=_e.s;if(re=(z=new Ve(z,re)).s,!me||!re)return new Ve(NaN);if(me!=re)return z.s=-re,_e.plus(z);var $e=_e.e/Fe,Pe=z.e/Fe,Se=_e.c,je=z.c;if(!$e||!Pe){if(!Se||!je)return Se?(z.s=-re,z):new Ve(je?_e:NaN);if(!Se[0]||!je[0])return je[0]?(z.s=-re,z):new Ve(Se[0]?_e:Re==3?-0:0)}if($e=ir($e),Pe=ir(Pe),Se=Se.slice(),me=$e-Pe){for((ge=me<0)?(me=-me,he=Se):(Pe=$e,he=je),he.reverse(),re=me;re--;he.push(0));he.reverse()}else for(we=(ge=(me=Se.length)<(re=je.length))?me:re,me=re=0;re<we;re++)if(Se[re]!=je[re]){ge=Se[re]<je[re];break}if(ge&&(he=Se,Se=je,je=he,z.s=-z.s),(re=(we=je.length)-(le=Se.length))>0)for(;re--;Se[le++]=0);for(re=ft-1;we>me;){if(Se[--we]<je[we]){for(le=we;le&&!Se[--le];Se[le]=re);--Se[le],Se[we]+=ft}Se[we]-=je[we]}for(;Se[0]==0;Se.splice(0,1),--Pe);return Se[0]?qr(z,Se,Pe):(z.s=Re==3?-1:1,z.c=[z.e=0],z)},A.modulo=A.mod=function(z,re){var le,we,he=this;return z=new Ve(z,re),!he.c||!z.s||z.c&&!z.c[0]?new Ve(NaN):!z.c||he.c&&!he.c[0]?new Ve(he):(lr==9?(we=z.s,z.s=1,le=Ct(he,z,0,3),z.s=we,le.s*=we):le=Ct(he,z,0,lr),(z=he.minus(le.times(z))).c[0]||lr!=1||(z.s=he.s),z)},A.multipliedBy=A.times=function(z,re){var le,we,he,ge,_e,me,$e,Pe,Se,je,lt,mt,It,Kt,Yt,Tt=this,Mt=Tt.c,or=(z=new Ve(z,re)).c;if(!(Mt&&or&&Mt[0]&&or[0]))return!Tt.s||!z.s||Mt&&!Mt[0]&&!or||or&&!or[0]&&!Mt?z.c=z.e=z.s=null:(z.s*=Tt.s,Mt&&or?(z.c=[0],z.e=0):z.c=z.e=null),z;for(we=ir(Tt.e/Fe)+ir(z.e/Fe),z.s*=Tt.s,($e=Mt.length)<(je=or.length)&&(It=Mt,Mt=or,or=It,he=$e,$e=je,je=he),he=$e+je,It=[];he--;It.push(0));for(Kt=ft,Yt=qt,he=je;--he>=0;){for(le=0,lt=or[he]%Yt,mt=or[he]/Yt|0,ge=he+(_e=$e);ge>he;)le=((Pe=lt*(Pe=Mt[--_e]%Yt)+(me=mt*Pe+(Se=Mt[_e]/Yt|0)*lt)%Yt*Yt+It[ge]+le)/Kt|0)+(me/Yt|0)+mt*Se,It[ge--]=Pe%Kt;It[ge]=le}return le?++we:It.splice(0,1),qr(z,It,we)},A.negated=function(){var z=new Ve(this);return z.s=-z.s||null,z},A.plus=function(z,re){var le,we=this,he=we.s;if(re=(z=new Ve(z,re)).s,!he||!re)return new Ve(NaN);if(he!=re)return z.s=-re,we.minus(z);var ge=we.e/Fe,_e=z.e/Fe,me=we.c,$e=z.c;if(!ge||!_e){if(!me||!$e)return new Ve(he/0);if(!me[0]||!$e[0])return $e[0]?z:new Ve(me[0]?we:0*he)}if(ge=ir(ge),_e=ir(_e),me=me.slice(),he=ge-_e){for(he>0?(_e=ge,le=$e):(he=-he,le=me),le.reverse();he--;le.push(0));le.reverse()}for((he=me.length)-(re=$e.length)<0&&(le=$e,$e=me,me=le,re=he),he=0;re;)he=(me[--re]=me[re]+$e[re]+he)/ft|0,me[re]=ft===me[re]?0:me[re]%ft;return he&&(me=[he].concat(me),++_e),qr(z,me,_e)},A.precision=A.sd=function(z,re){var le,we,he,ge=this;if(z!=null&&z!==!!z)return Dt(z,1,Wt),re==null?re=Re:Dt(re,0,8),mr(new Ve(ge),z,re);if(!(le=ge.c))return null;if(we=(he=le.length-1)*Fe+1,he=le[he]){for(;he%10==0;he/=10,we--);for(he=le[0];he>=10;he/=10,we++);}return z&&ge.e+1>we&&(we=ge.e+1),we},A.shiftedBy=function(z){return Dt(z,-9007199254740991,nr),this.times("1e"+z)},A.squareRoot=A.sqrt=function(){var z,re,le,we,he,ge=this,_e=ge.c,me=ge.s,$e=ge.e,Pe=Ue+4,Se=new Ve("0.5");if(me!==1||!_e||!_e[0])return new Ve(!me||me<0&&(!_e||_e[0])?NaN:_e?ge:1/0);if((me=Math.sqrt(+wr(ge)))==0||me==1/0?(((re=Xt(_e)).length+$e)%2==0&&(re+="0"),me=Math.sqrt(+re),$e=ir(($e+1)/2)-($e<0||$e%2),le=new Ve(re=me==1/0?"5e"+$e:(re=me.toExponential()).slice(0,re.indexOf("e")+1)+$e)):le=new Ve(me+""),le.c[0]){for((me=($e=le.e)+Pe)<3&&(me=0);;)if(he=le,le=Se.times(he.plus(Ct(ge,he,Pe,1))),Xt(he.c).slice(0,me)===(re=Xt(le.c)).slice(0,me)){if(le.e<$e&&--me,(re=re.slice(me-3,me+1))!="9999"&&(we||re!="4999")){+re&&(+re.slice(1)||re.charAt(0)!="5")||(mr(le,le.e+Ue+2,1),z=!le.times(le).eq(ge));break}if(!we&&(mr(he,he.e+Ue+2,0),he.times(he).eq(ge))){le=he;break}Pe+=4,me+=4,we=1}}return mr(le,le.e+Ue+1,Re,z)},A.toExponential=function(z,re){return z!=null&&(Dt(z,0,Wt),z++),Fr(this,z,re,1)},A.toFixed=function(z,re){return z!=null&&(Dt(z,0,Wt),z=z+this.e+1),Fr(this,z,re)},A.toFormat=function(z,re,le){var we,he=this;if(le==null)z!=null&&re&&typeof re=="object"?(le=re,re=null):z&&typeof z=="object"?(le=z,z=re=null):le=Ur;else if(typeof le!="object")throw Error(Ie+"Argument not an object: "+le);if(we=he.toFixed(z,re),he.c){var ge,_e=we.split("."),me=+le.groupSize,$e=+le.secondaryGroupSize,Pe=le.groupSeparator||"",Se=_e[0],je=_e[1],lt=he.s<0,mt=lt?Se.slice(1):Se,It=mt.length;if($e&&(ge=me,me=$e,$e=ge,It-=ge),me>0&&It>0){for(ge=It%me||me,Se=mt.substr(0,ge);ge<It;ge+=me)Se+=Pe+mt.substr(ge,me);$e>0&&(Se+=Pe+mt.slice(ge)),lt&&(Se="-"+Se)}we=je?Se+(le.decimalSeparator||"")+(($e=+le.fractionGroupSize)?je.replace(new RegExp("\\d{"+$e+"}\\B","g"),"$&"+(le.fractionGroupSeparator||"")):je):Se}return(le.prefix||"")+we+(le.suffix||"")},A.toFraction=function(z){var re,le,we,he,ge,_e,me,$e,Pe,Se,je,lt,mt=this,It=mt.c;if(z!=null&&(!(me=new Ve(z)).isInteger()&&(me.c||me.s!==1)||me.lt(Be)))throw Error(Ie+"Argument "+(me.isInteger()?"out of range: ":"not an integer: ")+wr(me));if(!It)return new Ve(mt);for(re=new Ve(Be),Pe=le=new Ve(Be),we=$e=new Ve(Be),lt=Xt(It),ge=re.e=lt.length-mt.e-1,re.c[0]=ar[(_e=ge%Fe)<0?Fe+_e:_e],z=!z||me.comparedTo(re)>0?ge>0?re:Pe:me,_e=Et,Et=1/0,me=new Ve(lt),$e.c[0]=0;Se=Ct(me,re,0,1),(he=le.plus(Se.times(we))).comparedTo(z)!=1;)le=we,we=he,Pe=$e.plus(Se.times(he=Pe)),$e=he,re=me.minus(Se.times(he=re)),me=he;return he=Ct(z.minus(le),we,0,1),$e=$e.plus(he.times(Pe)),le=le.plus(he.times(we)),$e.s=Pe.s=mt.s,je=Ct(Pe,we,ge*=2,Re).minus(mt).abs().comparedTo(Ct($e,le,ge,Re).minus(mt).abs())<1?[Pe,we]:[$e,le],Et=_e,je},A.toNumber=function(){return+wr(this)},A.toPrecision=function(z,re){return z!=null&&Dt(z,1,Wt),Fr(this,z,re,2)},A.toString=function(z){var re,le=this,we=le.s,he=le.e;return he===null?we?(re="Infinity",we<0&&(re="-"+re)):re="NaN":(z==null?re=he<=Xe||he>=tt?Mr(Xt(le.c),he):kr(Xt(le.c),he,"0"):z===10?re=kr(Xt((le=mr(new Ve(le),Ue+he+1,Re)).c),le.e,"0"):(Dt(z,2,Ar.length,"Base"),re=Ht(kr(Xt(le.c),he,"0"),10,z,we,!0)),we<0&&le.c[0]&&(re="-"+re)),re},A.valueOf=A.toJSON=function(){return wr(this)},A._isBigNumber=!0,xt!=null&&Ve.set(xt),Ve}()).default=D.BigNumber=D,w.exports?w.exports=D:(P||(P=typeof self<"u"&&self?self:window),P.BigNumber=D)})(this)}).BigNumber;const H={ROUNDING_MODE:Y.ROUND_DOWN};function _(w){return new TextEncoder().encode(w)}function m(w){return typeof w=="string"?m(g(w)):new TextDecoder().decode(w)}Y.config(H);const b="INVALID_ARGUMENT";function $(w,P="UNKNOWN_ERROR",D={}){let ne=[];Object.keys(D).forEach(Ie=>{try{ne.push(Ie+"="+JSON.stringify(D[Ie]))}catch{ne.push(Ie+"="+JSON.stringify(D[Ie].toString()))}});let de=w;ne.length&&(w+=" ("+ne.join(", ")+")");let ue=new Error(w);return ue.reason=de,ue.code=P,Object.keys(D).forEach(function(Ie){ue[Ie]=D[Ie]}),ue}function g(w){if(typeof w!="string")throw new Error("hexToBytes only accept strings, got: "+typeof w);if(w.substr(0,2)==="0x")return g(w.substr(2));const P=new Uint8Array(Math.ceil(w.length/2));let D=0;for(let ne=0;ne<w.length;ne+=2){const de=parseInt(w.substr(ne,2),16);if(isNaN(de))throw new Error("Cannot read hex string:"+JSON.stringify(w));P[D]=de,D++}return P}function O(w){return Array.from(w).map(P=>P.toString(16).padStart(2,"0")).join("")}function te(w,P){if(typeof w=="string"){if(P&&P.encoding==="hex"&&typeof w=="string"){let D=w;D.length>2&&D.substr(0,2)==="0x"&&(D=D.substr(2));const ne=g(D);return J(ne)}return J(_(w))}return J(w)}let Z={noether:"0",wei:"1",kwei:"1000",Kwei:"1000",babbage:"1000",femtoether:"1000",mwei:"1000000",Mwei:"1000000",lovelace:"1000000",picoether:"1000000",gwei:"1000000000",Gwei:"1000000000",shannon:"1000000000",nanoether:"1000000000",nano:"1000000000",szabo:"1000000000000",microether:"1000000000000",micro:"1000000000000",finney:"1000000000000000",milliether:"1000000000000000",milli:"1000000000000000",ether:"1000000000000000000",kether:"1000000000000000000000",grand:"1000000000000000000000",mether:"1000000000000000000000000",gether:"1000000000000000000000000000",tether:"1000000000000000000000000000000"};function ae(w,P,D){return new Array(P-w.length+1).join(D||"0")+w}function be(w){return Pt(w)&&w.name&&w.name.indexOf("(")!==-1?w.name:w.name+"("+Ae(!1,w.inputs||[]).join(",")+")"}function ke(...w){const P=w.reduce((de,ue)=>de+ue.length,0);var D=new Uint8Array(P);let ne=0;for(let de of w)D.set(de,ne),ne+=de.length;return D}function Ae(w,P){const D=[];return P.forEach(function(ne){if(typeof ne.components=="object"){if(ne.type.substring(0,5)!=="tuple")throw new Error("components found but type is not tuple; report on GitHub");var de="",ue=ne.type.indexOf("[");ue>=0&&(de=ne.type.substring(ue));var Ie=Ae(w,ne.components);tr(Ie)&&w?D.push("tuple("+Ie.join(",")+")"+de):w?D.push("("+Ie+")"):D.push("("+Ie.join(",")+")"+de)}else D.push(ne.type)}),D}function dt(w){let P=w.indexOf("("),D=w.indexOf(")");return P!==-1&&D!==-1?w.substr(0,P):w}function qe(w){let P=w.indexOf("("),D=w.indexOf(")");return P!==-1&&D!==-1?w.substr(P+1,D-P-1).replace(" ",""):""}function et(w){return w==null?w:ze(w).toNumber()}function Ke(w){return ze(w).toNumber()}function gt(w){return kt(w)?w.toString(10):""+w}function at(w){return typeof w=="string"&&!w.startsWith("0x")&&/^[A-Za-z0-9]+$/.test(w)?"0x"+w:Qe(w)}function Lt(w){if(typeof w=="string")return w.startsWith("0x")&&/^[A-Za-z0-9]+$/.test(w)?Qe(w):"0x"+O(_(w));if(w instanceof Uint8Array)return"0x"+O(w);throw new Error(`toStringData: Error trying to convert ${w} (${typeof w}) to a hex string.`)}function Ge(w){return typeof w=="boolean"?w:ze(w).toNumber()!==0}function st(w){let P=ze(w),D=P.toString(16);return P.isLessThan(0)?"-0x"+D.substr(1):"0x"+D}function Qe(w){if(Nt(w))return st(+w);if(kt(w))return st(w);if(jt(w)){const P=w;if(P.indexOf("-0x")===0)return st(P);if(P.indexOf("0x")===0)return P;if(!isFinite(P))return O(_(P))}if(w instanceof Uint8Array)return"0x"+O(w);if(tr(w)||Pt(w))throw new Error("toHex can only be called with scalar values, not objects or arrays");return st(w)}function We(w){let P=w?w.toLowerCase():"ether",D=Z[P];if(D===void 0)throw new Error("This unit doesn't exists, please use the one of the following units"+JSON.stringify(Z,null,2));return new Y(D,10)}function ze(w){let P=w||0;return kt(P)?P:(typeof P=="string"&&(P=P.trim()),typeof P!="string"||P.indexOf("0x")!==0&&P.indexOf("-0x")!==0?P instanceof Uint8Array?new Y(O(P),16):new Y(P,10):new Y(P.replace("0x","").toLowerCase(),16))}function ut(w){return new Y(new Array(w).fill("1").join(""),2)}function rt(w,P=256){let D=ze(w).integerValue();return D.isLessThan(0)?ut(P).plus(D).plus(1):D}function Ze(w,P){return ae(w.toString(2),P,"0")[0]=="1"}function er(w){if(typeof w!="string")throw $("invalid address",b,{arg:"address",value:w});if(w.trim().match(/^(0x)?[0-9a-fA-F]{40}$/))return w.trim().substring(0,2)!=="0x"&&(w="0x"+w),bt(w);throw $("invalid address",b,{arg:"address",value:w})}function Ye(w,P=256){if(Ze(w,P)){const D=ut(P);return w.minus(D).minus(1)}return w}function yt(w){return/^0x[0-9a-f]{40}$/i.test(w)}function Vt(w){return!!/^(0x)?[0-9a-f]{40}$/i.test(w)&&(!(!/^(0x)?[0-9a-f]{40}$/.test(w)&&!/^(0x)?[0-9A-F]{40}$/.test(w))||$t(w))}function $t(w){const P=w.replace("0x","");let D=te(P.toLowerCase());for(let ne=0;ne<40;ne++)if(parseInt(D[ne],16)>7&&P[ne].toUpperCase()!==P[ne]||parseInt(D[ne],16)<=7&&P[ne].toLowerCase()!==P[ne])return!1;return!0}function bt(w){if(w===void 0)return"";const P=w.toLowerCase().replace("0x",""),D=te(P);let ne="0x";for(let de=0;de<P.length;de++)parseInt(D[de],16)>7?ne+=P[de].toUpperCase():ne+=P[de];return ne}function Zt(w){if(!Array.isArray(w))throw new Error(`Value was not an array: ${JSON.stringify(w)}`);return w}function Rt(w){return yt(w)?w:/^[0-9a-f]{40}$/.test(w)?"0x"+w:"0x"+ae(Qe(w).substr(2),40)}function kt(w){return w instanceof Y}function jt(w){return typeof w=="string"||w&&w.constructor&&w.constructor.name==="String"}function Pt(w){return w!==null&&!Array.isArray(w)&&typeof w=="object"}function Nt(w){return typeof w=="boolean"}function tr(w){return Array.isArray(w)}var Ot,vt;function rr(w,P){if(!w)throw new Error("jsonrpc method should be specified!");if(typeof w!="string")throw new Error(`jsonrpc must be a string, got ${typeof w}!`);return n.messageId++,{jsonrpc:"2.0",id:n.messageId,method:w,params:P||[]}}function St(w){return Array.isArray(w)?w.every(P):P(w);function P(D){return!(!D||"error"in D||D.jsonrpc!=="2.0"||typeof D.id!="number"||D.result==null&&D.result===void 0)}}/*! *****************************************************************************
	  Copyright (c) Microsoft Corporation.

	  Permission to use, copy, modify, and/or distribute this software for any
	  purpose with or without fee is hereby granted.

	  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	  PERFORMANCE OF THIS SOFTWARE.
	  ***************************************************************************** */function G(w,P,D,ne){var de,ue=arguments.length,Ie=ue<3?P:ne===null?ne=Object.getOwnPropertyDescriptor(P,D):ne;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Ie=Reflect.decorate(w,P,D,ne);else for(var it=w.length-1;it>=0;it--)(de=w[it])&&(Ie=(ue<3?de(Ie):ue>3?de(P,D,Ie):de(P,D))||Ie);return ue>3&&Ie&&Object.defineProperty(P,D,Ie),Ie}function M(w,P){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(w,P)}n.TransactionStatus=void 0,(Ot=n.TransactionStatus||(n.TransactionStatus={})).pending="pending",Ot.confirmed="confirmed",Ot.failed="failed",n.TransactionType=void 0,(vt=n.TransactionType||(n.TransactionType={})).queued="queued",vt.dropped="dropped",vt.replaced="replaced",vt.pending="pending",vt.reverted="reverted",vt.confirmed="confirmed",n.messageId=0;function X(w){return ze(w)}function oe(w){return w===void 0?"latest":ve(w)}function ve(w){return w===void 0||w==null?null:function(P){return P==="latest"||P==="pending"||P==="earliest"}(w)?w:Qe(w)}function Ce(w){return w.from=w.from,w.from&&(w.from=se(w.from)),w.to&&(w.to=se(w.to)),w.gasPrice!==void 0&&(w.gasPrice=st(w.gasPrice)),w.gas!==void 0&&(w.gas=st(w.gas)),w.value!==void 0&&(w.value=st(w.value)),w.nonce!==void 0&&(w.nonce=st(w.nonce)),w.data&&!w.data.startsWith("0x")&&/^[A-Za-z0-9]+$/.test(w.data)&&(w.data="0x"+w.data),w}function Me(w){if(typeof w!="string")throw new Error("The provided input for transactionId is not a string, got: "+JSON.stringify(w));if(w.indexOf("0x")!==0)throw new Error("TransactionID must start with 0x, got: "+JSON.stringify(w));if(w.length!==66)throw new Error("TransactionID must be a 32 byte hex, got: "+JSON.stringify(w));return w}function He(w){if(typeof w!="object")throw new Error("Did not provide transaction options");if(!w.from)throw new Error('Missing "from" in transaction options');return w.from=se(w.from),w.to&&(w.to=se(w.to)),w.gasPrice!==void 0&&(w.gasPrice=st(w.gasPrice)),w.gas!==void 0&&(w.gas=st(w.gas)),w.value!==void 0&&(w.value=st(w.value)),w.nonce!==void 0&&(w.nonce=st(w.nonce)),w.data&&!w.data.startsWith("0x")&&/^[A-Za-z0-9]+$/.test(w.data)&&(w.data="0x"+w.data),w}function Je(w){return w?(w.blockNumber!==null&&(w.blockNumber=Ke(w.blockNumber)),w.transactionIndex!==null&&(w.transactionIndex=Ke(w.transactionIndex)),w.nonce=Ke(w.nonce),w.gas=Ke(w.gas),w.gasPrice=ze(w.gasPrice),w.value=ze(w.value),w):null}function j(w){return w?(w.blockNumber!==null&&(w.blockNumber=Ke(w.blockNumber)),w.transactionIndex!==null&&(w.transactionIndex=Ke(w.transactionIndex)),w.cumulativeGasUsed=Ke(w.cumulativeGasUsed),w.gasUsed=Ke(w.gasUsed),w.logs&&tr(w.logs)&&(w.logs=w.logs.map(function(P){return Q(P)})),w.status=Ke(w.status||""),w):null}function V(w){return w?(w.gasLimit=Ke(w.gasLimit),w.gasUsed=Ke(w.gasUsed),w.size=Ke(w.size),w.timestamp=Ke(w.timestamp),w.number!==null&&(w.number=Ke(w.number)),w.difficulty=ze(w.difficulty),w.totalDifficulty=ze(w.totalDifficulty),tr(w.transactions)&&w.transactions.forEach(function(P,D){jt(P)||(w.transactions[D]=Je(P)||w.transactions[D])}),w):null}function Q(w){return w&&(w.blockNumber&&(w.blockNumber=Ke(w.blockNumber)),w.transactionIndex&&(w.transactionIndex=Ke(w.transactionIndex)),w.logIndex&&(w.logIndex=Ke(w.logIndex)),w)}function se(w){if(yt(w))return w;if(Vt(w))return"0x"+w;throw new Error(`Invalid address: ${JSON.stringify(w)}`)}function pe(w){return w}function De(w){return w&&(w.startingBlock=Ke(w.startingBlock),w.currentBlock=Ke(w.currentBlock),w.highestBlock=Ke(w.highestBlock),w.knownStates&&(w.knownStates=Ke(w.knownStates),w.pulledStates=Ke(w.pulledStates)),w)}class Ee{constructor(P){this.callName=P.callName,this.params=P.params||0,this.inputFormatter=P.inputFormatter||null,this.outputFormatter=P.outputFormatter}validateArgs(P){if(P.length!==this.params)throw D=this.callName,ne=P.length,de=this.params,new Error(`Invalid number of input parameters to RPC method "${D}" given: ${ne}, expected: ${de}`);var D,ne,de}formatInput(P){return this.inputFormatter?this.inputFormatter.map(function(D,ne){return D?D(P[ne]):P[ne]}):P}formatOutput(P){return P!==null?this.outputFormatter(P):null}toPayload(P){let D=this.formatInput(P);return this.validateArgs(D),{method:this.callName,params:D}}async execute(P,...D){let ne=this.toPayload(D);if(!P)throw new Error("Missing RequestManager in method#exec");const de=await P.sendAsync(ne);return this.formatOutput(de)}}class nt{constructor(P){this.getter=P.getter,this.outputFormatter=P.outputFormatter}formatOutput(P){return this.outputFormatter(P)}async execute(P,...D){const ne=await P.sendAsync({method:this.getter,params:[]});return this.formatOutput(ne)}}var Te;function ct(w){return new Promise(P=>setTimeout(P,w))}n.eth=void 0,(Te=n.eth||(n.eth={})).eth_getBalance=new Ee({callName:"eth_getBalance",params:2,inputFormatter:[se,oe],outputFormatter:X}),Te.eth_getStorageAt=new Ee({callName:"eth_getStorageAt",params:3,inputFormatter:[se,Qe,oe],outputFormatter:at}),Te.eth_getCode=new Ee({callName:"eth_getCode",params:2,inputFormatter:[se,oe],outputFormatter:at}),Te.eth_getBlockByHash=new Ee({callName:"eth_getBlockByHash",params:2,inputFormatter:[ve,function(w){return!!w}],outputFormatter:V}),Te.eth_getBlockByNumber=new Ee({callName:"eth_getBlockByNumber",params:2,inputFormatter:[ve,function(w){return!!w}],outputFormatter:V}),Te.eth_getUncleByBlockHashAndIndex=new Ee({callName:"eth_getUncleByBlockHashAndIndex",params:2,inputFormatter:[ve,Qe],outputFormatter:V}),Te.eth_getUncleByBlockNumberAndIndex=new Ee({callName:"eth_getUncleByBlockNumberAndIndex",params:2,inputFormatter:[ve,Qe],outputFormatter:V}),Te.eth_getBlockTransactionCountByHash=new Ee({callName:"eth_getBlockTransactionCountByHash",params:1,inputFormatter:[ve],outputFormatter:Ke}),Te.eth_getBlockTransactionCountByNumber=new Ee({callName:"eth_getBlockTransactionCountByNumber",params:1,inputFormatter:[ve],outputFormatter:Ke}),Te.eth_getUncleCountByBlockHash=new Ee({callName:"eth_getUncleCountByBlockHash",params:1,inputFormatter:[ve],outputFormatter:Ke}),Te.eth_getUncleCountByBlockNumber=new Ee({callName:"eth_getUncleCountByBlockNumber",params:1,inputFormatter:[ve],outputFormatter:Ke}),Te.eth_getTransactionByHash=new Ee({callName:"eth_getTransactionByHash",params:1,inputFormatter:[Me],outputFormatter:Je}),Te.eth_getTransactionByBlockHashAndIndex=new Ee({callName:"eth_getTransactionByBlockHashAndIndex",params:2,inputFormatter:[ve,Qe],outputFormatter:Je}),Te.eth_getTransactionByBlockNumberAndIndex=new Ee({callName:"eth_getTransactionByBlockNumberAndIndex",params:2,inputFormatter:[ve,Qe],outputFormatter:Je}),Te.eth_getTransactionReceipt=new Ee({callName:"eth_getTransactionReceipt",params:1,inputFormatter:[Me],outputFormatter:j}),Te.eth_getTransactionCount=new Ee({callName:"eth_getTransactionCount",params:2,inputFormatter:[se,oe],outputFormatter:Ke}),Te.eth_sendRawTransaction=new Ee({callName:"eth_sendRawTransaction",params:1,inputFormatter:[null],outputFormatter:at}),Te.web3_sha3=new Ee({callName:"web3_sha3",params:1,inputFormatter:[null],outputFormatter:at}),Te.eth_sendTransaction=new Ee({callName:"eth_sendTransaction",params:1,inputFormatter:[He],outputFormatter:at}),Te.eth_sign=new Ee({callName:"eth_sign",params:2,inputFormatter:[se,null],outputFormatter:at}),Te.eth_call=new Ee({callName:"eth_call",params:2,inputFormatter:[Ce,oe],outputFormatter:at}),Te.eth_estimateGas=new Ee({callName:"eth_estimateGas",params:1,inputFormatter:[Ce],outputFormatter:Ke}),Te.eth_submitWork=new Ee({callName:"eth_submitWork",params:3,inputFormatter:[null,null,null],outputFormatter:Ge}),Te.eth_getWork=new Ee({callName:"eth_getWork",params:0,inputFormatter:[],outputFormatter:Zt}),Te.eth_coinbase=new nt({getter:"eth_coinbase",outputFormatter:Rt}),Te.eth_mining=new nt({getter:"eth_mining",outputFormatter:Ge}),Te.eth_hashrate=new nt({getter:"eth_hashrate",outputFormatter:Ke}),Te.eth_syncing=new nt({getter:"eth_syncing",outputFormatter:De}),Te.eth_gasPrice=new nt({getter:"eth_gasPrice",outputFormatter:X}),Te.eth_accounts=new nt({getter:"eth_accounts",outputFormatter:Zt}),Te.eth_blockNumber=new nt({getter:"eth_blockNumber",outputFormatter:Ke}),Te.eth_protocolVersion=new nt({getter:"eth_protocolVersion",outputFormatter:Ke}),Te.web3_clientVersion=new nt({getter:"web3_clientVersion",outputFormatter:gt}),Te.net_version=new nt({getter:"net_version",outputFormatter:gt}),Te.shh_version=new Ee({callName:"shh_version",params:0,inputFormatter:[],outputFormatter:Ke}),Te.shh_post=new Ee({callName:"shh_post",params:1,inputFormatter:[null],outputFormatter:Ge}),Te.personal_newAccount=new Ee({callName:"personal_newAccount",params:1,inputFormatter:[null],outputFormatter:Rt}),Te.personal_importRawKey=new Ee({callName:"personal_importRawKey",params:2,inputFormatter:[null,null],outputFormatter:Rt}),Te.personal_sign=new Ee({callName:"personal_sign",params:3,inputFormatter:[Lt,se,null],outputFormatter:at}),Te.personal_ecRecover=new Ee({callName:"personal_ecRecover",params:2,inputFormatter:[Lt,null],outputFormatter:Rt}),Te.personal_unlockAccount=new Ee({callName:"personal_unlockAccount",params:3,inputFormatter:[se,null,et],outputFormatter:Ge}),Te.personal_sendTransaction=new Ee({callName:"personal_sendTransaction",params:2,inputFormatter:[He,null],outputFormatter:at}),Te.personal_lockAccount=new Ee({callName:"personal_lockAccount",params:1,inputFormatter:[se],outputFormatter:Ge}),Te.personal_listAccounts=new nt({getter:"personal_listAccounts",outputFormatter:Zt}),Te.net_listening=new nt({getter:"net_listening",outputFormatter:Ge}),Te.net_peerCount=new nt({getter:"net_peerCount",outputFormatter:Ke}),Te.eth_newFilter=new Ee({callName:"eth_newFilter",params:1,inputFormatter:[pe],outputFormatter:Qe}),Te.eth_getLogs=new Ee({callName:"eth_getLogs",params:1,inputFormatter:[Qe],outputFormatter:Zt}),Te.eth_newBlockFilter=new Ee({callName:"eth_newBlockFilter",params:0,inputFormatter:[],outputFormatter:Qe}),Te.eth_newPendingTransactionFilter=new Ee({callName:"eth_newPendingTransactionFilter",params:0,inputFormatter:[],outputFormatter:Qe}),Te.eth_uninstallFilter=new Ee({callName:"eth_uninstallFilter",params:1,inputFormatter:[Qe],outputFormatter:Ge}),Te.eth_getFilterLogs=new Ee({callName:"eth_getFilterLogs",params:1,inputFormatter:[Qe],outputFormatter:Zt}),Te.eth_getFilterChanges=new Ee({callName:"eth_getFilterChanges",params:1,inputFormatter:[Qe],outputFormatter:Zt}),Te.eth_submitHashrate=new Ee({callName:"eth_submitHashrate",params:2,inputFormatter:[null,null],outputFormatter:Ge}),Te.shh_newIdentity=new Ee({callName:"shh_newIdentity",params:0,inputFormatter:[],outputFormatter:at}),Te.shh_hasIdentity=new Ee({callName:"shh_hasIdentity",params:1,inputFormatter:[null],outputFormatter:Ge}),Te.shh_newGroup=new Ee({callName:"shh_newGroup",params:0,inputFormatter:[],outputFormatter:at}),Te.shh_addToGroup=new Ee({callName:"shh_addToGroup",params:1,inputFormatter:[null],outputFormatter:Ge}),Te.shh_newFilter=new Ee({callName:"shh_newFilter",params:1,inputFormatter:[null],outputFormatter:Qe}),Te.shh_uninstallFilter=new Ee({callName:"shh_uninstallFilter",params:1,inputFormatter:[null],outputFormatter:Ge}),Te.shh_getLogs=new Ee({callName:"shh_getLogs",params:1,inputFormatter:[null],outputFormatter:Zt}),Te.shh_getFilterMessages=new Ee({callName:"shh_getFilterMessages",params:1,inputFormatter:[null],outputFormatter:Zt}),Te.shh_getFilterChanges=new Ee({callName:"shh_getFilterChanges",params:1,inputFormatter:[null],outputFormatter:Zt}),Te.shh_getMessages=new Ee({callName:"shh_getMessages",params:1,inputFormatter:[null],outputFormatter:Zt});function Ne(w,P){const D=n.eth[P];if(!D)throw new Error(`Could not find the method/property named ${P.toString()}`);Object.defineProperty(w,P,{value:function(){return D.execute(this,...arguments)}})}class Le{constructor(P){this.provider=P,this.requests=new Map}async sendAsync(P){const D=await this.provider;if(!D)throw new Error("Provider not set or invalid");let ne=rr(P.method,P.params);const de=d();return this.requests.set(ne.id,de),D.sendAsync(ne,(ue,Ie)=>{this.requests.delete(ne.id),ue?de.reject(ue):St(Ie)?de.resolve(Ie.result):de.reject(function(it){let ft=it&&it.error&&it.error.message?it.error.message:"Invalid JSON RPC response: "+JSON.stringify(it);return new Error(ft)}(Ie))}),de}setProvider(P){this.provider=P}async getConfirmedTransaction(P){const D=await this.waitForCompletion(P);if(this.isFailure(D))throw new Error(`Transaction "${P}" failed`);return D}async waitForCompletion(P,D){const ne=Me(P);if(await this.isTxDropped(ne,D)){const de=await this.getTransactionAndReceipt(ne);return Object.assign(Object.assign({},de),{status:n.TransactionStatus.failed})}for(;;){const de=await this.getTransactionAndReceipt(ne);if(!this.isPending(de)&&de.receipt)return Object.assign(Object.assign({},de),{status:this.isFailure(de)?n.TransactionStatus.failed:n.TransactionStatus.confirmed});await ct(2e3)}}async getTransaction(P){let D,ne=null;const de=Me(P);try{const Ie=(await this.eth_accounts())[0];Ie&&(ne=await this.eth_getTransactionCount(Ie,"latest"))}catch{ne=null}try{if(D=await this.eth_getTransactionByHash(de),D==null)return null}catch{return null}if(D.blockNumber==null){if(ne!=null){if(D.nonce<ne)return{hash:de,type:n.TransactionType.replaced,nonce:D.nonce};if(D.nonce>ne)return{hash:de,type:n.TransactionType.queued,nonce:D.nonce}}return Object.assign({type:n.TransactionType.pending},D)}let ue;try{if(ue=await this.eth_getTransactionReceipt(de),ue==null||ue.status===0)return Object.assign({type:n.TransactionType.reverted},D)}catch{return null}return Object.assign(Object.assign({type:n.TransactionType.confirmed},D),{receipt:ue})}async isTxDropped(P,D=15){let ne=D;for(;ne>0;){if(await this.getTransactionAndReceipt(P)!==null)return!1;ne-=1,await ct(2e3)}return!0}async getTransactionAndReceipt(P){P=Me(P);const[D,ne]=await Promise.all([this.eth_getTransactionByHash(P),this.eth_getTransactionReceipt(P)]);return Object.assign(Object.assign({},D),{receipt:ne})}isPending(P){return P&&P.blockNumber===null}isFailure(P){return P&&(!P.receipt||P.receipt.status===0)}}function wt(w){return"slice"in w&&w.slice||(w.slice=function(){var P=Array.prototype.slice.call(arguments);return new Uint8Array(Array.prototype.slice.apply(w,P))}),w}function ot(w){if(w==null)throw $("cannot convert null value to array",b,{arg:"value",value:w});if(w instanceof Uint8Array)return wt(new Uint8Array(w));if(typeof w=="string"){let ne=w.match(/^(0x)?[0-9a-fA-F]*$/);if(!ne)throw $("invalid hexidecimal string",b,{arg:"value",value:w});if(ne[1]!=="0x")throw $("hex string must have 0x prefix",b,{arg:"value",value:w});(w=w.substring(2)).length%2&&(w="0"+w);for(var P=[],D=0;D<w.length;D+=2)P.push(parseInt(w.substr(D,2),16));return wt(new Uint8Array(P))}if(function(ne){if(!ne||parseInt(String(ne.length))!=ne.length||typeof ne=="string")return!1;for(var de=0;de<ne.length;de++){var ue=ne[de];if(ue<0||ue>=256||parseInt(String(ue))!=ue)return!1}return!0}(w))return wt(new Uint8Array(w));throw $("invalid arrayify value",void 0,{arg:"value",value:w,type:typeof w})}function At(w,P,D){Object.defineProperty(w,P,{enumerable:!0,value:D,writable:!1})}G([Ne,M("design:type",Function)],Le.prototype,"web3_clientVersion",void 0),G([Ne,M("design:type",Function)],Le.prototype,"web3_sha3",void 0),G([Ne,M("design:type",Function)],Le.prototype,"net_version",void 0),G([Ne,M("design:type",Function)],Le.prototype,"net_peerCount",void 0),G([Ne,M("design:type",Function)],Le.prototype,"net_listening",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_protocolVersion",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_syncing",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_coinbase",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_mining",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_hashrate",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_gasPrice",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_accounts",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_blockNumber",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getBalance",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getStorageAt",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getTransactionCount",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getBlockTransactionCountByHash",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getBlockTransactionCountByNumber",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getUncleCountByBlockHash",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getUncleCountByBlockNumber",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getCode",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_sign",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_sendTransaction",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_sendRawTransaction",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_call",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_estimateGas",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getBlockByHash",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getBlockByNumber",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getTransactionByHash",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getTransactionByBlockHashAndIndex",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getTransactionByBlockNumberAndIndex",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getTransactionReceipt",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getUncleByBlockHashAndIndex",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getUncleByBlockNumberAndIndex",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_newFilter",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_newBlockFilter",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_newPendingTransactionFilter",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_uninstallFilter",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getFilterChanges",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getFilterLogs",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getLogs",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_getWork",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_submitWork",void 0),G([Ne,M("design:type",Function)],Le.prototype,"eth_submitHashrate",void 0),G([Ne,M("design:type",Function)],Le.prototype,"shh_post",void 0),G([Ne,M("design:type",Function)],Le.prototype,"shh_version",void 0),G([Ne,M("design:type",Function)],Le.prototype,"shh_newIdentity",void 0),G([Ne,M("design:type",Function)],Le.prototype,"shh_hasIdentity",void 0),G([Ne,M("design:type",Function)],Le.prototype,"shh_newGroup",void 0),G([Ne,M("design:type",Function)],Le.prototype,"shh_addToGroup",void 0),G([Ne,M("design:type",Function)],Le.prototype,"shh_newFilter",void 0),G([Ne,M("design:type",Function)],Le.prototype,"shh_uninstallFilter",void 0),G([Ne,M("design:type",Function)],Le.prototype,"shh_getFilterChanges",void 0),G([Ne,M("design:type",Function)],Le.prototype,"shh_getMessages",void 0),G([Ne,M("design:type",Function)],Le.prototype,"personal_unlockAccount",void 0),G([Ne,M("design:type",Function)],Le.prototype,"personal_newAccount",void 0),G([Ne,M("design:type",Function)],Le.prototype,"personal_listAccounts",void 0),G([Ne,M("design:type",Function)],Le.prototype,"personal_lockAccount",void 0),G([Ne,M("design:type",Function)],Le.prototype,"personal_importRawKey",void 0),G([Ne,M("design:type",Function)],Le.prototype,"personal_sendTransaction",void 0),G([Ne,M("design:type",Function)],Le.prototype,"personal_sign",void 0),G([Ne,M("design:type",Function)],Le.prototype,"personal_ecRecover",void 0);const zt=new Y(-1),Ut=new Y(0),xr=new Y(1),hr=new Y("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function pr(w){return function(P,D){function ne(nr){return new Error('unexpected character "'+P[nr]+'" at position '+nr+' in "'+P+'"')}for(var de={type:"",name:"",state:{allowType:!0}},ue=de,Ie=0;Ie<P.length;Ie++){var it=P[Ie];switch(it){case"(":if(!ue.state.allowParams)throw ne(Ie);ue.state.allowType=!1,ue.type=vr(ue.type),ue.components=[{type:"",name:"",parent:ue,state:{allowType:!0}}],ue=ue.components[0];break;case")":delete ue.state,D&&ue.name==="indexed"&&(ue.indexed=!0,ue.name=""),ue.type=vr(ue.type);var ft=ue;if(!(ue=ue.parent))throw ne(Ie);delete ft.parent,ue.state.allowParams=!1,ue.state.allowName=!0,ue.state.allowArray=!0;break;case",":delete ue.state,D&&ue.name==="indexed"&&(ue.indexed=!0,ue.name=""),ue.type=vr(ue.type);var Fe={type:"",name:"",parent:ue.parent,state:{allowType:!0}};ue.parent.components.push(Fe),delete ue.parent,ue=Fe;break;case" ":ue.state.allowType&&ue.type!==""&&(ue.type=vr(ue.type),delete ue.state.allowType,ue.state.allowName=!0,ue.state.allowParams=!0),ue.state.allowName&&ue.name!==""&&(D&&ue.name==="indexed"?(ue.indexed=!0,ue.name=""):ue.state.allowName=!1);break;case"[":if(!ue.state.allowArray)throw ne(Ie);ue.type+=it,ue.state.allowArray=!1,ue.state.allowName=!1,ue.state.readArray=!0;break;case"]":if(!ue.state.readArray)throw ne(Ie);ue.type+=it,ue.state.readArray=!1,ue.state.allowArray=!0,ue.state.allowName=!0;break;default:if(ue.state.allowType)ue.type+=it,ue.state.allowParams=!0,ue.state.allowArray=!0;else if(ue.state.allowName)ue.name+=it,delete ue.state.allowArray;else{if(!ue.state.readArray)throw ne(Ie);ue.type+=it}}}if(ue.parent)throw new Error("unexpected eof");return delete de.state,D&&ue.name==="indexed"&&(ue.indexed=!0,ue.name=""),de.type=vr(de.type),de}(w,!0)}function vr(w){return w.match(/^uint($|[^1-9])/)?w="uint256"+w.substring(4):w.match(/^int($|[^1-9])/)&&(w="int256"+w.substring(3)),w}const Er=new RegExp(/^bytes([0-9]*)$/),ur=new RegExp(/^(u?int)([0-9]*)$/),yr=new RegExp(/^(.*)\[([0-9]*)\]$/),$r=function(w,P){var D=w.match(ur);return D&&parseInt(D[2])<=48?P.toNumber():P};class Qt{constructor(P,D,ne,de="",ue){this.coerceFunc=P,this.name=D,this.type=ne,this.localName=de,this.dynamic=ue}}class Tr extends Qt{constructor(P){super(P.coerceFunc,P.name,P.type,void 0,P.dynamic),At(this,"coder",P)}encode(P){return this.coder.encode(P)}decode(P,D){return this.coder.decode(P,D)}}class Lr extends Qt{constructor(P,D){super(P,"null","",D,!1)}encode(P){return ot([])}decode(P,D){if(D>P.length)throw new Error("invalid null");return{consumed:0,value:this.coerceFunc("null",void 0)}}}function Rr(w,P){return new Y(w.toString(2).substr(-P),2)}class Gr extends Qt{constructor(P,D,ne,de){const ue=(ne?"int":"uint")+8*D;super(P,ue,ue,de,!1),this.size=D,this.signed=ne}encode(P){try{let D=ze(P);if(this.signed){let de=Rr(hr,8*this.size-1);if(D.gt(de))throw new Error("out-of-bounds");if(de=de.plus(xr).multipliedBy(zt),D.lt(de))throw new Error("out-of-bounds")}else if(D.lt(Ut)||D.gt(Rr(hr,8*this.size)))throw new Error("out-of-bounds");D=Rr(rt(D,8*this.size),8*this.size),this.signed&&(D=rt(Ye(D,8*this.size),256));let ne=ae(rt(D).toString(16),64);if(ne.indexOf("NaN")!=-1)throw $("invalid number value, NaN",b,{arg:this.localName,coderType:this.name,value:P,v:D,twosComplement:rt(D),twosComplement16:rt(D).toString(16),pad:ae(rt(D).toString(16),64),size:this.size});return g(ne)}catch(D){throw $("invalid number value",b,{arg:this.localName,coderType:this.name,value:P,message:D.toString()})}}decode(P,D){if(P.length<D+32)throw $("insufficient data for "+this.name+" type",b,{arg:this.localName,coderType:this.name,value:Qe(P.slice(D,D+32))});var ne=32-this.size,de=new Y(O(P.slice(D+ne,D+32)),16);return de=this.signed?Ye(de,8*this.size):Rr(de,8*this.size),{consumed:32,value:this.coerceFunc(this.name,de)}}}var Sr=new Gr(function(w,P){return P},32,!1,"none");class Wr extends Qt{constructor(P,D,ne){const de="bytes"+D;super(P,de,de,ne,!1),this.length=D}encode(P){var D=new Uint8Array(32);try{if(typeof P=="string"&&P.length%2!=0)throw new Error("hex string cannot be odd-length");let ne=ot(P);if(ne.length>this.length)throw new Error("incorrect data length");D.set(ne)}catch(ne){throw $("invalid "+this.name+" value. Use hex strings or Uint8Array",b,{arg:this.localName,coderType:this.name,value:ne.value||P,details:ne.message})}return D}decode(P,D){if(P.length<D+32)throw $("insufficient data for "+this.name+" type",b,{arg:this.localName,coderType:this.name,value:Qe(P.slice(D,D+32))});return{consumed:32,value:this.coerceFunc(this.name,P.slice(D,D+this.length))}}}function jr(w){var P=32*Math.ceil(w.length/32),D=new Uint8Array(P-w.length);return ke(Sr.encode(w.length),w,D)}function Zr(w,P,D){if(w.length<P+32)throw $("insufficient data for dynamicBytes length",b,{arg:D,coderType:"dynamicBytes",value:Qe(w.slice(P,P+32))});var ne=Sr.decode(w,P).value;try{ne=ne.toNumber()}catch(de){throw de("dynamic bytes count too large",b,{arg:D,coderType:"dynamicBytes",value:ne.toString()})}if(w.length<P+32+ne)throw $("insufficient data for dynamicBytes type",b,{arg:D,coderType:"dynamicBytes",value:Qe(w.slice(P,P+32+ne))});return{consumed:32+32*Math.ceil(ne/32),value:w.slice(P+32,P+32+ne)}}function Ir(w){return 32*Math.ceil(w/32)}function Sn(w,P){if(!Array.isArray(P)){if(!P||typeof P!="object")throw $("invalid tuple value",b,{coderType:"tuple",value:P});var D=[];w.forEach(function(Fe){D.push(P[Fe.localName])}),P=D}if(w.length!==P.length)throw $("types/value length mismatch",b,{coderType:"tuple",value:P});var ne=[];w.forEach(function(Fe,nr){ne.push({dynamic:Fe.dynamic,value:Fe.encode(P[nr])})});var de=0,ue=0;ne.forEach(function(Fe){Fe.dynamic?(de+=32,ue+=Ir(Fe.value.length)):de+=Ir(Fe.value.length)});var Ie=0,it=de,ft=new Uint8Array(de+ue);return ne.forEach(function(Fe){Fe.dynamic?(ft.set(Sr.encode(it),Ie),Ie+=32,ft.set(Fe.value,it),it+=Ir(Fe.value.length)):(ft.set(Fe.value,Ie),Ie+=Ir(Fe.value.length))}),ft}class Pn extends Array{}class Cn extends Qt{constructor(P,D,ne,de){super(P,"array",D.type+"["+(ne>=0?ne:"")+"]",de,ne===-1||D.dynamic),this.coder=D,this.length=ne}encode(P){if(!Array.isArray(P))throw $("expected array value",b,{arg:this.localName,coderType:"array",value:P});var D=this.length,ne=new Uint8Array(0);D===-1&&(D=P.length,ne=Sr.encode(D)),function(Ie,it,ft){if(ft||(ft=""),Ie<it)throw $("missing argument"+ft,"MISSING_ARGUMENT",{count:Ie,expectedCount:it});if(Ie>it)throw $("too many arguments"+ft,"UNEXPECTED_ARGUMENT",{count:Ie,expectedCount:it})}(D,P.length,"in coder array"+(this.localName?" "+this.localName:""));for(var de=[],ue=0;ue<P.length;ue++)de.push(this.coder);return ke(ne,Sn(de,P))}decode(P,D){var ne=0,de=this.length;if(de===-1){try{var ue=Sr.decode(P,D)}catch(Fe){throw Fe("insufficient data for dynamic array length",b,{arg:this.localName,coderType:"array",value:Fe.value})}try{de=ue.value.toNumber()}catch(Fe){throw Fe("array count too large",b,{arg:this.localName,coderType:"array",value:ue.value.toString()})}ne+=ue.consumed,D+=ue.consumed}for(var Ie=[],it=0;it<de;it++)Ie.push(new Tr(this.coder));var ft=function(Fe,nr,ar){var qt=ar,Wt=0,ir=[];return Fe.forEach(function(Xt){if(Xt.dynamic){var fr=Sr.decode(nr,ar);(Dt=Xt.decode(nr,qt+fr.value.toNumber())).consumed=fr.consumed}else var Dt=Xt.decode(nr,ar);Dt.value!=null&&ir.push(Dt.value),ar+=Dt.consumed,Wt+=Dt.consumed}),{value:ir,consumed:Wt}}(Ie,P,D);return ft.consumed+=ne,ft.value=this.coerceFunc(this.type,ft.value),ft}}class vn extends Qt{constructor(P,D,ne){var de=!1,ue=[];D.forEach(function(Ie){Ie.dynamic&&(de=!0),ue.push(Ie.type)}),super(P,"tuple","tuple("+ue.join(",")+")",ne,de),this.coders=D}encode(P){return Sn(this.coders,P)}decode(P,D){var ne=function(de,ue,Ie){var it=Ie,ft=0,Fe=new Pn;return de.forEach(function(nr){if(nr.dynamic){var ar=Sr.decode(ue,Ie);(qt=nr.decode(ue,it+ar.value.toNumber())).consumed=ar.consumed}else var qt=nr.decode(ue,Ie);qt.value!=null&&Fe.push(qt.value),Ie+=qt.consumed,ft+=qt.consumed}),de.forEach(function(nr,ar){let qt=nr.localName;qt&&(qt==="length"&&(qt="_length"),Fe[qt]==null&&(Fe[qt]=Fe[ar]))}),{value:Fe,consumed:ft}}(this.coders,P,D);return ne.value=this.coerceFunc(this.type,ne.value),ne}}const Tn={address:class extends Qt{constructor(w,P){super(w,"address","address",P,!1)}encode(w){let P=new Uint8Array(32);const D=w.trim();if(!Vt(D))throw $("invalid address format",b,{arg:this.localName,coderType:"address",value:w});try{P.set(g(se(D)),12)}catch(ne){throw $(`invalid address (${ne.message})`,b,{arg:this.localName,coderType:"address",value:w})}return P}decode(w,P){if(w.length<P+32)throw $("insufficuent data for address type",b,{arg:this.localName,coderType:"address",value:Qe(w.slice(P,P+32)),missingBytes:P+32-w.length});return{consumed:32,value:this.coerceFunc("address",er(Qe(w.slice(P+12,P+32))))}}},bool:class extends Qt{constructor(w,P){super(w,"bool","bool",P,!1)}encode(w){return Sr.encode(w?1:0)}decode(w,P){try{var D=Sr.decode(w,P)}catch(ne){throw ne.reason==="insufficient data for uint256 type"?$("insufficient data for boolean type",b,{arg:this.localName,coderType:"boolean",value:ne.value}):ne}return{consumed:D.consumed,value:this.coerceFunc("bool",!D.value.isZero())}}},string:class extends Qt{constructor(w,P){super(w,"string","string",P,!0)}encode(w){if(typeof w!="string")throw $("invalid string value",b,{arg:this.localName,coderType:"string",value:w});return jr(_(w))}decode(w,P){var D=Zr(w,P,this.localName);return D.value=this.coerceFunc("string",m(D.value)),D}},bytes:class extends Qt{constructor(w,P){super(w,"bytes","bytes",P,!0)}encode(w){try{return jr(ot(w))}catch(P){throw P("invalid bytes value",b,{arg:this.localName,coderType:"bytes",value:P.value})}}decode(w,P){var D=Zr(w,P,this.localName);return D.value=this.coerceFunc("bytes",D.value),D}},function:class extends Wr{constructor(w,P){super(w,24,P)}}};function Yr(w,P){var D,ne=Tn[P.type];if(ne)return new ne(w,P.name);if(D=P.type.match(ur)){let de=parseInt(D[2]||"256");if(de===0||de>256||de%8!=0)throw $("invalid "+D[1]+" bit length",b,{arg:"param",value:P});return new Gr(w,de/8,D[1]==="int",P.name)}if(D=P.type.match(Er)){let de=parseInt(D[1]);if(de===0||de>32)throw $("invalid bytes length",b,{arg:"param",value:P});return new Wr(w,de,P.name)}if(D=P.type.match(yr)){const de=Object.assign({},P);let ue=parseInt(D[2]||"-1");return de.type=D[1],new Cn(w,Yr(w,de),ue,P.name)}if(P.type.substring(0,5)==="tuple")return function(de,ue,Ie){ue||(ue=[]);var it=ue.map(ft=>Yr(de,ft));return new vn(de,it,Ie)}(w,P.components,P.name);if(P.type==="")return new Lr(w,P.name);throw $("invalid type",b,{arg:"type",value:P.type,fullType:P})}class yn{constructor(P){(function(D,ne){if(!(D instanceof ne))throw $("missing new","MISSING_NEW",{name:ne.name})})(this,yn),P||(P=$r),At(this,"coerceFunc",P)}encode(P,D){if(P.length!==D.length)throw $("types/values length mismatch",b,{count:{types:P.length,values:D.length},value:{types:P,values:D}});const ne=P.map(de=>typeof de=="string"?pr(de):de).map(de=>Yr(this.coerceFunc,de));return new vn(this.coerceFunc,ne,"_").encode(D)}decode(P,D){const ne=P.map(de=>typeof de=="string"?pr(de):de).map(de=>Yr(this.coerceFunc,de));return new vn(this.coerceFunc,ne,"_").decode(D,0).value}}const wn=new yn;var Nr;(function(w){w.encodeParams=function(P,D){return O(wn.encode(P,D))},w.decodeParams=function(P,D){if(P.length>0&&(!D||D==="0x"||D==="0X"))throw new Error("Returned values aren't valid, did it run Out of Gas? You might also see this error if you are not using the correct ABI for the contract you are retrieving data from, requesting data from a block number that does not exist, or querying a node which is not fully synced.");return wn.decode(P,g("0x"+D.replace(/0x/i,"")))}})(Nr||(Nr={}));class En{constructor(P){this.json=P,this._inputTypes=P.inputs||[],this._outputTypes=P.outputs||[],this._constant=!!P.constant,this._payable=!!P.payable||P.stateMutability==="payable",this.needsToBeTransaction=this._payable||"constant"in P&&!P.constant||P.stateMutability==="nonpayable",this._name=be(P)}extractDefaultBlock(P){return P.length>this._inputTypes.length&&!Pt(P[P.length-1])&&oe(P.pop())||"latest"}validateArgs(P){if(P.some(ue=>ue===void 0))throw new Error("Invalid call, some arguments are undefined");let D=P.filter(function(ue){return!(Pt(ue)===!0&&tr(ue)===!1&&kt(ue)===!1&&!(ue instanceof Uint8Array))});if(D.length!==this._inputTypes.length)throw ne=D.length,de=this._inputTypes.length,new Error(`Invalid number of arguments to Solidity function. given: ${ne}, expected: ${de}`);var ne,de}toPayload(P){let D={to:void 0,data:void 0,value:void 0,from:void 0};P.length>this._inputTypes.length&&Pt(P[P.length-1])&&(D=P.pop()),this.validateArgs(P);const ne=this.signature();let de=Nr.encodeParams(this._inputTypes,P);return de.indexOf("0x")==0&&(de=de.substr(2)),D.data="0x"+ne+de,D}signature(){return te(this._name).slice(0,8)}unpackOutput(P){if(!P)return;const D=P.length>=2?P.slice(2):P;let ne=Nr.decodeParams(this._outputTypes,D);return ne.length===1?ne[0]:ne}async execute(P,D,...ne){if(!P)throw new Error(`Cannot call function ${this.displayName()} because there is no requestManager`);if(this.needsToBeTransaction){const de=this.toPayload(ne);if(de.to=D,de.value>0&&!this._payable)throw new Error("Cannot send value to non-payable function");if(!de.from)throw new Error('Missing "from" in transaction options');return await P.eth_sendTransaction(de)}{const de=this.extractDefaultBlock(ne),ue=this.toPayload(ne);ue.to=D;const Ie=await P.eth_call(ue,de);return this.unpackOutput(Ie)}}estimateGas(P,D,...ne){if(!(P instanceof Le))throw new Error("estimateGas needs to receive a RequestManager as first argument");let de=this.toPayload(ne);return de.to=D,P.eth_estimateGas(de)}displayName(){return dt(this._name)}typeName(){return qe(this._name)||"void"}attachToContract(P){let D=this.displayName();const ne=Object.assign((...de)=>this.execute(P.requestManager,P.address,...de),{estimateGas:this.estimateGas.bind(this,P.requestManager,P.address),toPayload:(...de)=>this.toPayload(de)});P[D]||(P[D]=ne),P[D][this.typeName()]=ne}}function $n(w){if(w==null)return null;const P=String(w).toString();return P.indexOf("0x")===0?P:O(_(P))}class _n{constructor(P){this.requestManager=P,this.isStarted=!1,this.isDisposed=!1,this.formatter=D=>D,this.filterId=d(),this.callbacks=[],this.stopSemaphore=d()}async watch(P){if(this.isDisposed)throw new Error("The filter was disposed");P&&(this.callbacks.push(P),this.isStarted||await this.start())}async start(){if(this.isDisposed)throw new Error("The filter was disposed");if(!this.isStarted){this.isStarted=!0;try{const P=await this.getNewFilter();if(!P)throw new Error("Could not create a filter, response: "+JSON.stringify(P));this.filterId.resolve(P)}catch(P){throw P}this.stopSemaphore=d(),await this.poll()}}async stop(){if(!this.isStarted||this.isDisposed)return;this.isDisposed=!0;const P=await this.filterId;if(this.isStarted=!1,this.stopSemaphore&&await this.stopSemaphore,await this.uninstall()!==!0)throw new Error(`Couldn't stop the eth filter: ${P}`)}async poll(){if(this.isStarted){if(this.callbacks.length){const D=await this.getChanges();D&&this.callbacks.forEach(ne=>{this.formatter?D.forEach(de=>{ne(this.formatter(de))}):D.forEach(de=>ne(de))})}this.stopSemaphore.resolve(1),this.isStarted&&(this.stopSemaphore=d(),setTimeout((P=()=>this.poll(),function(){P().catch(D=>console.error(D))}),500))}else this.stopSemaphore.resolve(1);var P}}class Qr extends _n{constructor(P,D,ne=de=>de){super(P),this.requestManager=P,this.options=D,this.formatter=ne,this.options=this.options||{},this.options.topics=this.options.topics||[],this.options.topics=this.options.topics.map(function(de){return $n(de)}),this.options={topics:this.options.topics,address:this.options.address?this.options.address:void 0,fromBlock:typeof this.options.fromBlock=="number"||typeof this.options.fromBlock=="string"?ve(this.options.fromBlock)||void 0:"latest",toBlock:typeof this.options.toBlock=="number"||typeof this.options.toBlock=="string"?ve(this.options.toBlock)||void 0:"latest"}}async getLogs(){this.isStarted||await this.start();const P=await this.filterId;return this.requestManager.eth_getFilterLogs(P)}async getNewFilter(){return this.requestManager.eth_newFilter(this.options)}async getChanges(){const P=await this.filterId;return this.requestManager.eth_getFilterChanges(P)}async uninstall(){const P=await this.filterId;return this.requestManager.eth_uninstallFilter(P)}}class xn{constructor(P,D,ne){this.requestManager=P,this.address=ne,this._anonymous=!1,this._params=D.inputs||[],this._name=be(D),this._anonymous=D.anonymous||!1}types(P){return this._params.filter(function(D){return D.indexed===P})}displayName(){return dt(this._name)}typeName(){return qe(this._name)||"void"}signature(){return te(this._name)}encode(P={},D={}){let ne={topics:[],address:this.address};D.fromBlock!==void 0&&(ne.fromBlock=ve(D.fromBlock)||void 0),D.toBlock!==void 0&&(ne.toBlock=ve(D.toBlock)||void 0),ne.topics=ne.topics||[],this._anonymous||ne.topics.push("0x"+this.signature());let de=this._params.filter(function(ue){return ue.indexed===!0}).map(function(ue){let Ie=P[ue.name];return Ie==null?null:tr(Ie)?Ie.map(function(it){return"0x"+Nr.encodeParams([ue],[it])}):"0x"+Nr.encodeParams([ue],[Ie])});return ne.topics=ne.topics.concat(de),ne}decode(P){P.data=P.data||"",P.topics=P.topics||[];let D=(this._anonymous?P.topics:P.topics.slice(1)).map(function(it){return it.slice(2)}).join(""),ne=Nr.decodeParams(this.types(!0),D),de=P.data.slice(2),ue=Nr.decodeParams(this.types(!1),de);const Ie=this._params.reduce(function(it,ft){return it[ft.name]=ft.indexed?ne.shift():ue.shift(),it},{});return Object.assign(Object.assign({},Q(P)),{event:this.displayName(),address:P.address,args:Ie})}async execute(P,D){let ne=this.encode(P,D),de=this.decode.bind(this);return new Qr(this.requestManager,ne,de)}attachToContract(P){let D=this.execute.bind(this),ne=this.displayName();P.events[ne]||(P.events[ne]=D),P.events[ne][this.typeName()]=this.execute.bind(this,P)}}class Rn{constructor(P,D,ne){this._requestManager=P,this._json=D,this._address=ne}encode(P={}){let D={address:this._address};return P.fromBlock!==void 0&&(D.fromBlock=ve(P.fromBlock)||void 0),P.toBlock!==void 0&&(D.toBlock=ve(P.toBlock)||void 0),D}decode(P){P.data=P.data||"";let D=tr(P.topics)&&jt(P.topics[0])?P.topics[0].slice(2):"",ne=this._json.filter(function(de){return D===te(be(de))})[0];return ne?new xn(this._requestManager,ne,this._address).decode(P):Q(P)}async execute(P){let D=this.encode(P),ne=this.decode.bind(this);return new Qr(this._requestManager,D,ne)}getAllEventsFunction(){return this.execute.bind(this)}}class kn{constructor(P,D,ne){var de;this.requestManager=P,this.abi=D,this.address=ne,this.events={},this.transactionHash=null,this.address=ne,this.abi=D,(de=this).abi.filter(function(ue){return ue.type==="function"}).map(function(ue){return new En(ue)}).forEach(function(ue){ue.attachToContract(de)}),this.allEvents=function(ue){let Ie=ue.abi.filter(function(ft){return ft.type==="event"}),it=new Rn(ue.requestManager,Ie,ue.address);return Ie.map(function(ft){return new xn(ue.requestManager,ft,ue.address)}).forEach(function(ft){ft.attachToContract(ue)}),it.getAllEventsFunction()}(this)}}n.AbstractFilter=_n,n.BigNumber=Y,n.Contract=kn,n.ContractFactory=class{constructor(w,P){this.requestManager=w,this.abi=P}async deploy(...w){let P,D=w[w.length-1];if(Pt(D)&&!tr(D)&&(P=w.pop()),!P)throw new Error("Missing options object");if(!P.data||typeof P.data!="string")throw new Error("Invalid options.data");if(Ke(P.value)>0&&!(this.abi.filter(function(Fe){return Fe.type==="constructor"&&Fe.inputs.length===w.length})[0]||{}).payable)throw new Error("Cannot send value to non-payable constructor");let ne=(de=this.abi,ue=w,de.filter(function(Fe){return Fe.type==="constructor"&&Fe.inputs&&Fe.inputs.length===ue.length}).map(function(Fe){return Fe.inputs||[]}).map(function(Fe){return Nr.encodeParams(Fe,ue)})[0]||"");var de,ue;P.data+=ne,P.gas||(P.gas=await this.requestManager.eth_estimateGas(P));const Ie=await this.requestManager.eth_sendTransaction(P);if(!Ie)throw new Error("Error while sending contract creation transaction. A TxHash was not retrieved");const it=await async function(Fe,nr){const ar=d();let qt=0;const Wt=()=>{qt++,qt>50?ar.reject(new Error("Contract transaction couldn't be found after 50 blocks")):Fe.eth_getTransactionReceipt(nr).then(fr=>{fr&&fr.blockHash?ar.resolve(fr):setTimeout(Wt,1e3)},fr=>ar.reject(fr))};Wt();const ir=await ar,Xt=await Fe.eth_getCode(ir.contractAddress,"latest");if(Xt&&Xt.length>3)return ir.contractAddress;throw Object.assign(new Error("The contract code couldn't be stored, please check your gas amount."),{response:Xt,receipt:ir})}(this.requestManager,Ie),ft=await this.at(it);return ft.transactionHash=Ie,ft}async at(w){if(!Vt(w))throw new TypeError(`Invalid address ${JSON.stringify(w)}`);return new kn(this.requestManager,this.abi,w)}},n.EthBlockFilter=class extends Qr{constructor(w){super(w,{})}async getNewFilter(){return this.requestManager.eth_newBlockFilter()}},n.EthFilter=Qr,n.EthPendingTransactionFilter=class extends Qr{constructor(w){super(w,{})}async getNewFilter(){return this.requestManager.eth_newPendingTransactionFilter()}},n.HTTPProvider=class{constructor(w,P={}){this.host=w,this.options=P,this.debug=!1,this.host=w||"http://localhost:8545"}send(){throw new Error("Sync requests are deprecated")}sendAsync(w,P){try{let D=null;D=w instanceof Array?w.map(ue=>i(ue)):i(w);const ne=this.options.fetch||globalThis.fetch;if(ne===void 0)throw new Error("There is no global fetch object nor it was provided. Please install and import isomorphic-fetch");const de={body:JSON.stringify(D),method:"POST",headers:Object.assign(Object.assign({},this.options.headers),{"Content-Type":"application/json"})};this.debug&&console.log("SEND >> "+de.body),ne(this.host,de).then(async ue=>{if(ue.ok){const Ie=await ue.json();this.debug&&console.log("RECV << "+JSON.stringify(Ie)),Ie.error?P(Object.assign(new Error(Ie.error.json||Ie.error),Ie.error)):P(null,Ie)}else this.debug&&console.log("ERR << "+JSON.stringify(ue)),P(new Error("External error. response code: "+ue.status))},ue=>{this.debug&&console.log("ERR << "+JSON.stringify(ue)),P(ue)})}catch(D){this.debug&&console.log("ERR << "+JSON.stringify(D)),P(D)}}},n.Method=Ee,n.Property=nt,n.RequestManager=Le,n.SHHFilter=class extends _n{constructor(w,P){super(w),this.requestManager=w,this.options=P,this.options=this.options||{topics:[]},this.options.topics=this.options.topics||[],this.options.topics=this.options.topics.map(function(D){return $n(D)}),this.options={topics:this.options.topics,to:this.options.to}}async getMessages(){const w=await this.filterId;return this.requestManager.shh_getMessages(w)}async getNewFilter(){return this.requestManager.shh_newFilter(this.options)}async getChanges(){const w=await this.filterId;return this.requestManager.shh_getFilterChanges(w)}async uninstall(){const w=await this.filterId;return this.requestManager.shh_uninstallFilter(w)}},n.SolidityEvent=xn,n.SolidityFunction=En,n.WebSocketProvider=class{constructor(w,P={}){this.url=w,this.options=P,this.isDisposed=!1,this.responseCallbacks=new Map,this.notificationCallbacks=new Set,this.debug=!1,this.lastChunk="",this.connect()}dispose(){this.isDisposed=!0;const w=this.connection;this.timeout(new Error("Provider disposed.")),w.then(P=>P.close())}send(){throw new Error("Sync requests are deprecated")}sendAsync(w,P){const D=[];let ne;if(w instanceof Array)ne=Promise.all(w.map(de=>{const ue=d();try{const Ie=i(de);D.push(Ie),this.responseCallbacks.set(Ie.id,ue)}catch(Ie){ue.reject(Ie)}return ue}));else{const de=d();try{const ue=i(w);D.push(ue),this.responseCallbacks.set(ue.id,de)}catch(ue){de.reject(ue)}ne=de}ne.then(de=>P(null,de),de=>P(de)),this.connection.then(de=>{D.forEach(ue=>{const Ie=JSON.stringify(ue);this.debug&&console.log("SEND >> "+Ie),de.send(Ie)})},de=>{P(de)})}parseResponse(w){let P=[];return w.replace(/\}[\n\r]?\{/g,"}|--|{").replace(/\}\][\n\r]?\[\{/g,"}]|--|[{").replace(/\}[\n\r]?\[\{/g,"}|--|[{").replace(/\}\][\n\r]?\{/g,"}]|--|{").split("|--|").forEach(D=>{let ne=D;this.lastChunk&&(ne=this.lastChunk+ne);let de=null;try{de=JSON.parse(ne)}catch{return this.lastChunk=ne,clearTimeout(this.lastChunkTimeout),void(this.lastChunkTimeout=setTimeout(()=>{this.timeout()},15e3))}clearTimeout(this.lastChunkTimeout),this.lastChunk="",de&&P.push(de)}),P}processMessage(w){if("id"in w){const P=w.id,D=this.responseCallbacks.get(P);if(!D)return void console.error("Error: Received a response for an unknown request",w);this.responseCallbacks.delete(P),"error"in w?D.reject(Object.assign(new Error(w.error.message||w.error),w.error)):"result"in w&&D.resolve(w)}else this.notificationCallbacks.forEach(P=>P(null,w))}timeout(w){this.connection&&this.connection.isPending||(this.connection=d());const P=w||new Error("Connection timeout");this.responseCallbacks.forEach(D=>D.reject(P)),this.responseCallbacks.clear(),this.isDisposed||setTimeout(()=>this.connect(),1e3)}connect(){this.connection&&!this.connection.isPending&&this.connection.then(D=>D.close()),this.connection&&this.connection.isPending||(this.connection=d()),this.lastChunk="";let w=this.options.WebSocketConstructor||(typeof WebSocket<"u"?WebSocket:void 0);if(!w)throw new Error("Please provide a WebSocketConstructor");const P=new w(this.url,this.options.protocol);P.onopen=()=>{this.connection.resolve(P)},P.onerror=D=>{const ne=new Error("Error in web socket");ne.data=D,this.timeout(ne)},P.onclose=D=>{this.timeout(new Error(`Connection closed (${D&&D.reason||"Unknown reason"})`))},P.onmessage=D=>{let ne=typeof D.data=="string"?D.data:"";this.debug&&console.log("RECV << "+D.data),this.parseResponse(ne).forEach(de=>{de instanceof Array?de.forEach(ue=>this.processMessage(ue)):this.processMessage(de)})}}},n.bytesToHex=O,n.bytesToUtf8String=m,n.concatBytes=ke,n.default=Le,n.extractDisplayName=dt,n.extractTypeName=qe,n.fromAscii=function(w,P=0){let D="";for(let ne=0;ne<w.length;ne++){let de=w.charCodeAt(ne).toString(16);D+=de.length<2?"0"+de:de}return"0x"+D.padEnd(P,"0")},n.fromDecimal=st,n.fromTwosComplement=Ye,n.fromWei=function(w,P){let D=ze(w).dividedBy(We(P));return kt(w)?D:D.toString(10)},n.getAddress=er,n.getValueOfUnit=We,n.hexToBytes=g,n.isAddress=Vt,n.isArray=tr,n.isBigNumber=kt,n.isBloom=function(w){return!!/^(0x)?[0-9a-f]{512}$/i.test(w)&&!!/^(0x)?[0-9a-f]{512}$/i.test(w)},n.isBoolean=Nt,n.isChecksumAddress=$t,n.isFunction=function(w){return typeof w=="function"},n.isHex=function(w){return typeof w=="string"&&/^0x[0-9a-fA-F]+$/.test(w)},n.isJson=function(w){try{return!!JSON.parse(w)}catch{return!1}},n.isObject=Pt,n.isStrictAddress=yt,n.isString=jt,n.isTopic=function(w){return!!/^(0x)?[0-9a-f]{64}$/i.test(w)&&!!/^(0x)?[0-9a-f]{64}$/i.test(w)},n.isValidResponse=St,n.padLeft=ae,n.padRight=function(w,P,D){return w+new Array(P-w.length+1).join(D||"0")},n.sha3=te,n.signedIsNegative=Ze,n.stringToUtf8Bytes=_,n.toAddress=Rt,n.toArray=Zt,n.toAscii=function(w){let P="",D=0,ne=w.length;for(w.substring(0,2)==="0x"&&(D=2);D<ne;D+=2){let de=parseInt(w.substr(D,2),16);P+=String.fromCharCode(de)}return P},n.toBatchPayload=function(w){return w.map(function(P){return rr(P.method,P.params)})},n.toBigNumber=ze,n.toBoolean=Ge,n.toChecksumAddress=bt,n.toData=at,n.toDecimal=Ke,n.toHex=Qe,n.toJsonRpcRequest=rr,n.toNullDecimal=et,n.toString=gt,n.toStringData=Lt,n.toTwosComplement=rt,n.toWei=function(w,P){let D=ze(w).times(We(P));return kt(w)?D:D.toString(10)},n.transformToFullName=be,Object.defineProperty(n,"__esModule",{value:!0})})})(ethConnect,ethConnectExports);var SignatureValidator$1={};Object.defineProperty(SignatureValidator$1,"__esModule",{value:!0});SignatureValidator$1.SignatureValidator=void 0;const eth_connect_1$2=ethConnectExports;async function SignatureValidator(e,t){const n=[{constant:!0,inputs:[{name:"hash",type:"bytes32"},{name:"_signature",type:"bytes"}],name:"isValidSignature",outputs:[{name:"magicValue",type:"bytes4"}],payable:!1,stateMutability:"view",type:"function"}];return await new eth_connect_1$2.ContractFactory(e,n).at(t)}SignatureValidator$1.SignatureValidator=SignatureValidator;var types$1={},dist$2={},sdk={},ws={},sceneUpdate={},validation$2={},ajvExports={},ajv={get exports(){return ajvExports},set exports(e){ajvExports=e}},core$2={},validate={},boolSchema={},errors={},codegen={},code$1={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.regexpCode=e.getEsmExportName=e.getProperty=e.safeStringify=e.stringify=e.strConcat=e.addCodeArg=e.str=e._=e.nil=e._Code=e.Name=e.IDENTIFIER=e._CodeOrName=void 0;class t{}e._CodeOrName=t,e.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class n extends t{constructor(L){if(super(),!e.IDENTIFIER.test(L))throw new Error("CodeGen: name must be a valid identifier");this.str=L}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}e.Name=n;class i extends t{constructor(L){super(),this._items=typeof L=="string"?[L]:L}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const L=this._items[0];return L===""||L==='""'}get str(){var L;return(L=this._str)!==null&&L!==void 0?L:this._str=this._items.reduce((q,U)=>`${q}${U}`,"")}get names(){var L;return(L=this._names)!==null&&L!==void 0?L:this._names=this._items.reduce((q,U)=>(U instanceof n&&(q[U.str]=(q[U.str]||0)+1),q),{})}}e._Code=i,e.nil=new i("");function a(T,...L){const q=[T[0]];let U=0;for(;U<L.length;)d(q,L[U]),q.push(T[++U]);return new i(q)}e._=a;const o=new i("+");function c(T,...L){const q=[E(T[0])];let U=0;for(;U<L.length;)q.push(o),d(q,L[U]),q.push(o,E(T[++U]));return u(q),new i(q)}e.str=c;function d(T,L){L instanceof i?T.push(...L._items):L instanceof n?T.push(L):T.push(p(L))}e.addCodeArg=d;function u(T){let L=1;for(;L<T.length-1;){if(T[L]===o){const q=l(T[L-1],T[L+1]);if(q!==void 0){T.splice(L-1,3,q);continue}T[L++]="+"}L++}}function l(T,L){if(L==='""')return T;if(T==='""')return L;if(typeof T=="string")return L instanceof n||T[T.length-1]!=='"'?void 0:typeof L!="string"?`${T.slice(0,-1)}${L}"`:L[0]==='"'?T.slice(0,-1)+L.slice(1):void 0;if(typeof L=="string"&&L[0]==='"'&&!(T instanceof n))return`"${T}${L.slice(1)}`}function h(T,L){return L.emptyStr()?T:T.emptyStr()?L:c`${T}${L}`}e.strConcat=h;function p(T){return typeof T=="number"||typeof T=="boolean"||T===null?T:E(Array.isArray(T)?T.join(","):T)}function y(T){return new i(E(T))}e.stringify=y;function E(T){return JSON.stringify(T).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}e.safeStringify=E;function x(T){return typeof T=="string"&&e.IDENTIFIER.test(T)?new i(`.${T}`):a`[${T}]`}e.getProperty=x;function S(T){if(typeof T=="string"&&e.IDENTIFIER.test(T))return new i(`${T}`);throw new Error(`CodeGen: invalid export name: ${T}, use explicit $id name mapping`)}e.getEsmExportName=S;function k(T){return new i(T.toString())}e.regexpCode=k})(code$1);var scope={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ValueScope=e.ValueScopeName=e.Scope=e.varKinds=e.UsedValueState=void 0;const t=code$1;class n extends Error{constructor(l){super(`CodeGen: "code" for ${l} not defined`),this.value=l.value}}var i;(function(u){u[u.Started=0]="Started",u[u.Completed=1]="Completed"})(i=e.UsedValueState||(e.UsedValueState={})),e.varKinds={const:new t.Name("const"),let:new t.Name("let"),var:new t.Name("var")};class a{constructor({prefixes:l,parent:h}={}){this._names={},this._prefixes=l,this._parent=h}toName(l){return l instanceof t.Name?l:this.name(l)}name(l){return new t.Name(this._newName(l))}_newName(l){const h=this._names[l]||this._nameGroup(l);return`${l}${h.index++}`}_nameGroup(l){var h,p;if(!((p=(h=this._parent)===null||h===void 0?void 0:h._prefixes)===null||p===void 0)&&p.has(l)||this._prefixes&&!this._prefixes.has(l))throw new Error(`CodeGen: prefix "${l}" is not allowed in this scope`);return this._names[l]={prefix:l,index:0}}}e.Scope=a;class o extends t.Name{constructor(l,h){super(h),this.prefix=l}setValue(l,{property:h,itemIndex:p}){this.value=l,this.scopePath=(0,t._)`.${new t.Name(h)}[${p}]`}}e.ValueScopeName=o;const c=(0,t._)`\n`;class d extends a{constructor(l){super(l),this._values={},this._scope=l.scope,this.opts={...l,_n:l.lines?c:t.nil}}get(){return this._scope}name(l){return new o(l,this._newName(l))}value(l,h){var p;if(h.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const y=this.toName(l),{prefix:E}=y,x=(p=h.key)!==null&&p!==void 0?p:h.ref;let S=this._values[E];if(S){const L=S.get(x);if(L)return L}else S=this._values[E]=new Map;S.set(x,y);const k=this._scope[E]||(this._scope[E]=[]),T=k.length;return k[T]=h.ref,y.setValue(h,{property:E,itemIndex:T}),y}getValue(l,h){const p=this._values[l];if(p)return p.get(h)}scopeRefs(l,h=this._values){return this._reduceValues(h,p=>{if(p.scopePath===void 0)throw new Error(`CodeGen: name "${p}" has no value`);return(0,t._)`${l}${p.scopePath}`})}scopeCode(l=this._values,h,p){return this._reduceValues(l,y=>{if(y.value===void 0)throw new Error(`CodeGen: name "${y}" has no value`);return y.value.code},h,p)}_reduceValues(l,h,p={},y){let E=t.nil;for(const x in l){const S=l[x];if(!S)continue;const k=p[x]=p[x]||new Map;S.forEach(T=>{if(k.has(T))return;k.set(T,i.Started);let L=h(T);if(L){const q=this.opts.es5?e.varKinds.var:e.varKinds.const;E=(0,t._)`${E}${q} ${T} = ${L};${this.opts._n}`}else if(L=y==null?void 0:y(T))E=(0,t._)`${E}${L}${this.opts._n}`;else throw new n(T);k.set(T,i.Completed)})}return E}}e.ValueScope=d})(scope);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.or=e.and=e.not=e.CodeGen=e.operators=e.varKinds=e.ValueScopeName=e.ValueScope=e.Scope=e.Name=e.regexpCode=e.stringify=e.getProperty=e.nil=e.strConcat=e.str=e._=void 0;const t=code$1,n=scope;var i=code$1;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return i._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return i.str}}),Object.defineProperty(e,"strConcat",{enumerable:!0,get:function(){return i.strConcat}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return i.nil}}),Object.defineProperty(e,"getProperty",{enumerable:!0,get:function(){return i.getProperty}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return i.stringify}}),Object.defineProperty(e,"regexpCode",{enumerable:!0,get:function(){return i.regexpCode}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return i.Name}});var a=scope;Object.defineProperty(e,"Scope",{enumerable:!0,get:function(){return a.Scope}}),Object.defineProperty(e,"ValueScope",{enumerable:!0,get:function(){return a.ValueScope}}),Object.defineProperty(e,"ValueScopeName",{enumerable:!0,get:function(){return a.ValueScopeName}}),Object.defineProperty(e,"varKinds",{enumerable:!0,get:function(){return a.varKinds}}),e.operators={GT:new t._Code(">"),GTE:new t._Code(">="),LT:new t._Code("<"),LTE:new t._Code("<="),EQ:new t._Code("==="),NEQ:new t._Code("!=="),NOT:new t._Code("!"),OR:new t._Code("||"),AND:new t._Code("&&"),ADD:new t._Code("+")};class o{optimizeNodes(){return this}optimizeNames($,g){return this}}class c extends o{constructor($,g,O){super(),this.varKind=$,this.name=g,this.rhs=O}render({es5:$,_n:g}){const O=$?n.varKinds.var:this.varKind,te=this.rhs===void 0?"":` = ${this.rhs}`;return`${O} ${this.name}${te};`+g}optimizeNames($,g){if($[this.name.str])return this.rhs&&(this.rhs=v(this.rhs,$,g)),this}get names(){return this.rhs instanceof t._CodeOrName?this.rhs.names:{}}}class d extends o{constructor($,g,O){super(),this.lhs=$,this.rhs=g,this.sideEffects=O}render({_n:$}){return`${this.lhs} = ${this.rhs};`+$}optimizeNames($,g){if(!(this.lhs instanceof t.Name&&!$[this.lhs.str]&&!this.sideEffects))return this.rhs=v(this.rhs,$,g),this}get names(){const $=this.lhs instanceof t.Name?{}:{...this.lhs.names};return F($,this.rhs)}}class u extends d{constructor($,g,O,te){super($,O,te),this.op=g}render({_n:$}){return`${this.lhs} ${this.op}= ${this.rhs};`+$}}class l extends o{constructor($){super(),this.label=$,this.names={}}render({_n:$}){return`${this.label}:`+$}}class h extends o{constructor($){super(),this.label=$,this.names={}}render({_n:$}){return`break${this.label?` ${this.label}`:""};`+$}}class p extends o{constructor($){super(),this.error=$}render({_n:$}){return`throw ${this.error};`+$}get names(){return this.error.names}}class y extends o{constructor($){super(),this.code=$}render({_n:$}){return`${this.code};`+$}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames($,g){return this.code=v(this.code,$,g),this}get names(){return this.code instanceof t._CodeOrName?this.code.names:{}}}class E extends o{constructor($=[]){super(),this.nodes=$}render($){return this.nodes.reduce((g,O)=>g+O.render($),"")}optimizeNodes(){const{nodes:$}=this;let g=$.length;for(;g--;){const O=$[g].optimizeNodes();Array.isArray(O)?$.splice(g,1,...O):O?$[g]=O:$.splice(g,1)}return $.length>0?this:void 0}optimizeNames($,g){const{nodes:O}=this;let te=O.length;for(;te--;){const Z=O[te];Z.optimizeNames($,g)||(C($,Z.names),O.splice(te,1))}return O.length>0?this:void 0}get names(){return this.nodes.reduce(($,g)=>Oe($,g.names),{})}}class x extends E{render($){return"{"+$._n+super.render($)+"}"+$._n}}class S extends E{}class k extends x{}k.kind="else";class T extends x{constructor($,g){super(g),this.condition=$}render($){let g=`if(${this.condition})`+super.render($);return this.else&&(g+="else "+this.else.render($)),g}optimizeNodes(){super.optimizeNodes();const $=this.condition;if($===!0)return this.nodes;let g=this.else;if(g){const O=g.optimizeNodes();g=this.else=Array.isArray(O)?new k(O):O}if(g)return $===!1?g instanceof T?g:g.nodes:this.nodes.length?this:new T(I($),g instanceof T?[g]:g.nodes);if(!($===!1||!this.nodes.length))return this}optimizeNames($,g){var O;if(this.else=(O=this.else)===null||O===void 0?void 0:O.optimizeNames($,g),!!(super.optimizeNames($,g)||this.else))return this.condition=v(this.condition,$,g),this}get names(){const $=super.names;return F($,this.condition),this.else&&Oe($,this.else.names),$}}T.kind="if";class L extends x{}L.kind="for";class q extends L{constructor($){super(),this.iteration=$}render($){return`for(${this.iteration})`+super.render($)}optimizeNames($,g){if(super.optimizeNames($,g))return this.iteration=v(this.iteration,$,g),this}get names(){return Oe(super.names,this.iteration.names)}}class U extends L{constructor($,g,O,te){super(),this.varKind=$,this.name=g,this.from=O,this.to=te}render($){const g=$.es5?n.varKinds.var:this.varKind,{name:O,from:te,to:Z}=this;return`for(${g} ${O}=${te}; ${O}<${Z}; ${O}++)`+super.render($)}get names(){const $=F(super.names,this.from);return F($,this.to)}}class ee extends L{constructor($,g,O,te){super(),this.loop=$,this.varKind=g,this.name=O,this.iterable=te}render($){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render($)}optimizeNames($,g){if(super.optimizeNames($,g))return this.iterable=v(this.iterable,$,g),this}get names(){return Oe(super.names,this.iterable.names)}}class W extends x{constructor($,g,O){super(),this.name=$,this.args=g,this.async=O}render($){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render($)}}W.kind="func";class ie extends E{render($){return"return "+super.render($)}}ie.kind="return";class fe extends x{render($){let g="try"+super.render($);return this.catch&&(g+=this.catch.render($)),this.finally&&(g+=this.finally.render($)),g}optimizeNodes(){var $,g;return super.optimizeNodes(),($=this.catch)===null||$===void 0||$.optimizeNodes(),(g=this.finally)===null||g===void 0||g.optimizeNodes(),this}optimizeNames($,g){var O,te;return super.optimizeNames($,g),(O=this.catch)===null||O===void 0||O.optimizeNames($,g),(te=this.finally)===null||te===void 0||te.optimizeNames($,g),this}get names(){const $=super.names;return this.catch&&Oe($,this.catch.names),this.finally&&Oe($,this.finally.names),$}}class ce extends x{constructor($){super(),this.error=$}render($){return`catch(${this.error})`+super.render($)}}ce.kind="catch";class ye extends x{render($){return"finally"+super.render($)}}ye.kind="finally";class xe{constructor($,g={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...g,_n:g.lines?`
`:""},this._extScope=$,this._scope=new n.Scope({parent:$}),this._nodes=[new S]}toString(){return this._root.render(this.opts)}name($){return this._scope.name($)}scopeName($){return this._extScope.name($)}scopeValue($,g){const O=this._extScope.value($,g);return(this._values[O.prefix]||(this._values[O.prefix]=new Set)).add(O),O}getScopeValue($,g){return this._extScope.getValue($,g)}scopeRefs($){return this._extScope.scopeRefs($,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def($,g,O,te){const Z=this._scope.toName(g);return O!==void 0&&te&&(this._constants[Z.str]=O),this._leafNode(new c($,Z,O)),Z}const($,g,O){return this._def(n.varKinds.const,$,g,O)}let($,g,O){return this._def(n.varKinds.let,$,g,O)}var($,g,O){return this._def(n.varKinds.var,$,g,O)}assign($,g,O){return this._leafNode(new d($,g,O))}add($,g){return this._leafNode(new u($,e.operators.ADD,g))}code($){return typeof $=="function"?$():$!==t.nil&&this._leafNode(new y($)),this}object(...$){const g=["{"];for(const[O,te]of $)g.length>1&&g.push(","),g.push(O),(O!==te||this.opts.es5)&&(g.push(":"),(0,t.addCodeArg)(g,te));return g.push("}"),new t._Code(g)}if($,g,O){if(this._blockNode(new T($)),g&&O)this.code(g).else().code(O).endIf();else if(g)this.code(g).endIf();else if(O)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf($){return this._elseNode(new T($))}else(){return this._elseNode(new k)}endIf(){return this._endBlockNode(T,k)}_for($,g){return this._blockNode($),g&&this.code(g).endFor(),this}for($,g){return this._for(new q($),g)}forRange($,g,O,te,Z=this.opts.es5?n.varKinds.var:n.varKinds.let){const ae=this._scope.toName($);return this._for(new U(Z,ae,g,O),()=>te(ae))}forOf($,g,O,te=n.varKinds.const){const Z=this._scope.toName($);if(this.opts.es5){const ae=g instanceof t.Name?g:this.var("_arr",g);return this.forRange("_i",0,(0,t._)`${ae}.length`,be=>{this.var(Z,(0,t._)`${ae}[${be}]`),O(Z)})}return this._for(new ee("of",te,Z,g),()=>O(Z))}forIn($,g,O,te=this.opts.es5?n.varKinds.var:n.varKinds.const){if(this.opts.ownProperties)return this.forOf($,(0,t._)`Object.keys(${g})`,O);const Z=this._scope.toName($);return this._for(new ee("in",te,Z,g),()=>O(Z))}endFor(){return this._endBlockNode(L)}label($){return this._leafNode(new l($))}break($){return this._leafNode(new h($))}return($){const g=new ie;if(this._blockNode(g),this.code($),g.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(ie)}try($,g,O){if(!g&&!O)throw new Error('CodeGen: "try" without "catch" and "finally"');const te=new fe;if(this._blockNode(te),this.code($),g){const Z=this.name("e");this._currNode=te.catch=new ce(Z),g(Z)}return O&&(this._currNode=te.finally=new ye,this.code(O)),this._endBlockNode(ce,ye)}throw($){return this._leafNode(new p($))}block($,g){return this._blockStarts.push(this._nodes.length),$&&this.code($).endBlock(g),this}endBlock($){const g=this._blockStarts.pop();if(g===void 0)throw new Error("CodeGen: not in self-balancing block");const O=this._nodes.length-g;if(O<0||$!==void 0&&O!==$)throw new Error(`CodeGen: wrong number of nodes: ${O} vs ${$} expected`);return this._nodes.length=g,this}func($,g=t.nil,O,te){return this._blockNode(new W($,g,O)),te&&this.code(te).endFunc(),this}endFunc(){return this._endBlockNode(W)}optimize($=1){for(;$-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode($){return this._currNode.nodes.push($),this}_blockNode($){this._currNode.nodes.push($),this._nodes.push($)}_endBlockNode($,g){const O=this._currNode;if(O instanceof $||g&&O instanceof g)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${g?`${$.kind}/${g.kind}`:$.kind}"`)}_elseNode($){const g=this._currNode;if(!(g instanceof T))throw new Error('CodeGen: "else" without "if"');return this._currNode=g.else=$,this}get _root(){return this._nodes[0]}get _currNode(){const $=this._nodes;return $[$.length-1]}set _currNode($){const g=this._nodes;g[g.length-1]=$}}e.CodeGen=xe;function Oe(b,$){for(const g in $)b[g]=(b[g]||0)+($[g]||0);return b}function F(b,$){return $ instanceof t._CodeOrName?Oe(b,$.names):b}function v(b,$,g){if(b instanceof t.Name)return O(b);if(!te(b))return b;return new t._Code(b._items.reduce((Z,ae)=>(ae instanceof t.Name&&(ae=O(ae)),ae instanceof t._Code?Z.push(...ae._items):Z.push(ae),Z),[]));function O(Z){const ae=g[Z.str];return ae===void 0||$[Z.str]!==1?Z:(delete $[Z.str],ae)}function te(Z){return Z instanceof t._Code&&Z._items.some(ae=>ae instanceof t.Name&&$[ae.str]===1&&g[ae.str]!==void 0)}}function C(b,$){for(const g in $)b[g]=(b[g]||0)-($[g]||0)}function I(b){return typeof b=="boolean"||typeof b=="number"||b===null?!b:(0,t._)`!${m(b)}`}e.not=I;const B=_(e.operators.AND);function J(...b){return b.reduce(B)}e.and=J;const Y=_(e.operators.OR);function H(...b){return b.reduce(Y)}e.or=H;function _(b){return($,g)=>$===t.nil?g:g===t.nil?$:(0,t._)`${m($)} ${b} ${m(g)}`}function m(b){return b instanceof t.Name?b:(0,t._)`(${b})`}})(codegen);var util$a={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.checkStrictMode=e.getErrorPath=e.Type=e.useFunc=e.setEvaluated=e.evaluatedPropsToName=e.mergeEvaluated=e.eachItem=e.unescapeJsonPointer=e.escapeJsonPointer=e.escapeFragment=e.unescapeFragment=e.schemaRefOrVal=e.schemaHasRulesButRef=e.schemaHasRules=e.checkUnknownRules=e.alwaysValidSchema=e.toHash=void 0;const t=codegen,n=code$1;function i(W){const ie={};for(const fe of W)ie[fe]=!0;return ie}e.toHash=i;function a(W,ie){return typeof ie=="boolean"?ie:Object.keys(ie).length===0?!0:(o(W,ie),!c(ie,W.self.RULES.all))}e.alwaysValidSchema=a;function o(W,ie=W.schema){const{opts:fe,self:ce}=W;if(!fe.strictSchema||typeof ie=="boolean")return;const ye=ce.RULES.keywords;for(const xe in ie)ye[xe]||ee(W,`unknown keyword: "${xe}"`)}e.checkUnknownRules=o;function c(W,ie){if(typeof W=="boolean")return!W;for(const fe in W)if(ie[fe])return!0;return!1}e.schemaHasRules=c;function d(W,ie){if(typeof W=="boolean")return!W;for(const fe in W)if(fe!=="$ref"&&ie.all[fe])return!0;return!1}e.schemaHasRulesButRef=d;function u({topSchemaRef:W,schemaPath:ie},fe,ce,ye){if(!ye){if(typeof fe=="number"||typeof fe=="boolean")return fe;if(typeof fe=="string")return(0,t._)`${fe}`}return(0,t._)`${W}${ie}${(0,t.getProperty)(ce)}`}e.schemaRefOrVal=u;function l(W){return y(decodeURIComponent(W))}e.unescapeFragment=l;function h(W){return encodeURIComponent(p(W))}e.escapeFragment=h;function p(W){return typeof W=="number"?`${W}`:W.replace(/~/g,"~0").replace(/\//g,"~1")}e.escapeJsonPointer=p;function y(W){return W.replace(/~1/g,"/").replace(/~0/g,"~")}e.unescapeJsonPointer=y;function E(W,ie){if(Array.isArray(W))for(const fe of W)ie(fe);else ie(W)}e.eachItem=E;function x({mergeNames:W,mergeToName:ie,mergeValues:fe,resultToName:ce}){return(ye,xe,Oe,F)=>{const v=Oe===void 0?xe:Oe instanceof t.Name?(xe instanceof t.Name?W(ye,xe,Oe):ie(ye,xe,Oe),Oe):xe instanceof t.Name?(ie(ye,Oe,xe),xe):fe(xe,Oe);return F===t.Name&&!(v instanceof t.Name)?ce(ye,v):v}}e.mergeEvaluated={props:x({mergeNames:(W,ie,fe)=>W.if((0,t._)`${fe} !== true && ${ie} !== undefined`,()=>{W.if((0,t._)`${ie} === true`,()=>W.assign(fe,!0),()=>W.assign(fe,(0,t._)`${fe} || {}`).code((0,t._)`Object.assign(${fe}, ${ie})`))}),mergeToName:(W,ie,fe)=>W.if((0,t._)`${fe} !== true`,()=>{ie===!0?W.assign(fe,!0):(W.assign(fe,(0,t._)`${fe} || {}`),k(W,fe,ie))}),mergeValues:(W,ie)=>W===!0?!0:{...W,...ie},resultToName:S}),items:x({mergeNames:(W,ie,fe)=>W.if((0,t._)`${fe} !== true && ${ie} !== undefined`,()=>W.assign(fe,(0,t._)`${ie} === true ? true : ${fe} > ${ie} ? ${fe} : ${ie}`)),mergeToName:(W,ie,fe)=>W.if((0,t._)`${fe} !== true`,()=>W.assign(fe,ie===!0?!0:(0,t._)`${fe} > ${ie} ? ${fe} : ${ie}`)),mergeValues:(W,ie)=>W===!0?!0:Math.max(W,ie),resultToName:(W,ie)=>W.var("items",ie)})};function S(W,ie){if(ie===!0)return W.var("props",!0);const fe=W.var("props",(0,t._)`{}`);return ie!==void 0&&k(W,fe,ie),fe}e.evaluatedPropsToName=S;function k(W,ie,fe){Object.keys(fe).forEach(ce=>W.assign((0,t._)`${ie}${(0,t.getProperty)(ce)}`,!0))}e.setEvaluated=k;const T={};function L(W,ie){return W.scopeValue("func",{ref:ie,code:T[ie.code]||(T[ie.code]=new n._Code(ie.code))})}e.useFunc=L;var q;(function(W){W[W.Num=0]="Num",W[W.Str=1]="Str"})(q=e.Type||(e.Type={}));function U(W,ie,fe){if(W instanceof t.Name){const ce=ie===q.Num;return fe?ce?(0,t._)`"[" + ${W} + "]"`:(0,t._)`"['" + ${W} + "']"`:ce?(0,t._)`"/" + ${W}`:(0,t._)`"/" + ${W}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return fe?(0,t.getProperty)(W).toString():"/"+p(W)}e.getErrorPath=U;function ee(W,ie,fe=W.opts.strictSchema){if(fe){if(ie=`strict mode: ${ie}`,fe===!0)throw new Error(ie);W.self.logger.warn(ie)}}e.checkStrictMode=ee})(util$a);var names$1={};Object.defineProperty(names$1,"__esModule",{value:!0});const codegen_1$u=codegen,names={data:new codegen_1$u.Name("data"),valCxt:new codegen_1$u.Name("valCxt"),instancePath:new codegen_1$u.Name("instancePath"),parentData:new codegen_1$u.Name("parentData"),parentDataProperty:new codegen_1$u.Name("parentDataProperty"),rootData:new codegen_1$u.Name("rootData"),dynamicAnchors:new codegen_1$u.Name("dynamicAnchors"),vErrors:new codegen_1$u.Name("vErrors"),errors:new codegen_1$u.Name("errors"),this:new codegen_1$u.Name("this"),self:new codegen_1$u.Name("self"),scope:new codegen_1$u.Name("scope"),json:new codegen_1$u.Name("json"),jsonPos:new codegen_1$u.Name("jsonPos"),jsonLen:new codegen_1$u.Name("jsonLen"),jsonPart:new codegen_1$u.Name("jsonPart")};names$1.default=names;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.extendErrors=e.resetErrorsCount=e.reportExtraError=e.reportError=e.keyword$DataError=e.keywordError=void 0;const t=codegen,n=util$a,i=names$1;e.keywordError={message:({keyword:k})=>(0,t.str)`must pass "${k}" keyword validation`},e.keyword$DataError={message:({keyword:k,schemaType:T})=>T?(0,t.str)`"${k}" keyword must be ${T} ($data)`:(0,t.str)`"${k}" keyword is invalid ($data)`};function a(k,T=e.keywordError,L,q){const{it:U}=k,{gen:ee,compositeRule:W,allErrors:ie}=U,fe=p(k,T,L);q??(W||ie)?u(ee,fe):l(U,(0,t._)`[${fe}]`)}e.reportError=a;function o(k,T=e.keywordError,L){const{it:q}=k,{gen:U,compositeRule:ee,allErrors:W}=q,ie=p(k,T,L);u(U,ie),ee||W||l(q,i.default.vErrors)}e.reportExtraError=o;function c(k,T){k.assign(i.default.errors,T),k.if((0,t._)`${i.default.vErrors} !== null`,()=>k.if(T,()=>k.assign((0,t._)`${i.default.vErrors}.length`,T),()=>k.assign(i.default.vErrors,null)))}e.resetErrorsCount=c;function d({gen:k,keyword:T,schemaValue:L,data:q,errsCount:U,it:ee}){if(U===void 0)throw new Error("ajv implementation error");const W=k.name("err");k.forRange("i",U,i.default.errors,ie=>{k.const(W,(0,t._)`${i.default.vErrors}[${ie}]`),k.if((0,t._)`${W}.instancePath === undefined`,()=>k.assign((0,t._)`${W}.instancePath`,(0,t.strConcat)(i.default.instancePath,ee.errorPath))),k.assign((0,t._)`${W}.schemaPath`,(0,t.str)`${ee.errSchemaPath}/${T}`),ee.opts.verbose&&(k.assign((0,t._)`${W}.schema`,L),k.assign((0,t._)`${W}.data`,q))})}e.extendErrors=d;function u(k,T){const L=k.const("err",T);k.if((0,t._)`${i.default.vErrors} === null`,()=>k.assign(i.default.vErrors,(0,t._)`[${L}]`),(0,t._)`${i.default.vErrors}.push(${L})`),k.code((0,t._)`${i.default.errors}++`)}function l(k,T){const{gen:L,validateName:q,schemaEnv:U}=k;U.$async?L.throw((0,t._)`new ${k.ValidationError}(${T})`):(L.assign((0,t._)`${q}.errors`,T),L.return(!1))}const h={keyword:new t.Name("keyword"),schemaPath:new t.Name("schemaPath"),params:new t.Name("params"),propertyName:new t.Name("propertyName"),message:new t.Name("message"),schema:new t.Name("schema"),parentSchema:new t.Name("parentSchema")};function p(k,T,L){const{createErrors:q}=k.it;return q===!1?(0,t._)`{}`:y(k,T,L)}function y(k,T,L={}){const{gen:q,it:U}=k,ee=[E(U,L),x(k,L)];return S(k,T,ee),q.object(...ee)}function E({errorPath:k},{instancePath:T}){const L=T?(0,t.str)`${k}${(0,n.getErrorPath)(T,n.Type.Str)}`:k;return[i.default.instancePath,(0,t.strConcat)(i.default.instancePath,L)]}function x({keyword:k,it:{errSchemaPath:T}},{schemaPath:L,parentSchema:q}){let U=q?T:(0,t.str)`${T}/${k}`;return L&&(U=(0,t.str)`${U}${(0,n.getErrorPath)(L,n.Type.Str)}`),[h.schemaPath,U]}function S(k,{params:T,message:L},q){const{keyword:U,data:ee,schemaValue:W,it:ie}=k,{opts:fe,propertyName:ce,topSchemaRef:ye,schemaPath:xe}=ie;q.push([h.keyword,U],[h.params,typeof T=="function"?T(k):T||(0,t._)`{}`]),fe.messages&&q.push([h.message,typeof L=="function"?L(k):L]),fe.verbose&&q.push([h.schema,W],[h.parentSchema,(0,t._)`${ye}${xe}`],[i.default.data,ee]),ce&&q.push([h.propertyName,ce])}})(errors);Object.defineProperty(boolSchema,"__esModule",{value:!0});boolSchema.boolOrEmptySchema=boolSchema.topBoolOrEmptySchema=void 0;const errors_1$2=errors,codegen_1$t=codegen,names_1$6=names$1,boolError={message:"boolean schema is false"};function topBoolOrEmptySchema(e){const{gen:t,schema:n,validateName:i}=e;n===!1?falseSchemaError(e,!1):typeof n=="object"&&n.$async===!0?t.return(names_1$6.default.data):(t.assign((0,codegen_1$t._)`${i}.errors`,null),t.return(!0))}boolSchema.topBoolOrEmptySchema=topBoolOrEmptySchema;function boolOrEmptySchema(e,t){const{gen:n,schema:i}=e;i===!1?(n.var(t,!1),falseSchemaError(e)):n.var(t,!0)}boolSchema.boolOrEmptySchema=boolOrEmptySchema;function falseSchemaError(e,t){const{gen:n,data:i}=e,a={gen:n,keyword:"false schema",data:i,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:e};(0,errors_1$2.reportError)(a,boolError,void 0,t)}var dataType={},rules={};Object.defineProperty(rules,"__esModule",{value:!0});rules.getRules=rules.isJSONType=void 0;const _jsonTypes=["string","number","integer","boolean","null","object","array"],jsonTypes=new Set(_jsonTypes);function isJSONType(e){return typeof e=="string"&&jsonTypes.has(e)}rules.isJSONType=isJSONType;function getRules(){const e={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...e,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},e.number,e.string,e.array,e.object],post:{rules:[]},all:{},keywords:{}}}rules.getRules=getRules;var applicability={};Object.defineProperty(applicability,"__esModule",{value:!0});applicability.shouldUseRule=applicability.shouldUseGroup=applicability.schemaHasRulesForType=void 0;function schemaHasRulesForType({schema:e,self:t},n){const i=t.RULES.types[n];return i&&i!==!0&&shouldUseGroup(e,i)}applicability.schemaHasRulesForType=schemaHasRulesForType;function shouldUseGroup(e,t){return t.rules.some(n=>shouldUseRule(e,n))}applicability.shouldUseGroup=shouldUseGroup;function shouldUseRule(e,t){var n;return e[t.keyword]!==void 0||((n=t.definition.implements)===null||n===void 0?void 0:n.some(i=>e[i]!==void 0))}applicability.shouldUseRule=shouldUseRule;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.reportTypeError=e.checkDataTypes=e.checkDataType=e.coerceAndCheckDataType=e.getJSONTypes=e.getSchemaTypes=e.DataType=void 0;const t=rules,n=applicability,i=errors,a=codegen,o=util$a;var c;(function(q){q[q.Correct=0]="Correct",q[q.Wrong=1]="Wrong"})(c=e.DataType||(e.DataType={}));function d(q){const U=u(q.type);if(U.includes("null")){if(q.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!U.length&&q.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');q.nullable===!0&&U.push("null")}return U}e.getSchemaTypes=d;function u(q){const U=Array.isArray(q)?q:q?[q]:[];if(U.every(t.isJSONType))return U;throw new Error("type must be JSONType or JSONType[]: "+U.join(","))}e.getJSONTypes=u;function l(q,U){const{gen:ee,data:W,opts:ie}=q,fe=p(U,ie.coerceTypes),ce=U.length>0&&!(fe.length===0&&U.length===1&&(0,n.schemaHasRulesForType)(q,U[0]));if(ce){const ye=S(U,W,ie.strictNumbers,c.Wrong);ee.if(ye,()=>{fe.length?y(q,U,fe):T(q)})}return ce}e.coerceAndCheckDataType=l;const h=new Set(["string","number","integer","boolean","null"]);function p(q,U){return U?q.filter(ee=>h.has(ee)||U==="array"&&ee==="array"):[]}function y(q,U,ee){const{gen:W,data:ie,opts:fe}=q,ce=W.let("dataType",(0,a._)`typeof ${ie}`),ye=W.let("coerced",(0,a._)`undefined`);fe.coerceTypes==="array"&&W.if((0,a._)`${ce} == 'object' && Array.isArray(${ie}) && ${ie}.length == 1`,()=>W.assign(ie,(0,a._)`${ie}[0]`).assign(ce,(0,a._)`typeof ${ie}`).if(S(U,ie,fe.strictNumbers),()=>W.assign(ye,ie))),W.if((0,a._)`${ye} !== undefined`);for(const Oe of ee)(h.has(Oe)||Oe==="array"&&fe.coerceTypes==="array")&&xe(Oe);W.else(),T(q),W.endIf(),W.if((0,a._)`${ye} !== undefined`,()=>{W.assign(ie,ye),E(q,ye)});function xe(Oe){switch(Oe){case"string":W.elseIf((0,a._)`${ce} == "number" || ${ce} == "boolean"`).assign(ye,(0,a._)`"" + ${ie}`).elseIf((0,a._)`${ie} === null`).assign(ye,(0,a._)`""`);return;case"number":W.elseIf((0,a._)`${ce} == "boolean" || ${ie} === null
              || (${ce} == "string" && ${ie} && ${ie} == +${ie})`).assign(ye,(0,a._)`+${ie}`);return;case"integer":W.elseIf((0,a._)`${ce} === "boolean" || ${ie} === null
              || (${ce} === "string" && ${ie} && ${ie} == +${ie} && !(${ie} % 1))`).assign(ye,(0,a._)`+${ie}`);return;case"boolean":W.elseIf((0,a._)`${ie} === "false" || ${ie} === 0 || ${ie} === null`).assign(ye,!1).elseIf((0,a._)`${ie} === "true" || ${ie} === 1`).assign(ye,!0);return;case"null":W.elseIf((0,a._)`${ie} === "" || ${ie} === 0 || ${ie} === false`),W.assign(ye,null);return;case"array":W.elseIf((0,a._)`${ce} === "string" || ${ce} === "number"
              || ${ce} === "boolean" || ${ie} === null`).assign(ye,(0,a._)`[${ie}]`)}}}function E({gen:q,parentData:U,parentDataProperty:ee},W){q.if((0,a._)`${U} !== undefined`,()=>q.assign((0,a._)`${U}[${ee}]`,W))}function x(q,U,ee,W=c.Correct){const ie=W===c.Correct?a.operators.EQ:a.operators.NEQ;let fe;switch(q){case"null":return(0,a._)`${U} ${ie} null`;case"array":fe=(0,a._)`Array.isArray(${U})`;break;case"object":fe=(0,a._)`${U} && typeof ${U} == "object" && !Array.isArray(${U})`;break;case"integer":fe=ce((0,a._)`!(${U} % 1) && !isNaN(${U})`);break;case"number":fe=ce();break;default:return(0,a._)`typeof ${U} ${ie} ${q}`}return W===c.Correct?fe:(0,a.not)(fe);function ce(ye=a.nil){return(0,a.and)((0,a._)`typeof ${U} == "number"`,ye,ee?(0,a._)`isFinite(${U})`:a.nil)}}e.checkDataType=x;function S(q,U,ee,W){if(q.length===1)return x(q[0],U,ee,W);let ie;const fe=(0,o.toHash)(q);if(fe.array&&fe.object){const ce=(0,a._)`typeof ${U} != "object"`;ie=fe.null?ce:(0,a._)`!${U} || ${ce}`,delete fe.null,delete fe.array,delete fe.object}else ie=a.nil;fe.number&&delete fe.integer;for(const ce in fe)ie=(0,a.and)(ie,x(ce,U,ee,W));return ie}e.checkDataTypes=S;const k={message:({schema:q})=>`must be ${q}`,params:({schema:q,schemaValue:U})=>typeof q=="string"?(0,a._)`{type: ${q}}`:(0,a._)`{type: ${U}}`};function T(q){const U=L(q);(0,i.reportError)(U,k)}e.reportTypeError=T;function L(q){const{gen:U,data:ee,schema:W}=q,ie=(0,o.schemaRefOrVal)(q,W,"type");return{gen:U,keyword:"type",data:ee,schema:W.type,schemaCode:ie,schemaValue:ie,parentSchema:W,params:{},it:q}}})(dataType);var defaults={};Object.defineProperty(defaults,"__esModule",{value:!0});defaults.assignDefaults=void 0;const codegen_1$s=codegen,util_1$p=util$a;function assignDefaults(e,t){const{properties:n,items:i}=e.schema;if(t==="object"&&n)for(const a in n)assignDefault(e,a,n[a].default);else t==="array"&&Array.isArray(i)&&i.forEach((a,o)=>assignDefault(e,o,a.default))}defaults.assignDefaults=assignDefaults;function assignDefault(e,t,n){const{gen:i,compositeRule:a,data:o,opts:c}=e;if(n===void 0)return;const d=(0,codegen_1$s._)`${o}${(0,codegen_1$s.getProperty)(t)}`;if(a){(0,util_1$p.checkStrictMode)(e,`default is ignored for: ${d}`);return}let u=(0,codegen_1$s._)`${d} === undefined`;c.useDefaults==="empty"&&(u=(0,codegen_1$s._)`${u} || ${d} === null || ${d} === ""`),i.if(u,(0,codegen_1$s._)`${d} = ${(0,codegen_1$s.stringify)(n)}`)}var keyword={},code={};Object.defineProperty(code,"__esModule",{value:!0});code.validateUnion=code.validateArray=code.usePattern=code.callValidateCode=code.schemaProperties=code.allSchemaProperties=code.noPropertyInData=code.propertyInData=code.isOwnProperty=code.hasPropFunc=code.reportMissingProp=code.checkMissingProp=code.checkReportMissingProp=void 0;const codegen_1$r=codegen,util_1$o=util$a,names_1$5=names$1,util_2$1=util$a;function checkReportMissingProp(e,t){const{gen:n,data:i,it:a}=e;n.if(noPropertyInData(n,i,t,a.opts.ownProperties),()=>{e.setParams({missingProperty:(0,codegen_1$r._)`${t}`},!0),e.error()})}code.checkReportMissingProp=checkReportMissingProp;function checkMissingProp({gen:e,data:t,it:{opts:n}},i,a){return(0,codegen_1$r.or)(...i.map(o=>(0,codegen_1$r.and)(noPropertyInData(e,t,o,n.ownProperties),(0,codegen_1$r._)`${a} = ${o}`)))}code.checkMissingProp=checkMissingProp;function reportMissingProp(e,t){e.setParams({missingProperty:t},!0),e.error()}code.reportMissingProp=reportMissingProp;function hasPropFunc(e){return e.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,codegen_1$r._)`Object.prototype.hasOwnProperty`})}code.hasPropFunc=hasPropFunc;function isOwnProperty(e,t,n){return(0,codegen_1$r._)`${hasPropFunc(e)}.call(${t}, ${n})`}code.isOwnProperty=isOwnProperty;function propertyInData(e,t,n,i){const a=(0,codegen_1$r._)`${t}${(0,codegen_1$r.getProperty)(n)} !== undefined`;return i?(0,codegen_1$r._)`${a} && ${isOwnProperty(e,t,n)}`:a}code.propertyInData=propertyInData;function noPropertyInData(e,t,n,i){const a=(0,codegen_1$r._)`${t}${(0,codegen_1$r.getProperty)(n)} === undefined`;return i?(0,codegen_1$r.or)(a,(0,codegen_1$r.not)(isOwnProperty(e,t,n))):a}code.noPropertyInData=noPropertyInData;function allSchemaProperties(e){return e?Object.keys(e).filter(t=>t!=="__proto__"):[]}code.allSchemaProperties=allSchemaProperties;function schemaProperties(e,t){return allSchemaProperties(t).filter(n=>!(0,util_1$o.alwaysValidSchema)(e,t[n]))}code.schemaProperties=schemaProperties;function callValidateCode({schemaCode:e,data:t,it:{gen:n,topSchemaRef:i,schemaPath:a,errorPath:o},it:c},d,u,l){const h=l?(0,codegen_1$r._)`${e}, ${t}, ${i}${a}`:t,p=[[names_1$5.default.instancePath,(0,codegen_1$r.strConcat)(names_1$5.default.instancePath,o)],[names_1$5.default.parentData,c.parentData],[names_1$5.default.parentDataProperty,c.parentDataProperty],[names_1$5.default.rootData,names_1$5.default.rootData]];c.opts.dynamicRef&&p.push([names_1$5.default.dynamicAnchors,names_1$5.default.dynamicAnchors]);const y=(0,codegen_1$r._)`${h}, ${n.object(...p)}`;return u!==codegen_1$r.nil?(0,codegen_1$r._)`${d}.call(${u}, ${y})`:(0,codegen_1$r._)`${d}(${y})`}code.callValidateCode=callValidateCode;const newRegExp=(0,codegen_1$r._)`new RegExp`;function usePattern$1({gen:e,it:{opts:t}},n){const i=t.unicodeRegExp?"u":"",{regExp:a}=t.code,o=a(n,i);return e.scopeValue("pattern",{key:o.toString(),ref:o,code:(0,codegen_1$r._)`${a.code==="new RegExp"?newRegExp:(0,util_2$1.useFunc)(e,a)}(${n}, ${i})`})}code.usePattern=usePattern$1;function validateArray(e){const{gen:t,data:n,keyword:i,it:a}=e,o=t.name("valid");if(a.allErrors){const d=t.let("valid",!0);return c(()=>t.assign(d,!1)),d}return t.var(o,!0),c(()=>t.break()),o;function c(d){const u=t.const("len",(0,codegen_1$r._)`${n}.length`);t.forRange("i",0,u,l=>{e.subschema({keyword:i,dataProp:l,dataPropType:util_1$o.Type.Num},o),t.if((0,codegen_1$r.not)(o),d)})}}code.validateArray=validateArray;function validateUnion(e){const{gen:t,schema:n,keyword:i,it:a}=e;if(!Array.isArray(n))throw new Error("ajv implementation error");if(n.some(u=>(0,util_1$o.alwaysValidSchema)(a,u))&&!a.opts.unevaluated)return;const c=t.let("valid",!1),d=t.name("_valid");t.block(()=>n.forEach((u,l)=>{const h=e.subschema({keyword:i,schemaProp:l,compositeRule:!0},d);t.assign(c,(0,codegen_1$r._)`${c} || ${d}`),e.mergeValidEvaluated(h,d)||t.if((0,codegen_1$r.not)(c))})),e.result(c,()=>e.reset(),()=>e.error(!0))}code.validateUnion=validateUnion;Object.defineProperty(keyword,"__esModule",{value:!0});keyword.validateKeywordUsage=keyword.validSchemaType=keyword.funcKeywordCode=keyword.macroKeywordCode=void 0;const codegen_1$q=codegen,names_1$4=names$1,code_1$9=code,errors_1$1=errors;function macroKeywordCode(e,t){const{gen:n,keyword:i,schema:a,parentSchema:o,it:c}=e,d=t.macro.call(c.self,a,o,c),u=useKeyword(n,i,d);c.opts.validateSchema!==!1&&c.self.validateSchema(d,!0);const l=n.name("valid");e.subschema({schema:d,schemaPath:codegen_1$q.nil,errSchemaPath:`${c.errSchemaPath}/${i}`,topSchemaRef:u,compositeRule:!0},l),e.pass(l,()=>e.error(!0))}keyword.macroKeywordCode=macroKeywordCode;function funcKeywordCode(e,t){var n;const{gen:i,keyword:a,schema:o,parentSchema:c,$data:d,it:u}=e;checkAsyncKeyword(u,t);const l=!d&&t.compile?t.compile.call(u.self,o,c,u):t.validate,h=useKeyword(i,a,l),p=i.let("valid");e.block$data(p,y),e.ok((n=t.valid)!==null&&n!==void 0?n:p);function y(){if(t.errors===!1)S(),t.modifying&&modifyData(e),k(()=>e.error());else{const T=t.async?E():x();t.modifying&&modifyData(e),k(()=>addErrs(e,T))}}function E(){const T=i.let("ruleErrs",null);return i.try(()=>S((0,codegen_1$q._)`await `),L=>i.assign(p,!1).if((0,codegen_1$q._)`${L} instanceof ${u.ValidationError}`,()=>i.assign(T,(0,codegen_1$q._)`${L}.errors`),()=>i.throw(L))),T}function x(){const T=(0,codegen_1$q._)`${h}.errors`;return i.assign(T,null),S(codegen_1$q.nil),T}function S(T=t.async?(0,codegen_1$q._)`await `:codegen_1$q.nil){const L=u.opts.passContext?names_1$4.default.this:names_1$4.default.self,q=!("compile"in t&&!d||t.schema===!1);i.assign(p,(0,codegen_1$q._)`${T}${(0,code_1$9.callValidateCode)(e,h,L,q)}`,t.modifying)}function k(T){var L;i.if((0,codegen_1$q.not)((L=t.valid)!==null&&L!==void 0?L:p),T)}}keyword.funcKeywordCode=funcKeywordCode;function modifyData(e){const{gen:t,data:n,it:i}=e;t.if(i.parentData,()=>t.assign(n,(0,codegen_1$q._)`${i.parentData}[${i.parentDataProperty}]`))}function addErrs(e,t){const{gen:n}=e;n.if((0,codegen_1$q._)`Array.isArray(${t})`,()=>{n.assign(names_1$4.default.vErrors,(0,codegen_1$q._)`${names_1$4.default.vErrors} === null ? ${t} : ${names_1$4.default.vErrors}.concat(${t})`).assign(names_1$4.default.errors,(0,codegen_1$q._)`${names_1$4.default.vErrors}.length`),(0,errors_1$1.extendErrors)(e)},()=>e.error())}function checkAsyncKeyword({schemaEnv:e},t){if(t.async&&!e.$async)throw new Error("async keyword in sync schema")}function useKeyword(e,t,n){if(n===void 0)throw new Error(`keyword "${t}" failed to compile`);return e.scopeValue("keyword",typeof n=="function"?{ref:n}:{ref:n,code:(0,codegen_1$q.stringify)(n)})}function validSchemaType(e,t,n=!1){return!t.length||t.some(i=>i==="array"?Array.isArray(e):i==="object"?e&&typeof e=="object"&&!Array.isArray(e):typeof e==i||n&&typeof e>"u")}keyword.validSchemaType=validSchemaType;function validateKeywordUsage({schema:e,opts:t,self:n,errSchemaPath:i},a,o){if(Array.isArray(a.keyword)?!a.keyword.includes(o):a.keyword!==o)throw new Error("ajv implementation error");const c=a.dependencies;if(c!=null&&c.some(d=>!Object.prototype.hasOwnProperty.call(e,d)))throw new Error(`parent schema must have dependencies of ${o}: ${c.join(",")}`);if(a.validateSchema&&!a.validateSchema(e[o])){const u=`keyword "${o}" value is invalid at path "${i}": `+n.errorsText(a.validateSchema.errors);if(t.validateSchema==="log")n.logger.error(u);else throw new Error(u)}}keyword.validateKeywordUsage=validateKeywordUsage;var subschema={};Object.defineProperty(subschema,"__esModule",{value:!0});subschema.extendSubschemaMode=subschema.extendSubschemaData=subschema.getSubschema=void 0;const codegen_1$p=codegen,util_1$n=util$a;function getSubschema(e,{keyword:t,schemaProp:n,schema:i,schemaPath:a,errSchemaPath:o,topSchemaRef:c}){if(t!==void 0&&i!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(t!==void 0){const d=e.schema[t];return n===void 0?{schema:d,schemaPath:(0,codegen_1$p._)`${e.schemaPath}${(0,codegen_1$p.getProperty)(t)}`,errSchemaPath:`${e.errSchemaPath}/${t}`}:{schema:d[n],schemaPath:(0,codegen_1$p._)`${e.schemaPath}${(0,codegen_1$p.getProperty)(t)}${(0,codegen_1$p.getProperty)(n)}`,errSchemaPath:`${e.errSchemaPath}/${t}/${(0,util_1$n.escapeFragment)(n)}`}}if(i!==void 0){if(a===void 0||o===void 0||c===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:i,schemaPath:a,topSchemaRef:c,errSchemaPath:o}}throw new Error('either "keyword" or "schema" must be passed')}subschema.getSubschema=getSubschema;function extendSubschemaData(e,t,{dataProp:n,dataPropType:i,data:a,dataTypes:o,propertyName:c}){if(a!==void 0&&n!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:d}=t;if(n!==void 0){const{errorPath:l,dataPathArr:h,opts:p}=t,y=d.let("data",(0,codegen_1$p._)`${t.data}${(0,codegen_1$p.getProperty)(n)}`,!0);u(y),e.errorPath=(0,codegen_1$p.str)`${l}${(0,util_1$n.getErrorPath)(n,i,p.jsPropertySyntax)}`,e.parentDataProperty=(0,codegen_1$p._)`${n}`,e.dataPathArr=[...h,e.parentDataProperty]}if(a!==void 0){const l=a instanceof codegen_1$p.Name?a:d.let("data",a,!0);u(l),c!==void 0&&(e.propertyName=c)}o&&(e.dataTypes=o);function u(l){e.data=l,e.dataLevel=t.dataLevel+1,e.dataTypes=[],t.definedProperties=new Set,e.parentData=t.data,e.dataNames=[...t.dataNames,l]}}subschema.extendSubschemaData=extendSubschemaData;function extendSubschemaMode(e,{jtdDiscriminator:t,jtdMetadata:n,compositeRule:i,createErrors:a,allErrors:o}){i!==void 0&&(e.compositeRule=i),a!==void 0&&(e.createErrors=a),o!==void 0&&(e.allErrors=o),e.jtdDiscriminator=t,e.jtdMetadata=n}subschema.extendSubschemaMode=extendSubschemaMode;var resolve$1={},fastDeepEqual=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var i,a,o;if(Array.isArray(t)){if(i=t.length,i!=n.length)return!1;for(a=i;a--!==0;)if(!e(t[a],n[a]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(o=Object.keys(t),i=o.length,i!==Object.keys(n).length)return!1;for(a=i;a--!==0;)if(!Object.prototype.hasOwnProperty.call(n,o[a]))return!1;for(a=i;a--!==0;){var c=o[a];if(!e(t[c],n[c]))return!1}return!0}return t!==t&&n!==n},jsonSchemaTraverseExports={},jsonSchemaTraverse={get exports(){return jsonSchemaTraverseExports},set exports(e){jsonSchemaTraverseExports=e}},traverse$1=jsonSchemaTraverse.exports=function(e,t,n){typeof t=="function"&&(n=t,t={}),n=t.cb||n;var i=typeof n=="function"?n:n.pre||function(){},a=n.post||function(){};_traverse(t,i,a,e,"",e)};traverse$1.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};traverse$1.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};traverse$1.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};traverse$1.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function _traverse(e,t,n,i,a,o,c,d,u,l){if(i&&typeof i=="object"&&!Array.isArray(i)){t(i,a,o,c,d,u,l);for(var h in i){var p=i[h];if(Array.isArray(p)){if(h in traverse$1.arrayKeywords)for(var y=0;y<p.length;y++)_traverse(e,t,n,p[y],a+"/"+h+"/"+y,o,a,h,i,y)}else if(h in traverse$1.propsKeywords){if(p&&typeof p=="object")for(var E in p)_traverse(e,t,n,p[E],a+"/"+h+"/"+escapeJsonPtr(E),o,a,h,i,E)}else(h in traverse$1.keywords||e.allKeys&&!(h in traverse$1.skipKeywords))&&_traverse(e,t,n,p,a+"/"+h,o,a,h,i)}n(i,a,o,c,d,u,l)}}function escapeJsonPtr(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}Object.defineProperty(resolve$1,"__esModule",{value:!0});resolve$1.getSchemaRefs=resolve$1.resolveUrl=resolve$1.normalizeId=resolve$1._getFullPath=resolve$1.getFullPath=resolve$1.inlineRef=void 0;const util_1$m=util$a,equal$2=fastDeepEqual,traverse=jsonSchemaTraverseExports,SIMPLE_INLINED=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function inlineRef(e,t=!0){return typeof e=="boolean"?!0:t===!0?!hasRef(e):t?countKeys(e)<=t:!1}resolve$1.inlineRef=inlineRef;const REF_KEYWORDS=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function hasRef(e){for(const t in e){if(REF_KEYWORDS.has(t))return!0;const n=e[t];if(Array.isArray(n)&&n.some(hasRef)||typeof n=="object"&&hasRef(n))return!0}return!1}function countKeys(e){let t=0;for(const n in e){if(n==="$ref")return 1/0;if(t++,!SIMPLE_INLINED.has(n)&&(typeof e[n]=="object"&&(0,util_1$m.eachItem)(e[n],i=>t+=countKeys(i)),t===1/0))return 1/0}return t}function getFullPath(e,t="",n){n!==!1&&(t=normalizeId(t));const i=e.parse(t);return _getFullPath(e,i)}resolve$1.getFullPath=getFullPath;function _getFullPath(e,t){return e.serialize(t).split("#")[0]+"#"}resolve$1._getFullPath=_getFullPath;const TRAILING_SLASH_HASH=/#\/?$/;function normalizeId(e){return e?e.replace(TRAILING_SLASH_HASH,""):""}resolve$1.normalizeId=normalizeId;function resolveUrl(e,t,n){return n=normalizeId(n),e.resolve(t,n)}resolve$1.resolveUrl=resolveUrl;const ANCHOR=/^[a-z_][-a-z0-9._]*$/i;function getSchemaRefs(e,t){if(typeof e=="boolean")return{};const{schemaId:n,uriResolver:i}=this.opts,a=normalizeId(e[n]||t),o={"":a},c=getFullPath(i,a,!1),d={},u=new Set;return traverse(e,{allKeys:!0},(p,y,E,x)=>{if(x===void 0)return;const S=c+y;let k=o[x];typeof p[n]=="string"&&(k=T.call(this,p[n])),L.call(this,p.$anchor),L.call(this,p.$dynamicAnchor),o[y]=k;function T(q){const U=this.opts.uriResolver.resolve;if(q=normalizeId(k?U(k,q):q),u.has(q))throw h(q);u.add(q);let ee=this.refs[q];return typeof ee=="string"&&(ee=this.refs[ee]),typeof ee=="object"?l(p,ee.schema,q):q!==normalizeId(S)&&(q[0]==="#"?(l(p,d[q],q),d[q]=p):this.refs[q]=S),q}function L(q){if(typeof q=="string"){if(!ANCHOR.test(q))throw new Error(`invalid anchor "${q}"`);T.call(this,`#${q}`)}}}),d;function l(p,y,E){if(y!==void 0&&!equal$2(p,y))throw h(E)}function h(p){return new Error(`reference "${p}" resolves to more than one schema`)}}resolve$1.getSchemaRefs=getSchemaRefs;Object.defineProperty(validate,"__esModule",{value:!0});validate.getData=validate.KeywordCxt=validate.validateFunctionCode=void 0;const boolSchema_1=boolSchema,dataType_1$1=dataType,applicability_1=applicability,dataType_2=dataType,defaults_1=defaults,keyword_1=keyword,subschema_1=subschema,codegen_1$o=codegen,names_1$3=names$1,resolve_1$2=resolve$1,util_1$l=util$a,errors_1=errors;function validateFunctionCode(e){if(isSchemaObj(e)&&(checkKeywords(e),schemaCxtHasRules(e))){topSchemaObjCode(e);return}validateFunction(e,()=>(0,boolSchema_1.topBoolOrEmptySchema)(e))}validate.validateFunctionCode=validateFunctionCode;function validateFunction({gen:e,validateName:t,schema:n,schemaEnv:i,opts:a},o){a.code.es5?e.func(t,(0,codegen_1$o._)`${names_1$3.default.data}, ${names_1$3.default.valCxt}`,i.$async,()=>{e.code((0,codegen_1$o._)`"use strict"; ${funcSourceUrl(n,a)}`),destructureValCxtES5(e,a),e.code(o)}):e.func(t,(0,codegen_1$o._)`${names_1$3.default.data}, ${destructureValCxt(a)}`,i.$async,()=>e.code(funcSourceUrl(n,a)).code(o))}function destructureValCxt(e){return(0,codegen_1$o._)`{${names_1$3.default.instancePath}="", ${names_1$3.default.parentData}, ${names_1$3.default.parentDataProperty}, ${names_1$3.default.rootData}=${names_1$3.default.data}${e.dynamicRef?(0,codegen_1$o._)`, ${names_1$3.default.dynamicAnchors}={}`:codegen_1$o.nil}}={}`}function destructureValCxtES5(e,t){e.if(names_1$3.default.valCxt,()=>{e.var(names_1$3.default.instancePath,(0,codegen_1$o._)`${names_1$3.default.valCxt}.${names_1$3.default.instancePath}`),e.var(names_1$3.default.parentData,(0,codegen_1$o._)`${names_1$3.default.valCxt}.${names_1$3.default.parentData}`),e.var(names_1$3.default.parentDataProperty,(0,codegen_1$o._)`${names_1$3.default.valCxt}.${names_1$3.default.parentDataProperty}`),e.var(names_1$3.default.rootData,(0,codegen_1$o._)`${names_1$3.default.valCxt}.${names_1$3.default.rootData}`),t.dynamicRef&&e.var(names_1$3.default.dynamicAnchors,(0,codegen_1$o._)`${names_1$3.default.valCxt}.${names_1$3.default.dynamicAnchors}`)},()=>{e.var(names_1$3.default.instancePath,(0,codegen_1$o._)`""`),e.var(names_1$3.default.parentData,(0,codegen_1$o._)`undefined`),e.var(names_1$3.default.parentDataProperty,(0,codegen_1$o._)`undefined`),e.var(names_1$3.default.rootData,names_1$3.default.data),t.dynamicRef&&e.var(names_1$3.default.dynamicAnchors,(0,codegen_1$o._)`{}`)})}function topSchemaObjCode(e){const{schema:t,opts:n,gen:i}=e;validateFunction(e,()=>{n.$comment&&t.$comment&&commentKeyword(e),checkNoDefault(e),i.let(names_1$3.default.vErrors,null),i.let(names_1$3.default.errors,0),n.unevaluated&&resetEvaluated(e),typeAndKeywords(e),returnResults(e)})}function resetEvaluated(e){const{gen:t,validateName:n}=e;e.evaluated=t.const("evaluated",(0,codegen_1$o._)`${n}.evaluated`),t.if((0,codegen_1$o._)`${e.evaluated}.dynamicProps`,()=>t.assign((0,codegen_1$o._)`${e.evaluated}.props`,(0,codegen_1$o._)`undefined`)),t.if((0,codegen_1$o._)`${e.evaluated}.dynamicItems`,()=>t.assign((0,codegen_1$o._)`${e.evaluated}.items`,(0,codegen_1$o._)`undefined`))}function funcSourceUrl(e,t){const n=typeof e=="object"&&e[t.schemaId];return n&&(t.code.source||t.code.process)?(0,codegen_1$o._)`/*# sourceURL=${n} */`:codegen_1$o.nil}function subschemaCode(e,t){if(isSchemaObj(e)&&(checkKeywords(e),schemaCxtHasRules(e))){subSchemaObjCode(e,t);return}(0,boolSchema_1.boolOrEmptySchema)(e,t)}function schemaCxtHasRules({schema:e,self:t}){if(typeof e=="boolean")return!e;for(const n in e)if(t.RULES.all[n])return!0;return!1}function isSchemaObj(e){return typeof e.schema!="boolean"}function subSchemaObjCode(e,t){const{schema:n,gen:i,opts:a}=e;a.$comment&&n.$comment&&commentKeyword(e),updateContext(e),checkAsyncSchema(e);const o=i.const("_errs",names_1$3.default.errors);typeAndKeywords(e,o),i.var(t,(0,codegen_1$o._)`${o} === ${names_1$3.default.errors}`)}function checkKeywords(e){(0,util_1$l.checkUnknownRules)(e),checkRefsAndKeywords(e)}function typeAndKeywords(e,t){if(e.opts.jtd)return schemaKeywords(e,[],!1,t);const n=(0,dataType_1$1.getSchemaTypes)(e.schema),i=(0,dataType_1$1.coerceAndCheckDataType)(e,n);schemaKeywords(e,n,!i,t)}function checkRefsAndKeywords(e){const{schema:t,errSchemaPath:n,opts:i,self:a}=e;t.$ref&&i.ignoreKeywordsWithRef&&(0,util_1$l.schemaHasRulesButRef)(t,a.RULES)&&a.logger.warn(`$ref: keywords ignored in schema at path "${n}"`)}function checkNoDefault(e){const{schema:t,opts:n}=e;t.default!==void 0&&n.useDefaults&&n.strictSchema&&(0,util_1$l.checkStrictMode)(e,"default is ignored in the schema root")}function updateContext(e){const t=e.schema[e.opts.schemaId];t&&(e.baseId=(0,resolve_1$2.resolveUrl)(e.opts.uriResolver,e.baseId,t))}function checkAsyncSchema(e){if(e.schema.$async&&!e.schemaEnv.$async)throw new Error("async schema in sync schema")}function commentKeyword({gen:e,schemaEnv:t,schema:n,errSchemaPath:i,opts:a}){const o=n.$comment;if(a.$comment===!0)e.code((0,codegen_1$o._)`${names_1$3.default.self}.logger.log(${o})`);else if(typeof a.$comment=="function"){const c=(0,codegen_1$o.str)`${i}/$comment`,d=e.scopeValue("root",{ref:t.root});e.code((0,codegen_1$o._)`${names_1$3.default.self}.opts.$comment(${o}, ${c}, ${d}.schema)`)}}function returnResults(e){const{gen:t,schemaEnv:n,validateName:i,ValidationError:a,opts:o}=e;n.$async?t.if((0,codegen_1$o._)`${names_1$3.default.errors} === 0`,()=>t.return(names_1$3.default.data),()=>t.throw((0,codegen_1$o._)`new ${a}(${names_1$3.default.vErrors})`)):(t.assign((0,codegen_1$o._)`${i}.errors`,names_1$3.default.vErrors),o.unevaluated&&assignEvaluated(e),t.return((0,codegen_1$o._)`${names_1$3.default.errors} === 0`))}function assignEvaluated({gen:e,evaluated:t,props:n,items:i}){n instanceof codegen_1$o.Name&&e.assign((0,codegen_1$o._)`${t}.props`,n),i instanceof codegen_1$o.Name&&e.assign((0,codegen_1$o._)`${t}.items`,i)}function schemaKeywords(e,t,n,i){const{gen:a,schema:o,data:c,allErrors:d,opts:u,self:l}=e,{RULES:h}=l;if(o.$ref&&(u.ignoreKeywordsWithRef||!(0,util_1$l.schemaHasRulesButRef)(o,h))){a.block(()=>keywordCode(e,"$ref",h.all.$ref.definition));return}u.jtd||checkStrictTypes(e,t),a.block(()=>{for(const y of h.rules)p(y);p(h.post)});function p(y){(0,applicability_1.shouldUseGroup)(o,y)&&(y.type?(a.if((0,dataType_2.checkDataType)(y.type,c,u.strictNumbers)),iterateKeywords(e,y),t.length===1&&t[0]===y.type&&n&&(a.else(),(0,dataType_2.reportTypeError)(e)),a.endIf()):iterateKeywords(e,y),d||a.if((0,codegen_1$o._)`${names_1$3.default.errors} === ${i||0}`))}}function iterateKeywords(e,t){const{gen:n,schema:i,opts:{useDefaults:a}}=e;a&&(0,defaults_1.assignDefaults)(e,t.type),n.block(()=>{for(const o of t.rules)(0,applicability_1.shouldUseRule)(i,o)&&keywordCode(e,o.keyword,o.definition,t.type)})}function checkStrictTypes(e,t){e.schemaEnv.meta||!e.opts.strictTypes||(checkContextTypes(e,t),e.opts.allowUnionTypes||checkMultipleTypes(e,t),checkKeywordTypes(e,e.dataTypes))}function checkContextTypes(e,t){if(t.length){if(!e.dataTypes.length){e.dataTypes=t;return}t.forEach(n=>{includesType(e.dataTypes,n)||strictTypesError(e,`type "${n}" not allowed by context "${e.dataTypes.join(",")}"`)}),narrowSchemaTypes(e,t)}}function checkMultipleTypes(e,t){t.length>1&&!(t.length===2&&t.includes("null"))&&strictTypesError(e,"use allowUnionTypes to allow union type keyword")}function checkKeywordTypes(e,t){const n=e.self.RULES.all;for(const i in n){const a=n[i];if(typeof a=="object"&&(0,applicability_1.shouldUseRule)(e.schema,a)){const{type:o}=a.definition;o.length&&!o.some(c=>hasApplicableType(t,c))&&strictTypesError(e,`missing type "${o.join(",")}" for keyword "${i}"`)}}}function hasApplicableType(e,t){return e.includes(t)||t==="number"&&e.includes("integer")}function includesType(e,t){return e.includes(t)||t==="integer"&&e.includes("number")}function narrowSchemaTypes(e,t){const n=[];for(const i of e.dataTypes)includesType(t,i)?n.push(i):t.includes("integer")&&i==="number"&&n.push("integer");e.dataTypes=n}function strictTypesError(e,t){const n=e.schemaEnv.baseId+e.errSchemaPath;t+=` at "${n}" (strictTypes)`,(0,util_1$l.checkStrictMode)(e,t,e.opts.strictTypes)}class KeywordCxt{constructor(t,n,i){if((0,keyword_1.validateKeywordUsage)(t,n,i),this.gen=t.gen,this.allErrors=t.allErrors,this.keyword=i,this.data=t.data,this.schema=t.schema[i],this.$data=n.$data&&t.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,util_1$l.schemaRefOrVal)(t,this.schema,i,this.$data),this.schemaType=n.schemaType,this.parentSchema=t.schema,this.params={},this.it=t,this.def=n,this.$data)this.schemaCode=t.gen.const("vSchema",getData(this.$data,t));else if(this.schemaCode=this.schemaValue,!(0,keyword_1.validSchemaType)(this.schema,n.schemaType,n.allowUndefined))throw new Error(`${i} value must be ${JSON.stringify(n.schemaType)}`);("code"in n?n.trackErrors:n.errors!==!1)&&(this.errsCount=t.gen.const("_errs",names_1$3.default.errors))}result(t,n,i){this.failResult((0,codegen_1$o.not)(t),n,i)}failResult(t,n,i){this.gen.if(t),i?i():this.error(),n?(this.gen.else(),n(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(t,n){this.failResult((0,codegen_1$o.not)(t),void 0,n)}fail(t){if(t===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(t),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(t){if(!this.$data)return this.fail(t);const{schemaCode:n}=this;this.fail((0,codegen_1$o._)`${n} !== undefined && (${(0,codegen_1$o.or)(this.invalid$data(),t)})`)}error(t,n,i){if(n){this.setParams(n),this._error(t,i),this.setParams({});return}this._error(t,i)}_error(t,n){(t?errors_1.reportExtraError:errors_1.reportError)(this,this.def.error,n)}$dataError(){(0,errors_1.reportError)(this,this.def.$dataError||errors_1.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,errors_1.resetErrorsCount)(this.gen,this.errsCount)}ok(t){this.allErrors||this.gen.if(t)}setParams(t,n){n?Object.assign(this.params,t):this.params=t}block$data(t,n,i=codegen_1$o.nil){this.gen.block(()=>{this.check$data(t,i),n()})}check$data(t=codegen_1$o.nil,n=codegen_1$o.nil){if(!this.$data)return;const{gen:i,schemaCode:a,schemaType:o,def:c}=this;i.if((0,codegen_1$o.or)((0,codegen_1$o._)`${a} === undefined`,n)),t!==codegen_1$o.nil&&i.assign(t,!0),(o.length||c.validateSchema)&&(i.elseIf(this.invalid$data()),this.$dataError(),t!==codegen_1$o.nil&&i.assign(t,!1)),i.else()}invalid$data(){const{gen:t,schemaCode:n,schemaType:i,def:a,it:o}=this;return(0,codegen_1$o.or)(c(),d());function c(){if(i.length){if(!(n instanceof codegen_1$o.Name))throw new Error("ajv implementation error");const u=Array.isArray(i)?i:[i];return(0,codegen_1$o._)`${(0,dataType_2.checkDataTypes)(u,n,o.opts.strictNumbers,dataType_2.DataType.Wrong)}`}return codegen_1$o.nil}function d(){if(a.validateSchema){const u=t.scopeValue("validate$data",{ref:a.validateSchema});return(0,codegen_1$o._)`!${u}(${n})`}return codegen_1$o.nil}}subschema(t,n){const i=(0,subschema_1.getSubschema)(this.it,t);(0,subschema_1.extendSubschemaData)(i,this.it,t),(0,subschema_1.extendSubschemaMode)(i,t);const a={...this.it,...i,items:void 0,props:void 0};return subschemaCode(a,n),a}mergeEvaluated(t,n){const{it:i,gen:a}=this;i.opts.unevaluated&&(i.props!==!0&&t.props!==void 0&&(i.props=util_1$l.mergeEvaluated.props(a,t.props,i.props,n)),i.items!==!0&&t.items!==void 0&&(i.items=util_1$l.mergeEvaluated.items(a,t.items,i.items,n)))}mergeValidEvaluated(t,n){const{it:i,gen:a}=this;if(i.opts.unevaluated&&(i.props!==!0||i.items!==!0))return a.if(n,()=>this.mergeEvaluated(t,codegen_1$o.Name)),!0}}validate.KeywordCxt=KeywordCxt;function keywordCode(e,t,n,i){const a=new KeywordCxt(e,n,t);"code"in n?n.code(a,i):a.$data&&n.validate?(0,keyword_1.funcKeywordCode)(a,n):"macro"in n?(0,keyword_1.macroKeywordCode)(a,n):(n.compile||n.validate)&&(0,keyword_1.funcKeywordCode)(a,n)}const JSON_POINTER=/^\/(?:[^~]|~0|~1)*$/,RELATIVE_JSON_POINTER=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function getData(e,{dataLevel:t,dataNames:n,dataPathArr:i}){let a,o;if(e==="")return names_1$3.default.rootData;if(e[0]==="/"){if(!JSON_POINTER.test(e))throw new Error(`Invalid JSON-pointer: ${e}`);a=e,o=names_1$3.default.rootData}else{const l=RELATIVE_JSON_POINTER.exec(e);if(!l)throw new Error(`Invalid JSON-pointer: ${e}`);const h=+l[1];if(a=l[2],a==="#"){if(h>=t)throw new Error(u("property/index",h));return i[t-h]}if(h>t)throw new Error(u("data",h));if(o=n[t-h],!a)return o}let c=o;const d=a.split("/");for(const l of d)l&&(o=(0,codegen_1$o._)`${o}${(0,codegen_1$o.getProperty)((0,util_1$l.unescapeJsonPointer)(l))}`,c=(0,codegen_1$o._)`${c} && ${o}`);return c;function u(l,h){return`Cannot access ${l} ${h} levels up, current level is ${t}`}}validate.getData=getData;var validation_error={};Object.defineProperty(validation_error,"__esModule",{value:!0});class ValidationError extends Error{constructor(t){super("validation failed"),this.errors=t,this.ajv=this.validation=!0}}validation_error.default=ValidationError;var ref_error={};Object.defineProperty(ref_error,"__esModule",{value:!0});const resolve_1$1=resolve$1;class MissingRefError extends Error{constructor(t,n,i,a){super(a||`can't resolve reference ${i} from id ${n}`),this.missingRef=(0,resolve_1$1.resolveUrl)(t,n,i),this.missingSchema=(0,resolve_1$1.normalizeId)((0,resolve_1$1.getFullPath)(t,this.missingRef))}}ref_error.default=MissingRefError;var compile={};Object.defineProperty(compile,"__esModule",{value:!0});compile.resolveSchema=compile.getCompilingSchema=compile.resolveRef=compile.compileSchema=compile.SchemaEnv=void 0;const codegen_1$n=codegen,validation_error_1=validation_error,names_1$2=names$1,resolve_1=resolve$1,util_1$k=util$a,validate_1$1=validate;class SchemaEnv{constructor(t){var n;this.refs={},this.dynamicAnchors={};let i;typeof t.schema=="object"&&(i=t.schema),this.schema=t.schema,this.schemaId=t.schemaId,this.root=t.root||this,this.baseId=(n=t.baseId)!==null&&n!==void 0?n:(0,resolve_1.normalizeId)(i==null?void 0:i[t.schemaId||"$id"]),this.schemaPath=t.schemaPath,this.localRefs=t.localRefs,this.meta=t.meta,this.$async=i==null?void 0:i.$async,this.refs={}}}compile.SchemaEnv=SchemaEnv;function compileSchema(e){const t=getCompilingSchema.call(this,e);if(t)return t;const n=(0,resolve_1.getFullPath)(this.opts.uriResolver,e.root.baseId),{es5:i,lines:a}=this.opts.code,{ownProperties:o}=this.opts,c=new codegen_1$n.CodeGen(this.scope,{es5:i,lines:a,ownProperties:o});let d;e.$async&&(d=c.scopeValue("Error",{ref:validation_error_1.default,code:(0,codegen_1$n._)`require("ajv/dist/runtime/validation_error").default`}));const u=c.scopeName("validate");e.validateName=u;const l={gen:c,allErrors:this.opts.allErrors,data:names_1$2.default.data,parentData:names_1$2.default.parentData,parentDataProperty:names_1$2.default.parentDataProperty,dataNames:[names_1$2.default.data],dataPathArr:[codegen_1$n.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:c.scopeValue("schema",this.opts.code.source===!0?{ref:e.schema,code:(0,codegen_1$n.stringify)(e.schema)}:{ref:e.schema}),validateName:u,ValidationError:d,schema:e.schema,schemaEnv:e,rootId:n,baseId:e.baseId||n,schemaPath:codegen_1$n.nil,errSchemaPath:e.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,codegen_1$n._)`""`,opts:this.opts,self:this};let h;try{this._compilations.add(e),(0,validate_1$1.validateFunctionCode)(l),c.optimize(this.opts.code.optimize);const p=c.toString();h=`${c.scopeRefs(names_1$2.default.scope)}return ${p}`,this.opts.code.process&&(h=this.opts.code.process(h,e));const E=new Function(`${names_1$2.default.self}`,`${names_1$2.default.scope}`,h)(this,this.scope.get());if(this.scope.value(u,{ref:E}),E.errors=null,E.schema=e.schema,E.schemaEnv=e,e.$async&&(E.$async=!0),this.opts.code.source===!0&&(E.source={validateName:u,validateCode:p,scopeValues:c._values}),this.opts.unevaluated){const{props:x,items:S}=l;E.evaluated={props:x instanceof codegen_1$n.Name?void 0:x,items:S instanceof codegen_1$n.Name?void 0:S,dynamicProps:x instanceof codegen_1$n.Name,dynamicItems:S instanceof codegen_1$n.Name},E.source&&(E.source.evaluated=(0,codegen_1$n.stringify)(E.evaluated))}return e.validate=E,e}catch(p){throw delete e.validate,delete e.validateName,h&&this.logger.error("Error compiling schema, function code:",h),p}finally{this._compilations.delete(e)}}compile.compileSchema=compileSchema;function resolveRef(e,t,n){var i;n=(0,resolve_1.resolveUrl)(this.opts.uriResolver,t,n);const a=e.refs[n];if(a)return a;let o=resolve.call(this,e,n);if(o===void 0){const c=(i=e.localRefs)===null||i===void 0?void 0:i[n],{schemaId:d}=this.opts;c&&(o=new SchemaEnv({schema:c,schemaId:d,root:e,baseId:t}))}if(o!==void 0)return e.refs[n]=inlineOrCompile.call(this,o)}compile.resolveRef=resolveRef;function inlineOrCompile(e){return(0,resolve_1.inlineRef)(e.schema,this.opts.inlineRefs)?e.schema:e.validate?e:compileSchema.call(this,e)}function getCompilingSchema(e){for(const t of this._compilations)if(sameSchemaEnv(t,e))return t}compile.getCompilingSchema=getCompilingSchema;function sameSchemaEnv(e,t){return e.schema===t.schema&&e.root===t.root&&e.baseId===t.baseId}function resolve(e,t){let n;for(;typeof(n=this.refs[t])=="string";)t=n;return n||this.schemas[t]||resolveSchema.call(this,e,t)}function resolveSchema(e,t){const n=this.opts.uriResolver.parse(t),i=(0,resolve_1._getFullPath)(this.opts.uriResolver,n);let a=(0,resolve_1.getFullPath)(this.opts.uriResolver,e.baseId,void 0);if(Object.keys(e.schema).length>0&&i===a)return getJsonPointer.call(this,n,e);const o=(0,resolve_1.normalizeId)(i),c=this.refs[o]||this.schemas[o];if(typeof c=="string"){const d=resolveSchema.call(this,e,c);return typeof(d==null?void 0:d.schema)!="object"?void 0:getJsonPointer.call(this,n,d)}if(typeof(c==null?void 0:c.schema)=="object"){if(c.validate||compileSchema.call(this,c),o===(0,resolve_1.normalizeId)(t)){const{schema:d}=c,{schemaId:u}=this.opts,l=d[u];return l&&(a=(0,resolve_1.resolveUrl)(this.opts.uriResolver,a,l)),new SchemaEnv({schema:d,schemaId:u,root:e,baseId:a})}return getJsonPointer.call(this,n,c)}}compile.resolveSchema=resolveSchema;const PREVENT_SCOPE_CHANGE=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function getJsonPointer(e,{baseId:t,schema:n,root:i}){var a;if(((a=e.fragment)===null||a===void 0?void 0:a[0])!=="/")return;for(const d of e.fragment.slice(1).split("/")){if(typeof n=="boolean")return;const u=n[(0,util_1$k.unescapeFragment)(d)];if(u===void 0)return;n=u;const l=typeof n=="object"&&n[this.opts.schemaId];!PREVENT_SCOPE_CHANGE.has(d)&&l&&(t=(0,resolve_1.resolveUrl)(this.opts.uriResolver,t,l))}let o;if(typeof n!="boolean"&&n.$ref&&!(0,util_1$k.schemaHasRulesButRef)(n,this.RULES)){const d=(0,resolve_1.resolveUrl)(this.opts.uriResolver,t,n.$ref);o=resolveSchema.call(this,i,d)}const{schemaId:c}=this.opts;if(o=o||new SchemaEnv({schema:n,schemaId:c,root:i,baseId:t}),o.schema!==o.root.schema)return o}const $id$1="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description="Meta-schema for $data reference (JSON AnySchema extension proposal)",type$2="object",required$1=["$data"],properties$2={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties$1=!1,require$$9={$id:$id$1,description,type:type$2,required:required$1,properties:properties$2,additionalProperties:additionalProperties$1};var uri$1={},uri_allExports={},uri_all={get exports(){return uri_allExports},set exports(e){uri_allExports=e}};/** @license URI.js v4.4.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js */(function(e,t){(function(n,i){i(t)})(commonjsGlobal$1,function(n){function i(){for(var j=arguments.length,V=Array(j),Q=0;Q<j;Q++)V[Q]=arguments[Q];if(V.length>1){V[0]=V[0].slice(0,-1);for(var se=V.length-1,pe=1;pe<se;++pe)V[pe]=V[pe].slice(1,-1);return V[se]=V[se].slice(1),V.join("")}else return V[0]}function a(j){return"(?:"+j+")"}function o(j){return j===void 0?"undefined":j===null?"null":Object.prototype.toString.call(j).split(" ").pop().split("]").shift().toLowerCase()}function c(j){return j.toUpperCase()}function d(j){return j!=null?j instanceof Array?j:typeof j.length!="number"||j.split||j.setInterval||j.call?[j]:Array.prototype.slice.call(j):[]}function u(j,V){var Q=j;if(V)for(var se in V)Q[se]=V[se];return Q}function l(j){var V="[A-Za-z]",Q="[0-9]",se=i(Q,"[A-Fa-f]"),pe=a(a("%[EFef]"+se+"%"+se+se+"%"+se+se)+"|"+a("%[89A-Fa-f]"+se+"%"+se+se)+"|"+a("%"+se+se)),De="[\\:\\/\\?\\#\\[\\]\\@]",Ee="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",nt=i(De,Ee),Te=j?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",ct=j?"[\\uE000-\\uF8FF]":"[]",Ne=i(V,Q,"[\\-\\.\\_\\~]",Te);a(V+i(V,Q,"[\\+\\-\\.]")+"*"),a(a(pe+"|"+i(Ne,Ee,"[\\:]"))+"*");var Le=a(a("25[0-5]")+"|"+a("2[0-4]"+Q)+"|"+a("1"+Q+Q)+"|"+a("0?[1-9]"+Q)+"|0?0?"+Q),wt=a(Le+"\\."+Le+"\\."+Le+"\\."+Le),ot=a(se+"{1,4}"),At=a(a(ot+"\\:"+ot)+"|"+wt),zt=a(a(ot+"\\:")+"{6}"+At),Ut=a("\\:\\:"+a(ot+"\\:")+"{5}"+At),xr=a(a(ot)+"?\\:\\:"+a(ot+"\\:")+"{4}"+At),hr=a(a(a(ot+"\\:")+"{0,1}"+ot)+"?\\:\\:"+a(ot+"\\:")+"{3}"+At),pr=a(a(a(ot+"\\:")+"{0,2}"+ot)+"?\\:\\:"+a(ot+"\\:")+"{2}"+At),vr=a(a(a(ot+"\\:")+"{0,3}"+ot)+"?\\:\\:"+ot+"\\:"+At),Er=a(a(a(ot+"\\:")+"{0,4}"+ot)+"?\\:\\:"+At),ur=a(a(a(ot+"\\:")+"{0,5}"+ot)+"?\\:\\:"+ot),yr=a(a(a(ot+"\\:")+"{0,6}"+ot)+"?\\:\\:"),$r=a([zt,Ut,xr,hr,pr,vr,Er,ur,yr].join("|")),Qt=a(a(Ne+"|"+pe)+"+");a("[vV]"+se+"+\\."+i(Ne,Ee,"[\\:]")+"+"),a(a(pe+"|"+i(Ne,Ee))+"*");var Tr=a(pe+"|"+i(Ne,Ee,"[\\:\\@]"));return a(a(pe+"|"+i(Ne,Ee,"[\\@]"))+"+"),a(a(Tr+"|"+i("[\\/\\?]",ct))+"*"),{NOT_SCHEME:new RegExp(i("[^]",V,Q,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(i("[^\\%\\:]",Ne,Ee),"g"),NOT_HOST:new RegExp(i("[^\\%\\[\\]\\:]",Ne,Ee),"g"),NOT_PATH:new RegExp(i("[^\\%\\/\\:\\@]",Ne,Ee),"g"),NOT_PATH_NOSCHEME:new RegExp(i("[^\\%\\/\\@]",Ne,Ee),"g"),NOT_QUERY:new RegExp(i("[^\\%]",Ne,Ee,"[\\:\\@\\/\\?]",ct),"g"),NOT_FRAGMENT:new RegExp(i("[^\\%]",Ne,Ee,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(i("[^]",Ne,Ee),"g"),UNRESERVED:new RegExp(Ne,"g"),OTHER_CHARS:new RegExp(i("[^\\%]",Ne,nt),"g"),PCT_ENCODED:new RegExp(pe,"g"),IPV4ADDRESS:new RegExp("^("+wt+")$"),IPV6ADDRESS:new RegExp("^\\[?("+$r+")"+a(a("\\%25|\\%(?!"+se+"{2})")+"("+Qt+")")+"?\\]?$")}}var h=l(!1),p=l(!0),y=function(){function j(V,Q){var se=[],pe=!0,De=!1,Ee=void 0;try{for(var nt=V[Symbol.iterator](),Te;!(pe=(Te=nt.next()).done)&&(se.push(Te.value),!(Q&&se.length===Q));pe=!0);}catch(ct){De=!0,Ee=ct}finally{try{!pe&&nt.return&&nt.return()}finally{if(De)throw Ee}}return se}return function(V,Q){if(Array.isArray(V))return V;if(Symbol.iterator in Object(V))return j(V,Q);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),E=function(j){if(Array.isArray(j)){for(var V=0,Q=Array(j.length);V<j.length;V++)Q[V]=j[V];return Q}else return Array.from(j)},x=2147483647,S=36,k=1,T=26,L=38,q=700,U=72,ee=128,W="-",ie=/^xn--/,fe=/[^\0-\x7E]/,ce=/[\x2E\u3002\uFF0E\uFF61]/g,ye={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},xe=S-k,Oe=Math.floor,F=String.fromCharCode;function v(j){throw new RangeError(ye[j])}function C(j,V){for(var Q=[],se=j.length;se--;)Q[se]=V(j[se]);return Q}function I(j,V){var Q=j.split("@"),se="";Q.length>1&&(se=Q[0]+"@",j=Q[1]),j=j.replace(ce,".");var pe=j.split("."),De=C(pe,V).join(".");return se+De}function B(j){for(var V=[],Q=0,se=j.length;Q<se;){var pe=j.charCodeAt(Q++);if(pe>=55296&&pe<=56319&&Q<se){var De=j.charCodeAt(Q++);(De&64512)==56320?V.push(((pe&1023)<<10)+(De&1023)+65536):(V.push(pe),Q--)}else V.push(pe)}return V}var J=function(V){return String.fromCodePoint.apply(String,E(V))},Y=function(V){return V-48<10?V-22:V-65<26?V-65:V-97<26?V-97:S},H=function(V,Q){return V+22+75*(V<26)-((Q!=0)<<5)},_=function(V,Q,se){var pe=0;for(V=se?Oe(V/q):V>>1,V+=Oe(V/Q);V>xe*T>>1;pe+=S)V=Oe(V/xe);return Oe(pe+(xe+1)*V/(V+L))},m=function(V){var Q=[],se=V.length,pe=0,De=ee,Ee=U,nt=V.lastIndexOf(W);nt<0&&(nt=0);for(var Te=0;Te<nt;++Te)V.charCodeAt(Te)>=128&&v("not-basic"),Q.push(V.charCodeAt(Te));for(var ct=nt>0?nt+1:0;ct<se;){for(var Ne=pe,Le=1,wt=S;;wt+=S){ct>=se&&v("invalid-input");var ot=Y(V.charCodeAt(ct++));(ot>=S||ot>Oe((x-pe)/Le))&&v("overflow"),pe+=ot*Le;var At=wt<=Ee?k:wt>=Ee+T?T:wt-Ee;if(ot<At)break;var zt=S-At;Le>Oe(x/zt)&&v("overflow"),Le*=zt}var Ut=Q.length+1;Ee=_(pe-Ne,Ut,Ne==0),Oe(pe/Ut)>x-De&&v("overflow"),De+=Oe(pe/Ut),pe%=Ut,Q.splice(pe++,0,De)}return String.fromCodePoint.apply(String,Q)},b=function(V){var Q=[];V=B(V);var se=V.length,pe=ee,De=0,Ee=U,nt=!0,Te=!1,ct=void 0;try{for(var Ne=V[Symbol.iterator](),Le;!(nt=(Le=Ne.next()).done);nt=!0){var wt=Le.value;wt<128&&Q.push(F(wt))}}catch(Ir){Te=!0,ct=Ir}finally{try{!nt&&Ne.return&&Ne.return()}finally{if(Te)throw ct}}var ot=Q.length,At=ot;for(ot&&Q.push(W);At<se;){var zt=x,Ut=!0,xr=!1,hr=void 0;try{for(var pr=V[Symbol.iterator](),vr;!(Ut=(vr=pr.next()).done);Ut=!0){var Er=vr.value;Er>=pe&&Er<zt&&(zt=Er)}}catch(Ir){xr=!0,hr=Ir}finally{try{!Ut&&pr.return&&pr.return()}finally{if(xr)throw hr}}var ur=At+1;zt-pe>Oe((x-De)/ur)&&v("overflow"),De+=(zt-pe)*ur,pe=zt;var yr=!0,$r=!1,Qt=void 0;try{for(var Tr=V[Symbol.iterator](),Lr;!(yr=(Lr=Tr.next()).done);yr=!0){var Rr=Lr.value;if(Rr<pe&&++De>x&&v("overflow"),Rr==pe){for(var Gr=De,Sr=S;;Sr+=S){var Wr=Sr<=Ee?k:Sr>=Ee+T?T:Sr-Ee;if(Gr<Wr)break;var jr=Gr-Wr,Zr=S-Wr;Q.push(F(H(Wr+jr%Zr,0))),Gr=Oe(jr/Zr)}Q.push(F(H(Gr,0))),Ee=_(De,ur,At==ot),De=0,++At}}}catch(Ir){$r=!0,Qt=Ir}finally{try{!yr&&Tr.return&&Tr.return()}finally{if($r)throw Qt}}++De,++pe}return Q.join("")},$=function(V){return I(V,function(Q){return ie.test(Q)?m(Q.slice(4).toLowerCase()):Q})},g=function(V){return I(V,function(Q){return fe.test(Q)?"xn--"+b(Q):Q})},O={version:"2.1.0",ucs2:{decode:B,encode:J},decode:m,encode:b,toASCII:g,toUnicode:$},te={};function Z(j){var V=j.charCodeAt(0),Q=void 0;return V<16?Q="%0"+V.toString(16).toUpperCase():V<128?Q="%"+V.toString(16).toUpperCase():V<2048?Q="%"+(V>>6|192).toString(16).toUpperCase()+"%"+(V&63|128).toString(16).toUpperCase():Q="%"+(V>>12|224).toString(16).toUpperCase()+"%"+(V>>6&63|128).toString(16).toUpperCase()+"%"+(V&63|128).toString(16).toUpperCase(),Q}function ae(j){for(var V="",Q=0,se=j.length;Q<se;){var pe=parseInt(j.substr(Q+1,2),16);if(pe<128)V+=String.fromCharCode(pe),Q+=3;else if(pe>=194&&pe<224){if(se-Q>=6){var De=parseInt(j.substr(Q+4,2),16);V+=String.fromCharCode((pe&31)<<6|De&63)}else V+=j.substr(Q,6);Q+=6}else if(pe>=224){if(se-Q>=9){var Ee=parseInt(j.substr(Q+4,2),16),nt=parseInt(j.substr(Q+7,2),16);V+=String.fromCharCode((pe&15)<<12|(Ee&63)<<6|nt&63)}else V+=j.substr(Q,9);Q+=9}else V+=j.substr(Q,3),Q+=3}return V}function be(j,V){function Q(se){var pe=ae(se);return pe.match(V.UNRESERVED)?pe:se}return j.scheme&&(j.scheme=String(j.scheme).replace(V.PCT_ENCODED,Q).toLowerCase().replace(V.NOT_SCHEME,"")),j.userinfo!==void 0&&(j.userinfo=String(j.userinfo).replace(V.PCT_ENCODED,Q).replace(V.NOT_USERINFO,Z).replace(V.PCT_ENCODED,c)),j.host!==void 0&&(j.host=String(j.host).replace(V.PCT_ENCODED,Q).toLowerCase().replace(V.NOT_HOST,Z).replace(V.PCT_ENCODED,c)),j.path!==void 0&&(j.path=String(j.path).replace(V.PCT_ENCODED,Q).replace(j.scheme?V.NOT_PATH:V.NOT_PATH_NOSCHEME,Z).replace(V.PCT_ENCODED,c)),j.query!==void 0&&(j.query=String(j.query).replace(V.PCT_ENCODED,Q).replace(V.NOT_QUERY,Z).replace(V.PCT_ENCODED,c)),j.fragment!==void 0&&(j.fragment=String(j.fragment).replace(V.PCT_ENCODED,Q).replace(V.NOT_FRAGMENT,Z).replace(V.PCT_ENCODED,c)),j}function ke(j){return j.replace(/^0*(.*)/,"$1")||"0"}function Ae(j,V){var Q=j.match(V.IPV4ADDRESS)||[],se=y(Q,2),pe=se[1];return pe?pe.split(".").map(ke).join("."):j}function dt(j,V){var Q=j.match(V.IPV6ADDRESS)||[],se=y(Q,3),pe=se[1],De=se[2];if(pe){for(var Ee=pe.toLowerCase().split("::").reverse(),nt=y(Ee,2),Te=nt[0],ct=nt[1],Ne=ct?ct.split(":").map(ke):[],Le=Te.split(":").map(ke),wt=V.IPV4ADDRESS.test(Le[Le.length-1]),ot=wt?7:8,At=Le.length-ot,zt=Array(ot),Ut=0;Ut<ot;++Ut)zt[Ut]=Ne[Ut]||Le[At+Ut]||"";wt&&(zt[ot-1]=Ae(zt[ot-1],V));var xr=zt.reduce(function(ur,yr,$r){if(!yr||yr==="0"){var Qt=ur[ur.length-1];Qt&&Qt.index+Qt.length===$r?Qt.length++:ur.push({index:$r,length:1})}return ur},[]),hr=xr.sort(function(ur,yr){return yr.length-ur.length})[0],pr=void 0;if(hr&&hr.length>1){var vr=zt.slice(0,hr.index),Er=zt.slice(hr.index+hr.length);pr=vr.join(":")+"::"+Er.join(":")}else pr=zt.join(":");return De&&(pr+="%"+De),pr}else return j}var qe=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,et="".match(/(){0}/)[1]===void 0;function Ke(j){var V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Q={},se=V.iri!==!1?p:h;V.reference==="suffix"&&(j=(V.scheme?V.scheme+":":"")+"//"+j);var pe=j.match(qe);if(pe){et?(Q.scheme=pe[1],Q.userinfo=pe[3],Q.host=pe[4],Q.port=parseInt(pe[5],10),Q.path=pe[6]||"",Q.query=pe[7],Q.fragment=pe[8],isNaN(Q.port)&&(Q.port=pe[5])):(Q.scheme=pe[1]||void 0,Q.userinfo=j.indexOf("@")!==-1?pe[3]:void 0,Q.host=j.indexOf("//")!==-1?pe[4]:void 0,Q.port=parseInt(pe[5],10),Q.path=pe[6]||"",Q.query=j.indexOf("?")!==-1?pe[7]:void 0,Q.fragment=j.indexOf("#")!==-1?pe[8]:void 0,isNaN(Q.port)&&(Q.port=j.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?pe[4]:void 0)),Q.host&&(Q.host=dt(Ae(Q.host,se),se)),Q.scheme===void 0&&Q.userinfo===void 0&&Q.host===void 0&&Q.port===void 0&&!Q.path&&Q.query===void 0?Q.reference="same-document":Q.scheme===void 0?Q.reference="relative":Q.fragment===void 0?Q.reference="absolute":Q.reference="uri",V.reference&&V.reference!=="suffix"&&V.reference!==Q.reference&&(Q.error=Q.error||"URI is not a "+V.reference+" reference.");var De=te[(V.scheme||Q.scheme||"").toLowerCase()];if(!V.unicodeSupport&&(!De||!De.unicodeSupport)){if(Q.host&&(V.domainHost||De&&De.domainHost))try{Q.host=O.toASCII(Q.host.replace(se.PCT_ENCODED,ae).toLowerCase())}catch(Ee){Q.error=Q.error||"Host's domain name can not be converted to ASCII via punycode: "+Ee}be(Q,h)}else be(Q,se);De&&De.parse&&De.parse(Q,V)}else Q.error=Q.error||"URI can not be parsed.";return Q}function gt(j,V){var Q=V.iri!==!1?p:h,se=[];return j.userinfo!==void 0&&(se.push(j.userinfo),se.push("@")),j.host!==void 0&&se.push(dt(Ae(String(j.host),Q),Q).replace(Q.IPV6ADDRESS,function(pe,De,Ee){return"["+De+(Ee?"%25"+Ee:"")+"]"})),(typeof j.port=="number"||typeof j.port=="string")&&(se.push(":"),se.push(String(j.port))),se.length?se.join(""):void 0}var at=/^\.\.?\//,Lt=/^\/\.(\/|$)/,Ge=/^\/\.\.(\/|$)/,st=/^\/?(?:.|\n)*?(?=\/|$)/;function Qe(j){for(var V=[];j.length;)if(j.match(at))j=j.replace(at,"");else if(j.match(Lt))j=j.replace(Lt,"/");else if(j.match(Ge))j=j.replace(Ge,"/"),V.pop();else if(j==="."||j==="..")j="";else{var Q=j.match(st);if(Q){var se=Q[0];j=j.slice(se.length),V.push(se)}else throw new Error("Unexpected dot segment condition")}return V.join("")}function We(j){var V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Q=V.iri?p:h,se=[],pe=te[(V.scheme||j.scheme||"").toLowerCase()];if(pe&&pe.serialize&&pe.serialize(j,V),j.host&&!Q.IPV6ADDRESS.test(j.host)){if(V.domainHost||pe&&pe.domainHost)try{j.host=V.iri?O.toUnicode(j.host):O.toASCII(j.host.replace(Q.PCT_ENCODED,ae).toLowerCase())}catch(nt){j.error=j.error||"Host's domain name can not be converted to "+(V.iri?"Unicode":"ASCII")+" via punycode: "+nt}}be(j,Q),V.reference!=="suffix"&&j.scheme&&(se.push(j.scheme),se.push(":"));var De=gt(j,V);if(De!==void 0&&(V.reference!=="suffix"&&se.push("//"),se.push(De),j.path&&j.path.charAt(0)!=="/"&&se.push("/")),j.path!==void 0){var Ee=j.path;!V.absolutePath&&(!pe||!pe.absolutePath)&&(Ee=Qe(Ee)),De===void 0&&(Ee=Ee.replace(/^\/\//,"/%2F")),se.push(Ee)}return j.query!==void 0&&(se.push("?"),se.push(j.query)),j.fragment!==void 0&&(se.push("#"),se.push(j.fragment)),se.join("")}function ze(j,V){var Q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},se=arguments[3],pe={};return se||(j=Ke(We(j,Q),Q),V=Ke(We(V,Q),Q)),Q=Q||{},!Q.tolerant&&V.scheme?(pe.scheme=V.scheme,pe.userinfo=V.userinfo,pe.host=V.host,pe.port=V.port,pe.path=Qe(V.path||""),pe.query=V.query):(V.userinfo!==void 0||V.host!==void 0||V.port!==void 0?(pe.userinfo=V.userinfo,pe.host=V.host,pe.port=V.port,pe.path=Qe(V.path||""),pe.query=V.query):(V.path?(V.path.charAt(0)==="/"?pe.path=Qe(V.path):((j.userinfo!==void 0||j.host!==void 0||j.port!==void 0)&&!j.path?pe.path="/"+V.path:j.path?pe.path=j.path.slice(0,j.path.lastIndexOf("/")+1)+V.path:pe.path=V.path,pe.path=Qe(pe.path)),pe.query=V.query):(pe.path=j.path,V.query!==void 0?pe.query=V.query:pe.query=j.query),pe.userinfo=j.userinfo,pe.host=j.host,pe.port=j.port),pe.scheme=j.scheme),pe.fragment=V.fragment,pe}function ut(j,V,Q){var se=u({scheme:"null"},Q);return We(ze(Ke(j,se),Ke(V,se),se,!0),se)}function rt(j,V){return typeof j=="string"?j=We(Ke(j,V),V):o(j)==="object"&&(j=Ke(We(j,V),V)),j}function Ze(j,V,Q){return typeof j=="string"?j=We(Ke(j,Q),Q):o(j)==="object"&&(j=We(j,Q)),typeof V=="string"?V=We(Ke(V,Q),Q):o(V)==="object"&&(V=We(V,Q)),j===V}function er(j,V){return j&&j.toString().replace(!V||!V.iri?h.ESCAPE:p.ESCAPE,Z)}function Ye(j,V){return j&&j.toString().replace(!V||!V.iri?h.PCT_ENCODED:p.PCT_ENCODED,ae)}var yt={scheme:"http",domainHost:!0,parse:function(V,Q){return V.host||(V.error=V.error||"HTTP URIs must have a host."),V},serialize:function(V,Q){var se=String(V.scheme).toLowerCase()==="https";return(V.port===(se?443:80)||V.port==="")&&(V.port=void 0),V.path||(V.path="/"),V}},Vt={scheme:"https",domainHost:yt.domainHost,parse:yt.parse,serialize:yt.serialize};function $t(j){return typeof j.secure=="boolean"?j.secure:String(j.scheme).toLowerCase()==="wss"}var bt={scheme:"ws",domainHost:!0,parse:function(V,Q){var se=V;return se.secure=$t(se),se.resourceName=(se.path||"/")+(se.query?"?"+se.query:""),se.path=void 0,se.query=void 0,se},serialize:function(V,Q){if((V.port===($t(V)?443:80)||V.port==="")&&(V.port=void 0),typeof V.secure=="boolean"&&(V.scheme=V.secure?"wss":"ws",V.secure=void 0),V.resourceName){var se=V.resourceName.split("?"),pe=y(se,2),De=pe[0],Ee=pe[1];V.path=De&&De!=="/"?De:void 0,V.query=Ee,V.resourceName=void 0}return V.fragment=void 0,V}},Zt={scheme:"wss",domainHost:bt.domainHost,parse:bt.parse,serialize:bt.serialize},Rt={},kt="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",jt="[0-9A-Fa-f]",Pt=a(a("%[EFef]"+jt+"%"+jt+jt+"%"+jt+jt)+"|"+a("%[89A-Fa-f]"+jt+"%"+jt+jt)+"|"+a("%"+jt+jt)),Nt="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",tr="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",Ot=i(tr,'[\\"\\\\]'),vt="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",rr=new RegExp(kt,"g"),St=new RegExp(Pt,"g"),G=new RegExp(i("[^]",Nt,"[\\.]",'[\\"]',Ot),"g"),M=new RegExp(i("[^]",kt,vt),"g"),X=M;function oe(j){var V=ae(j);return V.match(rr)?V:j}var ve={scheme:"mailto",parse:function(V,Q){var se=V,pe=se.to=se.path?se.path.split(","):[];if(se.path=void 0,se.query){for(var De=!1,Ee={},nt=se.query.split("&"),Te=0,ct=nt.length;Te<ct;++Te){var Ne=nt[Te].split("=");switch(Ne[0]){case"to":for(var Le=Ne[1].split(","),wt=0,ot=Le.length;wt<ot;++wt)pe.push(Le[wt]);break;case"subject":se.subject=Ye(Ne[1],Q);break;case"body":se.body=Ye(Ne[1],Q);break;default:De=!0,Ee[Ye(Ne[0],Q)]=Ye(Ne[1],Q);break}}De&&(se.headers=Ee)}se.query=void 0;for(var At=0,zt=pe.length;At<zt;++At){var Ut=pe[At].split("@");if(Ut[0]=Ye(Ut[0]),Q.unicodeSupport)Ut[1]=Ye(Ut[1],Q).toLowerCase();else try{Ut[1]=O.toASCII(Ye(Ut[1],Q).toLowerCase())}catch(xr){se.error=se.error||"Email address's domain name can not be converted to ASCII via punycode: "+xr}pe[At]=Ut.join("@")}return se},serialize:function(V,Q){var se=V,pe=d(V.to);if(pe){for(var De=0,Ee=pe.length;De<Ee;++De){var nt=String(pe[De]),Te=nt.lastIndexOf("@"),ct=nt.slice(0,Te).replace(St,oe).replace(St,c).replace(G,Z),Ne=nt.slice(Te+1);try{Ne=Q.iri?O.toUnicode(Ne):O.toASCII(Ye(Ne,Q).toLowerCase())}catch(At){se.error=se.error||"Email address's domain name can not be converted to "+(Q.iri?"Unicode":"ASCII")+" via punycode: "+At}pe[De]=ct+"@"+Ne}se.path=pe.join(",")}var Le=V.headers=V.headers||{};V.subject&&(Le.subject=V.subject),V.body&&(Le.body=V.body);var wt=[];for(var ot in Le)Le[ot]!==Rt[ot]&&wt.push(ot.replace(St,oe).replace(St,c).replace(M,Z)+"="+Le[ot].replace(St,oe).replace(St,c).replace(X,Z));return wt.length&&(se.query=wt.join("&")),se}},Ce=/^([^\:]+)\:(.*)/,Me={scheme:"urn",parse:function(V,Q){var se=V.path&&V.path.match(Ce),pe=V;if(se){var De=Q.scheme||pe.scheme||"urn",Ee=se[1].toLowerCase(),nt=se[2],Te=De+":"+(Q.nid||Ee),ct=te[Te];pe.nid=Ee,pe.nss=nt,pe.path=void 0,ct&&(pe=ct.parse(pe,Q))}else pe.error=pe.error||"URN can not be parsed.";return pe},serialize:function(V,Q){var se=Q.scheme||V.scheme||"urn",pe=V.nid,De=se+":"+(Q.nid||pe),Ee=te[De];Ee&&(V=Ee.serialize(V,Q));var nt=V,Te=V.nss;return nt.path=(pe||Q.nid)+":"+Te,nt}},He=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,Je={scheme:"urn:uuid",parse:function(V,Q){var se=V;return se.uuid=se.nss,se.nss=void 0,!Q.tolerant&&(!se.uuid||!se.uuid.match(He))&&(se.error=se.error||"UUID is not valid."),se},serialize:function(V,Q){var se=V;return se.nss=(V.uuid||"").toLowerCase(),se}};te[yt.scheme]=yt,te[Vt.scheme]=Vt,te[bt.scheme]=bt,te[Zt.scheme]=Zt,te[ve.scheme]=ve,te[Me.scheme]=Me,te[Je.scheme]=Je,n.SCHEMES=te,n.pctEncChar=Z,n.pctDecChars=ae,n.parse=Ke,n.removeDotSegments=Qe,n.serialize=We,n.resolveComponents=ze,n.resolve=ut,n.normalize=rt,n.equal=Ze,n.escapeComponent=er,n.unescapeComponent=Ye,Object.defineProperty(n,"__esModule",{value:!0})})})(uri_all,uri_allExports);Object.defineProperty(uri$1,"__esModule",{value:!0});const uri=uri_allExports;uri.code='require("ajv/dist/runtime/uri").default';uri$1.default=uri;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=void 0;var t=validate;Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return t.KeywordCxt}});var n=codegen;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return n._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return n.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return n.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return n.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return n.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return n.CodeGen}});const i=validation_error,a=ref_error,o=rules,c=compile,d=codegen,u=resolve$1,l=dataType,h=util$a,p=require$$9,y=uri$1,E=(H,_)=>new RegExp(H,_);E.code="new RegExp";const x=["removeAdditional","useDefaults","coerceTypes"],S=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),k={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},T={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},L=200;function q(H){var _,m,b,$,g,O,te,Z,ae,be,ke,Ae,dt,qe,et,Ke,gt,at,Lt,Ge,st,Qe,We,ze,ut;const rt=H.strict,Ze=(_=H.code)===null||_===void 0?void 0:_.optimize,er=Ze===!0||Ze===void 0?1:Ze||0,Ye=(b=(m=H.code)===null||m===void 0?void 0:m.regExp)!==null&&b!==void 0?b:E,yt=($=H.uriResolver)!==null&&$!==void 0?$:y.default;return{strictSchema:(O=(g=H.strictSchema)!==null&&g!==void 0?g:rt)!==null&&O!==void 0?O:!0,strictNumbers:(Z=(te=H.strictNumbers)!==null&&te!==void 0?te:rt)!==null&&Z!==void 0?Z:!0,strictTypes:(be=(ae=H.strictTypes)!==null&&ae!==void 0?ae:rt)!==null&&be!==void 0?be:"log",strictTuples:(Ae=(ke=H.strictTuples)!==null&&ke!==void 0?ke:rt)!==null&&Ae!==void 0?Ae:"log",strictRequired:(qe=(dt=H.strictRequired)!==null&&dt!==void 0?dt:rt)!==null&&qe!==void 0?qe:!1,code:H.code?{...H.code,optimize:er,regExp:Ye}:{optimize:er,regExp:Ye},loopRequired:(et=H.loopRequired)!==null&&et!==void 0?et:L,loopEnum:(Ke=H.loopEnum)!==null&&Ke!==void 0?Ke:L,meta:(gt=H.meta)!==null&&gt!==void 0?gt:!0,messages:(at=H.messages)!==null&&at!==void 0?at:!0,inlineRefs:(Lt=H.inlineRefs)!==null&&Lt!==void 0?Lt:!0,schemaId:(Ge=H.schemaId)!==null&&Ge!==void 0?Ge:"$id",addUsedSchema:(st=H.addUsedSchema)!==null&&st!==void 0?st:!0,validateSchema:(Qe=H.validateSchema)!==null&&Qe!==void 0?Qe:!0,validateFormats:(We=H.validateFormats)!==null&&We!==void 0?We:!0,unicodeRegExp:(ze=H.unicodeRegExp)!==null&&ze!==void 0?ze:!0,int32range:(ut=H.int32range)!==null&&ut!==void 0?ut:!0,uriResolver:yt}}class U{constructor(_={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,_=this.opts={..._,...q(_)};const{es5:m,lines:b}=this.opts.code;this.scope=new d.ValueScope({scope:{},prefixes:S,es5:m,lines:b}),this.logger=Oe(_.logger);const $=_.validateFormats;_.validateFormats=!1,this.RULES=(0,o.getRules)(),ee.call(this,k,_,"NOT SUPPORTED"),ee.call(this,T,_,"DEPRECATED","warn"),this._metaOpts=ye.call(this),_.formats&&fe.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),_.keywords&&ce.call(this,_.keywords),typeof _.meta=="object"&&this.addMetaSchema(_.meta),ie.call(this),_.validateFormats=$}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:_,meta:m,schemaId:b}=this.opts;let $=p;b==="id"&&($={...p},$.id=$.$id,delete $.$id),m&&_&&this.addMetaSchema($,$[b],!1)}defaultMeta(){const{meta:_,schemaId:m}=this.opts;return this.opts.defaultMeta=typeof _=="object"?_[m]||_:void 0}validate(_,m){let b;if(typeof _=="string"){if(b=this.getSchema(_),!b)throw new Error(`no schema with key or ref "${_}"`)}else b=this.compile(_);const $=b(m);return"$async"in b||(this.errors=b.errors),$}compile(_,m){const b=this._addSchema(_,m);return b.validate||this._compileSchemaEnv(b)}compileAsync(_,m){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");const{loadSchema:b}=this.opts;return $.call(this,_,m);async function $(be,ke){await g.call(this,be.$schema);const Ae=this._addSchema(be,ke);return Ae.validate||O.call(this,Ae)}async function g(be){be&&!this.getSchema(be)&&await $.call(this,{$ref:be},!0)}async function O(be){try{return this._compileSchemaEnv(be)}catch(ke){if(!(ke instanceof a.default))throw ke;return te.call(this,ke),await Z.call(this,ke.missingSchema),O.call(this,be)}}function te({missingSchema:be,missingRef:ke}){if(this.refs[be])throw new Error(`AnySchema ${be} is loaded but ${ke} cannot be resolved`)}async function Z(be){const ke=await ae.call(this,be);this.refs[be]||await g.call(this,ke.$schema),this.refs[be]||this.addSchema(ke,be,m)}async function ae(be){const ke=this._loading[be];if(ke)return ke;try{return await(this._loading[be]=b(be))}finally{delete this._loading[be]}}}addSchema(_,m,b,$=this.opts.validateSchema){if(Array.isArray(_)){for(const O of _)this.addSchema(O,void 0,b,$);return this}let g;if(typeof _=="object"){const{schemaId:O}=this.opts;if(g=_[O],g!==void 0&&typeof g!="string")throw new Error(`schema ${O} must be string`)}return m=(0,u.normalizeId)(m||g),this._checkUnique(m),this.schemas[m]=this._addSchema(_,b,m,$,!0),this}addMetaSchema(_,m,b=this.opts.validateSchema){return this.addSchema(_,m,!0,b),this}validateSchema(_,m){if(typeof _=="boolean")return!0;let b;if(b=_.$schema,b!==void 0&&typeof b!="string")throw new Error("$schema must be a string");if(b=b||this.opts.defaultMeta||this.defaultMeta(),!b)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const $=this.validate(b,_);if(!$&&m){const g="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(g);else throw new Error(g)}return $}getSchema(_){let m;for(;typeof(m=W.call(this,_))=="string";)_=m;if(m===void 0){const{schemaId:b}=this.opts,$=new c.SchemaEnv({schema:{},schemaId:b});if(m=c.resolveSchema.call(this,$,_),!m)return;this.refs[_]=m}return m.validate||this._compileSchemaEnv(m)}removeSchema(_){if(_ instanceof RegExp)return this._removeAllSchemas(this.schemas,_),this._removeAllSchemas(this.refs,_),this;switch(typeof _){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const m=W.call(this,_);return typeof m=="object"&&this._cache.delete(m.schema),delete this.schemas[_],delete this.refs[_],this}case"object":{const m=_;this._cache.delete(m);let b=_[this.opts.schemaId];return b&&(b=(0,u.normalizeId)(b),delete this.schemas[b],delete this.refs[b]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(_){for(const m of _)this.addKeyword(m);return this}addKeyword(_,m){let b;if(typeof _=="string")b=_,typeof m=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),m.keyword=b);else if(typeof _=="object"&&m===void 0){if(m=_,b=m.keyword,Array.isArray(b)&&!b.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(v.call(this,b,m),!m)return(0,h.eachItem)(b,g=>C.call(this,g)),this;B.call(this,m);const $={...m,type:(0,l.getJSONTypes)(m.type),schemaType:(0,l.getJSONTypes)(m.schemaType)};return(0,h.eachItem)(b,$.type.length===0?g=>C.call(this,g,$):g=>$.type.forEach(O=>C.call(this,g,$,O))),this}getKeyword(_){const m=this.RULES.all[_];return typeof m=="object"?m.definition:!!m}removeKeyword(_){const{RULES:m}=this;delete m.keywords[_],delete m.all[_];for(const b of m.rules){const $=b.rules.findIndex(g=>g.keyword===_);$>=0&&b.rules.splice($,1)}return this}addFormat(_,m){return typeof m=="string"&&(m=new RegExp(m)),this.formats[_]=m,this}errorsText(_=this.errors,{separator:m=", ",dataVar:b="data"}={}){return!_||_.length===0?"No errors":_.map($=>`${b}${$.instancePath} ${$.message}`).reduce(($,g)=>$+m+g)}$dataMetaSchema(_,m){const b=this.RULES.all;_=JSON.parse(JSON.stringify(_));for(const $ of m){const g=$.split("/").slice(1);let O=_;for(const te of g)O=O[te];for(const te in b){const Z=b[te];if(typeof Z!="object")continue;const{$data:ae}=Z.definition,be=O[te];ae&&be&&(O[te]=Y(be))}}return _}_removeAllSchemas(_,m){for(const b in _){const $=_[b];(!m||m.test(b))&&(typeof $=="string"?delete _[b]:$&&!$.meta&&(this._cache.delete($.schema),delete _[b]))}}_addSchema(_,m,b,$=this.opts.validateSchema,g=this.opts.addUsedSchema){let O;const{schemaId:te}=this.opts;if(typeof _=="object")O=_[te];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof _!="boolean")throw new Error("schema must be object or boolean")}let Z=this._cache.get(_);if(Z!==void 0)return Z;b=(0,u.normalizeId)(O||b);const ae=u.getSchemaRefs.call(this,_,b);return Z=new c.SchemaEnv({schema:_,schemaId:te,meta:m,baseId:b,localRefs:ae}),this._cache.set(Z.schema,Z),g&&!b.startsWith("#")&&(b&&this._checkUnique(b),this.refs[b]=Z),$&&this.validateSchema(_,!0),Z}_checkUnique(_){if(this.schemas[_]||this.refs[_])throw new Error(`schema with key or id "${_}" already exists`)}_compileSchemaEnv(_){if(_.meta?this._compileMetaSchema(_):c.compileSchema.call(this,_),!_.validate)throw new Error("ajv implementation error");return _.validate}_compileMetaSchema(_){const m=this.opts;this.opts=this._metaOpts;try{c.compileSchema.call(this,_)}finally{this.opts=m}}}e.default=U,U.ValidationError=i.default,U.MissingRefError=a.default;function ee(H,_,m,b="error"){for(const $ in H){const g=$;g in _&&this.logger[b](`${m}: option ${$}. ${H[g]}`)}}function W(H){return H=(0,u.normalizeId)(H),this.schemas[H]||this.refs[H]}function ie(){const H=this.opts.schemas;if(H)if(Array.isArray(H))this.addSchema(H);else for(const _ in H)this.addSchema(H[_],_)}function fe(){for(const H in this.opts.formats){const _=this.opts.formats[H];_&&this.addFormat(H,_)}}function ce(H){if(Array.isArray(H)){this.addVocabulary(H);return}this.logger.warn("keywords option as map is deprecated, pass array");for(const _ in H){const m=H[_];m.keyword||(m.keyword=_),this.addKeyword(m)}}function ye(){const H={...this.opts};for(const _ of x)delete H[_];return H}const xe={log(){},warn(){},error(){}};function Oe(H){if(H===!1)return xe;if(H===void 0)return console;if(H.log&&H.warn&&H.error)return H;throw new Error("logger must implement log, warn and error methods")}const F=/^[a-z_$][a-z0-9_$:-]*$/i;function v(H,_){const{RULES:m}=this;if((0,h.eachItem)(H,b=>{if(m.keywords[b])throw new Error(`Keyword ${b} is already defined`);if(!F.test(b))throw new Error(`Keyword ${b} has invalid name`)}),!!_&&_.$data&&!("code"in _||"validate"in _))throw new Error('$data keyword must have "code" or "validate" function')}function C(H,_,m){var b;const $=_==null?void 0:_.post;if(m&&$)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:g}=this;let O=$?g.post:g.rules.find(({type:Z})=>Z===m);if(O||(O={type:m,rules:[]},g.rules.push(O)),g.keywords[H]=!0,!_)return;const te={keyword:H,definition:{..._,type:(0,l.getJSONTypes)(_.type),schemaType:(0,l.getJSONTypes)(_.schemaType)}};_.before?I.call(this,O,te,_.before):O.rules.push(te),g.all[H]=te,(b=_.implements)===null||b===void 0||b.forEach(Z=>this.addKeyword(Z))}function I(H,_,m){const b=H.rules.findIndex($=>$.keyword===m);b>=0?H.rules.splice(b,0,_):(H.rules.push(_),this.logger.warn(`rule ${m} is not defined`))}function B(H){let{metaSchema:_}=H;_!==void 0&&(H.$data&&this.opts.$data&&(_=Y(_)),H.validateSchema=this.compile(_,!0))}const J={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function Y(H){return{anyOf:[H,J]}}})(core$2);var draft7={},core$1={},id$1={};Object.defineProperty(id$1,"__esModule",{value:!0});const def$s={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};id$1.default=def$s;var ref={};Object.defineProperty(ref,"__esModule",{value:!0});ref.callRef=ref.getValidate=void 0;const ref_error_1=ref_error,code_1$8=code,codegen_1$m=codegen,names_1$1=names$1,compile_1$1=compile,util_1$j=util$a,def$r={keyword:"$ref",schemaType:"string",code(e){const{gen:t,schema:n,it:i}=e,{baseId:a,schemaEnv:o,validateName:c,opts:d,self:u}=i,{root:l}=o;if((n==="#"||n==="#/")&&a===l.baseId)return p();const h=compile_1$1.resolveRef.call(u,l,a,n);if(h===void 0)throw new ref_error_1.default(i.opts.uriResolver,a,n);if(h instanceof compile_1$1.SchemaEnv)return y(h);return E(h);function p(){if(o===l)return callRef(e,c,o,o.$async);const x=t.scopeValue("root",{ref:l});return callRef(e,(0,codegen_1$m._)`${x}.validate`,l,l.$async)}function y(x){const S=getValidate(e,x);callRef(e,S,x,x.$async)}function E(x){const S=t.scopeValue("schema",d.code.source===!0?{ref:x,code:(0,codegen_1$m.stringify)(x)}:{ref:x}),k=t.name("valid"),T=e.subschema({schema:x,dataTypes:[],schemaPath:codegen_1$m.nil,topSchemaRef:S,errSchemaPath:n},k);e.mergeEvaluated(T),e.ok(k)}}};function getValidate(e,t){const{gen:n}=e;return t.validate?n.scopeValue("validate",{ref:t.validate}):(0,codegen_1$m._)`${n.scopeValue("wrapper",{ref:t})}.validate`}ref.getValidate=getValidate;function callRef(e,t,n,i){const{gen:a,it:o}=e,{allErrors:c,schemaEnv:d,opts:u}=o,l=u.passContext?names_1$1.default.this:codegen_1$m.nil;i?h():p();function h(){if(!d.$async)throw new Error("async schema referenced by sync schema");const x=a.let("valid");a.try(()=>{a.code((0,codegen_1$m._)`await ${(0,code_1$8.callValidateCode)(e,t,l)}`),E(t),c||a.assign(x,!0)},S=>{a.if((0,codegen_1$m._)`!(${S} instanceof ${o.ValidationError})`,()=>a.throw(S)),y(S),c||a.assign(x,!1)}),e.ok(x)}function p(){e.result((0,code_1$8.callValidateCode)(e,t,l),()=>E(t),()=>y(t))}function y(x){const S=(0,codegen_1$m._)`${x}.errors`;a.assign(names_1$1.default.vErrors,(0,codegen_1$m._)`${names_1$1.default.vErrors} === null ? ${S} : ${names_1$1.default.vErrors}.concat(${S})`),a.assign(names_1$1.default.errors,(0,codegen_1$m._)`${names_1$1.default.vErrors}.length`)}function E(x){var S;if(!o.opts.unevaluated)return;const k=(S=n==null?void 0:n.validate)===null||S===void 0?void 0:S.evaluated;if(o.props!==!0)if(k&&!k.dynamicProps)k.props!==void 0&&(o.props=util_1$j.mergeEvaluated.props(a,k.props,o.props));else{const T=a.var("props",(0,codegen_1$m._)`${x}.evaluated.props`);o.props=util_1$j.mergeEvaluated.props(a,T,o.props,codegen_1$m.Name)}if(o.items!==!0)if(k&&!k.dynamicItems)k.items!==void 0&&(o.items=util_1$j.mergeEvaluated.items(a,k.items,o.items));else{const T=a.var("items",(0,codegen_1$m._)`${x}.evaluated.items`);o.items=util_1$j.mergeEvaluated.items(a,T,o.items,codegen_1$m.Name)}}}ref.callRef=callRef;ref.default=def$r;Object.defineProperty(core$1,"__esModule",{value:!0});const id_1=id$1,ref_1=ref,core=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",id_1.default,ref_1.default];core$1.default=core;var validation$1={},limitNumber={};Object.defineProperty(limitNumber,"__esModule",{value:!0});const codegen_1$l=codegen,ops=codegen_1$l.operators,KWDs={maximum:{okStr:"<=",ok:ops.LTE,fail:ops.GT},minimum:{okStr:">=",ok:ops.GTE,fail:ops.LT},exclusiveMaximum:{okStr:"<",ok:ops.LT,fail:ops.GTE},exclusiveMinimum:{okStr:">",ok:ops.GT,fail:ops.LTE}},error$i={message:({keyword:e,schemaCode:t})=>(0,codegen_1$l.str)`must be ${KWDs[e].okStr} ${t}`,params:({keyword:e,schemaCode:t})=>(0,codegen_1$l._)`{comparison: ${KWDs[e].okStr}, limit: ${t}}`},def$q={keyword:Object.keys(KWDs),type:"number",schemaType:"number",$data:!0,error:error$i,code(e){const{keyword:t,data:n,schemaCode:i}=e;e.fail$data((0,codegen_1$l._)`${n} ${KWDs[t].fail} ${i} || isNaN(${n})`)}};limitNumber.default=def$q;var multipleOf={};Object.defineProperty(multipleOf,"__esModule",{value:!0});const codegen_1$k=codegen,error$h={message:({schemaCode:e})=>(0,codegen_1$k.str)`must be multiple of ${e}`,params:({schemaCode:e})=>(0,codegen_1$k._)`{multipleOf: ${e}}`},def$p={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:error$h,code(e){const{gen:t,data:n,schemaCode:i,it:a}=e,o=a.opts.multipleOfPrecision,c=t.let("res"),d=o?(0,codegen_1$k._)`Math.abs(Math.round(${c}) - ${c}) > 1e-${o}`:(0,codegen_1$k._)`${c} !== parseInt(${c})`;e.fail$data((0,codegen_1$k._)`(${i} === 0 || (${c} = ${n}/${i}, ${d}))`)}};multipleOf.default=def$p;var limitLength={},ucs2length$1={};Object.defineProperty(ucs2length$1,"__esModule",{value:!0});function ucs2length(e){const t=e.length;let n=0,i=0,a;for(;i<t;)n++,a=e.charCodeAt(i++),a>=55296&&a<=56319&&i<t&&(a=e.charCodeAt(i),(a&64512)===56320&&i++);return n}ucs2length$1.default=ucs2length;ucs2length.code='require("ajv/dist/runtime/ucs2length").default';Object.defineProperty(limitLength,"__esModule",{value:!0});const codegen_1$j=codegen,util_1$i=util$a,ucs2length_1=ucs2length$1,error$g={message({keyword:e,schemaCode:t}){const n=e==="maxLength"?"more":"fewer";return(0,codegen_1$j.str)`must NOT have ${n} than ${t} characters`},params:({schemaCode:e})=>(0,codegen_1$j._)`{limit: ${e}}`},def$o={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:error$g,code(e){const{keyword:t,data:n,schemaCode:i,it:a}=e,o=t==="maxLength"?codegen_1$j.operators.GT:codegen_1$j.operators.LT,c=a.opts.unicode===!1?(0,codegen_1$j._)`${n}.length`:(0,codegen_1$j._)`${(0,util_1$i.useFunc)(e.gen,ucs2length_1.default)}(${n})`;e.fail$data((0,codegen_1$j._)`${c} ${o} ${i}`)}};limitLength.default=def$o;var pattern={};Object.defineProperty(pattern,"__esModule",{value:!0});const code_1$7=code,codegen_1$i=codegen,error$f={message:({schemaCode:e})=>(0,codegen_1$i.str)`must match pattern "${e}"`,params:({schemaCode:e})=>(0,codegen_1$i._)`{pattern: ${e}}`},def$n={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:error$f,code(e){const{data:t,$data:n,schema:i,schemaCode:a,it:o}=e,c=o.opts.unicodeRegExp?"u":"",d=n?(0,codegen_1$i._)`(new RegExp(${a}, ${c}))`:(0,code_1$7.usePattern)(e,i);e.fail$data((0,codegen_1$i._)`!${d}.test(${t})`)}};pattern.default=def$n;var limitProperties={};Object.defineProperty(limitProperties,"__esModule",{value:!0});const codegen_1$h=codegen,error$e={message({keyword:e,schemaCode:t}){const n=e==="maxProperties"?"more":"fewer";return(0,codegen_1$h.str)`must NOT have ${n} than ${t} properties`},params:({schemaCode:e})=>(0,codegen_1$h._)`{limit: ${e}}`},def$m={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:error$e,code(e){const{keyword:t,data:n,schemaCode:i}=e,a=t==="maxProperties"?codegen_1$h.operators.GT:codegen_1$h.operators.LT;e.fail$data((0,codegen_1$h._)`Object.keys(${n}).length ${a} ${i}`)}};limitProperties.default=def$m;var required={};Object.defineProperty(required,"__esModule",{value:!0});const code_1$6=code,codegen_1$g=codegen,util_1$h=util$a,error$d={message:({params:{missingProperty:e}})=>(0,codegen_1$g.str)`must have required property '${e}'`,params:({params:{missingProperty:e}})=>(0,codegen_1$g._)`{missingProperty: ${e}}`},def$l={keyword:"required",type:"object",schemaType:"array",$data:!0,error:error$d,code(e){const{gen:t,schema:n,schemaCode:i,data:a,$data:o,it:c}=e,{opts:d}=c;if(!o&&n.length===0)return;const u=n.length>=d.loopRequired;if(c.allErrors?l():h(),d.strictRequired){const E=e.parentSchema.properties,{definedProperties:x}=e.it;for(const S of n)if((E==null?void 0:E[S])===void 0&&!x.has(S)){const k=c.schemaEnv.baseId+c.errSchemaPath,T=`required property "${S}" is not defined at "${k}" (strictRequired)`;(0,util_1$h.checkStrictMode)(c,T,c.opts.strictRequired)}}function l(){if(u||o)e.block$data(codegen_1$g.nil,p);else for(const E of n)(0,code_1$6.checkReportMissingProp)(e,E)}function h(){const E=t.let("missing");if(u||o){const x=t.let("valid",!0);e.block$data(x,()=>y(E,x)),e.ok(x)}else t.if((0,code_1$6.checkMissingProp)(e,n,E)),(0,code_1$6.reportMissingProp)(e,E),t.else()}function p(){t.forOf("prop",i,E=>{e.setParams({missingProperty:E}),t.if((0,code_1$6.noPropertyInData)(t,a,E,d.ownProperties),()=>e.error())})}function y(E,x){e.setParams({missingProperty:E}),t.forOf(E,i,()=>{t.assign(x,(0,code_1$6.propertyInData)(t,a,E,d.ownProperties)),t.if((0,codegen_1$g.not)(x),()=>{e.error(),t.break()})},codegen_1$g.nil)}}};required.default=def$l;var limitItems={};Object.defineProperty(limitItems,"__esModule",{value:!0});const codegen_1$f=codegen,error$c={message({keyword:e,schemaCode:t}){const n=e==="maxItems"?"more":"fewer";return(0,codegen_1$f.str)`must NOT have ${n} than ${t} items`},params:({schemaCode:e})=>(0,codegen_1$f._)`{limit: ${e}}`},def$k={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:error$c,code(e){const{keyword:t,data:n,schemaCode:i}=e,a=t==="maxItems"?codegen_1$f.operators.GT:codegen_1$f.operators.LT;e.fail$data((0,codegen_1$f._)`${n}.length ${a} ${i}`)}};limitItems.default=def$k;var uniqueItems={},equal$1={};Object.defineProperty(equal$1,"__esModule",{value:!0});const equal=fastDeepEqual;equal.code='require("ajv/dist/runtime/equal").default';equal$1.default=equal;Object.defineProperty(uniqueItems,"__esModule",{value:!0});const dataType_1=dataType,codegen_1$e=codegen,util_1$g=util$a,equal_1$2=equal$1,error$b={message:({params:{i:e,j:t}})=>(0,codegen_1$e.str)`must NOT have duplicate items (items ## ${t} and ${e} are identical)`,params:({params:{i:e,j:t}})=>(0,codegen_1$e._)`{i: ${e}, j: ${t}}`},def$j={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:error$b,code(e){const{gen:t,data:n,$data:i,schema:a,parentSchema:o,schemaCode:c,it:d}=e;if(!i&&!a)return;const u=t.let("valid"),l=o.items?(0,dataType_1.getSchemaTypes)(o.items):[];e.block$data(u,h,(0,codegen_1$e._)`${c} === false`),e.ok(u);function h(){const x=t.let("i",(0,codegen_1$e._)`${n}.length`),S=t.let("j");e.setParams({i:x,j:S}),t.assign(u,!0),t.if((0,codegen_1$e._)`${x} > 1`,()=>(p()?y:E)(x,S))}function p(){return l.length>0&&!l.some(x=>x==="object"||x==="array")}function y(x,S){const k=t.name("item"),T=(0,dataType_1.checkDataTypes)(l,k,d.opts.strictNumbers,dataType_1.DataType.Wrong),L=t.const("indices",(0,codegen_1$e._)`{}`);t.for((0,codegen_1$e._)`;${x}--;`,()=>{t.let(k,(0,codegen_1$e._)`${n}[${x}]`),t.if(T,(0,codegen_1$e._)`continue`),l.length>1&&t.if((0,codegen_1$e._)`typeof ${k} == "string"`,(0,codegen_1$e._)`${k} += "_"`),t.if((0,codegen_1$e._)`typeof ${L}[${k}] == "number"`,()=>{t.assign(S,(0,codegen_1$e._)`${L}[${k}]`),e.error(),t.assign(u,!1).break()}).code((0,codegen_1$e._)`${L}[${k}] = ${x}`)})}function E(x,S){const k=(0,util_1$g.useFunc)(t,equal_1$2.default),T=t.name("outer");t.label(T).for((0,codegen_1$e._)`;${x}--;`,()=>t.for((0,codegen_1$e._)`${S} = ${x}; ${S}--;`,()=>t.if((0,codegen_1$e._)`${k}(${n}[${x}], ${n}[${S}])`,()=>{e.error(),t.assign(u,!1).break(T)})))}}};uniqueItems.default=def$j;var _const={};Object.defineProperty(_const,"__esModule",{value:!0});const codegen_1$d=codegen,util_1$f=util$a,equal_1$1=equal$1,error$a={message:"must be equal to constant",params:({schemaCode:e})=>(0,codegen_1$d._)`{allowedValue: ${e}}`},def$i={keyword:"const",$data:!0,error:error$a,code(e){const{gen:t,data:n,$data:i,schemaCode:a,schema:o}=e;i||o&&typeof o=="object"?e.fail$data((0,codegen_1$d._)`!${(0,util_1$f.useFunc)(t,equal_1$1.default)}(${n}, ${a})`):e.fail((0,codegen_1$d._)`${o} !== ${n}`)}};_const.default=def$i;var _enum={};Object.defineProperty(_enum,"__esModule",{value:!0});const codegen_1$c=codegen,util_1$e=util$a,equal_1=equal$1,error$9={message:"must be equal to one of the allowed values",params:({schemaCode:e})=>(0,codegen_1$c._)`{allowedValues: ${e}}`},def$h={keyword:"enum",schemaType:"array",$data:!0,error:error$9,code(e){const{gen:t,data:n,$data:i,schema:a,schemaCode:o,it:c}=e;if(!i&&a.length===0)throw new Error("enum must have non-empty array");const d=a.length>=c.opts.loopEnum;let u;const l=()=>u??(u=(0,util_1$e.useFunc)(t,equal_1.default));let h;if(d||i)h=t.let("valid"),e.block$data(h,p);else{if(!Array.isArray(a))throw new Error("ajv implementation error");const E=t.const("vSchema",o);h=(0,codegen_1$c.or)(...a.map((x,S)=>y(E,S)))}e.pass(h);function p(){t.assign(h,!1),t.forOf("v",o,E=>t.if((0,codegen_1$c._)`${l()}(${n}, ${E})`,()=>t.assign(h,!0).break()))}function y(E,x){const S=a[x];return typeof S=="object"&&S!==null?(0,codegen_1$c._)`${l()}(${n}, ${E}[${x}])`:(0,codegen_1$c._)`${n} === ${S}`}}};_enum.default=def$h;Object.defineProperty(validation$1,"__esModule",{value:!0});const limitNumber_1=limitNumber,multipleOf_1=multipleOf,limitLength_1=limitLength,pattern_1=pattern,limitProperties_1=limitProperties,required_1=required,limitItems_1=limitItems,uniqueItems_1=uniqueItems,const_1=_const,enum_1=_enum,validation=[limitNumber_1.default,multipleOf_1.default,limitLength_1.default,pattern_1.default,limitProperties_1.default,required_1.default,limitItems_1.default,uniqueItems_1.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},const_1.default,enum_1.default];validation$1.default=validation;var applicator={},additionalItems={};Object.defineProperty(additionalItems,"__esModule",{value:!0});additionalItems.validateAdditionalItems=void 0;const codegen_1$b=codegen,util_1$d=util$a,error$8={message:({params:{len:e}})=>(0,codegen_1$b.str)`must NOT have more than ${e} items`,params:({params:{len:e}})=>(0,codegen_1$b._)`{limit: ${e}}`},def$g={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:error$8,code(e){const{parentSchema:t,it:n}=e,{items:i}=t;if(!Array.isArray(i)){(0,util_1$d.checkStrictMode)(n,'"additionalItems" is ignored when "items" is not an array of schemas');return}validateAdditionalItems(e,i)}};function validateAdditionalItems(e,t){const{gen:n,schema:i,data:a,keyword:o,it:c}=e;c.items=!0;const d=n.const("len",(0,codegen_1$b._)`${a}.length`);if(i===!1)e.setParams({len:t.length}),e.pass((0,codegen_1$b._)`${d} <= ${t.length}`);else if(typeof i=="object"&&!(0,util_1$d.alwaysValidSchema)(c,i)){const l=n.var("valid",(0,codegen_1$b._)`${d} <= ${t.length}`);n.if((0,codegen_1$b.not)(l),()=>u(l)),e.ok(l)}function u(l){n.forRange("i",t.length,d,h=>{e.subschema({keyword:o,dataProp:h,dataPropType:util_1$d.Type.Num},l),c.allErrors||n.if((0,codegen_1$b.not)(l),()=>n.break())})}}additionalItems.validateAdditionalItems=validateAdditionalItems;additionalItems.default=def$g;var prefixItems={},items={};Object.defineProperty(items,"__esModule",{value:!0});items.validateTuple=void 0;const codegen_1$a=codegen,util_1$c=util$a,code_1$5=code,def$f={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(e){const{schema:t,it:n}=e;if(Array.isArray(t))return validateTuple(e,"additionalItems",t);n.items=!0,!(0,util_1$c.alwaysValidSchema)(n,t)&&e.ok((0,code_1$5.validateArray)(e))}};function validateTuple(e,t,n=e.schema){const{gen:i,parentSchema:a,data:o,keyword:c,it:d}=e;h(a),d.opts.unevaluated&&n.length&&d.items!==!0&&(d.items=util_1$c.mergeEvaluated.items(i,n.length,d.items));const u=i.name("valid"),l=i.const("len",(0,codegen_1$a._)`${o}.length`);n.forEach((p,y)=>{(0,util_1$c.alwaysValidSchema)(d,p)||(i.if((0,codegen_1$a._)`${l} > ${y}`,()=>e.subschema({keyword:c,schemaProp:y,dataProp:y},u)),e.ok(u))});function h(p){const{opts:y,errSchemaPath:E}=d,x=n.length,S=x===p.minItems&&(x===p.maxItems||p[t]===!1);if(y.strictTuples&&!S){const k=`"${c}" is ${x}-tuple, but minItems or maxItems/${t} are not specified or different at path "${E}"`;(0,util_1$c.checkStrictMode)(d,k,y.strictTuples)}}}items.validateTuple=validateTuple;items.default=def$f;Object.defineProperty(prefixItems,"__esModule",{value:!0});const items_1$1=items,def$e={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:e=>(0,items_1$1.validateTuple)(e,"items")};prefixItems.default=def$e;var items2020={};Object.defineProperty(items2020,"__esModule",{value:!0});const codegen_1$9=codegen,util_1$b=util$a,code_1$4=code,additionalItems_1$1=additionalItems,error$7={message:({params:{len:e}})=>(0,codegen_1$9.str)`must NOT have more than ${e} items`,params:({params:{len:e}})=>(0,codegen_1$9._)`{limit: ${e}}`},def$d={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:error$7,code(e){const{schema:t,parentSchema:n,it:i}=e,{prefixItems:a}=n;i.items=!0,!(0,util_1$b.alwaysValidSchema)(i,t)&&(a?(0,additionalItems_1$1.validateAdditionalItems)(e,a):e.ok((0,code_1$4.validateArray)(e)))}};items2020.default=def$d;var contains={};Object.defineProperty(contains,"__esModule",{value:!0});const codegen_1$8=codegen,util_1$a=util$a,error$6={message:({params:{min:e,max:t}})=>t===void 0?(0,codegen_1$8.str)`must contain at least ${e} valid item(s)`:(0,codegen_1$8.str)`must contain at least ${e} and no more than ${t} valid item(s)`,params:({params:{min:e,max:t}})=>t===void 0?(0,codegen_1$8._)`{minContains: ${e}}`:(0,codegen_1$8._)`{minContains: ${e}, maxContains: ${t}}`},def$c={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:error$6,code(e){const{gen:t,schema:n,parentSchema:i,data:a,it:o}=e;let c,d;const{minContains:u,maxContains:l}=i;o.opts.next?(c=u===void 0?1:u,d=l):c=1;const h=t.const("len",(0,codegen_1$8._)`${a}.length`);if(e.setParams({min:c,max:d}),d===void 0&&c===0){(0,util_1$a.checkStrictMode)(o,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(d!==void 0&&c>d){(0,util_1$a.checkStrictMode)(o,'"minContains" > "maxContains" is always invalid'),e.fail();return}if((0,util_1$a.alwaysValidSchema)(o,n)){let S=(0,codegen_1$8._)`${h} >= ${c}`;d!==void 0&&(S=(0,codegen_1$8._)`${S} && ${h} <= ${d}`),e.pass(S);return}o.items=!0;const p=t.name("valid");d===void 0&&c===1?E(p,()=>t.if(p,()=>t.break())):c===0?(t.let(p,!0),d!==void 0&&t.if((0,codegen_1$8._)`${a}.length > 0`,y)):(t.let(p,!1),y()),e.result(p,()=>e.reset());function y(){const S=t.name("_valid"),k=t.let("count",0);E(S,()=>t.if(S,()=>x(k)))}function E(S,k){t.forRange("i",0,h,T=>{e.subschema({keyword:"contains",dataProp:T,dataPropType:util_1$a.Type.Num,compositeRule:!0},S),k()})}function x(S){t.code((0,codegen_1$8._)`${S}++`),d===void 0?t.if((0,codegen_1$8._)`${S} >= ${c}`,()=>t.assign(p,!0).break()):(t.if((0,codegen_1$8._)`${S} > ${d}`,()=>t.assign(p,!1).break()),c===1?t.assign(p,!0):t.if((0,codegen_1$8._)`${S} >= ${c}`,()=>t.assign(p,!0)))}}};contains.default=def$c;var dependencies={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validateSchemaDeps=e.validatePropertyDeps=e.error=void 0;const t=codegen,n=util$a,i=code;e.error={message:({params:{property:u,depsCount:l,deps:h}})=>{const p=l===1?"property":"properties";return(0,t.str)`must have ${p} ${h} when property ${u} is present`},params:({params:{property:u,depsCount:l,deps:h,missingProperty:p}})=>(0,t._)`{property: ${u},
    missingProperty: ${p},
    depsCount: ${l},
    deps: ${h}}`};const a={keyword:"dependencies",type:"object",schemaType:"object",error:e.error,code(u){const[l,h]=o(u);c(u,l),d(u,h)}};function o({schema:u}){const l={},h={};for(const p in u){if(p==="__proto__")continue;const y=Array.isArray(u[p])?l:h;y[p]=u[p]}return[l,h]}function c(u,l=u.schema){const{gen:h,data:p,it:y}=u;if(Object.keys(l).length===0)return;const E=h.let("missing");for(const x in l){const S=l[x];if(S.length===0)continue;const k=(0,i.propertyInData)(h,p,x,y.opts.ownProperties);u.setParams({property:x,depsCount:S.length,deps:S.join(", ")}),y.allErrors?h.if(k,()=>{for(const T of S)(0,i.checkReportMissingProp)(u,T)}):(h.if((0,t._)`${k} && (${(0,i.checkMissingProp)(u,S,E)})`),(0,i.reportMissingProp)(u,E),h.else())}}e.validatePropertyDeps=c;function d(u,l=u.schema){const{gen:h,data:p,keyword:y,it:E}=u,x=h.name("valid");for(const S in l)(0,n.alwaysValidSchema)(E,l[S])||(h.if((0,i.propertyInData)(h,p,S,E.opts.ownProperties),()=>{const k=u.subschema({keyword:y,schemaProp:S},x);u.mergeValidEvaluated(k,x)},()=>h.var(x,!0)),u.ok(x))}e.validateSchemaDeps=d,e.default=a})(dependencies);var propertyNames={};Object.defineProperty(propertyNames,"__esModule",{value:!0});const codegen_1$7=codegen,util_1$9=util$a,error$5={message:"property name must be valid",params:({params:e})=>(0,codegen_1$7._)`{propertyName: ${e.propertyName}}`},def$b={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:error$5,code(e){const{gen:t,schema:n,data:i,it:a}=e;if((0,util_1$9.alwaysValidSchema)(a,n))return;const o=t.name("valid");t.forIn("key",i,c=>{e.setParams({propertyName:c}),e.subschema({keyword:"propertyNames",data:c,dataTypes:["string"],propertyName:c,compositeRule:!0},o),t.if((0,codegen_1$7.not)(o),()=>{e.error(!0),a.allErrors||t.break()})}),e.ok(o)}};propertyNames.default=def$b;var additionalProperties={};Object.defineProperty(additionalProperties,"__esModule",{value:!0});const code_1$3=code,codegen_1$6=codegen,names_1=names$1,util_1$8=util$a,error$4={message:"must NOT have additional properties",params:({params:e})=>(0,codegen_1$6._)`{additionalProperty: ${e.additionalProperty}}`},def$a={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:error$4,code(e){const{gen:t,schema:n,parentSchema:i,data:a,errsCount:o,it:c}=e;if(!o)throw new Error("ajv implementation error");const{allErrors:d,opts:u}=c;if(c.props=!0,u.removeAdditional!=="all"&&(0,util_1$8.alwaysValidSchema)(c,n))return;const l=(0,code_1$3.allSchemaProperties)(i.properties),h=(0,code_1$3.allSchemaProperties)(i.patternProperties);p(),e.ok((0,codegen_1$6._)`${o} === ${names_1.default.errors}`);function p(){t.forIn("key",a,k=>{!l.length&&!h.length?x(k):t.if(y(k),()=>x(k))})}function y(k){let T;if(l.length>8){const L=(0,util_1$8.schemaRefOrVal)(c,i.properties,"properties");T=(0,code_1$3.isOwnProperty)(t,L,k)}else l.length?T=(0,codegen_1$6.or)(...l.map(L=>(0,codegen_1$6._)`${k} === ${L}`)):T=codegen_1$6.nil;return h.length&&(T=(0,codegen_1$6.or)(T,...h.map(L=>(0,codegen_1$6._)`${(0,code_1$3.usePattern)(e,L)}.test(${k})`))),(0,codegen_1$6.not)(T)}function E(k){t.code((0,codegen_1$6._)`delete ${a}[${k}]`)}function x(k){if(u.removeAdditional==="all"||u.removeAdditional&&n===!1){E(k);return}if(n===!1){e.setParams({additionalProperty:k}),e.error(),d||t.break();return}if(typeof n=="object"&&!(0,util_1$8.alwaysValidSchema)(c,n)){const T=t.name("valid");u.removeAdditional==="failing"?(S(k,T,!1),t.if((0,codegen_1$6.not)(T),()=>{e.reset(),E(k)})):(S(k,T),d||t.if((0,codegen_1$6.not)(T),()=>t.break()))}}function S(k,T,L){const q={keyword:"additionalProperties",dataProp:k,dataPropType:util_1$8.Type.Str};L===!1&&Object.assign(q,{compositeRule:!0,createErrors:!1,allErrors:!1}),e.subschema(q,T)}}};additionalProperties.default=def$a;var properties$1={};Object.defineProperty(properties$1,"__esModule",{value:!0});const validate_1=validate,code_1$2=code,util_1$7=util$a,additionalProperties_1$1=additionalProperties,def$9={keyword:"properties",type:"object",schemaType:"object",code(e){const{gen:t,schema:n,parentSchema:i,data:a,it:o}=e;o.opts.removeAdditional==="all"&&i.additionalProperties===void 0&&additionalProperties_1$1.default.code(new validate_1.KeywordCxt(o,additionalProperties_1$1.default,"additionalProperties"));const c=(0,code_1$2.allSchemaProperties)(n);for(const p of c)o.definedProperties.add(p);o.opts.unevaluated&&c.length&&o.props!==!0&&(o.props=util_1$7.mergeEvaluated.props(t,(0,util_1$7.toHash)(c),o.props));const d=c.filter(p=>!(0,util_1$7.alwaysValidSchema)(o,n[p]));if(d.length===0)return;const u=t.name("valid");for(const p of d)l(p)?h(p):(t.if((0,code_1$2.propertyInData)(t,a,p,o.opts.ownProperties)),h(p),o.allErrors||t.else().var(u,!0),t.endIf()),e.it.definedProperties.add(p),e.ok(u);function l(p){return o.opts.useDefaults&&!o.compositeRule&&n[p].default!==void 0}function h(p){e.subschema({keyword:"properties",schemaProp:p,dataProp:p},u)}}};properties$1.default=def$9;var patternProperties={};Object.defineProperty(patternProperties,"__esModule",{value:!0});const code_1$1=code,codegen_1$5=codegen,util_1$6=util$a,util_2=util$a,def$8={keyword:"patternProperties",type:"object",schemaType:"object",code(e){const{gen:t,schema:n,data:i,parentSchema:a,it:o}=e,{opts:c}=o,d=(0,code_1$1.allSchemaProperties)(n),u=d.filter(S=>(0,util_1$6.alwaysValidSchema)(o,n[S]));if(d.length===0||u.length===d.length&&(!o.opts.unevaluated||o.props===!0))return;const l=c.strictSchema&&!c.allowMatchingProperties&&a.properties,h=t.name("valid");o.props!==!0&&!(o.props instanceof codegen_1$5.Name)&&(o.props=(0,util_2.evaluatedPropsToName)(t,o.props));const{props:p}=o;y();function y(){for(const S of d)l&&E(S),o.allErrors?x(S):(t.var(h,!0),x(S),t.if(h))}function E(S){for(const k in l)new RegExp(S).test(k)&&(0,util_1$6.checkStrictMode)(o,`property ${k} matches pattern ${S} (use allowMatchingProperties)`)}function x(S){t.forIn("key",i,k=>{t.if((0,codegen_1$5._)`${(0,code_1$1.usePattern)(e,S)}.test(${k})`,()=>{const T=u.includes(S);T||e.subschema({keyword:"patternProperties",schemaProp:S,dataProp:k,dataPropType:util_2.Type.Str},h),o.opts.unevaluated&&p!==!0?t.assign((0,codegen_1$5._)`${p}[${k}]`,!0):!T&&!o.allErrors&&t.if((0,codegen_1$5.not)(h),()=>t.break())})})}}};patternProperties.default=def$8;var not={};Object.defineProperty(not,"__esModule",{value:!0});const util_1$5=util$a,def$7={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(e){const{gen:t,schema:n,it:i}=e;if((0,util_1$5.alwaysValidSchema)(i,n)){e.fail();return}const a=t.name("valid");e.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},a),e.failResult(a,()=>e.reset(),()=>e.error())},error:{message:"must NOT be valid"}};not.default=def$7;var anyOf={};Object.defineProperty(anyOf,"__esModule",{value:!0});const code_1=code,def$6={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:code_1.validateUnion,error:{message:"must match a schema in anyOf"}};anyOf.default=def$6;var oneOf={};Object.defineProperty(oneOf,"__esModule",{value:!0});const codegen_1$4=codegen,util_1$4=util$a,error$3={message:"must match exactly one schema in oneOf",params:({params:e})=>(0,codegen_1$4._)`{passingSchemas: ${e.passing}}`},def$5={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:error$3,code(e){const{gen:t,schema:n,parentSchema:i,it:a}=e;if(!Array.isArray(n))throw new Error("ajv implementation error");if(a.opts.discriminator&&i.discriminator)return;const o=n,c=t.let("valid",!1),d=t.let("passing",null),u=t.name("_valid");e.setParams({passing:d}),t.block(l),e.result(c,()=>e.reset(),()=>e.error(!0));function l(){o.forEach((h,p)=>{let y;(0,util_1$4.alwaysValidSchema)(a,h)?t.var(u,!0):y=e.subschema({keyword:"oneOf",schemaProp:p,compositeRule:!0},u),p>0&&t.if((0,codegen_1$4._)`${u} && ${c}`).assign(c,!1).assign(d,(0,codegen_1$4._)`[${d}, ${p}]`).else(),t.if(u,()=>{t.assign(c,!0),t.assign(d,p),y&&e.mergeEvaluated(y,codegen_1$4.Name)})})}}};oneOf.default=def$5;var allOf={};Object.defineProperty(allOf,"__esModule",{value:!0});const util_1$3=util$a,def$4={keyword:"allOf",schemaType:"array",code(e){const{gen:t,schema:n,it:i}=e;if(!Array.isArray(n))throw new Error("ajv implementation error");const a=t.name("valid");n.forEach((o,c)=>{if((0,util_1$3.alwaysValidSchema)(i,o))return;const d=e.subschema({keyword:"allOf",schemaProp:c},a);e.ok(a),e.mergeEvaluated(d)})}};allOf.default=def$4;var _if={};Object.defineProperty(_if,"__esModule",{value:!0});const codegen_1$3=codegen,util_1$2=util$a,error$2={message:({params:e})=>(0,codegen_1$3.str)`must match "${e.ifClause}" schema`,params:({params:e})=>(0,codegen_1$3._)`{failingKeyword: ${e.ifClause}}`},def$3={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:error$2,code(e){const{gen:t,parentSchema:n,it:i}=e;n.then===void 0&&n.else===void 0&&(0,util_1$2.checkStrictMode)(i,'"if" without "then" and "else" is ignored');const a=hasSchema(i,"then"),o=hasSchema(i,"else");if(!a&&!o)return;const c=t.let("valid",!0),d=t.name("_valid");if(u(),e.reset(),a&&o){const h=t.let("ifClause");e.setParams({ifClause:h}),t.if(d,l("then",h),l("else",h))}else a?t.if(d,l("then")):t.if((0,codegen_1$3.not)(d),l("else"));e.pass(c,()=>e.error(!0));function u(){const h=e.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},d);e.mergeEvaluated(h)}function l(h,p){return()=>{const y=e.subschema({keyword:h},d);t.assign(c,d),e.mergeValidEvaluated(y,c),p?t.assign(p,(0,codegen_1$3._)`${h}`):e.setParams({ifClause:h})}}}};function hasSchema(e,t){const n=e.schema[t];return n!==void 0&&!(0,util_1$2.alwaysValidSchema)(e,n)}_if.default=def$3;var thenElse={};Object.defineProperty(thenElse,"__esModule",{value:!0});const util_1$1=util$a,def$2={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:e,parentSchema:t,it:n}){t.if===void 0&&(0,util_1$1.checkStrictMode)(n,`"${e}" without "if" is ignored`)}};thenElse.default=def$2;Object.defineProperty(applicator,"__esModule",{value:!0});const additionalItems_1=additionalItems,prefixItems_1=prefixItems,items_1=items,items2020_1=items2020,contains_1=contains,dependencies_1=dependencies,propertyNames_1=propertyNames,additionalProperties_1=additionalProperties,properties_1=properties$1,patternProperties_1=patternProperties,not_1=not,anyOf_1=anyOf,oneOf_1=oneOf,allOf_1=allOf,if_1=_if,thenElse_1=thenElse;function getApplicator(e=!1){const t=[not_1.default,anyOf_1.default,oneOf_1.default,allOf_1.default,if_1.default,thenElse_1.default,propertyNames_1.default,additionalProperties_1.default,dependencies_1.default,properties_1.default,patternProperties_1.default];return e?t.push(prefixItems_1.default,items2020_1.default):t.push(additionalItems_1.default,items_1.default),t.push(contains_1.default),t}applicator.default=getApplicator;var format$3={},format$2={};Object.defineProperty(format$2,"__esModule",{value:!0});const codegen_1$2=codegen,error$1={message:({schemaCode:e})=>(0,codegen_1$2.str)`must match format "${e}"`,params:({schemaCode:e})=>(0,codegen_1$2._)`{format: ${e}}`},def$1={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:error$1,code(e,t){const{gen:n,data:i,$data:a,schema:o,schemaCode:c,it:d}=e,{opts:u,errSchemaPath:l,schemaEnv:h,self:p}=d;if(!u.validateFormats)return;a?y():E();function y(){const x=n.scopeValue("formats",{ref:p.formats,code:u.code.formats}),S=n.const("fDef",(0,codegen_1$2._)`${x}[${c}]`),k=n.let("fType"),T=n.let("format");n.if((0,codegen_1$2._)`typeof ${S} == "object" && !(${S} instanceof RegExp)`,()=>n.assign(k,(0,codegen_1$2._)`${S}.type || "string"`).assign(T,(0,codegen_1$2._)`${S}.validate`),()=>n.assign(k,(0,codegen_1$2._)`"string"`).assign(T,S)),e.fail$data((0,codegen_1$2.or)(L(),q()));function L(){return u.strictSchema===!1?codegen_1$2.nil:(0,codegen_1$2._)`${c} && !${T}`}function q(){const U=h.$async?(0,codegen_1$2._)`(${S}.async ? await ${T}(${i}) : ${T}(${i}))`:(0,codegen_1$2._)`${T}(${i})`,ee=(0,codegen_1$2._)`(typeof ${T} == "function" ? ${U} : ${T}.test(${i}))`;return(0,codegen_1$2._)`${T} && ${T} !== true && ${k} === ${t} && !${ee}`}}function E(){const x=p.formats[o];if(!x){L();return}if(x===!0)return;const[S,k,T]=q(x);S===t&&e.pass(U());function L(){if(u.strictSchema===!1){p.logger.warn(ee());return}throw new Error(ee());function ee(){return`unknown format "${o}" ignored in schema at path "${l}"`}}function q(ee){const W=ee instanceof RegExp?(0,codegen_1$2.regexpCode)(ee):u.code.formats?(0,codegen_1$2._)`${u.code.formats}${(0,codegen_1$2.getProperty)(o)}`:void 0,ie=n.scopeValue("formats",{key:o,ref:ee,code:W});return typeof ee=="object"&&!(ee instanceof RegExp)?[ee.type||"string",ee.validate,(0,codegen_1$2._)`${ie}.validate`]:["string",ee,ie]}function U(){if(typeof x=="object"&&!(x instanceof RegExp)&&x.async){if(!h.$async)throw new Error("async format in sync schema");return(0,codegen_1$2._)`await ${T}(${i})`}return typeof k=="function"?(0,codegen_1$2._)`${T}(${i})`:(0,codegen_1$2._)`${T}.test(${i})`}}}};format$2.default=def$1;Object.defineProperty(format$3,"__esModule",{value:!0});const format_1$1=format$2,format$1=[format_1$1.default];format$3.default=format$1;var metadata={};Object.defineProperty(metadata,"__esModule",{value:!0});metadata.contentVocabulary=metadata.metadataVocabulary=void 0;metadata.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];metadata.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"];Object.defineProperty(draft7,"__esModule",{value:!0});const core_1=core$1,validation_1=validation$1,applicator_1=applicator,format_1=format$3,metadata_1=metadata,draft7Vocabularies=[core_1.default,validation_1.default,(0,applicator_1.default)(),format_1.default,metadata_1.metadataVocabulary,metadata_1.contentVocabulary];draft7.default=draft7Vocabularies;var discriminator={},types={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DiscrError=void 0,function(t){t.Tag="tag",t.Mapping="mapping"}(e.DiscrError||(e.DiscrError={}))})(types);Object.defineProperty(discriminator,"__esModule",{value:!0});const codegen_1$1=codegen,types_1=types,compile_1=compile,util_1=util$a,error={message:({params:{discrError:e,tagName:t}})=>e===types_1.DiscrError.Tag?`tag "${t}" must be string`:`value of tag "${t}" must be in oneOf`,params:({params:{discrError:e,tag:t,tagName:n}})=>(0,codegen_1$1._)`{error: ${e}, tag: ${n}, tagValue: ${t}}`},def={keyword:"discriminator",type:"object",schemaType:"object",error,code(e){const{gen:t,data:n,schema:i,parentSchema:a,it:o}=e,{oneOf:c}=a;if(!o.opts.discriminator)throw new Error("discriminator: requires discriminator option");const d=i.propertyName;if(typeof d!="string")throw new Error("discriminator: requires propertyName");if(i.mapping)throw new Error("discriminator: mapping is not supported");if(!c)throw new Error("discriminator: requires oneOf keyword");const u=t.let("valid",!1),l=t.const("tag",(0,codegen_1$1._)`${n}${(0,codegen_1$1.getProperty)(d)}`);t.if((0,codegen_1$1._)`typeof ${l} == "string"`,()=>h(),()=>e.error(!1,{discrError:types_1.DiscrError.Tag,tag:l,tagName:d})),e.ok(u);function h(){const E=y();t.if(!1);for(const x in E)t.elseIf((0,codegen_1$1._)`${l} === ${x}`),t.assign(u,p(E[x]));t.else(),e.error(!1,{discrError:types_1.DiscrError.Mapping,tag:l,tagName:d}),t.endIf()}function p(E){const x=t.name("valid"),S=e.subschema({keyword:"oneOf",schemaProp:E},x);return e.mergeEvaluated(S,codegen_1$1.Name),x}function y(){var E;const x={},S=T(a);let k=!0;for(let U=0;U<c.length;U++){let ee=c[U];ee!=null&&ee.$ref&&!(0,util_1.schemaHasRulesButRef)(ee,o.self.RULES)&&(ee=compile_1.resolveRef.call(o.self,o.schemaEnv.root,o.baseId,ee==null?void 0:ee.$ref),ee instanceof compile_1.SchemaEnv&&(ee=ee.schema));const W=(E=ee==null?void 0:ee.properties)===null||E===void 0?void 0:E[d];if(typeof W!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${d}"`);k=k&&(S||T(ee)),L(W,U)}if(!k)throw new Error(`discriminator: "${d}" must be required`);return x;function T({required:U}){return Array.isArray(U)&&U.includes(d)}function L(U,ee){if(U.const)q(U.const,ee);else if(U.enum)for(const W of U.enum)q(W,ee);else throw new Error(`discriminator: "properties/${d}" must have "const" or "enum"`)}function q(U,ee){if(typeof U!="string"||U in x)throw new Error(`discriminator: "${d}" values must be unique strings`);x[U]=ee}}}};discriminator.default=def;const $schema="http://json-schema.org/draft-07/schema#",$id="http://json-schema.org/draft-07/schema#",title="Core schema meta-schema",definitions={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type$1=["object","boolean"],properties={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},require$$3={$schema,$id,title,definitions,type:type$1,properties,default:!0};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MissingRefError=t.ValidationError=t.CodeGen=t.Name=t.nil=t.stringify=t.str=t._=t.KeywordCxt=void 0;const n=core$2,i=draft7,a=discriminator,o=require$$3,c=["/properties"],d="http://json-schema.org/draft-07/schema";class u extends n.default{_addVocabularies(){super._addVocabularies(),i.default.forEach(x=>this.addVocabulary(x)),this.opts.discriminator&&this.addKeyword(a.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const x=this.opts.$data?this.$dataMetaSchema(o,c):o;this.addMetaSchema(x,d,!1),this.refs["http://json-schema.org/schema"]=d}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(d)?d:void 0)}}e.exports=t=u,Object.defineProperty(t,"__esModule",{value:!0}),t.default=u;var l=validate;Object.defineProperty(t,"KeywordCxt",{enumerable:!0,get:function(){return l.KeywordCxt}});var h=codegen;Object.defineProperty(t,"_",{enumerable:!0,get:function(){return h._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return h.str}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return h.stringify}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return h.nil}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return h.Name}}),Object.defineProperty(t,"CodeGen",{enumerable:!0,get:function(){return h.CodeGen}});var p=validation_error;Object.defineProperty(t,"ValidationError",{enumerable:!0,get:function(){return p.default}});var y=ref_error;Object.defineProperty(t,"MissingRefError",{enumerable:!0,get:function(){return y.default}})})(ajv,ajvExports);var distExports$1={},dist$1={get exports(){return distExports$1},set exports(e){distExports$1=e}},keywordsExports={},keywords={get exports(){return keywordsExports},set exports(e){keywordsExports=e}},_typeofExports$1={},_typeof$1={get exports(){return _typeofExports$1},set exports(e){_typeofExports$1=e}},_typeofExports={},_typeof={get exports(){return _typeofExports},set exports(e){_typeofExports=e}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const n=codegen,i=["undefined","string","number","object","function","boolean","symbol"];function a(){return{keyword:"typeof",schemaType:["string","array"],code(o){const{data:c,schema:d,schemaValue:u}=o;o.fail(typeof d=="string"?(0,n._)`typeof ${c} != ${d}`:(0,n._)`${u}.indexOf(typeof ${c}) < 0`)},metaSchema:{anyOf:[{type:"string",enum:i},{type:"array",items:{type:"string",enum:i}}]}}}t.default=a,e.exports=a})(_typeof,_typeofExports);(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(_typeofExports),a=o=>o.addKeyword((0,i.default)());t.default=a,e.exports=a})(_typeof$1,_typeofExports$1);var _instanceofExports$1={},_instanceof$1={get exports(){return _instanceofExports$1},set exports(e){_instanceofExports$1=e}},_instanceofExports={},_instanceof={get exports(){return _instanceofExports},set exports(e){_instanceofExports=e}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const n={Object,Array,Function,Number,String,Date,RegExp};typeof Buffer<"u"&&(n.Buffer=Buffer),typeof Promise<"u"&&(n.Promise=Promise);const i=Object.assign(a,{CONSTRUCTORS:n});function a(){return{keyword:"instanceof",schemaType:["string","array"],compile(c){if(typeof c=="string"){const d=o(c);return u=>u instanceof d}if(Array.isArray(c)){const d=c.map(o);return u=>{for(const l of d)if(u instanceof l)return!0;return!1}}throw new Error("ajv implementation error")},metaSchema:{anyOf:[{type:"string"},{type:"array",items:{type:"string"}}]}}}function o(c){const d=n[c];if(d)return d;throw new Error(`invalid "instanceof" keyword value ${c}`)}t.default=i,e.exports=i})(_instanceof,_instanceofExports);(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(_instanceofExports),a=o=>o.addKeyword((0,i.default)());t.default=a,e.exports=a})(_instanceof$1,_instanceofExports$1);var rangeExports$1={},range$1={get exports(){return rangeExports$1},set exports(e){rangeExports$1=e}},rangeExports={},range={get exports(){return rangeExports},set exports(e){rangeExports=e}},_range={};Object.defineProperty(_range,"__esModule",{value:!0});function getRangeDef(e){return()=>({keyword:e,type:"number",schemaType:"array",macro:function([n,i]){return t(n,i),e==="range"?{minimum:n,maximum:i}:{exclusiveMinimum:n,exclusiveMaximum:i}},metaSchema:{type:"array",minItems:2,maxItems:2,items:{type:"number"}}});function t(n,i){if(n>i||e==="exclusiveRange"&&n===i)throw new Error("There are no numbers in range")}}_range.default=getRangeDef;(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const a=(0,n(_range).default)("range");t.default=a,e.exports=a})(range,rangeExports);(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(rangeExports),a=o=>o.addKeyword((0,i.default)());t.default=a,e.exports=a})(range$1,rangeExports$1);var exclusiveRangeExports$1={},exclusiveRange$1={get exports(){return exclusiveRangeExports$1},set exports(e){exclusiveRangeExports$1=e}},exclusiveRangeExports={},exclusiveRange={get exports(){return exclusiveRangeExports},set exports(e){exclusiveRangeExports=e}};(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const a=(0,n(_range).default)("exclusiveRange");t.default=a,e.exports=a})(exclusiveRange,exclusiveRangeExports);(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(exclusiveRangeExports),a=o=>o.addKeyword((0,i.default)());t.default=a,e.exports=a})(exclusiveRange$1,exclusiveRangeExports$1);var regexpExports$1={},regexp$1={get exports(){return regexpExports$1},set exports(e){regexpExports$1=e}},regexpExports={},regexp={get exports(){return regexpExports},set exports(e){regexpExports=e}},_util={};Object.defineProperty(_util,"__esModule",{value:!0});_util.usePattern=_util.metaSchemaRef=void 0;const codegen_1=codegen,META_SCHEMA_ID="http://json-schema.org/schema";function metaSchemaRef({defaultMeta:e}={}){return e===!1?{}:{$ref:e||META_SCHEMA_ID}}_util.metaSchemaRef=metaSchemaRef;function usePattern({gen:e,it:{opts:t}},n,i=t.unicodeRegExp?"u":""){const a=new RegExp(n,i);return e.scopeValue("pattern",{key:a.toString(),ref:a,code:(0,codegen_1._)`new RegExp(${n}, ${i})`})}_util.usePattern=usePattern;(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const n=codegen,i=_util,a={type:"object",properties:{pattern:{type:"string"},flags:{type:"string",nullable:!0}},required:["pattern"],additionalProperties:!1},o=/^\/(.*)\/([gimuy]*)$/;function c(){return{keyword:"regexp",type:"string",schemaType:["string","object"],code(d){const{data:u,schema:l}=d,h=p(l);d.pass((0,n._)`${h}.test(${u})`);function p(y){if(typeof y=="object")return(0,i.usePattern)(d,y.pattern,y.flags);const E=o.exec(y);if(E)return(0,i.usePattern)(d,E[1],E[2]);throw new Error("cannot parse string into RegExp")}},metaSchema:{anyOf:[{type:"string"},a]}}}t.default=c,e.exports=c})(regexp,regexpExports);(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(regexpExports),a=o=>o.addKeyword((0,i.default)());t.default=a,e.exports=a})(regexp$1,regexpExports$1);var transformExports$1={},transform$1={get exports(){return transformExports$1},set exports(e){transformExports$1=e}},transformExports={},transform={get exports(){return transformExports},set exports(e){transformExports=e}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const n=codegen,i={trimStart:u=>u.trimStart(),trimEnd:u=>u.trimEnd(),trimLeft:u=>u.trimStart(),trimRight:u=>u.trimEnd(),trim:u=>u.trim(),toLowerCase:u=>u.toLowerCase(),toUpperCase:u=>u.toUpperCase(),toEnumCase:(u,l)=>(l==null?void 0:l.hash[d(u)])||u},a=Object.assign(o,{transform:i});function o(){return{keyword:"transform",schemaType:"array",before:"enum",code(u){const{gen:l,data:h,schema:p,parentSchema:y,it:E}=u,{parentData:x,parentDataProperty:S}=E,k=p;if(!k.length)return;let T;if(k.includes("toEnumCase")){const q=c(y);T=l.scopeValue("obj",{ref:q,code:(0,n.stringify)(q)})}l.if((0,n._)`typeof ${h} == "string" && ${x} !== undefined`,()=>{l.assign(h,L(k.slice())),l.assign((0,n._)`${x}[${S}]`,h)});function L(q){if(!q.length)return h;const U=q.pop();if(!(U in i))throw new Error(`transform: unknown transformation ${U}`);const ee=l.scopeValue("func",{ref:i[U],code:(0,n._)`require("ajv-keywords/dist/definitions/transform").transform${(0,n.getProperty)(U)}`}),W=L(q);return T&&U==="toEnumCase"?(0,n._)`${ee}(${W}, ${T})`:(0,n._)`${ee}(${W})`}},metaSchema:{type:"array",items:{type:"string",enum:Object.keys(i)}}}}function c(u){const l={hash:{}};if(!u.enum)throw new Error('transform: "toEnumCase" requires "enum"');for(const h of u.enum){if(typeof h!="string")continue;const p=d(h);if(l.hash[p])throw new Error('transform: "toEnumCase" requires all lowercased "enum" values to be unique');l.hash[p]=h}return l}function d(u){return u.toLowerCase()}t.default=a,e.exports=a})(transform,transformExports);(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(transformExports),a=o=>o.addKeyword((0,i.default)());t.default=a,e.exports=a})(transform$1,transformExports$1);var uniqueItemPropertiesExports$1={},uniqueItemProperties$1={get exports(){return uniqueItemPropertiesExports$1},set exports(e){uniqueItemPropertiesExports$1=e}},uniqueItemPropertiesExports={},uniqueItemProperties={get exports(){return uniqueItemPropertiesExports},set exports(e){uniqueItemPropertiesExports=e}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const n=fastDeepEqual,i=["number","integer","string","boolean","null"];function a(){return{keyword:"uniqueItemProperties",type:"array",schemaType:"array",compile(c,d){const u=o(c,d);return l=>{if(l.length<=1)return!0;for(let h=0;h<c.length;h++){const p=c[h];if(u[h]){const y={};for(const E of l){if(!E||typeof E!="object")continue;let x=E[p];if(!(x&&typeof x=="object")){if(typeof x=="string"&&(x='"'+x),y[x])return!1;y[x]=!0}}}else for(let y=l.length;y--;){const E=l[y];if(!(!E||typeof E!="object"))for(let x=y;x--;){const S=l[x];if(S&&typeof S=="object"&&n(E[p],S[p]))return!1}}}return!0}},metaSchema:{type:"array",items:{type:"string"}}}}t.default=a;function o(c,d){return c.map(u=>{var l,h,p;const y=(p=(h=(l=d.items)===null||l===void 0?void 0:l.properties)===null||h===void 0?void 0:h[u])===null||p===void 0?void 0:p.type;return Array.isArray(y)?!y.includes("object")&&!y.includes("array"):i.includes(y)})}e.exports=a})(uniqueItemProperties,uniqueItemPropertiesExports);(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(uniqueItemPropertiesExports),a=o=>o.addKeyword((0,i.default)());t.default=a,e.exports=a})(uniqueItemProperties$1,uniqueItemPropertiesExports$1);var allRequiredExports$1={},allRequired$1={get exports(){return allRequiredExports$1},set exports(e){allRequiredExports$1=e}},allRequiredExports={},allRequired={get exports(){return allRequiredExports},set exports(e){allRequiredExports=e}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});function n(){return{keyword:"allRequired",type:"object",schemaType:"boolean",macro(i,a){if(!i)return!0;const o=Object.keys(a.properties);return o.length===0?!0:{required:o}},dependencies:["properties"]}}t.default=n,e.exports=n})(allRequired,allRequiredExports);(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(allRequiredExports),a=o=>o.addKeyword((0,i.default)());t.default=a,e.exports=a})(allRequired$1,allRequiredExports$1);var anyRequiredExports$1={},anyRequired$1={get exports(){return anyRequiredExports$1},set exports(e){anyRequiredExports$1=e}},anyRequiredExports={},anyRequired={get exports(){return anyRequiredExports},set exports(e){anyRequiredExports=e}},_required={};Object.defineProperty(_required,"__esModule",{value:!0});function getRequiredDef(e){return()=>({keyword:e,type:"object",schemaType:"array",macro(t){return t.length===0?!0:t.length===1?{required:t}:{[e==="anyRequired"?"anyOf":"oneOf"]:t.map(i=>({required:[i]}))}},metaSchema:{type:"array",items:{type:"string"}}})}_required.default=getRequiredDef;(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const a=(0,n(_required).default)("anyRequired");t.default=a,e.exports=a})(anyRequired,anyRequiredExports);(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(anyRequiredExports),a=o=>o.addKeyword((0,i.default)());t.default=a,e.exports=a})(anyRequired$1,anyRequiredExports$1);var oneRequiredExports$1={},oneRequired$1={get exports(){return oneRequiredExports$1},set exports(e){oneRequiredExports$1=e}},oneRequiredExports={},oneRequired={get exports(){return oneRequiredExports},set exports(e){oneRequiredExports=e}};(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const a=(0,n(_required).default)("oneRequired");t.default=a,e.exports=a})(oneRequired,oneRequiredExports);(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(oneRequiredExports),a=o=>o.addKeyword((0,i.default)());t.default=a,e.exports=a})(oneRequired$1,oneRequiredExports$1);var patternRequiredExports$1={},patternRequired$1={get exports(){return patternRequiredExports$1},set exports(e){patternRequiredExports$1=e}},patternRequiredExports={},patternRequired={get exports(){return patternRequiredExports},set exports(e){patternRequiredExports=e}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const n=codegen,i=_util,a={message:({params:{missingPattern:c}})=>(0,n.str)`should have property matching pattern '${c}'`,params:({params:{missingPattern:c}})=>(0,n._)`{missingPattern: ${c}}`};function o(){return{keyword:"patternRequired",type:"object",schemaType:"array",error:a,code(c){const{gen:d,schema:u,data:l}=c;if(u.length===0)return;const h=d.let("valid",!0);for(const y of u)p(y);function p(y){const E=d.let("matched",!1);d.forIn("key",l,x=>{d.assign(E,(0,n._)`${(0,i.usePattern)(c,y)}.test(${x})`),d.if(E,()=>d.break())}),c.setParams({missingPattern:y}),d.assign(h,(0,n.and)(h,E)),c.pass(h)}},metaSchema:{type:"array",items:{type:"string",format:"regex"},uniqueItems:!0}}}t.default=o,e.exports=o})(patternRequired,patternRequiredExports);(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(patternRequiredExports),a=o=>o.addKeyword((0,i.default)());t.default=a,e.exports=a})(patternRequired$1,patternRequiredExports$1);var prohibitedExports$1={},prohibited$1={get exports(){return prohibitedExports$1},set exports(e){prohibitedExports$1=e}},prohibitedExports={},prohibited={get exports(){return prohibitedExports},set exports(e){prohibitedExports=e}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});function n(){return{keyword:"prohibited",type:"object",schemaType:"array",macro:function(i){return i.length===0?!0:i.length===1?{not:{required:i}}:{not:{anyOf:i.map(a=>({required:[a]}))}}},metaSchema:{type:"array",items:{type:"string"}}}}t.default=n,e.exports=n})(prohibited,prohibitedExports);(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(prohibitedExports),a=o=>o.addKeyword((0,i.default)());t.default=a,e.exports=a})(prohibited$1,prohibitedExports$1);var deepPropertiesExports$1={},deepProperties$1={get exports(){return deepPropertiesExports$1},set exports(e){deepPropertiesExports$1=e}},deepPropertiesExports={},deepProperties={get exports(){return deepPropertiesExports},set exports(e){deepPropertiesExports=e}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const n=_util;function i(c){return{keyword:"deepProperties",type:"object",schemaType:"object",macro:function(d){const u=[];for(const l in d)u.push(a(l,d[l]));return{allOf:u}},metaSchema:{type:"object",propertyNames:{type:"string",format:"json-pointer"},additionalProperties:(0,n.metaSchemaRef)(c)}}}t.default=i;function a(c,d){const u=c.split("/"),l={};let h=l;for(let p=1;p<u.length;p++){let y=u[p];const E=p===u.length-1;y=o(y);const x=h.properties={};let S;if(/[0-9]+/.test(y)){let k=+y;for(S=h.items=[],h.type=["object","array"];k--;)S.push({})}else h.type="object";h=E?d:{},x[y]=h,S&&S.push(h)}return l}function o(c){return c.replace(/~1/g,"/").replace(/~0/g,"~")}e.exports=i})(deepProperties,deepPropertiesExports);(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(deepPropertiesExports),a=(o,c)=>o.addKeyword((0,i.default)(c));t.default=a,e.exports=a})(deepProperties$1,deepPropertiesExports$1);var deepRequiredExports$1={},deepRequired$1={get exports(){return deepRequiredExports$1},set exports(e){deepRequiredExports$1=e}},deepRequiredExports={},deepRequired={get exports(){return deepRequiredExports},set exports(e){deepRequiredExports=e}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const n=codegen;function i(){return{keyword:"deepRequired",type:"object",schemaType:"array",code(o){const{schema:c,data:d}=o,u=c.map(h=>(0,n._)`(${l(h)}) === undefined`);o.fail((0,n.or)(...u));function l(h){if(h==="")throw new Error("empty JSON pointer not allowed");const p=h.split("/");let y=d;const E=p.map((x,S)=>S?y=(0,n._)`${y}${(0,n.getProperty)(a(x))}`:y);return(0,n.and)(...E)}},metaSchema:{type:"array",items:{type:"string",format:"json-pointer"}}}}t.default=i;function a(o){return o.replace(/~1/g,"/").replace(/~0/g,"~")}e.exports=i})(deepRequired,deepRequiredExports);(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(deepRequiredExports),a=o=>o.addKeyword((0,i.default)());t.default=a,e.exports=a})(deepRequired$1,deepRequiredExports$1);var dynamicDefaultsExports$1={},dynamicDefaults$1={get exports(){return dynamicDefaultsExports$1},set exports(e){dynamicDefaultsExports$1=e}},dynamicDefaultsExports={},dynamicDefaults={get exports(){return dynamicDefaultsExports},set exports(e){dynamicDefaultsExports=e}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const n={},i={timestamp:()=>()=>Date.now(),datetime:()=>()=>new Date().toISOString(),date:()=>()=>new Date().toISOString().slice(0,10),time:()=>()=>new Date().toISOString().slice(11),random:()=>()=>Math.random(),randomint:h=>{var p;const y=(p=h==null?void 0:h.max)!==null&&p!==void 0?p:2;return()=>Math.floor(Math.random()*y)},seq:h=>{var p;const y=(p=h==null?void 0:h.name)!==null&&p!==void 0?p:"";return n[y]||(n[y]=0),()=>n[y]++}},a=Object.assign(o,{DEFAULTS:i});function o(){return{keyword:"dynamicDefaults",type:"object",schemaType:["string","object"],modifying:!0,valid:!0,compile(h,p,y){if(!y.opts.useDefaults||y.compositeRule)return()=>!0;const E={};for(const S in h)E[S]=c(h[S]);const x=y.opts.useDefaults==="empty";return S=>{for(const k in h)(S[k]===void 0||x&&(S[k]===null||S[k]===""))&&(S[k]=E[k]());return!0}},metaSchema:{type:"object",additionalProperties:{anyOf:[{type:"string"},{type:"object",additionalProperties:!1,required:["func","args"],properties:{func:{type:"string"},args:{type:"object"}}}]}}}}function c(h){return typeof h=="object"?d(h):u(h)}function d({func:h,args:p}){const y=i[h];return l(h,y),y(p)}function u(h=""){const p=i[h];return l(h,p),p()}function l(h,p){if(!p)throw new Error(`invalid "dynamicDefaults" keyword property value: ${h}`)}t.default=a,e.exports=a})(dynamicDefaults,dynamicDefaultsExports);(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(dynamicDefaultsExports),a=o=>o.addKeyword((0,i.default)());t.default=a,e.exports=a})(dynamicDefaults$1,dynamicDefaultsExports$1);var selectExports$1={},select$1={get exports(){return selectExports$1},set exports(e){selectExports$1=e}},selectExports={},select={get exports(){return selectExports},set exports(e){selectExports=e}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const n=codegen,i=_util,a={message:({params:{schemaProp:c}})=>c?(0,n.str)`should match case "${c}" schema`:(0,n.str)`should match default case schema`,params:({params:{schemaProp:c}})=>c?(0,n._)`{failingCase: ${c}}`:(0,n._)`{failingDefault: true}`};function o(c){const d=(0,i.metaSchemaRef)(c);return[{keyword:"select",schemaType:["string","number","boolean","null"],$data:!0,error:a,dependencies:["selectCases"],code(u){const{gen:l,schemaCode:h,parentSchema:p}=u;u.block$data(n.nil,()=>{const y=l.let("valid",!0),E=l.name("_valid"),x=l.const("value",(0,n._)`${h} === null ? "null" : ${h}`);l.if(!1);for(const S in p.selectCases){u.setParams({schemaProp:S}),l.elseIf((0,n._)`"" + ${x} == ${S}`);const k=u.subschema({keyword:"selectCases",schemaProp:S},E);u.mergeEvaluated(k,n.Name),l.assign(y,E)}if(l.else(),p.selectDefault!==void 0){u.setParams({schemaProp:void 0});const S=u.subschema({keyword:"selectDefault"},E);u.mergeEvaluated(S,n.Name),l.assign(y,E)}l.endIf(),u.pass(y)})}},{keyword:"selectCases",dependencies:["select"],metaSchema:{type:"object",additionalProperties:d}},{keyword:"selectDefault",dependencies:["select","selectCases"],metaSchema:d}]}t.default=o,e.exports=o})(select,selectExports);(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(selectExports),a=(o,c)=>((0,i.default)(c).forEach(d=>o.addKeyword(d)),o);t.default=a,e.exports=a})(select$1,selectExports$1);(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(U){return U&&U.__esModule?U:{default:U}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(_typeofExports$1),a=n(_instanceofExports$1),o=n(rangeExports$1),c=n(exclusiveRangeExports$1),d=n(regexpExports$1),u=n(transformExports$1),l=n(uniqueItemPropertiesExports$1),h=n(allRequiredExports$1),p=n(anyRequiredExports$1),y=n(oneRequiredExports$1),E=n(patternRequiredExports$1),x=n(prohibitedExports$1),S=n(deepPropertiesExports$1),k=n(deepRequiredExports$1),T=n(dynamicDefaultsExports$1),L=n(selectExports$1),q={typeof:i.default,instanceof:a.default,range:o.default,exclusiveRange:c.default,regexp:d.default,transform:u.default,uniqueItemProperties:l.default,allRequired:h.default,anyRequired:p.default,oneRequired:y.default,patternRequired:E.default,prohibited:x.default,deepProperties:S.default,deepRequired:k.default,dynamicDefaults:T.default,select:L.default};t.default=q,e.exports=q})(keywords,keywordsExports);(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(keywordsExports),a=(c,d)=>{if(Array.isArray(d)){for(const u of d)o(u)(c);return c}if(d)return o(d)(c),c;for(d in i.default)o(d)(c);return c};a.get=o;function o(c){const d=i.default[c];if(!d)throw new Error("Unknown keyword "+c);return d}t.default=a,e.exports=a,e.exports.default=a})(dist$1,distExports$1);var distExports={},dist={get exports(){return distExports},set exports(e){distExports=e}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const n=ajvExports,i=codegen,a=code$1,o=validate,c=errors,d=names$1,u="errorMessage",l=new n.Name("emUsed"),h={required:"missingProperty",dependencies:"property",dependentRequired:"property"},p=/\$\{[^}]+\}/,y=/\$\{([^}]+)\}/g,E=/^""\s*\+\s*|\s*\+\s*""$/g;function x(k){return{keyword:u,schemaType:["string","object"],post:!0,code(T){const{gen:L,data:q,schema:U,schemaValue:ee,it:W}=T;if(W.createErrors===!1)return;const ie=U,fe=i.strConcat(d.default.instancePath,W.errorPath);L.if(n._`${d.default.errors} > 0`,()=>{if(typeof ie=="object"){const[b,$]=ye(ie);$&&xe($),b&&Oe(b),F(ce(ie))}const m=typeof ie=="string"?ie:ie._;m&&v(m),k.keepErrors||C()});function ce({properties:m,items:b}){const $={};if(m){$.props={};for(const g in m)$.props[g]=[]}if(b){$.items={};for(let g=0;g<b.length;g++)$.items[g]=[]}return $}function ye(m){let b,$;for(const g in m){if(g==="properties"||g==="items")continue;const O=m[g];if(typeof O=="object"){b||(b={});const te=b[g]={};for(const Z in O)te[Z]=[]}else $||($={}),$[g]=[]}return[b,$]}function xe(m){const b=L.const("emErrors",n.stringify(m)),$=L.const("templates",Y(m,U));L.forOf("err",d.default.vErrors,Z=>L.if(I(Z,b),()=>L.code(n._`${b}[${Z}.keyword].push(${Z})`).assign(n._`${Z}.${l}`,!0)));const{singleError:g}=k;if(g){const Z=L.let("message",n._`""`),ae=L.let("paramsErrors",n._`[]`);O(be=>{L.if(Z,()=>L.code(n._`${Z} += ${typeof g=="string"?g:";"}`)),L.code(n._`${Z} += ${te(be)}`),L.assign(ae,n._`${ae}.concat(${b}[${be}])`)}),c.reportError(T,{message:Z,params:n._`{errors: ${ae}}`})}else O(Z=>c.reportError(T,{message:te(Z),params:n._`{errors: ${b}[${Z}]}`}));function O(Z){L.forIn("key",b,ae=>L.if(n._`${b}[${ae}].length`,()=>Z(ae)))}function te(Z){return n._`${Z} in ${$} ? ${$}[${Z}]() : ${ee}[${Z}]`}}function Oe(m){const b=L.const("emErrors",n.stringify(m)),$=[];for(const ae in m)$.push([ae,Y(m[ae],U[ae])]);const g=L.const("templates",L.object(...$)),O=L.scopeValue("obj",{ref:h,code:n.stringify(h)}),te=L.let("emPropParams"),Z=L.let("emParamsErrors");L.forOf("err",d.default.vErrors,ae=>L.if(I(ae,b),()=>{L.assign(te,n._`${O}[${ae}.keyword]`),L.assign(Z,n._`${b}[${ae}.keyword][${ae}.params[${te}]]`),L.if(Z,()=>L.code(n._`${Z}.push(${ae})`).assign(n._`${ae}.${l}`,!0))})),L.forIn("key",b,ae=>L.forIn("keyProp",n._`${b}[${ae}]`,be=>{L.assign(Z,n._`${b}[${ae}][${be}]`),L.if(n._`${Z}.length`,()=>{const ke=L.const("tmpl",n._`${g}[${ae}] && ${g}[${ae}][${be}]`);c.reportError(T,{message:n._`${ke} ? ${ke}() : ${ee}[${ae}][${be}]`,params:n._`{errors: ${Z}}`})})}))}function F(m){const{props:b,items:$}=m;if(!b&&!$)return;const g=n._`typeof ${q} == "object"`,O=n._`Array.isArray(${q})`,te=L.let("emErrors");let Z,ae;const be=L.let("templates");b&&$?(Z=L.let("emChildKwd"),L.if(g),L.if(O,()=>{ke($,U.items),L.assign(Z,n.str`items`)},()=>{ke(b,U.properties),L.assign(Z,n.str`properties`)}),ae=n._`[${Z}]`):$?(L.if(O),ke($,U.items),ae=n._`.items`):b&&(L.if(i.and(g,i.not(O))),ke(b,U.properties),ae=n._`.properties`),L.forOf("err",d.default.vErrors,Ae=>B(Ae,te,dt=>L.code(n._`${te}[${dt}].push(${Ae})`).assign(n._`${Ae}.${l}`,!0))),L.forIn("key",te,Ae=>L.if(n._`${te}[${Ae}].length`,()=>{c.reportError(T,{message:n._`${Ae} in ${be} ? ${be}[${Ae}]() : ${ee}${ae}[${Ae}]`,params:n._`{errors: ${te}[${Ae}]}`}),L.assign(n._`${d.default.vErrors}[${d.default.errors}-1].instancePath`,n._`${fe} + "/" + ${Ae}.replace(/~/g, "~0").replace(/\\//g, "~1")`)})),L.endIf();function ke(Ae,dt){L.assign(te,n.stringify(Ae)),L.assign(be,Y(Ae,dt))}}function v(m){const b=L.const("emErrs",n._`[]`);L.forOf("err",d.default.vErrors,$=>L.if(J($),()=>L.code(n._`${b}.push(${$})`).assign(n._`${$}.${l}`,!0))),L.if(n._`${b}.length`,()=>c.reportError(T,{message:H(m),params:n._`{errors: ${b}}`}))}function C(){const m=L.const("emErrs",n._`[]`);L.forOf("err",d.default.vErrors,b=>L.if(n._`!${b}.${l}`,()=>L.code(n._`${m}.push(${b})`))),L.assign(d.default.vErrors,m).assign(d.default.errors,n._`${m}.length`)}function I(m,b){return i.and(n._`${m}.keyword !== ${u}`,n._`!${m}.${l}`,n._`${m}.instancePath === ${fe}`,n._`${m}.keyword in ${b}`,n._`${m}.schemaPath.indexOf(${W.errSchemaPath}) === 0`,n._`/^\\/[^\\/]*$/.test(${m}.schemaPath.slice(${W.errSchemaPath.length}))`)}function B(m,b,$){L.if(i.and(n._`${m}.keyword !== ${u}`,n._`!${m}.${l}`,n._`${m}.instancePath.indexOf(${fe}) === 0`),()=>{const g=L.scopeValue("pattern",{ref:/^\/([^/]*)(?:\/|$)/,code:n._`new RegExp("^\\\/([^/]*)(?:\\\/|$)")`}),O=L.const("emMatches",n._`${g}.exec(${m}.instancePath.slice(${fe}.length))`),te=L.const("emChild",n._`${O} && ${O}[1].replace(/~1/g, "/").replace(/~0/g, "~")`);L.if(n._`${te} !== undefined && ${te} in ${b}`,()=>$(te))})}function J(m){return i.and(n._`${m}.keyword !== ${u}`,n._`!${m}.${l}`,i.or(n._`${m}.instancePath === ${fe}`,i.and(n._`${m}.instancePath.indexOf(${fe}) === 0`,n._`${m}.instancePath[${fe}.length] === "/"`)),n._`${m}.schemaPath.indexOf(${W.errSchemaPath}) === 0`,n._`${m}.schemaPath[${W.errSchemaPath}.length] === "/"`)}function Y(m,b){const $=[];for(const g in m){const O=b[g];p.test(O)&&$.push([g,_(O)])}return L.object(...$)}function H(m){return p.test(m)?new a._Code(a.safeStringify(m).replace(y,(b,$)=>`" + JSON.stringify(${o.getData($,W)}) + "`).replace(E,"")):n.stringify(m)}function _(m){return n._`function(){return ${H(m)}}`}},metaSchema:{anyOf:[{type:"string"},{type:"object",properties:{properties:{$ref:"#/$defs/stringMap"},items:{$ref:"#/$defs/stringList"},required:{$ref:"#/$defs/stringOrMap"},dependencies:{$ref:"#/$defs/stringOrMap"}},additionalProperties:{type:"string"}}],$defs:{stringMap:{type:"object",additionalProperties:{type:"string"}},stringOrMap:{anyOf:[{type:"string"},{$ref:"#/$defs/stringMap"}]},stringList:{type:"array",items:{type:"string"}}}}}}const S=(k,T={})=>{if(!k.opts.allErrors)throw new Error("ajv-errors: Ajv option allErrors must be true");if(k.opts.jsPropertySyntax)throw new Error("ajv-errors: ajv option jsPropertySyntax is not supported");return k.addKeyword(x(T))};t.default=S,e.exports=S,e.exports.default=S})(dist,distExports);var __importDefault=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(validation$2,"__esModule",{value:!0});validation$2.validateType=validation$2.generateLazyValidator=validation$2.Ajv=void 0;const ajv_1=__importDefault(ajvExports);validation$2.Ajv=ajv_1.default;const ajv_keywords_1=__importDefault(distExports$1),ajv_errors_1=__importDefault(distExports);function generateLazyValidator(e,t){let n=null;const i=(a,o)=>{if(!n){const c=new ajv_1.default({$data:!0,allErrors:!0});(0,ajv_keywords_1.default)(c),(0,ajv_errors_1.default)(c,{singleError:!0}),t==null||t.forEach(d=>c.addKeyword(d)),n=c.compile(e),Object.defineProperty(i,"errors",{get(){return n==null?void 0:n.errors}})}return n(a,o)};return i}validation$2.generateLazyValidator=generateLazyValidator;function validateType(e,t){return e.validate(t)}validation$2.validateType=validateType;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SceneUpdate=e.SCENE_UPDATE=void 0;const t=validation$2;e.SCENE_UPDATE="SCENE_UPDATE",function(n){n.schema={type:"object",properties:{type:{type:"string",enum:[e.SCENE_UPDATE]},payload:{type:"object",properties:{sceneId:{type:"string"},sceneType:{type:"string"}},additionalProperties:!1,required:["sceneId","sceneType"]}},required:["payload","type"]},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.SceneUpdate||(e.SceneUpdate={}))})(sceneUpdate);var update={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Update=e.UPDATE=void 0;const t=validation$2;e.UPDATE="update",function(n){n.schema={type:"object",properties:{type:{type:"string",enum:[e.UPDATE]}},required:["type"]},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.Update||(e.Update={}))})(update);(function(e){var t=commonjsGlobal$1&&commonjsGlobal$1.__createBinding||(Object.create?function(i,a,o,c){c===void 0&&(c=o);var d=Object.getOwnPropertyDescriptor(a,o);(!d||("get"in d?!a.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return a[o]}}),Object.defineProperty(i,c,d)}:function(i,a,o,c){c===void 0&&(c=o),i[c]=a[o]}),n=commonjsGlobal$1&&commonjsGlobal$1.__exportStar||function(i,a){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(a,o)&&t(a,i,o)};Object.defineProperty(e,"__esModule",{value:!0}),n(sceneUpdate,e),n(update,e)})(ws);var project={},type={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ProjectType=void 0;const t=validation$2;(function(n){n.SCENE="scene",n.SMART_ITEM="smart-item",n.PORTABLE_EXPERIENCE="portable-experience",n.LIBRARY="library"})(e.ProjectType||(e.ProjectType={})),function(n){n.schema={type:"string",enum:Object.values(n)},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.ProjectType||(e.ProjectType={}))})(type);var wearableJson={},rarity={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Rarity=void 0;const t=validation$2;(function(n){n.UNIQUE="unique",n.MYTHIC="mythic",n.LEGENDARY="legendary",n.EPIC="epic",n.RARE="rare",n.UNCOMMON="uncommon",n.COMMON="common"})(e.Rarity||(e.Rarity={})),function(n){n.schema={type:"string",enum:Object.values(n)},n.validate=(0,t.generateLazyValidator)(n.schema);const i={[n.UNIQUE]:1,[n.MYTHIC]:10,[n.LEGENDARY]:100,[n.EPIC]:1e3,[n.RARE]:5e3,[n.UNCOMMON]:1e4,[n.COMMON]:1e5},a={[n.UNIQUE]:"#FFE617",[n.MYTHIC]:"#FB7DE3",[n.LEGENDARY]:"#A657ED",[n.EPIC]:"#6397F2",[n.RARE]:"#3AD682",[n.UNCOMMON]:"#FF8563",[n.COMMON]:"#D4E0E0"},o={[n.UNIQUE]:"#FFB626",[n.MYTHIC]:"#FF63E1",[n.LEGENDARY]:"#842DDA",[n.EPIC]:"#3D85E6",[n.RARE]:"#36CF75",[n.UNCOMMON]:"#ED6D4F",[n.COMMON]:"#ABC1C1"};function c(l){return i[l]}n.getMaxSupply=c;function d(l){return o[l]}n.getColor=d;function u(l){return[a[l],o[l]]}n.getGradient=u}(e.Rarity||(e.Rarity={}))})(rarity);var wearableCategory={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.WearableCategory=void 0;const t=validation$2;(function(n){n.EYEBROWS="eyebrows",n.EYES="eyes",n.FACIAL_HAIR="facial_hair",n.HAIR="hair",n.HEAD="head",n.BODY_SHAPE="body_shape",n.MOUTH="mouth",n.UPPER_BODY="upper_body",n.LOWER_BODY="lower_body",n.FEET="feet",n.EARRING="earring",n.EYEWEAR="eyewear",n.HAT="hat",n.HELMET="helmet",n.MASK="mask",n.TIARA="tiara",n.TOP_HEAD="top_head",n.SKIN="skin"})(e.WearableCategory||(e.WearableCategory={})),function(n){n.schema={type:"string",enum:Object.values(n)},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.WearableCategory||(e.WearableCategory={}))})(wearableCategory);var representation={},bodyShape={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.BodyShape=void 0;const t=validation$2;(function(n){n.MALE="urn:decentraland:off-chain:base-avatars:BaseMale",n.FEMALE="urn:decentraland:off-chain:base-avatars:BaseFemale"})(e.BodyShape||(e.BodyShape={})),function(n){n.schema={type:"string",enum:Object.values(n)},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.BodyShape||(e.BodyShape={}))})(bodyShape);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.WearableRepresentation=void 0;const t=wearableCategory,n=validation$2,i=bodyShape;(function(a){a.schema={type:"object",properties:{bodyShapes:{type:"array",items:i.BodyShape.schema,minItems:1,uniqueItems:!0},mainFile:{type:"string",minLength:1},contents:{type:"array",items:{type:"string"},minItems:1,uniqueItems:!0,contains:{const:{$data:"2/mainFile"}}},overrideHides:{type:"array",items:t.WearableCategory.schema},overrideReplaces:{type:"array",items:t.WearableCategory.schema}},required:["bodyShapes","mainFile","contents","overrideHides","overrideReplaces"]},a.validate=(0,n.generateLazyValidator)(a.schema)})(e.WearableRepresentation||(e.WearableRepresentation={}))})(representation);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.WearableJson=void 0;const t=rarity,n=wearableCategory,i=representation,a=validation$2;(function(o){o.schema={type:"object",properties:{description:{type:"string"},rarity:Object.assign(Object.assign({},t.Rarity.schema),{nullable:!0}),name:{type:"string"},data:{type:"object",properties:{replaces:{type:"array",items:n.WearableCategory.schema},hides:{type:"array",items:n.WearableCategory.schema},tags:{type:"array",items:{type:"string",minLength:1}},representations:{type:"array",items:i.WearableRepresentation.schema,minItems:1},category:n.WearableCategory.schema},required:["replaces","hides","tags","representations","category"]}},additionalProperties:!0,required:["description","name","data"]},o.validate=(0,a.generateLazyValidator)(o.schema)})(e.WearableJson||(e.WearableJson={}))})(wearableJson);(function(e){var t=commonjsGlobal$1&&commonjsGlobal$1.__createBinding||(Object.create?function(i,a,o,c){c===void 0&&(c=o);var d=Object.getOwnPropertyDescriptor(a,o);(!d||("get"in d?!a.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return a[o]}}),Object.defineProperty(i,c,d)}:function(i,a,o,c){c===void 0&&(c=o),i[c]=a[o]}),n=commonjsGlobal$1&&commonjsGlobal$1.__exportStar||function(i,a){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(a,o)&&t(a,i,o)};Object.defineProperty(e,"__esModule",{value:!0}),n(type,e),n(wearableJson,e)})(project);(function(e){var t=commonjsGlobal$1&&commonjsGlobal$1.__createBinding||(Object.create?function(i,a,o,c){c===void 0&&(c=o);var d=Object.getOwnPropertyDescriptor(a,o);(!d||("get"in d?!a.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return a[o]}}),Object.defineProperty(i,c,d)}:function(i,a,o,c){c===void 0&&(c=o),i[c]=a[o]}),n=commonjsGlobal$1&&commonjsGlobal$1.__exportStar||function(i,a){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(a,o)&&t(a,i,o)};Object.defineProperty(e,"__esModule",{value:!0}),n(ws,e),n(project,e)})(sdk);var bid={},chainId={},chainName={},hasRequiredChainName;function requireChainName(){return hasRequiredChainName||(hasRequiredChainName=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getChainId=e.ChainName=void 0;const t=validation$2,n=requireChainId();var i;(function(o){o.ETHEREUM_MAINNET="Ethereum Mainnet",o.ETHEREUM_ROPSTEN="Ropsten",o.ETHEREUM_RINKEBY="Rinkeby",o.ETHEREUM_GOERLI="Goerli",o.ETHEREUM_KOVAN="Kovan",o.MATIC_MAINNET="Polygon",o.MATIC_MUMBAI="Mumbai"})(i=e.ChainName||(e.ChainName={}));function a(o){switch(o){case i.ETHEREUM_MAINNET:return n.ChainId.ETHEREUM_MAINNET;case i.ETHEREUM_ROPSTEN:return n.ChainId.ETHEREUM_ROPSTEN;case i.ETHEREUM_RINKEBY:return n.ChainId.ETHEREUM_RINKEBY;case i.ETHEREUM_GOERLI:return n.ChainId.ETHEREUM_GOERLI;case i.ETHEREUM_KOVAN:return n.ChainId.ETHEREUM_KOVAN;case i.MATIC_MAINNET:return n.ChainId.MATIC_MAINNET;case i.MATIC_MUMBAI:return n.ChainId.MATIC_MUMBAI;default:return null}}e.getChainId=a,function(o){o.schema={type:"string",enum:Object.values(o)},o.validate=(0,t.generateLazyValidator)(o.schema)}(i=e.ChainName||(e.ChainName={}))}(chainName)),chainName}var network={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Network=void 0;const t=validation$2;(function(n){n.ETHEREUM="ETHEREUM",n.MATIC="MATIC"})(e.Network||(e.Network={})),function(n){n.schema={type:"string",enum:Object.values(n)},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.Network||(e.Network={}))})(network);var hasRequiredChainId;function requireChainId(){return hasRequiredChainId||(hasRequiredChainId=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getNetwork=e.getNetworkMapping=e.getURNProtocol=e.getChainName=e.ChainId=void 0;const t=validation$2,n=requireChainName(),i=network;var a;(function(l){l[l.ETHEREUM_MAINNET=1]="ETHEREUM_MAINNET",l[l.ETHEREUM_ROPSTEN=3]="ETHEREUM_ROPSTEN",l[l.ETHEREUM_RINKEBY=4]="ETHEREUM_RINKEBY",l[l.ETHEREUM_GOERLI=5]="ETHEREUM_GOERLI",l[l.ETHEREUM_KOVAN=42]="ETHEREUM_KOVAN",l[l.MATIC_MAINNET=137]="MATIC_MAINNET",l[l.MATIC_MUMBAI=80001]="MATIC_MUMBAI"})(a=e.ChainId||(e.ChainId={}));function o(l){switch(l){case a.ETHEREUM_MAINNET:return n.ChainName.ETHEREUM_MAINNET;case a.ETHEREUM_ROPSTEN:return n.ChainName.ETHEREUM_ROPSTEN;case a.ETHEREUM_RINKEBY:return n.ChainName.ETHEREUM_RINKEBY;case a.ETHEREUM_GOERLI:return n.ChainName.ETHEREUM_GOERLI;case a.ETHEREUM_KOVAN:return n.ChainName.ETHEREUM_KOVAN;case a.MATIC_MAINNET:return n.ChainName.MATIC_MAINNET;case a.MATIC_MUMBAI:return n.ChainName.MATIC_MUMBAI;default:return null}}e.getChainName=o;function c(l){switch(l){case a.ETHEREUM_MAINNET:return"mainnet";case a.ETHEREUM_ROPSTEN:return"ropsten";case a.ETHEREUM_RINKEBY:return"rinkeby";case a.ETHEREUM_GOERLI:return"goerli";case a.ETHEREUM_KOVAN:return"kovan";case a.MATIC_MAINNET:return"matic";case a.MATIC_MUMBAI:return"mumbai"}}e.getURNProtocol=c;function d(l){switch(l){case a.ETHEREUM_MAINNET:return{[i.Network.ETHEREUM]:a.ETHEREUM_MAINNET,[i.Network.MATIC]:a.MATIC_MAINNET};case a.ETHEREUM_ROPSTEN:return{[i.Network.ETHEREUM]:a.ETHEREUM_ROPSTEN,[i.Network.MATIC]:a.MATIC_MUMBAI};case a.ETHEREUM_RINKEBY:return{[i.Network.ETHEREUM]:a.ETHEREUM_RINKEBY,[i.Network.MATIC]:a.MATIC_MUMBAI};case a.ETHEREUM_GOERLI:return{[i.Network.ETHEREUM]:a.ETHEREUM_GOERLI,[i.Network.MATIC]:a.MATIC_MUMBAI};case a.ETHEREUM_KOVAN:return{[i.Network.ETHEREUM]:a.ETHEREUM_KOVAN,[i.Network.MATIC]:a.MATIC_MUMBAI};case a.MATIC_MAINNET:return{[i.Network.ETHEREUM]:a.MATIC_MAINNET,[i.Network.MATIC]:a.MATIC_MAINNET};case a.MATIC_MUMBAI:return{[i.Network.ETHEREUM]:a.MATIC_MUMBAI,[i.Network.MATIC]:a.MATIC_MUMBAI}}}e.getNetworkMapping=d;function u(l){switch(l){case a.ETHEREUM_MAINNET:case a.ETHEREUM_ROPSTEN:case a.ETHEREUM_GOERLI:case a.ETHEREUM_KOVAN:case a.ETHEREUM_RINKEBY:return i.Network.ETHEREUM;case a.MATIC_MAINNET:case a.MATIC_MUMBAI:return i.Network.MATIC}}e.getNetwork=u,function(l){l.schema={type:"number",enum:Object.values(l)},l.validate=(0,t.generateLazyValidator)(l.schema)}(a=e.ChainId||(e.ChainId={}))}(chainId)),chainId}var listingStatus={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ListingStatus=void 0;const t=validation$2;(function(n){n.OPEN="open",n.SOLD="sold",n.CANCELLED="cancelled"})(e.ListingStatus||(e.ListingStatus={})),function(n){n.schema={type:"string",enum:Object.values(n)},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.ListingStatus||(e.ListingStatus={}))})(listingStatus);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Bid=e.BidSortBy=void 0;const t=validation$2,n=requireChainId(),i=listingStatus,a=network;(function(o){o.RECENTLY_OFFERED="recently_offered",o.RECENTLY_UPDATED="recently_updated",o.MOST_EXPENSIVE="most_expensive"})(e.BidSortBy||(e.BidSortBy={})),function(o){o.schema={type:"object",properties:{id:{type:"string"},bidAddress:{type:"string"},bidder:{type:"string"},seller:{type:"string"},price:{type:"string"},fingerprint:{type:"string"},status:i.ListingStatus.schema,blockchainId:{type:"string"},blockNumber:{type:"string"},contractAddress:{type:"string"},tokenId:{type:"string"},network:a.Network.schema,chainId:n.ChainId.schema,expiresAt:{type:"integer"},createdAt:{type:"integer"},updatedAt:{type:"integer"}},required:["id","bidAddress","bidder","seller","price","fingerprint","status","blockchainId","blockNumber","contractAddress","tokenId","network","chainId","expiresAt","createdAt","updatedAt"]},o.validate=(0,t.generateLazyValidator)(o.schema)}(e.Bid||(e.Bid={}))})(bid);var account={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Account=e.AccountSortBy=void 0;const t=validation$2;(function(n){n.MOST_SALES="most_sales",n.MOST_PURCHASES="most_purchases",n.MOST_SPENT="most_spent",n.MOST_EARNED="most_earned",n.MOST_ROYALTIES="most_royalties",n.MOST_COLLECTIONS="most_collections"})(e.AccountSortBy||(e.AccountSortBy={})),function(n){n.schema={type:"object",properties:{id:{type:"string"},address:{type:"string"},sales:{type:"integer"},purchases:{type:"integer"},spent:{type:"string"},earned:{type:"string"},royalties:{type:"string"},collections:{type:"number"}},required:["id","address","sales","purchases","spent","earned","royalties","collections"]},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.Account||(e.Account={}))})(account);var collection={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Collection=e.CollectionSortBy=void 0;const t=validation$2,n=requireChainId(),i=network;(function(a){a.NEWEST="newest",a.NAME="name",a.RECENTLY_REVIEWED="recently_reviewed",a.RECENTLY_LISTED="recently_listed",a.SIZE="size"})(e.CollectionSortBy||(e.CollectionSortBy={})),function(a){a.schema={type:"object",properties:{urn:{type:"string"},creator:{type:"string"},name:{type:"string"},contractAddress:{type:"string"},size:{type:"integer"},isOnSale:{type:"boolean"},createdAt:{type:"integer"},updatedAt:{type:"integer"},reviewedAt:{type:"integer"},network:i.Network.schema,chainId:n.ChainId.schema,firstListedAt:{type:"integer",nullable:!0}},required:["urn","creator","name","contractAddress","isOnSale","size","createdAt","updatedAt","reviewedAt","network","chainId"]},a.validate=(0,t.generateLazyValidator)(a.schema)}(e.Collection||(e.Collection={}))})(collection);var contract={},nftCategory={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.NFTCategory=void 0;const t=validation$2;(function(n){n.PARCEL="parcel",n.ESTATE="estate",n.WEARABLE="wearable",n.ENS="ens",n.EMOTE="emote"})(e.NFTCategory||(e.NFTCategory={})),function(n){n.schema={type:"string",enum:Object.values(n)},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.NFTCategory||(e.NFTCategory={}))})(nftCategory);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Contract=e.ContractSortBy=void 0;const t=validation$2,n=requireChainId(),i=network,a=nftCategory;(function(o){o.NAME="name"})(e.ContractSortBy||(e.ContractSortBy={})),function(o){o.schema={type:"object",properties:{name:{type:"string"},address:{type:"string"},category:a.NFTCategory.schema,network:i.Network.schema,chainId:n.ChainId.schema},required:["name","address","category","network","chainId"]},o.validate=(0,t.generateLazyValidator)(o.schema)}(e.Contract||(e.Contract={}))})(contract);var item$1={},nft={},platform={},profile$1={},avatar={},misc={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.IPFSv1=e.IPFSv2=e.EthAddress=e.Color3=void 0;const t=validation$2;(function(n){n.schema={type:"object",required:["r","g","b"],properties:{r:{type:"number",minimum:0,maximum:1},g:{type:"number",minimum:0,maximum:1},b:{type:"number",minimum:0,maximum:1}}};const i=(0,t.generateLazyValidator)(n.schema);n.validate=a=>i(a)})(e.Color3||(e.Color3={})),function(n){n.schema={type:"string",pattern:"^0x[a-fA-F0-9]{40}$"};const i=new RegExp(n.schema.pattern);n.validate=a=>i.test(a)}(e.EthAddress||(e.EthAddress={})),function(n){n.schema={type:"string",pattern:"^(ba)[a-zA-Z0-9]{57}$"};const i=new RegExp(n.schema.pattern);n.validate=a=>i.test(a)}(e.IPFSv2||(e.IPFSv2={})),function(n){n.schema={type:"string",pattern:"^(Qm)[a-zA-Z0-9]{44}$"};const i=new RegExp(n.schema.pattern);n.validate=a=>i.test(a)}(e.IPFSv1||(e.IPFSv1={}))})(misc);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Avatar=e.AvatarInfo=e.Snapshots=void 0;const t=misc,n=validation$2;var i;(function(o){o.schema={type:"object",required:["face256","body"],properties:{face256:t.IPFSv2.schema,body:t.IPFSv2.schema}},o.validate=(0,n.generateLazyValidator)(o.schema)})(i=e.Snapshots||(e.Snapshots={}));var a;(function(o){o.schema={type:"object",required:["bodyShape","eyes","hair","skin"],properties:{bodyShape:{type:"string"},eyes:{type:"object",required:["color"],properties:{color:t.Color3.schema}},hair:{type:"object",required:["color"],properties:{color:t.Color3.schema}},skin:{type:"object",required:["color"],properties:{color:t.Color3.schema}},wearables:{type:"array",items:{type:"string"}},emotes:{type:"array",items:{type:"object",properties:{slot:{type:"number"},urn:{type:"string"}},required:["slot","urn"]},nullable:!0},snapshots:i.schema},additionalProperties:!0},o.validate=(0,n.generateLazyValidator)(o.schema)})(a=e.AvatarInfo||(e.AvatarInfo={})),function(o){o.schema={type:"object",required:["name","description","ethAddress","version","tutorialStep","avatar"],properties:{userId:{type:"string"},name:{type:"string"},description:{type:"string"},ethAddress:t.EthAddress.schema,version:{type:"number"},tutorialStep:{type:"number"},email:{type:"string",nullable:!0},blocked:{type:"array",items:{type:"string"},nullable:!0},muted:{type:"array",items:{type:"string"},nullable:!0},interests:{type:"array",items:{type:"string"},nullable:!0},hasClaimedName:{type:"boolean",nullable:!0},hasConnectedWeb3:{type:"boolean",nullable:!0},avatar:a.schema},additionalProperties:!0},o.validate=(0,n.generateLazyValidator)(o.schema)}(e.Avatar||(e.Avatar={}))})(avatar);var profile={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Profile=void 0;const t=validation$2,n=avatar;(function(i){i.schema={type:"object",required:["avatars"],properties:{avatars:{type:"array",items:n.Avatar.schema}},additionalProperties:!0},i.validate=(0,t.generateLazyValidator)(i.schema)})(e.Profile||(e.Profile={}))})(profile);(function(e){var t=commonjsGlobal$1&&commonjsGlobal$1.__createBinding||(Object.create?function(i,a,o,c){c===void 0&&(c=o);var d=Object.getOwnPropertyDescriptor(a,o);(!d||("get"in d?!a.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return a[o]}}),Object.defineProperty(i,c,d)}:function(i,a,o,c){c===void 0&&(c=o),i[c]=a[o]}),n=commonjsGlobal$1&&commonjsGlobal$1.__exportStar||function(i,a){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(a,o)&&t(a,i,o)};Object.defineProperty(e,"__esModule",{value:!0}),n(avatar,e),n(profile,e)})(profile$1);var scene$1={},featureToggles={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.FeatureToggles=void 0;const t=validation$2;(function(n){n.schema={type:"object",additionalProperties:{type:"string",enum:["disabled","enabled"]},required:[]},n.validate=(0,t.generateLazyValidator)(n.schema)})(e.FeatureToggles||(e.FeatureToggles={}))})(featureToggles);var worldConfiguration={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.WorldConfiguration=void 0;const t=validation$2;(function(n){n.schema={type:"object",properties:{name:{type:"string",nullable:!0},skybox:{type:"number",nullable:!0},minimapVisible:{type:"boolean",nullable:!0},fixedAdapter:{type:"string",nullable:!0}},required:[]},n.validate=(0,t.generateLazyValidator)(n.schema)})(e.WorldConfiguration||(e.WorldConfiguration={}))})(worldConfiguration);var sceneParcels={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SceneParcels=void 0;const t=validation$2;(function(n){n.schema={description:'Describes a scene, a set of parcels whose content is treated as the same entity. A list of parcels is listed, for which one of them is considered the "base" for positioning purposes.',type:"object",properties:{base:{type:"string",pattern:"^-?[0-9]+,-?[0-9]+$"},parcels:{type:"array",items:{type:"string",pattern:"^-?[0-9]+,-?[0-9]+$"},minItems:1}},additionalProperties:!0,required:["base","parcels"]},n.schemaValidator=(0,t.generateLazyValidator)(n.schema),n.validate=i=>n.schemaValidator(i)&&i.parcels.includes(i.base)})(e.SceneParcels||(e.SceneParcels={}))})(sceneParcels);var scene={},displayable={};Object.defineProperty(displayable,"__esModule",{value:!0});displayable.displayableProperties=void 0;displayable.displayableProperties={menuBarIcon:{description:"Name of the file used as icon for the MenuBar",type:"string",nullable:!0}};var source={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Source=void 0;const t=validation$2;(function(n){n.schema={type:"object",properties:{version:{type:"number",nullable:!0},origin:{type:"string"},projectId:{type:"string"},point:{type:"object",properties:{x:{type:"integer"},y:{type:"integer"}},nullable:!0,required:["x","y"]},rotation:{type:"string",enum:["north","east","south","west"],nullable:!0},layout:{type:"object",properties:{rows:{type:"integer"},cols:{type:"integer"}},nullable:!0,required:["rows","cols"]},isEmpty:{type:"boolean",nullable:!0}},additionalProperties:!0,required:["origin","projectId"]},n.validate=(0,t.generateLazyValidator)(n.schema)})(e.Source||(e.Source={}))})(source);var spawnPoint={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpawnPoint=void 0;const t=validation$2;(function(n){n.schema={type:"object",properties:{name:{type:"string",nullable:!0},position:{type:"object",oneOf:[{$ref:"#single-position"},{$ref:"#multi-position"}],required:["x","y","z"]},default:{type:"boolean",nullable:!0},cameraTarget:{type:"object",properties:{x:{type:"number"},y:{type:"number"},z:{type:"number"}},required:["x","y","z"],nullable:!0}},required:["position"],definitions:{"single-position":{$id:"#single-position",type:"object",properties:{x:{type:"number"},y:{type:"number"},z:{type:"number"}},required:["x","y","z"]},"multi-position":{$id:"#multi-position",type:"object",properties:{x:{type:"array",items:{type:"number"},minItems:1},y:{type:"array",items:{type:"number"},minItems:1},z:{type:"array",items:{type:"number"},minItems:1}},required:["x","y","z"]}}},n.validate=(0,t.generateLazyValidator)(n.schema)})(e.SpawnPoint||(e.SpawnPoint={}))})(spawnPoint);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Scene=void 0;const t=validation$2,n=displayable,i=featureToggles,a=sceneParcels,o=source,c=spawnPoint,d=worldConfiguration;(function(u){u.schema={type:"object",properties:Object.assign(Object.assign({main:{description:"File that contains the entry point of the scene's code",type:"string",minLength:1},scene:a.SceneParcels.schema},n.displayableProperties),{display:{description:"Information related to how should this land be displayed apart from the normal rendering of the scene",type:"object",properties:{title:{description:"A name so other users can identify what the contents of this land should be",type:"string",nullable:!0},favicon:{description:"DEPRECATED. Allow the land owner to set up a favicon to this land",type:"string",nullable:!0},description:{description:"A description that will be shown on client's nav map when the scene is selected",type:"string",nullable:!0},navmapThumbnail:{type:"string",nullable:!0}},nullable:!0,required:[]},owner:{type:"string",nullable:!0},contact:{description:"Describe different ways of contacting the land owner",type:"object",properties:{name:{type:"string",nullable:!0},email:{type:"string",nullable:!0},im:{type:"string",nullable:!0},url:{type:"string",nullable:!0}},nullable:!0,required:[]},tags:{type:"array",items:{type:"string",minLength:1},nullable:!0},source:Object.assign(Object.assign({},o.Source.schema),{nullable:!0}),spawnPoints:{type:"array",items:c.SpawnPoint.schema,nullable:!0},requiredPermissions:{type:"array",items:{type:"string"},nullable:!0},featureToggles:Object.assign(Object.assign({},i.FeatureToggles.schema),{nullable:!0}),worldConfiguration:Object.assign(Object.assign({},d.WorldConfiguration.schema),{nullable:!0}),allowedMediaHostnames:{type:"array",items:{type:"string"},nullable:!0}}),additionalProperties:!0,required:["main","scene"]},u.validate=(0,t.generateLazyValidator)(u.schema)})(e.Scene||(e.Scene={}))})(scene);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpawnPoint=e.Source=e.Scene=e.SceneParcels=e.WorldConfiguration=e.FeatureToggles=void 0;var t=featureToggles;Object.defineProperty(e,"FeatureToggles",{enumerable:!0,get:function(){return t.FeatureToggles}});var n=worldConfiguration;Object.defineProperty(e,"WorldConfiguration",{enumerable:!0,get:function(){return n.WorldConfiguration}});var i=sceneParcels;Object.defineProperty(e,"SceneParcels",{enumerable:!0,get:function(){return i.SceneParcels}});var a=scene;Object.defineProperty(e,"Scene",{enumerable:!0,get:function(){return a.Scene}});var o=source;Object.defineProperty(e,"Source",{enumerable:!0,get:function(){return o.Source}});var c=spawnPoint;Object.defineProperty(e,"SpawnPoint",{enumerable:!0,get:function(){return c.SpawnPoint}})})(scene$1);var item={},i18n={},locale={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Locale=void 0;const t=validation$2;(function(n){n.EN="en",n.ES="es"})(e.Locale||(e.Locale={})),function(n){n.schema={type:"string",enum:Object.values(n)},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.Locale||(e.Locale={}))})(locale);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.I18N=void 0;const t=validation$2,n=locale;(function(i){i.schema={type:"object",properties:{code:n.Locale.schema,text:{type:"string"}},additionalProperties:!0,required:["code","text"]},i.validate=(0,t.generateLazyValidator)(i.schema)})(e.I18N||(e.I18N={}))})(i18n);var metrics={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Metrics=void 0;const t=validation$2;(function(n){n.schema={type:"object",properties:{triangles:{type:"number"},materials:{type:"number"},textures:{type:"number"},meshes:{type:"number"},bodies:{type:"number"},entities:{type:"number"}},required:["triangles","materials","textures","meshes","bodies","entities"]},n.validate=(0,t.generateLazyValidator)(n.schema)})(e.Metrics||(e.Metrics={}))})(metrics);var standardProps={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.isStandard=e.standardProperties=void 0;const t=rarity,n=validation$2;e.standardProperties={collectionAddress:{type:"string",nullable:!1},rarity:t.Rarity.schema};const i={type:"object",properties:Object.assign({},e.standardProperties),required:["collectionAddress","rarity"]},a=(0,n.generateLazyValidator)(i);function o(c){return a(c)}e.isStandard=o})(standardProps);var thirdPartyProps={},merkleProof={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MerkleProof=void 0;const t=validation$2;(function(n){n.schema={type:"object",properties:{proof:{type:"array",items:{type:"string"}},index:{type:"number"},hashingKeys:{type:"array",items:{type:"string"}},entityHash:{type:"string"}},required:["entityHash","hashingKeys","index","proof"],additionalProperties:!0},n.validate=(0,t.generateLazyValidator)(n.schema)})(e.MerkleProof||(e.MerkleProof={}))})(merkleProof);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.isThirdParty=e.thirdPartyProps=void 0;const t=validation$2,n=merkleProof;e.thirdPartyProps={merkleProof:n.MerkleProof.schema,content:{type:"object",nullable:!1,additionalProperties:{type:"string"},required:[]}};const i={type:"object",properties:Object.assign({},e.thirdPartyProps),required:["merkleProof","content"],_containsHashingKeys:!0},a={keyword:"_containsHashingKeys",validate:(d,u)=>{var l;const h=u;return!((l=h==null?void 0:h.merkleProof)===null||l===void 0)&&l.hashingKeys?h.merkleProof.hashingKeys.every(p=>h.hasOwnProperty(p)):!1},errors:!1},o=(0,t.generateLazyValidator)(i,[a]);function c(d){return o(d)}e.isThirdParty=c})(thirdPartyProps);var wearable$1={},wearable={},baseItem={};Object.defineProperty(baseItem,"__esModule",{value:!0});baseItem.isBaseAvatar=baseItem.requiredBaseItemProps=baseItem.baseItemProperties=void 0;const i18n_1=i18n,metrics_1=metrics,displayable_1=displayable;baseItem.baseItemProperties=Object.assign(Object.assign({},displayable_1.displayableProperties),{id:{type:"string"},name:{type:"string"},description:{type:"string"},i18n:{type:"array",items:i18n_1.I18N.schema,minItems:1,uniqueItemProperties:["code"],errorMessage:'${0#} array should not have duplicates for "code"'},thumbnail:{type:"string"},image:{type:"string"},metrics:Object.assign(Object.assign({},metrics_1.Metrics.schema),{nullable:!0})});baseItem.requiredBaseItemProps=["id","name","description","i18n","thumbnail","image"];function isBaseAvatar(e){if(!e||!e.id)return!1;const t=e.id.split(":"),n=t[1]==="decentraland",i=t[3]==="base-avatars";return t.length===5&&n&&i}baseItem.isBaseAvatar=isBaseAvatar;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Wearable=void 0;const t=validation$2,n=wearableCategory,i=representation,a=baseItem,o=standardProps,c=thirdPartyProps;(function(d){d.schema={type:"object",properties:Object.assign(Object.assign(Object.assign(Object.assign({},a.baseItemProperties),o.standardProperties),c.thirdPartyProps),{data:{type:"object",properties:{replaces:{type:"array",items:n.WearableCategory.schema},hides:{type:"array",items:n.WearableCategory.schema},tags:{type:"array",items:{type:"string",minLength:1}},representations:{type:"array",items:i.WearableRepresentation.schema,minItems:1},category:n.WearableCategory.schema},required:["replaces","hides","tags","representations","category"]}}),additionalProperties:!0,required:[],oneOf:[{required:["id","i18n"],prohibited:["merkleProof","content","collectionAddress","rarity"],_isBaseAvatar:!0},{required:[...a.requiredBaseItemProps,"data","collectionAddress","rarity"],prohibited:["merkleProof","content"]},{required:[...a.requiredBaseItemProps,"data","merkleProof","content"],prohibited:["collectionAddress","rarity"],_isThirdParty:!0}],errorMessage:{oneOf:"either standard XOR thirdparty properties conditions must be met"}};const u={keyword:"_isThirdParty",validate:(h,p)=>!h||(0,c.isThirdParty)(p),errors:!1},l={keyword:"_isBaseAvatar",validate:(h,p)=>!h||(0,a.isBaseAvatar)(p),errors:!1};d.validate=(0,t.generateLazyValidator)(d.schema,[u,l])})(e.Wearable||(e.Wearable={}))})(wearable);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Wearable=e.WearableRepresentation=void 0;var t=representation;Object.defineProperty(e,"WearableRepresentation",{enumerable:!0,get:function(){return t.WearableRepresentation}});var n=wearable;Object.defineProperty(e,"Wearable",{enumerable:!0,get:function(){return n.Wearable}})})(wearable$1);var emote$1={},emote={},emoteDataAdr74={},emoteCategory={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EmoteCategory=void 0;const t=validation$2;(function(n){n.DANCE="dance",n.STUNT="stunt",n.GREETINGS="greetings",n.FUN="fun",n.POSES="poses",n.REACTIONS="reactions",n.HORROR="horror",n.MISCELLANEOUS="miscellaneous"})(e.EmoteCategory||(e.EmoteCategory={})),function(n){n.schema={type:"string",enum:Object.values(n)},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.EmoteCategory||(e.EmoteCategory={}))})(emoteCategory);var representationAdr74={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EmoteRepresentationADR74=void 0;const t=validation$2,n=bodyShape;(function(i){i.schema={type:"object",properties:{bodyShapes:{type:"array",items:n.BodyShape.schema,minItems:1,uniqueItems:!0},mainFile:{type:"string",minLength:1},contents:{type:"array",items:{type:"string"},minItems:1,uniqueItems:!0,contains:{const:{$data:"2/mainFile"}},errorMessage:{contains:"contents should contain mainFile: ${1/mainFile}"}}},required:["bodyShapes","mainFile","contents"]},i.validate=(0,t.generateLazyValidator)(i.schema)})(e.EmoteRepresentationADR74||(e.EmoteRepresentationADR74={}))})(representationAdr74);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EmoteDataADR74=void 0;const t=emoteCategory,n=validation$2,i=representationAdr74;(function(a){a.schema={type:"object",properties:{tags:{type:"array",items:{type:"string",minLength:1}},representations:{type:"array",items:i.EmoteRepresentationADR74.schema,minItems:1},category:t.EmoteCategory.schema,loop:{type:"boolean"}},required:["category","tags","representations","loop"],additionalProperties:!0},a.validate=(0,n.generateLazyValidator)(a.schema)})(e.EmoteDataADR74||(e.EmoteDataADR74={}))})(emoteDataAdr74);var hasRequiredEmote$1;function requireEmote$1(){return hasRequiredEmote$1||(hasRequiredEmote$1=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Emote=void 0;const t=requireItem(),n=validation$2,i=baseItem,a=standardProps,o=thirdPartyProps,c=emoteDataAdr74;(function(d){d.schema={type:"object",properties:Object.assign(Object.assign(Object.assign(Object.assign({},i.baseItemProperties),a.standardProperties),o.thirdPartyProps),{emoteDataADR74:c.EmoteDataADR74.schema}),additionalProperties:!0,required:[...i.requiredBaseItemProps],oneOf:[{required:["emoteDataADR74"],oneOf:[{required:["collectionAddress","rarity"],prohibited:["merkleProof","content"],errorMessage:"standard properties conditions are not met"},{required:["merkleProof","content","id","name","description","i18n","image","thumbnail","emoteDataADR74"],_isThirdParty:!0,prohibited:["collectionAddress","rarity"],errorMessage:"thirdparty properties conditions are not met"}],errorMessage:{oneOf:"emote should have either standard or thirdparty properties"}}],errorMessage:{oneOf:'emote should have "emoteDataADR74" and match its schema'}};const u={keyword:"_isThirdParty",validate:(l,h)=>!l||(0,t.isThirdParty)(h),errors:!1};d.validate=(0,n.generateLazyValidator)(d.schema,[u])})(e.Emote||(e.Emote={}))}(emote)),emote}var emotePlayMode={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EmotePlayMode=void 0;const t=validation$2;(function(n){n.SIMPLE="simple",n.LOOP="loop"})(e.EmotePlayMode||(e.EmotePlayMode={})),function(n){n.schema={type:"string",enum:Object.values(n)},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.EmotePlayMode||(e.EmotePlayMode={}))})(emotePlayMode);var hasRequiredEmote;function requireEmote(){return hasRequiredEmote||(hasRequiredEmote=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EmotePlayMode=e.EmoteCategory=e.EmoteDataADR74=e.EmoteRepresentationADR74=e.Emote=void 0;var t=requireEmote$1();Object.defineProperty(e,"Emote",{enumerable:!0,get:function(){return t.Emote}});var n=representationAdr74;Object.defineProperty(e,"EmoteRepresentationADR74",{enumerable:!0,get:function(){return n.EmoteRepresentationADR74}});var i=emoteDataAdr74;Object.defineProperty(e,"EmoteDataADR74",{enumerable:!0,get:function(){return i.EmoteDataADR74}});var a=emoteCategory;Object.defineProperty(e,"EmoteCategory",{enumerable:!0,get:function(){return a.EmoteCategory}});var o=emotePlayMode;Object.defineProperty(e,"EmotePlayMode",{enumerable:!0,get:function(){return o.EmotePlayMode}})}(emote$1)),emote$1}var hasRequiredItem;function requireItem(){return hasRequiredItem||(hasRequiredItem=1,function(e){var t=commonjsGlobal$1&&commonjsGlobal$1.__createBinding||(Object.create?function(l,h,p,y){y===void 0&&(y=p);var E=Object.getOwnPropertyDescriptor(h,p);(!E||("get"in E?!h.__esModule:E.writable||E.configurable))&&(E={enumerable:!0,get:function(){return h[p]}}),Object.defineProperty(l,y,E)}:function(l,h,p,y){y===void 0&&(y=p),l[y]=h[p]}),n=commonjsGlobal$1&&commonjsGlobal$1.__exportStar||function(l,h){for(var p in l)p!=="default"&&!Object.prototype.hasOwnProperty.call(h,p)&&t(h,l,p)};Object.defineProperty(e,"__esModule",{value:!0}),e.isThirdParty=e.isStandard=e.BodyShape=e.Metrics=e.Locale=e.I18N=void 0;var i=i18n;Object.defineProperty(e,"I18N",{enumerable:!0,get:function(){return i.I18N}});var a=locale;Object.defineProperty(e,"Locale",{enumerable:!0,get:function(){return a.Locale}});var o=metrics;Object.defineProperty(e,"Metrics",{enumerable:!0,get:function(){return o.Metrics}});var c=bodyShape;Object.defineProperty(e,"BodyShape",{enumerable:!0,get:function(){return c.BodyShape}});var d=standardProps;Object.defineProperty(e,"isStandard",{enumerable:!0,get:function(){return d.isStandard}});var u=thirdPartyProps;Object.defineProperty(e,"isThirdParty",{enumerable:!0,get:function(){return u.isThirdParty}}),n(wearable$1,e),n(requireEmote(),e)}(item)),item}var merkleTree={};(function(e){var t=commonjsGlobal$1&&commonjsGlobal$1.__createBinding||(Object.create?function(i,a,o,c){c===void 0&&(c=o);var d=Object.getOwnPropertyDescriptor(a,o);(!d||("get"in d?!a.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return a[o]}}),Object.defineProperty(i,c,d)}:function(i,a,o,c){c===void 0&&(c=o),i[c]=a[o]}),n=commonjsGlobal$1&&commonjsGlobal$1.__exportStar||function(i,a){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(a,o)&&t(a,i,o)};Object.defineProperty(e,"__esModule",{value:!0}),n(merkleProof,e)})(merkleTree);var syncDeployments={},authChain={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AuthChain=e.AuthLink=e.AuthLinkType=void 0;const t=validation$2;var n;(function(a){a.SIGNER="SIGNER",a.ECDSA_PERSONAL_EPHEMERAL="ECDSA_EPHEMERAL",a.ECDSA_PERSONAL_SIGNED_ENTITY="ECDSA_SIGNED_ENTITY",a.ECDSA_EIP_1654_EPHEMERAL="ECDSA_EIP_1654_EPHEMERAL",a.ECDSA_EIP_1654_SIGNED_ENTITY="ECDSA_EIP_1654_SIGNED_ENTITY"})(n=e.AuthLinkType||(e.AuthLinkType={}));var i;(function(a){a.schema={type:"object",properties:{type:{type:"string",enum:Object.values(n)},payload:{type:"string"},signature:{type:"string",nullable:!0}},required:["payload","type"],if:{properties:{type:{not:{const:n.SIGNER}}}},then:{required:["signature"]},else:{oneOf:[{properties:{signature:{type:"string",const:""}},required:["signature"]},{properties:{signature:{type:"null"}}}]}},a.validate=(0,t.generateLazyValidator)(a.schema)})(i=e.AuthLink||(e.AuthLink={})),function(a){a.schema={type:"array",items:i.schema,minItems:1},a.validate=(0,t.generateLazyValidator)(a.schema)}(e.AuthChain||(e.AuthChain={}))})(authChain);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PointerChangesSyncDeployment=e.SnapshotSyncDeployment=void 0;const t=misc,n=authChain,i=validation$2;(function(a){a.schema={type:"object",properties:{entityId:{type:"string"},entityType:{type:"string"},pointers:{type:"array",items:{type:"string"},minItems:1},entityTimestamp:{type:"number",minimum:0},authChain:n.AuthChain.schema},oneOf:[{properties:{entityId:t.IPFSv1.schema}},{properties:{entityId:t.IPFSv2.schema}}],required:["entityId","entityType","pointers","entityTimestamp","authChain"]},a.validate=(0,i.generateLazyValidator)(a.schema)})(e.SnapshotSyncDeployment||(e.SnapshotSyncDeployment={})),function(a){a.schema={type:"object",properties:{entityId:{type:"string"},entityType:{type:"string"},pointers:{type:"array",items:{type:"string"},minItems:1},localTimestamp:{type:"number",minimum:0},authChain:n.AuthChain.schema},oneOf:[{properties:{entityId:t.IPFSv1.schema}},{properties:{entityId:t.IPFSv2.schema}}],required:["entityId","entityType","pointers","localTimestamp","authChain"]},a.validate=(0,i.generateLazyValidator)(a.schema)}(e.PointerChangesSyncDeployment||(e.PointerChangesSyncDeployment={}))})(syncDeployments);var entity={},contentMapping={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ContentMapping=void 0;const t=misc,n=validation$2;(function(i){i.schema={type:"object",properties:{file:{type:"string",minLength:1},hash:{type:"string",oneOf:[t.IPFSv1.schema,t.IPFSv2.schema]}},required:["file","hash"]},i.validate=(0,n.generateLazyValidator)(i.schema)})(e.ContentMapping||(e.ContentMapping={}))})(contentMapping);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Entity=e.EntityType=void 0;const t=misc,n=contentMapping,i=validation$2;(function(a){a.SCENE="scene",a.PROFILE="profile",a.WEARABLE="wearable",a.STORE="store",a.EMOTE="emote"})(e.EntityType||(e.EntityType={})),function(a){a.schema={type:"object",properties:{version:{type:"string",enum:["v3"]},id:{type:"string",oneOf:[t.IPFSv1.schema,t.IPFSv2.schema]},type:{type:"string"},pointers:{type:"array",items:{type:"string",minLength:1}},timestamp:{type:"number",minimum:0},content:{type:"array",items:n.ContentMapping.schema},metadata:{type:"object",nullable:!0}},required:["version","id","type","pointers","timestamp","content"]},a.validate=(0,i.generateLazyValidator)(a.schema)}(e.Entity||(e.Entity={}))})(entity);var deploymentWithAuthChain={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DeploymentWithAuthChain=void 0;const t=authChain,n=validation$2;(function(i){i.schema={type:"object",properties:{entityId:{type:"string"},entityType:{type:"string"},pointers:{type:"array",items:{type:"string"},minItems:1},localTimestamp:{type:"number",minimum:0},authChain:t.AuthChain.schema},required:["entityId","entityType","pointers","localTimestamp","authChain"]},i.validate=(0,n.generateLazyValidator)(i.schema)})(e.DeploymentWithAuthChain||(e.DeploymentWithAuthChain={}))})(deploymentWithAuthChain);(function(e){var t=commonjsGlobal$1&&commonjsGlobal$1.__createBinding||(Object.create?function(i,a,o,c){c===void 0&&(c=o);var d=Object.getOwnPropertyDescriptor(a,o);(!d||("get"in d?!a.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return a[o]}}),Object.defineProperty(i,c,d)}:function(i,a,o,c){c===void 0&&(c=o),i[c]=a[o]}),n=commonjsGlobal$1&&commonjsGlobal$1.__exportStar||function(i,a){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(a,o)&&t(a,i,o)};Object.defineProperty(e,"__esModule",{value:!0}),n(profile$1,e),n(scene$1,e),n(requireItem(),e),n(displayable,e),n(merkleTree,e),n(syncDeployments,e),n(entity,e),n(deploymentWithAuthChain,e)})(platform);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.NFT=e.NFTSortBy=void 0;const t=validation$2,n=requireChainId(),i=platform,a=network,o=nftCategory,c=rarity,d=wearableCategory;(function(u){u.NAME="name",u.NEWEST="newest",u.RECENTLY_LISTED="recently_listed",u.RECENTLY_SOLD="recently_sold",u.CHEAPEST="cheapest",u.RENTAL_LISTING_DATE="rental_listing_date",u.RENTAL_DATE="rented_date",u.MAX_RENTAL_PRICE="max_rental_price",u.MIN_RENTAL_PRICE="min_rental_price"})(e.NFTSortBy||(e.NFTSortBy={})),function(u){u.schema={type:"object",properties:{id:{type:"string"},tokenId:{type:"string"},contractAddress:{type:"string"},activeOrderId:{type:"string",nullable:!0},openRentalId:{type:"string",nullable:!0},owner:{type:"string"},name:{type:"string"},image:{type:"string"},url:{type:"string"},data:{type:"object",nullable:!1,properties:{parcel:{type:"object",properties:{description:{type:["string"],nullable:!0},x:{type:"string"},y:{type:"string"},estate:{type:"object",properties:{tokenId:{type:"string"},name:{type:"string"}},required:["tokenId","name"],nullable:!0}},required:["description","x","y","estate"],nullable:!0},estate:{type:"object",properties:{description:{type:["string"],nullable:!0},size:{type:"integer"},parcels:{type:"array",items:{type:"object",properties:{x:{type:"number"},y:{type:"number"}},required:["x","y"]}}},required:["description","size","parcels"],nullable:!0},wearable:{type:"object",properties:{bodyShapes:{type:"array",items:i.BodyShape.schema},category:d.WearableCategory.schema,description:{type:"string"},rarity:c.Rarity.schema,isSmart:{type:"boolean"}},required:["bodyShapes","category","description","rarity","isSmart"],nullable:!0},ens:{type:"object",properties:{subdomain:{type:"string"}},required:["subdomain"],nullable:!0},emote:{type:"object",properties:{bodyShapes:{type:"array",items:i.BodyShape.schema},category:i.EmoteCategory.schema,description:{type:"string"},rarity:c.Rarity.schema,loop:{type:"boolean"}},required:["bodyShapes","category","description","rarity","loop"],nullable:!0}},required:[]},issuedId:{type:"string",nullable:!0},itemId:{type:"string",nullable:!0},category:o.NFTCategory.schema,network:a.Network.schema,chainId:n.ChainId.schema,createdAt:{type:"integer"},updatedAt:{type:"integer"},soldAt:{type:"integer"}},required:["id","tokenId","contractAddress","activeOrderId","openRentalId","owner","name","image","url","data","issuedId","itemId","category","network","chainId","createdAt","updatedAt","soldAt"]},u.validate=(0,t.generateLazyValidator)(u.schema)}(e.NFT||(e.NFT={}))})(nft);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Item=e.ItemSortBy=void 0;const t=validation$2,n=requireChainId(),i=network,a=nft,o=nftCategory;(function(c){c.NAME="name",c.NEWEST="newest",c.RECENTLY_REVIEWED="recently_reviewed",c.RECENTLY_SOLD="recently_sold",c.RECENTLY_LISTED="recently_listed",c.CHEAPEST="cheapest"})(e.ItemSortBy||(e.ItemSortBy={})),function(c){c.schema={type:"object",properties:{id:{type:"string"},name:{type:"string"},thumbnail:{type:"string"},url:{type:"string"},category:o.NFTCategory.schema,contractAddress:{type:"string"},itemId:{type:"string"},rarity:{type:"string"},price:{type:"string"},available:{type:"integer"},isOnSale:{type:"boolean"},creator:{type:"string"},beneficiary:{type:"string",nullable:!0},data:a.NFT.schema.properties.data,network:i.Network.schema,chainId:n.ChainId.schema,createdAt:{type:"integer"},updatedAt:{type:"integer"},reviewedAt:{type:"integer"},soldAt:{type:"integer"},firstListedAt:{type:"integer",nullable:!0},picks:{type:"object",properties:{pickedByUser:{type:"boolean",nullable:!0},count:{type:"integer"}},required:["count"],nullable:!0}},required:["id","name","thumbnail","url","category","contractAddress","itemId","rarity","price","available","isOnSale","creator","data","network","chainId","createdAt","updatedAt","soldAt"]},c.validate=(0,t.generateLazyValidator)(c.schema)}(e.Item||(e.Item={}))})(item$1);var metaTransactions={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MetaTransaction=void 0;const t=validation$2;(function(n){n.schema={type:"object",properties:{from:{type:"string"},params:{type:"array",items:[{type:"string"},{type:"string"}],additionalItems:!1,minItems:2}},additionalProperties:!1,required:["from","params"]},n.validate=(0,t.generateLazyValidator)(n.schema)})(e.MetaTransaction||(e.MetaTransaction={}))})(metaTransactions);var mint={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Mint=e.MintSortBy=void 0;const t=validation$2,n=requireChainId(),i=network;(function(a){a.RECENTLY_MINTED="recently_minted",a.MOST_EXPENSIVE="most_expensive"})(e.MintSortBy||(e.MintSortBy={})),function(a){a.schema={type:"object",properties:{id:{type:"string"},creator:{type:"string"},beneficiary:{type:"string"},minter:{type:"string"},price:{type:"string",nullable:!0},contractAddress:{type:"string"},tokenId:{type:"string"},itemId:{type:"string"},issuedId:{type:"string"},timestamp:{type:"integer"},network:i.Network.schema,chainId:n.ChainId.schema},required:["id","creator","beneficiary","minter","itemId","tokenId","issuedId","contractAddress","price","timestamp","network","chainId"]},a.validate=(0,t.generateLazyValidator)(a.schema)}(e.Mint||(e.Mint={}))})(mint);var order={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Order=e.OrderSortBy=void 0;const t=validation$2,n=requireChainId(),i=listingStatus,a=network;(function(o){o.RECENTLY_LISTED="recently_listed",o.RECENTLY_UPDATED="recently_updated",o.CHEAPEST="cheapest",o.ISSUED_ID_ASC="issued_id_asc",o.ISSUED_ID_DESC="issued_id_desc",o.OLDEST="oldest"})(e.OrderSortBy||(e.OrderSortBy={})),function(o){o.schema={type:"object",properties:{id:{type:"string"},marketplaceAddress:{type:"string"},contractAddress:{type:"string"},tokenId:{type:"string"},owner:{type:"string"},buyer:{type:["string"],nullable:!0},price:{type:"string"},status:i.ListingStatus.schema,network:a.Network.schema,chainId:n.ChainId.schema,expiresAt:{type:"integer"},createdAt:{type:"integer"},updatedAt:{type:"integer"},issuedId:{type:"string"}},required:["id","marketplaceAddress","contractAddress","tokenId","owner","buyer","price","status","network","chainId","expiresAt","createdAt","updatedAt"]},o.validate=(0,t.generateLazyValidator)(o.schema)}(e.Order||(e.Order={}))})(order);var providerType={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ProviderType=void 0;const t=validation$2;(function(n){n.INJECTED="injected",n.FORTMATIC="formatic",n.NETWORK="network",n.WALLET_CONNECT="wallet_connect",n.WALLET_CONNECT_V2="wallet_connect_v2",n.WALLET_LINK="wallet_link",n.METAMASK_MOBILE="metamask_mobile"})(e.ProviderType||(e.ProviderType={})),function(n){n.schema={type:"string",enum:Object.values(n)},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.ProviderType||(e.ProviderType={}))})(providerType);var saleType={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SaleType=void 0;const t=validation$2;(function(n){n.ORDER="order",n.BID="bid",n.MINT="mint"})(e.SaleType||(e.SaleType={})),function(n){n.schema={type:"string",enum:Object.values(n)},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.SaleType||(e.SaleType={}))})(saleType);var sale={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Sale=e.SaleSortBy=void 0;const t=validation$2,n=requireChainId(),i=saleType,a=network;(function(o){o.RECENTLY_SOLD="recently_sold",o.MOST_EXPENSIVE="most_expensive"})(e.SaleSortBy||(e.SaleSortBy={})),function(o){o.schema={type:"object",properties:{id:{type:"string"},type:i.SaleType.schema,buyer:{type:"string"},seller:{type:"string"},price:{type:"string"},contractAddress:{type:"string"},tokenId:{type:"string"},itemId:{type:"string"},txHash:{type:"string"},timestamp:{type:"integer"},network:a.Network.schema,chainId:n.ChainId.schema},required:["id","buyer","seller","itemId","tokenId","price","contractAddress","timestamp","txHash","network","chainId"]},o.validate=(0,t.generateLazyValidator)(o.schema)}(e.Sale||(e.Sale={}))})(sale);var rentalsListings={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RentalListingCreation=e.PeriodCreation=e.RentalsListingsSortBy=e.RentalsListingsFilterByCategory=e.RentalsListingSortDirection=e.RentalStatus=void 0;const t=validation$2,n=requireChainId(),i=network;(function(o){o.OPEN="open",o.CANCELLED="cancelled",o.EXECUTED="executed",o.CLAIMED="claimed"})(e.RentalStatus||(e.RentalStatus={})),function(o){o.ASC="asc",o.DESC="desc"}(e.RentalsListingSortDirection||(e.RentalsListingSortDirection={})),function(o){o.PARCEL="parcel",o.ESTATE="estate"}(e.RentalsListingsFilterByCategory||(e.RentalsListingsFilterByCategory={})),function(o){o.LAND_CREATION_DATE="land_creation_date",o.RENTAL_LISTING_DATE="rental_listing_date",o.RENTAL_DATE="rented_date",o.NAME="name",o.MAX_RENTAL_PRICE="max_rental_price",o.MIN_RENTAL_PRICE="min_rental_price"}(e.RentalsListingsSortBy||(e.RentalsListingsSortBy={}));var a;(function(o){o.schema={type:"object",properties:{minDays:{type:"integer",minimum:0,maximum:2147483647},maxDays:{type:"integer",minimum:0,maximum:2147483647},pricePerDay:{type:"string",pattern:"^[0-9]+$"}},additionalProperties:!1,required:["minDays","maxDays","pricePerDay"]},o.validate=(0,t.generateLazyValidator)(o.schema)})(a=e.PeriodCreation||(e.PeriodCreation={})),function(o){o.schema={type:"object",properties:{network:i.Network.schema,chainId:n.ChainId.schema,expiration:{type:"number",minimum:0},signature:{type:"string",minLength:1},tokenId:{type:"string",minLength:1},nonces:{type:"array",minItems:3,maxItems:3,items:{minLength:1,type:"string",pattern:"^[0-9]+$"}},contractAddress:{type:"string",pattern:"^0x[a-fA-F0-9]{40}$"},rentalContractAddress:{type:"string",pattern:"^0x[a-fA-F0-9]{40}$"},periods:{type:"array",minItems:1,maxItems:100,uniqueItems:!0,items:a.schema},target:{type:"string",pattern:"^0x[a-fA-F0-9]{40}$"}},additionalProperties:!1,required:["network","chainId","expiration","signature","nonces","tokenId","contractAddress","rentalContractAddress","periods","target"]},o.validate=(0,t.generateLazyValidator)(o.schema)}(e.RentalListingCreation||(e.RentalListingCreation={}))})(rentalsListings);var analyticsDayData={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AnalyticsDayDataSortBy=void 0,function(t){t.DATE="date",t.MOST_SALES="most_sales"}(e.AnalyticsDayDataSortBy||(e.AnalyticsDayDataSortBy={}))})(analyticsDayData);var store={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Store=void 0;const t=validation$2;(function(n){n.schema={type:"object",properties:{id:{type:"string"},version:{type:"number"},owner:{type:"string"},description:{type:"string"},links:{type:"array",items:{type:"object",properties:{name:{type:"string"},url:{type:"string"}},required:["name","url"]}},images:{type:"array",items:{type:"object",properties:{name:{type:"string"},file:{type:"string"}},required:["name","file"]}}},required:["id","version","owner","description","links","images"]},n.validate=(0,t.generateLazyValidator)(n.schema)})(e.Store||(e.Store={}))})(store);var wearableGender={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GenderFilterOption=e.WearableGender=void 0;const t=validation$2;(function(n){n.MALE="male",n.FEMALE="female"})(e.WearableGender||(e.WearableGender={})),function(n){n.MALE="male",n.FEMALE="female",n.UNISEX="unisex"}(e.GenderFilterOption||(e.GenderFilterOption={})),function(n){n.schema={type:"string",enum:Object.values(n)},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.WearableGender||(e.WearableGender={}))})(wearableGender);var world={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.World=e.isInsideWorldLimits=e.getWorld=void 0;const t=validation$2;function n(){return{validWorldRanges:[{xMin:-150,yMin:-150,xMax:150,yMax:150},{xMin:62,yMin:151,xMax:162,yMax:158},{xMin:151,yMin:144,xMax:162,yMax:150},{xMin:151,yMin:59,xMax:163,yMax:143}]}}e.getWorld=n;function i(a,o){const c=n().validWorldRanges;for(const d of c)if(a>=d.xMin&&a<=d.xMax&&o>=d.yMin&&o<=d.yMax)return!0;return!1}e.isInsideWorldLimits=i,function(a){a.schema={type:"object",required:["validWorldRanges"],properties:{validWorldRanges:{type:"array",default:[{xMin:-150,yMin:-150,xMax:150,yMax:150}],items:{type:"object",required:["xMin","yMin","xMax","yMax"],properties:{xMin:{type:"integer"},yMin:{type:"integer"},xMax:{type:"integer"},yMax:{type:"integer"}}}}},additionalProperties:!1},a.validate=(0,t.generateLazyValidator)(a.schema)}(e.World||(e.World={}))})(world);var preview={},previewCamera={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PreviewCamera=void 0;const t=validation$2;(function(n){n.STATIC="static",n.INTERACTIVE="interactive"})(e.PreviewCamera||(e.PreviewCamera={})),function(n){n.schema={type:"string",enum:Object.values(n)},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.PreviewCamera||(e.PreviewCamera={}))})(previewCamera);var previewConfig={};Object.defineProperty(previewConfig,"__esModule",{value:!0});var previewController={};Object.defineProperty(previewController,"__esModule",{value:!0});var previewEmoteEventType={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PreviewEmoteEventType=void 0;const t=validation$2;(function(n){n.ANIMATION_PLAY="animation_play",n.ANIMATION_PAUSE="animation_pause",n.ANIMATION_LOOP="animation_loop",n.ANIMATION_END="animation_end",n.ANIMATION_PLAYING="animation_playing"})(e.PreviewEmoteEventType||(e.PreviewEmoteEventType={})),function(n){n.schema={type:"string",enum:Object.values(n)},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.PreviewEmoteEventType||(e.PreviewEmoteEventType={}))})(previewEmoteEventType);var previewEmote={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PreviewEmote=void 0;const t=validation$2;(function(n){n.IDLE="idle",n.CLAP="clap",n.DAB="dab",n.DANCE="dance",n.FASHION="fashion",n.FASHION_2="fashion-2",n.FASHION_3="fashion-3",n.FASHION_4="fashion-4",n.LOVE="love",n.MONEY="money",n.FIST_PUMP="fist-pump",n.HEAD_EXPLODE="head-explode"})(e.PreviewEmote||(e.PreviewEmote={})),function(n){n.schema={type:"string",enum:Object.values(n)},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.PreviewEmote||(e.PreviewEmote={}))})(previewEmote);var previewMessage={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.sendMessage=e.PreviewMessageType=void 0;const t=validation$2;(function(i){i.READY="ready",i.LOAD="load",i.ERROR="error",i.UPDATE="update",i.CONTROLLER_REQUEST="controller_request",i.CONTROLLER_RESPONSE="controller_response",i.EMOTE_EVENT="emote_event"})(e.PreviewMessageType||(e.PreviewMessageType={})),function(i){i.schema={type:"string",enum:Object.values(i)},i.validate=(0,t.generateLazyValidator)(i.schema)}(e.PreviewMessageType||(e.PreviewMessageType={}));const n=(i,a,o,c="*")=>{const d={type:a,payload:o};i.postMessage(d,c)};e.sendMessage=n})(previewMessage);var previewOptions={};Object.defineProperty(previewOptions,"__esModule",{value:!0});var previewProjection={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PreviewProjection=void 0;const t=validation$2;(function(n){n.ORTHOGRAPHIC="orthographic",n.PERSPECTIVE="perspective"})(e.PreviewProjection||(e.PreviewProjection={})),function(n){n.schema={type:"string",enum:Object.values(n)},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.PreviewProjection||(e.PreviewProjection={}))})(previewProjection);var previewType={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PreviewType=void 0;const t=validation$2;(function(n){n.TEXTURE="texture",n.WEARABLE="wearable",n.AVATAR="avatar"})(e.PreviewType||(e.PreviewType={})),function(n){n.schema={type:"string",enum:Object.values(n)},n.validate=(0,t.generateLazyValidator)(n.schema)}(e.PreviewType||(e.PreviewType={}))})(previewType);var wearableRepresentationDefinition={};Object.defineProperty(wearableRepresentationDefinition,"__esModule",{value:!0});var wearableRepresentationWithBlobs={};Object.defineProperty(wearableRepresentationWithBlobs,"__esModule",{value:!0});var wearableDefinition={};Object.defineProperty(wearableDefinition,"__esModule",{value:!0});var wearableWithBlobs={};Object.defineProperty(wearableWithBlobs,"__esModule",{value:!0});var emoteRepresentationDefinition={};Object.defineProperty(emoteRepresentationDefinition,"__esModule",{value:!0});var emoteRepresentationWithBlobs={};Object.defineProperty(emoteRepresentationWithBlobs,"__esModule",{value:!0});var emoteDefinition={};Object.defineProperty(emoteDefinition,"__esModule",{value:!0});var emoteWithBlobs={};Object.defineProperty(emoteWithBlobs,"__esModule",{value:!0});(function(e){var t=commonjsGlobal$1&&commonjsGlobal$1.__createBinding||(Object.create?function(i,a,o,c){c===void 0&&(c=o);var d=Object.getOwnPropertyDescriptor(a,o);(!d||("get"in d?!a.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return a[o]}}),Object.defineProperty(i,c,d)}:function(i,a,o,c){c===void 0&&(c=o),i[c]=a[o]}),n=commonjsGlobal$1&&commonjsGlobal$1.__exportStar||function(i,a){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(a,o)&&t(a,i,o)};Object.defineProperty(e,"__esModule",{value:!0}),n(previewCamera,e),n(previewConfig,e),n(previewController,e),n(previewEmoteEventType,e),n(previewEmote,e),n(previewMessage,e),n(previewOptions,e),n(previewProjection,e),n(previewType,e),n(wearableRepresentationDefinition,e),n(wearableRepresentationWithBlobs,e),n(wearableDefinition,e),n(wearableWithBlobs,e),n(emoteRepresentationDefinition,e),n(emoteRepresentationWithBlobs,e),n(emoteDefinition,e),n(emoteWithBlobs,e)})(preview);(function(e){var t=commonjsGlobal$1&&commonjsGlobal$1.__createBinding||(Object.create?function(v,C,I,B){B===void 0&&(B=I);var J=Object.getOwnPropertyDescriptor(C,I);(!J||("get"in J?!C.__esModule:J.writable||J.configurable))&&(J={enumerable:!0,get:function(){return C[I]}}),Object.defineProperty(v,B,J)}:function(v,C,I,B){B===void 0&&(B=I),v[B]=C[I]}),n=commonjsGlobal$1&&commonjsGlobal$1.__setModuleDefault||(Object.create?function(v,C){Object.defineProperty(v,"default",{enumerable:!0,value:C})}:function(v,C){v.default=C}),i=commonjsGlobal$1&&commonjsGlobal$1.__importStar||function(v){if(v&&v.__esModule)return v;var C={};if(v!=null)for(var I in v)I!=="default"&&Object.prototype.hasOwnProperty.call(v,I)&&t(C,v,I);return n(C,v),C},a=commonjsGlobal$1&&commonjsGlobal$1.__exportStar||function(v,C){for(var I in v)I!=="default"&&!Object.prototype.hasOwnProperty.call(C,I)&&t(C,v,I)};Object.defineProperty(e,"__esModule",{value:!0}),e.sdk=e.isInsideWorldLimits=e.getWorld=e.World=e.GenderFilterOption=e.WearableGender=e.WearableCategory=e.Store=e.AnalyticsDayDataSortBy=e.PeriodCreation=e.RentalListingCreation=e.RentalsListingsSortBy=e.RentalsListingsFilterByCategory=e.RentalsListingSortDirection=e.RentalStatus=e.SaleSortBy=e.Sale=e.SaleType=e.Rarity=e.ProviderType=e.OrderSortBy=e.Order=e.NFTSortBy=e.NFT=e.NFTCategory=e.Network=e.MintSortBy=e.Mint=e.MetaTransaction=e.ListingStatus=e.ItemSortBy=e.Item=e.ContractSortBy=e.Contract=e.CollectionSortBy=e.Collection=e.getChainId=e.ChainName=e.getURNProtocol=e.getChainName=e.ChainId=e.AccountSortBy=e.Account=e.BidSortBy=e.Bid=void 0;const o=i(sdk);e.sdk=o,a(validation$2,e);var c=bid;Object.defineProperty(e,"Bid",{enumerable:!0,get:function(){return c.Bid}}),Object.defineProperty(e,"BidSortBy",{enumerable:!0,get:function(){return c.BidSortBy}});var d=account;Object.defineProperty(e,"Account",{enumerable:!0,get:function(){return d.Account}}),Object.defineProperty(e,"AccountSortBy",{enumerable:!0,get:function(){return d.AccountSortBy}});var u=requireChainId();Object.defineProperty(e,"ChainId",{enumerable:!0,get:function(){return u.ChainId}}),Object.defineProperty(e,"getChainName",{enumerable:!0,get:function(){return u.getChainName}}),Object.defineProperty(e,"getURNProtocol",{enumerable:!0,get:function(){return u.getURNProtocol}});var l=requireChainName();Object.defineProperty(e,"ChainName",{enumerable:!0,get:function(){return l.ChainName}}),Object.defineProperty(e,"getChainId",{enumerable:!0,get:function(){return l.getChainId}});var h=collection;Object.defineProperty(e,"Collection",{enumerable:!0,get:function(){return h.Collection}}),Object.defineProperty(e,"CollectionSortBy",{enumerable:!0,get:function(){return h.CollectionSortBy}});var p=contract;Object.defineProperty(e,"Contract",{enumerable:!0,get:function(){return p.Contract}}),Object.defineProperty(e,"ContractSortBy",{enumerable:!0,get:function(){return p.ContractSortBy}});var y=item$1;Object.defineProperty(e,"Item",{enumerable:!0,get:function(){return y.Item}}),Object.defineProperty(e,"ItemSortBy",{enumerable:!0,get:function(){return y.ItemSortBy}});var E=listingStatus;Object.defineProperty(e,"ListingStatus",{enumerable:!0,get:function(){return E.ListingStatus}});var x=metaTransactions;Object.defineProperty(e,"MetaTransaction",{enumerable:!0,get:function(){return x.MetaTransaction}});var S=mint;Object.defineProperty(e,"Mint",{enumerable:!0,get:function(){return S.Mint}}),Object.defineProperty(e,"MintSortBy",{enumerable:!0,get:function(){return S.MintSortBy}});var k=network;Object.defineProperty(e,"Network",{enumerable:!0,get:function(){return k.Network}});var T=nftCategory;Object.defineProperty(e,"NFTCategory",{enumerable:!0,get:function(){return T.NFTCategory}});var L=nft;Object.defineProperty(e,"NFT",{enumerable:!0,get:function(){return L.NFT}}),Object.defineProperty(e,"NFTSortBy",{enumerable:!0,get:function(){return L.NFTSortBy}});var q=order;Object.defineProperty(e,"Order",{enumerable:!0,get:function(){return q.Order}}),Object.defineProperty(e,"OrderSortBy",{enumerable:!0,get:function(){return q.OrderSortBy}});var U=providerType;Object.defineProperty(e,"ProviderType",{enumerable:!0,get:function(){return U.ProviderType}});var ee=rarity;Object.defineProperty(e,"Rarity",{enumerable:!0,get:function(){return ee.Rarity}});var W=saleType;Object.defineProperty(e,"SaleType",{enumerable:!0,get:function(){return W.SaleType}});var ie=sale;Object.defineProperty(e,"Sale",{enumerable:!0,get:function(){return ie.Sale}}),Object.defineProperty(e,"SaleSortBy",{enumerable:!0,get:function(){return ie.SaleSortBy}});var fe=rentalsListings;Object.defineProperty(e,"RentalStatus",{enumerable:!0,get:function(){return fe.RentalStatus}}),Object.defineProperty(e,"RentalsListingSortDirection",{enumerable:!0,get:function(){return fe.RentalsListingSortDirection}}),Object.defineProperty(e,"RentalsListingsFilterByCategory",{enumerable:!0,get:function(){return fe.RentalsListingsFilterByCategory}}),Object.defineProperty(e,"RentalsListingsSortBy",{enumerable:!0,get:function(){return fe.RentalsListingsSortBy}}),Object.defineProperty(e,"RentalListingCreation",{enumerable:!0,get:function(){return fe.RentalListingCreation}}),Object.defineProperty(e,"PeriodCreation",{enumerable:!0,get:function(){return fe.PeriodCreation}});var ce=analyticsDayData;Object.defineProperty(e,"AnalyticsDayDataSortBy",{enumerable:!0,get:function(){return ce.AnalyticsDayDataSortBy}});var ye=store;Object.defineProperty(e,"Store",{enumerable:!0,get:function(){return ye.Store}});var xe=wearableCategory;Object.defineProperty(e,"WearableCategory",{enumerable:!0,get:function(){return xe.WearableCategory}});var Oe=wearableGender;Object.defineProperty(e,"WearableGender",{enumerable:!0,get:function(){return Oe.WearableGender}}),Object.defineProperty(e,"GenderFilterOption",{enumerable:!0,get:function(){return Oe.GenderFilterOption}});var F=world;Object.defineProperty(e,"World",{enumerable:!0,get:function(){return F.World}}),Object.defineProperty(e,"getWorld",{enumerable:!0,get:function(){return F.getWorld}}),Object.defineProperty(e,"isInsideWorldLimits",{enumerable:!0,get:function(){return F.isInsideWorldLimits}}),a(preview,e),a(platform,e),a(misc,e),a(authChain,e),a(contentMapping,e)})(dist$2);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AuthLink=e.AuthLinkType=e.AuthChain=void 0;const t=dist$2;Object.defineProperty(e,"AuthChain",{enumerable:!0,get:function(){return t.AuthChain}}),Object.defineProperty(e,"AuthLinkType",{enumerable:!0,get:function(){return t.AuthLinkType}}),Object.defineProperty(e,"AuthLink",{enumerable:!0,get:function(){return t.AuthLink}})})(types$1);var utils$c={};Object.defineProperty(utils$c,"__esModule",{value:!0});utils$c.moveMinutes=void 0;function moveMinutes(e){const t=new Date;return t.setMinutes(t.getMinutes()+e),t}utils$c.moveMinutes=moveMinutes;var blocks={};Object.defineProperty(blocks,"__esModule",{value:!0});const eth_connect_1$1=ethConnectExports;class Blocks{constructor(t,n=!0){this.requestManager=t,this.checkedBlocks={},this.saveBlocks=n,n&&(this.savedBlocks={}),this.requests=0}async fillBlockTime(){const t=await this.getBlockWrapper("latest"),n=await this.getBlockWrapper(1);this.blockTime=(t.timestamp-n.timestamp)/Number(t.number)-1,this.firstTimestamp=n.timestamp}async getDate(t,n=!0){const i=t/1e3,a=Date.now()/1e3;if((typeof this.firstTimestamp>"u"||typeof this.blockTime>"u")&&await this.fillBlockTime(),i<this.firstTimestamp)return{block:1,timestamp:i};if(i>=a||i>this.savedBlocks.latest.timestamp)return{block:(0,eth_connect_1$1.toBigNumber)(await this.requestManager.eth_blockNumber()).toNumber(),timestamp:i};this.checkedBlocks[i]=[];const o=await this.getBlockWrapper(Math.ceil((i-this.firstTimestamp/this.blockTime)/1e3));return{block:await this.findBetter(i,o,n),timestamp:i}}async findBetter(t,n,i,a=this.blockTime){if(await this.isBetterBlock(t,n,i))return n.number;const o=t-n.timestamp;let c=Math.ceil(o/a);c===0&&(c=o<0?-1:1);const d=await this.getBlockWrapper(this.getNextBlock(t,n.number,c));return a=Math.abs((n.timestamp-d.timestamp)/(n.number-d.number)),this.findBetter(t,d,i,a)}async isBetterBlock(t,n,i){const a=n.timestamp;if(i){if(a<t)return!1;const o=await this.getBlockWrapper(n.number-1);if(a>=t&&o.timestamp<t)return!0}else{if(a>=t)return!1;const o=await this.getBlockWrapper(n.number+1);if(a<t&&o.timestamp>=t)return!0}return!1}getNextBlock(t,n,i){const a=n+i;return this.checkedBlocks[t].includes(a)?this.getNextBlock(t,n,i<0?++i:--i):(this.checkedBlocks[t].push(a),a)}async getBlockWrapper(t){if(!this.saveBlocks){const i=await this.requestManager.eth_getBlockByNumber(t,!1);return{number:(0,eth_connect_1$1.toBigNumber)(i.number).toNumber(),timestamp:(0,eth_connect_1$1.toBigNumber)(i.timestamp).toNumber()}}if(this.savedBlocks[t.toString()])return this.savedBlocks[t];if(typeof t=="number"&&this.savedBlocks.latest&&this.savedBlocks.latest.number<=t)return this.savedBlocks.latest;const{timestamp:n}=await this.requestManager.eth_getBlockByNumber(t,!1);return this.savedBlocks[t.toString()]={number:(0,eth_connect_1$1.toBigNumber)(t==="latest"?await this.requestManager.eth_blockNumber():t).toNumber(),timestamp:(0,eth_connect_1$1.toBigNumber)(n).toNumber()},this.requests++,this.savedBlocks[t.toString()]}}blocks.default=Blocks;var crypto$2={},secp256k1={},hmac$1={},_assert={};Object.defineProperty(_assert,"__esModule",{value:!0});_assert.output=_assert.exists=_assert.hash=_assert.bytes=_assert.bool=_assert.number=void 0;function number(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}_assert.number=number;function bool(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}_assert.bool=bool;function bytes(e,...t){if(!(e instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new TypeError(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}_assert.bytes=bytes;function hash$1(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number(e.outputLen),number(e.blockLen)}_assert.hash=hash$1;function exists(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}_assert.exists=exists;function output$1(e,t){bytes(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}_assert.output=output$1;const assert$c={number,bool,bytes,hash:hash$1,exists,output:output$1};_assert.default=assert$c;var utils$b={},cryptoBrowser={};Object.defineProperty(cryptoBrowser,"__esModule",{value:!0});cryptoBrowser.crypto=void 0;cryptoBrowser.crypto={node:void 0,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};(function(e){/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(e,"__esModule",{value:!0}),e.randomBytes=e.wrapConstructorWithOpts=e.wrapConstructor=e.checkOpts=e.Hash=e.concatBytes=e.toBytes=e.utf8ToBytes=e.asyncLoop=e.nextTick=e.hexToBytes=e.bytesToHex=e.isLE=e.rotr=e.createView=e.u32=e.u8=void 0;const t=cryptoBrowser,n=U=>new Uint8Array(U.buffer,U.byteOffset,U.byteLength);e.u8=n;const i=U=>new Uint32Array(U.buffer,U.byteOffset,Math.floor(U.byteLength/4));e.u32=i;const a=U=>new DataView(U.buffer,U.byteOffset,U.byteLength);e.createView=a;const o=(U,ee)=>U<<32-ee|U>>>ee;if(e.rotr=o,e.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,!e.isLE)throw new Error("Non little-endian hardware is not supported");const c=Array.from({length:256},(U,ee)=>ee.toString(16).padStart(2,"0"));function d(U){if(!(U instanceof Uint8Array))throw new Error("Uint8Array expected");let ee="";for(let W=0;W<U.length;W++)ee+=c[U[W]];return ee}e.bytesToHex=d;function u(U){if(typeof U!="string")throw new TypeError("hexToBytes: expected string, got "+typeof U);if(U.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const ee=new Uint8Array(U.length/2);for(let W=0;W<ee.length;W++){const ie=W*2,fe=U.slice(ie,ie+2),ce=Number.parseInt(fe,16);if(Number.isNaN(ce)||ce<0)throw new Error("Invalid byte sequence");ee[W]=ce}return ee}e.hexToBytes=u;const l=async()=>{};e.nextTick=l;async function h(U,ee,W){let ie=Date.now();for(let fe=0;fe<U;fe++){W(fe);const ce=Date.now()-ie;ce>=0&&ce<ee||(await(0,e.nextTick)(),ie+=ce)}}e.asyncLoop=h;function p(U){if(typeof U!="string")throw new TypeError(`utf8ToBytes expected string, got ${typeof U}`);return new TextEncoder().encode(U)}e.utf8ToBytes=p;function y(U){if(typeof U=="string"&&(U=p(U)),!(U instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof U})`);return U}e.toBytes=y;function E(...U){if(!U.every(ie=>ie instanceof Uint8Array))throw new Error("Uint8Array list expected");if(U.length===1)return U[0];const ee=U.reduce((ie,fe)=>ie+fe.length,0),W=new Uint8Array(ee);for(let ie=0,fe=0;ie<U.length;ie++){const ce=U[ie];W.set(ce,fe),fe+=ce.length}return W}e.concatBytes=E;class x{clone(){return this._cloneInto()}}e.Hash=x;const S=U=>Object.prototype.toString.call(U)==="[object Object]"&&U.constructor===Object;function k(U,ee){if(ee!==void 0&&(typeof ee!="object"||!S(ee)))throw new TypeError("Options should be object or undefined");return Object.assign(U,ee)}e.checkOpts=k;function T(U){const ee=ie=>U().update(y(ie)).digest(),W=U();return ee.outputLen=W.outputLen,ee.blockLen=W.blockLen,ee.create=()=>U(),ee}e.wrapConstructor=T;function L(U){const ee=(ie,fe)=>U(fe).update(y(ie)).digest(),W=U({});return ee.outputLen=W.outputLen,ee.blockLen=W.blockLen,ee.create=ie=>U(ie),ee}e.wrapConstructorWithOpts=L;function q(U=32){if(t.crypto.web)return t.crypto.web.getRandomValues(new Uint8Array(U));if(t.crypto.node)return new Uint8Array(t.crypto.node.randomBytes(U).buffer);throw new Error("The environment doesn't have randomBytes function")}e.randomBytes=q})(utils$b);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.hmac=void 0;const t=_assert,n=utils$b;class i extends n.Hash{constructor(c,d){super(),this.finished=!1,this.destroyed=!1,t.default.hash(c);const u=(0,n.toBytes)(d);if(this.iHash=c.create(),typeof this.iHash.update!="function")throw new TypeError("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const l=this.blockLen,h=new Uint8Array(l);h.set(u.length>l?c.create().update(u).digest():u);for(let p=0;p<h.length;p++)h[p]^=54;this.iHash.update(h),this.oHash=c.create();for(let p=0;p<h.length;p++)h[p]^=106;this.oHash.update(h),h.fill(0)}update(c){return t.default.exists(this),this.iHash.update(c),this}digestInto(c){t.default.exists(this),t.default.bytes(c,this.outputLen),this.finished=!0,this.iHash.digestInto(c),this.oHash.update(c),this.oHash.digestInto(c),this.destroy()}digest(){const c=new Uint8Array(this.oHash.outputLen);return this.digestInto(c),c}_cloneInto(c){c||(c=Object.create(Object.getPrototypeOf(this),{}));const{oHash:d,iHash:u,finished:l,destroyed:h,blockLen:p,outputLen:y}=this;return c=c,c.finished=l,c.destroyed=h,c.blockLen=p,c.outputLen=y,c.oHash=d._cloneInto(c.oHash),c.iHash=u._cloneInto(c.iHash),c}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const a=(o,c,d)=>new i(o,c).update(d).digest();e.hmac=a,e.hmac.create=(o,c)=>new i(o,c)})(hmac$1);var sha256$1={},_sha2={};Object.defineProperty(_sha2,"__esModule",{value:!0});_sha2.SHA2=void 0;const _assert_js_1=_assert,utils_js_1$1=utils$b;function setBigUint64(e,t,n,i){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,i);const a=BigInt(32),o=BigInt(4294967295),c=Number(n>>a&o),d=Number(n&o),u=i?4:0,l=i?0:4;e.setUint32(t+u,c,i),e.setUint32(t+l,d,i)}class SHA2 extends utils_js_1$1.Hash{constructor(t,n,i,a){super(),this.blockLen=t,this.outputLen=n,this.padOffset=i,this.isLE=a,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=(0,utils_js_1$1.createView)(this.buffer)}update(t){_assert_js_1.default.exists(this);const{view:n,buffer:i,blockLen:a}=this;t=(0,utils_js_1$1.toBytes)(t);const o=t.length;for(let c=0;c<o;){const d=Math.min(a-this.pos,o-c);if(d===a){const u=(0,utils_js_1$1.createView)(t);for(;a<=o-c;c+=a)this.process(u,c);continue}i.set(t.subarray(c,c+d),this.pos),this.pos+=d,c+=d,this.pos===a&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){_assert_js_1.default.exists(this),_assert_js_1.default.output(t,this),this.finished=!0;const{buffer:n,view:i,blockLen:a,isLE:o}=this;let{pos:c}=this;n[c++]=128,this.buffer.subarray(c).fill(0),this.padOffset>a-c&&(this.process(i,0),c=0);for(let p=c;p<a;p++)n[p]=0;setBigUint64(i,a-8,BigInt(this.length*8),o),this.process(i,0);const d=(0,utils_js_1$1.createView)(t),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=u/4,h=this.get();if(l>h.length)throw new Error("_sha2: outputLen bigger than state");for(let p=0;p<l;p++)d.setUint32(4*p,h[p],o)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const i=t.slice(0,n);return this.destroy(),i}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:i,length:a,finished:o,destroyed:c,pos:d}=this;return t.length=a,t.pos=d,t.finished=o,t.destroyed=c,a%n&&t.buffer.set(i),t}}_sha2.SHA2=SHA2;Object.defineProperty(sha256$1,"__esModule",{value:!0});sha256$1.sha224=sha256$1.sha256=void 0;const _sha2_js_1=_sha2,utils_js_1=utils$b,Chi=(e,t,n)=>e&t^~e&n,Maj=(e,t,n)=>e&t^e&n^t&n,SHA256_K=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W=new Uint32Array(64);let SHA256$2=class extends _sha2_js_1.SHA2{constructor(){super(64,32,8,!1),this.A=IV[0]|0,this.B=IV[1]|0,this.C=IV[2]|0,this.D=IV[3]|0,this.E=IV[4]|0,this.F=IV[5]|0,this.G=IV[6]|0,this.H=IV[7]|0}get(){const{A:t,B:n,C:i,D:a,E:o,F:c,G:d,H:u}=this;return[t,n,i,a,o,c,d,u]}set(t,n,i,a,o,c,d,u){this.A=t|0,this.B=n|0,this.C=i|0,this.D=a|0,this.E=o|0,this.F=c|0,this.G=d|0,this.H=u|0}process(t,n){for(let p=0;p<16;p++,n+=4)SHA256_W[p]=t.getUint32(n,!1);for(let p=16;p<64;p++){const y=SHA256_W[p-15],E=SHA256_W[p-2],x=(0,utils_js_1.rotr)(y,7)^(0,utils_js_1.rotr)(y,18)^y>>>3,S=(0,utils_js_1.rotr)(E,17)^(0,utils_js_1.rotr)(E,19)^E>>>10;SHA256_W[p]=S+SHA256_W[p-7]+x+SHA256_W[p-16]|0}let{A:i,B:a,C:o,D:c,E:d,F:u,G:l,H:h}=this;for(let p=0;p<64;p++){const y=(0,utils_js_1.rotr)(d,6)^(0,utils_js_1.rotr)(d,11)^(0,utils_js_1.rotr)(d,25),E=h+y+Chi(d,u,l)+SHA256_K[p]+SHA256_W[p]|0,S=((0,utils_js_1.rotr)(i,2)^(0,utils_js_1.rotr)(i,13)^(0,utils_js_1.rotr)(i,22))+Maj(i,a,o)|0;h=l,l=u,u=d,d=c+E|0,c=o,o=a,a=i,i=E+S|0}i=i+this.A|0,a=a+this.B|0,o=o+this.C|0,c=c+this.D|0,d=d+this.E|0,u=u+this.F|0,l=l+this.G|0,h=h+this.H|0,this.set(i,a,o,c,d,u,l,h)}roundClean(){SHA256_W.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},SHA224$1=class extends SHA256$2{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}};sha256$1.sha256=(0,utils_js_1.wrapConstructor)(()=>new SHA256$2);sha256$1.sha224=(0,utils_js_1.wrapConstructor)(()=>new SHA224$1);var lib={};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(__viteBrowserExternal$1);(function(e){/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */Object.defineProperty(e,"__esModule",{value:!0}),e.utils=e.schnorr=e.verify=e.signSync=e.sign=e.getSharedSecret=e.recoverPublicKey=e.getPublicKey=e.Signature=e.Point=e.CURVE=void 0;const t=require$$0,n=BigInt(0),i=BigInt(1),a=BigInt(2),o=BigInt(3),c=BigInt(8),d=Object.freeze({a:n,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:i,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")});e.CURVE=d;const u=(G,M)=>(G+M/a)/M,l={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(G){const{n:M}=d,X=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),oe=-i*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),ve=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),Ce=X,Me=BigInt("0x100000000000000000000000000000000"),He=u(Ce*G,M),Je=u(-oe*G,M);let j=b(G-He*X-Je*ve,M),V=b(-He*oe-Je*Ce,M);const Q=j>Me,se=V>Me;if(Q&&(j=M-j),se&&(V=M-V),j>Me||V>Me)throw new Error("splitScalarEndo: Endomorphism failed, k="+G);return{k1neg:Q,k1:j,k2neg:se,k2:V}}},h=32,p=32,y=32,E=h+1,x=2*h+1;function S(G){const{a:M,b:X}=d,oe=b(G*G),ve=b(oe*G);return b(ve+M*G+X)}const k=d.a===n;class T extends Error{constructor(M){super(M)}}function L(G){if(!(G instanceof q))throw new TypeError("JacobianPoint expected")}class q{constructor(M,X,oe){this.x=M,this.y=X,this.z=oe}static fromAffine(M){if(!(M instanceof W))throw new TypeError("JacobianPoint#fromAffine: expected Point");return M.equals(W.ZERO)?q.ZERO:new q(M.x,M.y,i)}static toAffineBatch(M){const X=te(M.map(oe=>oe.z));return M.map((oe,ve)=>oe.toAffine(X[ve]))}static normalizeZ(M){return q.toAffineBatch(M).map(q.fromAffine)}equals(M){L(M);const{x:X,y:oe,z:ve}=this,{x:Ce,y:Me,z:He}=M,Je=b(ve*ve),j=b(He*He),V=b(X*j),Q=b(Ce*Je),se=b(b(oe*He)*j),pe=b(b(Me*ve)*Je);return V===Q&&se===pe}negate(){return new q(this.x,b(-this.y),this.z)}double(){const{x:M,y:X,z:oe}=this,ve=b(M*M),Ce=b(X*X),Me=b(Ce*Ce),He=M+Ce,Je=b(a*(b(He*He)-ve-Me)),j=b(o*ve),V=b(j*j),Q=b(V-a*Je),se=b(j*(Je-Q)-c*Me),pe=b(a*X*oe);return new q(Q,se,pe)}add(M){L(M);const{x:X,y:oe,z:ve}=this,{x:Ce,y:Me,z:He}=M;if(Ce===n||Me===n)return this;if(X===n||oe===n)return M;const Je=b(ve*ve),j=b(He*He),V=b(X*j),Q=b(Ce*Je),se=b(b(oe*He)*j),pe=b(b(Me*ve)*Je),De=b(Q-V),Ee=b(pe-se);if(De===n)return Ee===n?this.double():q.ZERO;const nt=b(De*De),Te=b(De*nt),ct=b(V*nt),Ne=b(Ee*Ee-Te-a*ct),Le=b(Ee*(ct-Ne)-se*Te),wt=b(ve*He*De);return new q(Ne,Le,wt)}subtract(M){return this.add(M.negate())}multiplyUnsafe(M){const X=q.ZERO;if(typeof M=="bigint"&&M===n)return X;let oe=m(M);if(oe===i)return this;if(!k){let Q=X,se=this;for(;oe>n;)oe&i&&(Q=Q.add(se)),se=se.double(),oe>>=i;return Q}let{k1neg:ve,k1:Ce,k2neg:Me,k2:He}=l.splitScalar(oe),Je=X,j=X,V=this;for(;Ce>n||He>n;)Ce&i&&(Je=Je.add(V)),He&i&&(j=j.add(V)),V=V.double(),Ce>>=i,He>>=i;return ve&&(Je=Je.negate()),Me&&(j=j.negate()),j=new q(b(j.x*l.beta),j.y,j.z),Je.add(j)}precomputeWindow(M){const X=k?128/M+1:256/M+1,oe=[];let ve=this,Ce=ve;for(let Me=0;Me<X;Me++){Ce=ve,oe.push(Ce);for(let He=1;He<2**(M-1);He++)Ce=Ce.add(ve),oe.push(Ce);ve=Ce.double()}return oe}wNAF(M,X){!X&&this.equals(q.BASE)&&(X=W.BASE);const oe=X&&X._WINDOW_SIZE||1;if(256%oe)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let ve=X&&ee.get(X);ve||(ve=this.precomputeWindow(oe),X&&oe!==1&&(ve=q.normalizeZ(ve),ee.set(X,ve)));let Ce=q.ZERO,Me=q.BASE;const He=1+(k?128/oe:256/oe),Je=2**(oe-1),j=BigInt(2**oe-1),V=2**oe,Q=BigInt(oe);for(let se=0;se<He;se++){const pe=se*Je;let De=Number(M&j);M>>=Q,De>Je&&(De-=V,M+=i);const Ee=pe,nt=pe+Math.abs(De)-1,Te=se%2!==0,ct=De<0;De===0?Me=Me.add(U(Te,ve[Ee])):Ce=Ce.add(U(ct,ve[nt]))}return{p:Ce,f:Me}}multiply(M,X){let oe=m(M),ve,Ce;if(k){const{k1neg:Me,k1:He,k2neg:Je,k2:j}=l.splitScalar(oe);let{p:V,f:Q}=this.wNAF(He,X),{p:se,f:pe}=this.wNAF(j,X);V=U(Me,V),se=U(Je,se),se=new q(b(se.x*l.beta),se.y,se.z),ve=V.add(se),Ce=Q.add(pe)}else{const{p:Me,f:He}=this.wNAF(oe,X);ve=Me,Ce=He}return q.normalizeZ([ve,Ce])[0]}toAffine(M){const{x:X,y:oe,z:ve}=this,Ce=this.equals(q.ZERO);M==null&&(M=Ce?c:O(ve));const Me=M,He=b(Me*Me),Je=b(He*Me),j=b(X*He),V=b(oe*Je),Q=b(ve*Me);if(Ce)return W.ZERO;if(Q!==i)throw new Error("invZ was invalid");return new W(j,V)}}q.BASE=new q(d.Gx,d.Gy,i),q.ZERO=new q(n,i,n);function U(G,M){const X=M.negate();return G?X:M}const ee=new WeakMap;class W{constructor(M,X){this.x=M,this.y=X}_setWindowSize(M){this._WINDOW_SIZE=M,ee.delete(this)}hasEvenY(){return this.y%a===n}static fromCompressedHex(M){const X=M.length===32,oe=H(X?M:M.subarray(1));if(!qe(oe))throw new Error("Point is not on curve");const ve=S(oe);let Ce=g(ve);const Me=(Ce&i)===i;X?Me&&(Ce=b(-Ce)):(M[0]&1)===1!==Me&&(Ce=b(-Ce));const He=new W(oe,Ce);return He.assertValidity(),He}static fromUncompressedHex(M){const X=H(M.subarray(1,h+1)),oe=H(M.subarray(h+1,h*2+1)),ve=new W(X,oe);return ve.assertValidity(),ve}static fromHex(M){const X=_(M),oe=X.length,ve=X[0];if(oe===h)return this.fromCompressedHex(X);if(oe===E&&(ve===2||ve===3))return this.fromCompressedHex(X);if(oe===x&&ve===4)return this.fromUncompressedHex(X);throw new Error(`Point.fromHex: received invalid point. Expected 32-${E} compressed bytes or ${x} uncompressed bytes, not ${oe}`)}static fromPrivateKey(M){return W.BASE.multiply(Ke(M))}static fromSignature(M,X,oe){const{r:ve,s:Ce}=at(X);if(![0,1,2,3].includes(oe))throw new Error("Cannot recover: invalid recovery bit");const Me=ae(_(M)),{n:He}=d,Je=oe===2||oe===3?ve+He:ve,j=O(Je,He),V=b(-Me*j,He),Q=b(Ce*j,He),se=oe&1?"03":"02",pe=W.fromHex(se+C(Je)),De=W.BASE.multiplyAndAddUnsafe(pe,V,Q);if(!De)throw new Error("Cannot recover signature: point at infinify");return De.assertValidity(),De}toRawBytes(M=!1){return Y(this.toHex(M))}toHex(M=!1){const X=C(this.x);return M?`${this.hasEvenY()?"02":"03"}${X}`:`04${X}${C(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const M="Point is not on elliptic curve",{x:X,y:oe}=this;if(!qe(X)||!qe(oe))throw new Error(M);const ve=b(oe*oe),Ce=S(X);if(b(ve-Ce)!==n)throw new Error(M)}equals(M){return this.x===M.x&&this.y===M.y}negate(){return new W(this.x,b(-this.y))}double(){return q.fromAffine(this).double().toAffine()}add(M){return q.fromAffine(this).add(q.fromAffine(M)).toAffine()}subtract(M){return this.add(M.negate())}multiply(M){return q.fromAffine(this).multiply(M,this).toAffine()}multiplyAndAddUnsafe(M,X,oe){const ve=q.fromAffine(this),Ce=X===n||X===i||this!==W.BASE?ve.multiplyUnsafe(X):ve.multiply(X),Me=q.fromAffine(M).multiplyUnsafe(oe),He=Ce.add(Me);return He.equals(q.ZERO)?void 0:He.toAffine()}}e.Point=W,W.BASE=new W(d.Gx,d.Gy),W.ZERO=new W(n,n);function ie(G){return Number.parseInt(G[0],16)>=8?"00"+G:G}function fe(G){if(G.length<2||G[0]!==2)throw new Error(`Invalid signature integer tag: ${F(G)}`);const M=G[1],X=G.subarray(2,M+2);if(!M||X.length!==M)throw new Error("Invalid signature integer: wrong length");if(X[0]===0&&X[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:H(X),left:G.subarray(M+2)}}function ce(G){if(G.length<2||G[0]!=48)throw new Error(`Invalid signature tag: ${F(G)}`);if(G[1]!==G.length-2)throw new Error("Invalid signature: incorrect length");const{data:M,left:X}=fe(G.subarray(2)),{data:oe,left:ve}=fe(X);if(ve.length)throw new Error(`Invalid signature: left bytes after parsing: ${F(ve)}`);return{r:M,s:oe}}class ye{constructor(M,X){this.r=M,this.s=X,this.assertValidity()}static fromCompact(M){const X=M instanceof Uint8Array,oe="Signature.fromCompact";if(typeof M!="string"&&!X)throw new TypeError(`${oe}: Expected string or Uint8Array`);const ve=X?F(M):M;if(ve.length!==128)throw new Error(`${oe}: Expected 64-byte hex`);return new ye(J(ve.slice(0,64)),J(ve.slice(64,128)))}static fromDER(M){const X=M instanceof Uint8Array;if(typeof M!="string"&&!X)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r:oe,s:ve}=ce(X?M:Y(M));return new ye(oe,ve)}static fromHex(M){return this.fromDER(M)}assertValidity(){const{r:M,s:X}=this;if(!dt(M))throw new Error("Invalid Signature: r must be 0 < r < n");if(!dt(X))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const M=d.n>>i;return this.s>M}normalizeS(){return this.hasHighS()?new ye(this.r,b(-this.s,d.n)):this}toDERRawBytes(){return Y(this.toDERHex())}toDERHex(){const M=ie(B(this.s)),X=ie(B(this.r)),oe=M.length/2,ve=X.length/2,Ce=B(oe),Me=B(ve);return`30${B(ve+oe+4)}02${Me}${X}02${Ce}${M}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return Y(this.toCompactHex())}toCompactHex(){return C(this.r)+C(this.s)}}e.Signature=ye;function xe(...G){if(!G.every(oe=>oe instanceof Uint8Array))throw new Error("Uint8Array list expected");if(G.length===1)return G[0];const M=G.reduce((oe,ve)=>oe+ve.length,0),X=new Uint8Array(M);for(let oe=0,ve=0;oe<G.length;oe++){const Ce=G[oe];X.set(Ce,ve),ve+=Ce.length}return X}const Oe=Array.from({length:256},(G,M)=>M.toString(16).padStart(2,"0"));function F(G){if(!(G instanceof Uint8Array))throw new Error("Expected Uint8Array");let M="";for(let X=0;X<G.length;X++)M+=Oe[G[X]];return M}const v=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function C(G){if(typeof G!="bigint")throw new Error("Expected bigint");if(!(n<=G&&G<v))throw new Error("Expected number 0 <= n < 2^256");return G.toString(16).padStart(64,"0")}function I(G){const M=Y(C(G));if(M.length!==32)throw new Error("Error: expected 32 bytes");return M}function B(G){const M=G.toString(16);return M.length&1?`0${M}`:M}function J(G){if(typeof G!="string")throw new TypeError("hexToNumber: expected string, got "+typeof G);return BigInt(`0x${G}`)}function Y(G){if(typeof G!="string")throw new TypeError("hexToBytes: expected string, got "+typeof G);if(G.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+G.length);const M=new Uint8Array(G.length/2);for(let X=0;X<M.length;X++){const oe=X*2,ve=G.slice(oe,oe+2),Ce=Number.parseInt(ve,16);if(Number.isNaN(Ce)||Ce<0)throw new Error("Invalid byte sequence");M[X]=Ce}return M}function H(G){return J(F(G))}function _(G){return G instanceof Uint8Array?Uint8Array.from(G):Y(G)}function m(G){if(typeof G=="number"&&Number.isSafeInteger(G)&&G>0)return BigInt(G);if(typeof G=="bigint"&&dt(G))return G;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function b(G,M=d.P){const X=G%M;return X>=n?X:M+X}function $(G,M){const{P:X}=d;let oe=G;for(;M-- >n;)oe*=oe,oe%=X;return oe}function g(G){const{P:M}=d,X=BigInt(6),oe=BigInt(11),ve=BigInt(22),Ce=BigInt(23),Me=BigInt(44),He=BigInt(88),Je=G*G*G%M,j=Je*Je*G%M,V=$(j,o)*j%M,Q=$(V,o)*j%M,se=$(Q,a)*Je%M,pe=$(se,oe)*se%M,De=$(pe,ve)*pe%M,Ee=$(De,Me)*De%M,nt=$(Ee,He)*Ee%M,Te=$(nt,Me)*De%M,ct=$(Te,o)*j%M,Ne=$(ct,Ce)*pe%M,Le=$(Ne,X)*Je%M,wt=$(Le,a);if(wt*wt%M!==G)throw new Error("Cannot find square root");return wt}function O(G,M=d.P){if(G===n||M<=n)throw new Error(`invert: expected positive integers, got n=${G} mod=${M}`);let X=b(G,M),oe=M,ve=n,Ce=i;for(;X!==n;){const He=oe/X,Je=oe%X,j=ve-Ce*He;oe=X,X=Je,ve=Ce,Ce=j}if(oe!==i)throw new Error("invert: does not exist");return b(ve,M)}function te(G,M=d.P){const X=new Array(G.length),oe=G.reduce((Ce,Me,He)=>Me===n?Ce:(X[He]=Ce,b(Ce*Me,M)),i),ve=O(oe,M);return G.reduceRight((Ce,Me,He)=>Me===n?Ce:(X[He]=b(Ce*X[He],M),b(Ce*Me,M)),ve),X}function Z(G){const M=G.length*8-p*8,X=H(G);return M>0?X>>BigInt(M):X}function ae(G,M=!1){const X=Z(G);if(M)return X;const{n:oe}=d;return X>=oe?X-oe:X}let be,ke;class Ae{constructor(M,X){if(this.hashLen=M,this.qByteLen=X,typeof M!="number"||M<2)throw new Error("hashLen must be a number");if(typeof X!="number"||X<2)throw new Error("qByteLen must be a number");this.v=new Uint8Array(M).fill(1),this.k=new Uint8Array(M).fill(0),this.counter=0}hmac(...M){return e.utils.hmacSha256(this.k,...M)}hmacSync(...M){return ke(this.k,...M)}checkSync(){if(typeof ke!="function")throw new T("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(M=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),M),this.v=await this.hmac(this.v),M.length!==0&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),M),this.v=await this.hmac(this.v))}reseedSync(M=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),M),this.v=this.hmacSync(this.v),M.length!==0&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),M),this.v=this.hmacSync(this.v))}async generate(){this.incr();let M=0;const X=[];for(;M<this.qByteLen;){this.v=await this.hmac(this.v);const oe=this.v.slice();X.push(oe),M+=this.v.length}return xe(...X)}generateSync(){this.checkSync(),this.incr();let M=0;const X=[];for(;M<this.qByteLen;){this.v=this.hmacSync(this.v);const oe=this.v.slice();X.push(oe),M+=this.v.length}return xe(...X)}}function dt(G){return n<G&&G<d.n}function qe(G){return n<G&&G<d.P}function et(G,M,X,oe=!0){const{n:ve}=d,Ce=ae(G,!0);if(!dt(Ce))return;const Me=O(Ce,ve),He=W.BASE.multiply(Ce),Je=b(He.x,ve);if(Je===n)return;const j=b(Me*b(M+X*Je,ve),ve);if(j===n)return;let V=new ye(Je,j),Q=(He.x===V.r?0:2)|Number(He.y&i);return oe&&V.hasHighS()&&(V=V.normalizeS(),Q^=1),{sig:V,recovery:Q}}function Ke(G){let M;if(typeof G=="bigint")M=G;else if(typeof G=="number"&&Number.isSafeInteger(G)&&G>0)M=BigInt(G);else if(typeof G=="string"){if(G.length!==2*p)throw new Error("Expected 32 bytes of private key");M=J(G)}else if(G instanceof Uint8Array){if(G.length!==p)throw new Error("Expected 32 bytes of private key");M=H(G)}else throw new TypeError("Expected valid private key");if(!dt(M))throw new Error("Expected private key: 0 < key < n");return M}function gt(G){return G instanceof W?(G.assertValidity(),G):W.fromHex(G)}function at(G){if(G instanceof ye)return G.assertValidity(),G;try{return ye.fromDER(G)}catch{return ye.fromCompact(G)}}function Lt(G,M=!1){return W.fromPrivateKey(G).toRawBytes(M)}e.getPublicKey=Lt;function Ge(G,M,X,oe=!1){return W.fromSignature(G,M,X).toRawBytes(oe)}e.recoverPublicKey=Ge;function st(G){const M=G instanceof Uint8Array,X=typeof G=="string",oe=(M||X)&&G.length;return M?oe===E||oe===x:X?oe===E*2||oe===x*2:G instanceof W}function Qe(G,M,X=!1){if(st(G))throw new TypeError("getSharedSecret: first arg must be private key");if(!st(M))throw new TypeError("getSharedSecret: second arg must be public key");const oe=gt(M);return oe.assertValidity(),oe.multiply(Ke(G)).toRawBytes(X)}e.getSharedSecret=Qe;function We(G){const M=G.length>h?G.slice(0,h):G;return H(M)}function ze(G){const M=We(G),X=b(M,d.n);return ut(X<n?M:X)}function ut(G){return I(G)}function rt(G,M,X){if(G==null)throw new Error(`sign: expected valid message hash, not "${G}"`);const oe=_(G),ve=Ke(M),Ce=[ut(ve),ze(oe)];if(X!=null){X===!0&&(X=e.utils.randomBytes(h));const Je=_(X);if(Je.length!==h)throw new Error(`sign: Expected ${h} bytes of extra data`);Ce.push(Je)}const Me=xe(...Ce),He=We(oe);return{seed:Me,m:He,d:ve}}function Ze(G,M){const{sig:X,recovery:oe}=G,{der:ve,recovered:Ce}=Object.assign({canonical:!0,der:!0},M),Me=ve?X.toDERRawBytes():X.toCompactRawBytes();return Ce?[Me,oe]:Me}async function er(G,M,X={}){const{seed:oe,m:ve,d:Ce}=rt(G,M,X.extraEntropy),Me=new Ae(y,p);await Me.reseed(oe);let He;for(;!(He=et(await Me.generate(),ve,Ce,X.canonical));)await Me.reseed();return Ze(He,X)}e.sign=er;function Ye(G,M,X={}){const{seed:oe,m:ve,d:Ce}=rt(G,M,X.extraEntropy),Me=new Ae(y,p);Me.reseedSync(oe);let He;for(;!(He=et(Me.generateSync(),ve,Ce,X.canonical));)Me.reseedSync();return Ze(He,X)}e.signSync=Ye;const yt={strict:!0};function Vt(G,M,X,oe=yt){let ve;try{ve=at(G),M=_(M)}catch{return!1}const{r:Ce,s:Me}=ve;if(oe.strict&&ve.hasHighS())return!1;const He=ae(M);let Je;try{Je=gt(X)}catch{return!1}const{n:j}=d,V=O(Me,j),Q=b(He*V,j),se=b(Ce*V,j),pe=W.BASE.multiplyAndAddUnsafe(Je,Q,se);return pe?b(pe.x,j)===Ce:!1}e.verify=Vt;function $t(G){return b(H(G),d.n)}class bt{constructor(M,X){this.r=M,this.s=X,this.assertValidity()}static fromHex(M){const X=_(M);if(X.length!==64)throw new TypeError(`SchnorrSignature.fromHex: expected 64 bytes, not ${X.length}`);const oe=H(X.subarray(0,32)),ve=H(X.subarray(32,64));return new bt(oe,ve)}assertValidity(){const{r:M,s:X}=this;if(!qe(M)||!dt(X))throw new Error("Invalid signature")}toHex(){return C(this.r)+C(this.s)}toRawBytes(){return Y(this.toHex())}}function Zt(G){return W.fromPrivateKey(G).toRawX()}class Rt{constructor(M,X,oe=e.utils.randomBytes()){if(M==null)throw new TypeError(`sign: Expected valid message, not "${M}"`);this.m=_(M);const{x:ve,scalar:Ce}=this.getScalar(Ke(X));if(this.px=ve,this.d=Ce,this.rand=_(oe),this.rand.length!==32)throw new TypeError("sign: Expected 32 bytes of aux randomness")}getScalar(M){const X=W.fromPrivateKey(M),oe=X.hasEvenY()?M:d.n-M;return{point:X,scalar:oe,x:X.toRawX()}}initNonce(M,X){return I(M^H(X))}finalizeNonce(M){const X=b(H(M),d.n);if(X===n)throw new Error("sign: Creation of signature failed. k is zero");const{point:oe,x:ve,scalar:Ce}=this.getScalar(X);return{R:oe,rx:ve,k:Ce}}finalizeSig(M,X,oe,ve){return new bt(M.x,b(X+oe*ve,d.n)).toRawBytes()}error(){throw new Error("sign: Invalid signature produced")}async calc(){const{m:M,d:X,px:oe,rand:ve}=this,Ce=e.utils.taggedHash,Me=this.initNonce(X,await Ce(rr.aux,ve)),{R:He,rx:Je,k:j}=this.finalizeNonce(await Ce(rr.nonce,Me,oe,M)),V=$t(await Ce(rr.challenge,Je,oe,M)),Q=this.finalizeSig(He,j,V,X);return await tr(Q,M,oe)||this.error(),Q}calcSync(){const{m:M,d:X,px:oe,rand:ve}=this,Ce=e.utils.taggedHashSync,Me=this.initNonce(X,Ce(rr.aux,ve)),{R:He,rx:Je,k:j}=this.finalizeNonce(Ce(rr.nonce,Me,oe,M)),V=$t(Ce(rr.challenge,Je,oe,M)),Q=this.finalizeSig(He,j,V,X);return Ot(Q,M,oe)||this.error(),Q}}async function kt(G,M,X){return new Rt(G,M,X).calc()}function jt(G,M,X){return new Rt(G,M,X).calcSync()}function Pt(G,M,X){const oe=G instanceof bt,ve=oe?G:bt.fromHex(G);return oe&&ve.assertValidity(),{...ve,m:_(M),P:gt(X)}}function Nt(G,M,X,oe){const ve=W.BASE.multiplyAndAddUnsafe(M,Ke(X),b(-oe,d.n));return!(!ve||!ve.hasEvenY()||ve.x!==G)}async function tr(G,M,X){try{const{r:oe,s:ve,m:Ce,P:Me}=Pt(G,M,X),He=$t(await e.utils.taggedHash(rr.challenge,I(oe),Me.toRawX(),Ce));return Nt(oe,Me,ve,He)}catch{return!1}}function Ot(G,M,X){try{const{r:oe,s:ve,m:Ce,P:Me}=Pt(G,M,X),He=$t(e.utils.taggedHashSync(rr.challenge,I(oe),Me.toRawX(),Ce));return Nt(oe,Me,ve,He)}catch(oe){if(oe instanceof T)throw oe;return!1}}e.schnorr={Signature:bt,getPublicKey:Zt,sign:kt,verify:tr,signSync:jt,verifySync:Ot},W.BASE._setWindowSize(8);const vt={node:t,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},rr={challenge:"BIP0340/challenge",aux:"BIP0340/aux",nonce:"BIP0340/nonce"},St={};e.utils={bytesToHex:F,hexToBytes:Y,concatBytes:xe,mod:b,invert:O,isValidPrivateKey(G){try{return Ke(G),!0}catch{return!1}},_bigintTo32Bytes:I,_normalizePrivateKey:Ke,hashToPrivateKey:G=>{G=_(G);const M=p+8;if(G.length<M||G.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");const X=b(H(G),d.n-i)+i;return I(X)},randomBytes:(G=32)=>{if(vt.web)return vt.web.getRandomValues(new Uint8Array(G));if(vt.node){const{randomBytes:M}=vt.node;return Uint8Array.from(M(G))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>e.utils.hashToPrivateKey(e.utils.randomBytes(p+8)),precompute(G=8,M=W.BASE){const X=M===W.BASE?M:new W(M.x,M.y);return X._setWindowSize(G),X.multiply(o),X},sha256:async(...G)=>{if(vt.web){const M=await vt.web.subtle.digest("SHA-256",xe(...G));return new Uint8Array(M)}else if(vt.node){const{createHash:M}=vt.node,X=M("sha256");return G.forEach(oe=>X.update(oe)),Uint8Array.from(X.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(G,...M)=>{if(vt.web){const X=await vt.web.subtle.importKey("raw",G,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),oe=xe(...M),ve=await vt.web.subtle.sign("HMAC",X,oe);return new Uint8Array(ve)}else if(vt.node){const{createHmac:X}=vt.node,oe=X("sha256",G);return M.forEach(ve=>oe.update(ve)),Uint8Array.from(oe.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(G,...M)=>{let X=St[G];if(X===void 0){const oe=await e.utils.sha256(Uint8Array.from(G,ve=>ve.charCodeAt(0)));X=xe(oe,oe),St[G]=X}return e.utils.sha256(X,...M)},taggedHashSync:(G,...M)=>{if(typeof be!="function")throw new T("sha256Sync is undefined, you need to set it");let X=St[G];if(X===void 0){const oe=be(Uint8Array.from(G,ve=>ve.charCodeAt(0)));X=xe(oe,oe),St[G]=X}return be(X,...M)},_JacobianPoint:q},Object.defineProperties(e.utils,{sha256Sync:{configurable:!1,get(){return be},set(G){be||(be=G)}},hmacSha256Sync:{configurable:!1,get(){return ke},set(G){ke||(ke=G)}}})})(lib);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.schnorr=e.Signature=e.Point=e.CURVE=e.utils=e.getSharedSecret=e.recoverPublicKey=e.verify=e.signSync=e.sign=e.getPublicKey=void 0;const t=hmac$1,n=sha256$1,i=lib;var a=lib;Object.defineProperty(e,"getPublicKey",{enumerable:!0,get:function(){return a.getPublicKey}}),Object.defineProperty(e,"sign",{enumerable:!0,get:function(){return a.sign}}),Object.defineProperty(e,"signSync",{enumerable:!0,get:function(){return a.signSync}}),Object.defineProperty(e,"verify",{enumerable:!0,get:function(){return a.verify}}),Object.defineProperty(e,"recoverPublicKey",{enumerable:!0,get:function(){return a.recoverPublicKey}}),Object.defineProperty(e,"getSharedSecret",{enumerable:!0,get:function(){return a.getSharedSecret}}),Object.defineProperty(e,"utils",{enumerable:!0,get:function(){return a.utils}}),Object.defineProperty(e,"CURVE",{enumerable:!0,get:function(){return a.CURVE}}),Object.defineProperty(e,"Point",{enumerable:!0,get:function(){return a.Point}}),Object.defineProperty(e,"Signature",{enumerable:!0,get:function(){return a.Signature}}),Object.defineProperty(e,"schnorr",{enumerable:!0,get:function(){return a.schnorr}}),i.utils.hmacSha256Sync=(o,...c)=>{const d=t.hmac.create(n.sha256,o);return c.forEach(u=>d.update(u)),d.digest()}})(secp256k1);var secp256k1Compat={};function commonjsRequire$1(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var utilsExports={},utils$a={get exports(){return utilsExports},set exports(e){utilsExports=e}};(function(e,t){var n=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(t,"__esModule",{value:!0}),t.crypto=t.wrapHash=t.equalsBytes=t.hexToBytes=t.bytesToUtf8=t.utf8ToBytes=t.createView=t.concatBytes=t.toHex=t.bytesToHex=t.assertBytes=t.assertBool=void 0;const i=n(_assert),a=utils$b,o=i.default.bool;t.assertBool=o;const c=i.default.bytes;t.assertBytes=c;var d=utils$b;Object.defineProperty(t,"bytesToHex",{enumerable:!0,get:function(){return d.bytesToHex}}),Object.defineProperty(t,"toHex",{enumerable:!0,get:function(){return d.bytesToHex}}),Object.defineProperty(t,"concatBytes",{enumerable:!0,get:function(){return d.concatBytes}}),Object.defineProperty(t,"createView",{enumerable:!0,get:function(){return d.createView}}),Object.defineProperty(t,"utf8ToBytes",{enumerable:!0,get:function(){return d.utf8ToBytes}});function u(y){if(!(y instanceof Uint8Array))throw new TypeError(`bytesToUtf8 expected Uint8Array, got ${typeof y}`);return new TextDecoder().decode(y)}t.bytesToUtf8=u;function l(y){const E=y.startsWith("0x")?y.substring(2):y;return(0,a.hexToBytes)(E)}t.hexToBytes=l;function h(y,E){if(y.length!==E.length)return!1;for(let x=0;x<y.length;x++)if(y[x]!==E[x])return!1;return!0}t.equalsBytes=h;function p(y){return E=>(i.default.bytes(E),y(E))}t.wrapHash=p,t.crypto=(()=>{const y=typeof self=="object"&&"crypto"in self?self.crypto:void 0,E=typeof commonjsRequire$1=="function"&&commonjsRequire$1.bind(e);return{node:E&&!y?E("crypto"):void 0,web:y}})()})(utils$a,utilsExports);var __createBinding=commonjsGlobal$1&&commonjsGlobal$1.__createBinding||(Object.create?function(e,t,n,i){i===void 0&&(i=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,a)}:function(e,t,n,i){i===void 0&&(i=n),e[i]=t[n]}),__setModuleDefault=commonjsGlobal$1&&commonjsGlobal$1.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=commonjsGlobal$1&&commonjsGlobal$1.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t};Object.defineProperty(secp256k1Compat,"__esModule",{value:!0});secp256k1Compat.contextRandomize=secp256k1Compat.ecdh=secp256k1Compat.signatureNormalize=secp256k1Compat.signatureImport=secp256k1Compat.signatureExport=secp256k1Compat.privateKeyTweakMul=secp256k1Compat.publicKeyTweakMul=secp256k1Compat.publicKeyTweakAdd=secp256k1Compat.publicKeyCombine=secp256k1Compat.publicKeyNegate=secp256k1Compat.privateKeyNegate=secp256k1Compat.privateKeyTweakAdd=secp256k1Compat.ecdsaVerify=secp256k1Compat.ecdsaRecover=secp256k1Compat.ecdsaSign=secp256k1Compat.publicKeyConvert=secp256k1Compat.publicKeyVerify=secp256k1Compat.publicKeyCreate=secp256k1Compat.privateKeyVerify=secp256k1Compat.createPrivateKey=secp256k1Compat.createPrivateKeySync=void 0;const sha256_1=sha256$1,secp=__importStar(secp256k1),utils_1$2=utilsExports;function hexToNumber(e){if(typeof e!="string")throw new TypeError("hexToNumber: expected string, got "+typeof e);return BigInt(`0x${e}`)}const bytesToNumber=e=>hexToNumber((0,utils_1$2.toHex)(e)),numberToHex=e=>e.toString(16).padStart(64,"0"),numberToBytes=e=>(0,utils_1$2.hexToBytes)(numberToHex(e)),{mod}=secp.utils,ORDER=secp.CURVE.n;function output(e=i=>new Uint8Array(i),t,n){return typeof e=="function"&&(e=e(t)),(0,utils_1$2.assertBytes)(e,t),n&&e.set(n),e}function getSignature(e){return(0,utils_1$2.assertBytes)(e,64),secp.Signature.fromCompact(e)}function createPrivateKeySync(){return secp.utils.randomPrivateKey()}secp256k1Compat.createPrivateKeySync=createPrivateKeySync;async function createPrivateKey(){return createPrivateKeySync()}secp256k1Compat.createPrivateKey=createPrivateKey;function privateKeyVerify(e){return(0,utils_1$2.assertBytes)(e,32),secp.utils.isValidPrivateKey(e)}secp256k1Compat.privateKeyVerify=privateKeyVerify;function publicKeyCreate(e,t=!0,n){(0,utils_1$2.assertBytes)(e,32),(0,utils_1$2.assertBool)(t);const i=secp.getPublicKey(e,t);return output(n,t?33:65,i)}secp256k1Compat.publicKeyCreate=publicKeyCreate;function publicKeyVerify(e){(0,utils_1$2.assertBytes)(e,33,65);try{return secp.Point.fromHex(e),!0}catch{return!1}}secp256k1Compat.publicKeyVerify=publicKeyVerify;function publicKeyConvert(e,t=!0,n){(0,utils_1$2.assertBytes)(e,33,65),(0,utils_1$2.assertBool)(t);const i=secp.Point.fromHex(e).toRawBytes(t);return output(n,t?33:65,i)}secp256k1Compat.publicKeyConvert=publicKeyConvert;function ecdsaSign(e,t,n={noncefn:void 0,data:void 0},i){if((0,utils_1$2.assertBytes)(e,32),(0,utils_1$2.assertBytes)(t,32),typeof n!="object"||n===null)throw new TypeError("secp256k1.ecdsaSign: options should be object");if(n&&(n.noncefn!==void 0||n.data!==void 0))throw new Error("Secp256k1: noncefn && data is unsupported");const[a,o]=secp.signSync(e,t,{recovered:!0,der:!1});return{signature:output(i,64,a),recid:o}}secp256k1Compat.ecdsaSign=ecdsaSign;function ecdsaRecover(e,t,n,i=!0,a){(0,utils_1$2.assertBytes)(n,32),(0,utils_1$2.assertBool)(i);const o=getSignature(e).toHex(),c=secp.Point.fromSignature(n,o,t);return output(a,i?33:65,c.toRawBytes(i))}secp256k1Compat.ecdsaRecover=ecdsaRecover;function ecdsaVerify(e,t,n){(0,utils_1$2.assertBytes)(e,64),(0,utils_1$2.assertBytes)(t,32),(0,utils_1$2.assertBytes)(n,33,65),(0,utils_1$2.assertBytes)(e,64);const i=bytesToNumber(e.slice(0,32)),a=bytesToNumber(e.slice(32,64));if(i>=ORDER||a>=ORDER)throw new Error("Cannot parse signature");const o=secp.Point.fromHex(n);let c;try{c=getSignature(e)}catch{return!1}return secp.verify(c,t,o)}secp256k1Compat.ecdsaVerify=ecdsaVerify;function privateKeyTweakAdd(e,t){(0,utils_1$2.assertBytes)(e,32),(0,utils_1$2.assertBytes)(t,32);let n=bytesToNumber(t);if(n===0n)throw new Error("Tweak must not be zero");if(n>=ORDER)throw new Error("Tweak bigger than curve order");if(n+=bytesToNumber(e),n>=ORDER&&(n-=ORDER),n===0n)throw new Error("The tweak was out of range or the resulted private key is invalid");return e.set((0,utils_1$2.hexToBytes)(numberToHex(n))),e}secp256k1Compat.privateKeyTweakAdd=privateKeyTweakAdd;function privateKeyNegate(e){(0,utils_1$2.assertBytes)(e,32);const t=mod(-bytesToNumber(e),ORDER);return e.set((0,utils_1$2.hexToBytes)(numberToHex(t))),e}secp256k1Compat.privateKeyNegate=privateKeyNegate;function publicKeyNegate(e,t=!0,n){(0,utils_1$2.assertBytes)(e,33,65),(0,utils_1$2.assertBool)(t);const i=secp.Point.fromHex(e).negate();return output(n,t?33:65,i.toRawBytes(t))}secp256k1Compat.publicKeyNegate=publicKeyNegate;function publicKeyCombine(e,t=!0,n){if(!Array.isArray(e)||!e.length)throw new TypeError(`Expected array with one or more items, not ${e}`);for(const a of e)(0,utils_1$2.assertBytes)(a,33,65);(0,utils_1$2.assertBool)(t);const i=e.map(a=>secp.Point.fromHex(a)).reduce((a,o)=>a.add(o),secp.Point.ZERO);if(i.equals(secp.Point.ZERO))throw new Error("Combined result must not be zero");return output(n,t?33:65,i.toRawBytes(t))}secp256k1Compat.publicKeyCombine=publicKeyCombine;function publicKeyTweakAdd(e,t,n=!0,i){(0,utils_1$2.assertBytes)(e,33,65),(0,utils_1$2.assertBytes)(t,32),(0,utils_1$2.assertBool)(n);const a=secp.Point.fromHex(e),o=secp.Point.fromPrivateKey(t),c=a.add(o);if(o.equals(secp.Point.ZERO)||c.equals(secp.Point.ZERO))throw new Error("Tweak must not be zero");return output(i,n?33:65,c.toRawBytes(n))}secp256k1Compat.publicKeyTweakAdd=publicKeyTweakAdd;function publicKeyTweakMul(e,t,n=!0,i){(0,utils_1$2.assertBytes)(e,33,65),(0,utils_1$2.assertBytes)(t,32),(0,utils_1$2.assertBool)(n);const a=bytesToNumber(t);if(a===0n)throw new Error("Tweak must not be zero");if(a<=1||a>=ORDER)throw new Error("Tweak is zero or bigger than curve order");const o=secp.Point.fromHex(e).multiply(a);return output(i,n?33:65,o.toRawBytes(n))}secp256k1Compat.publicKeyTweakMul=publicKeyTweakMul;function privateKeyTweakMul(e,t){(0,utils_1$2.assertBytes)(e,32),(0,utils_1$2.assertBytes)(t,32);const n=bytesToNumber(t);if(n<=1||n>=ORDER)throw new Error("Tweak is zero or bigger than curve order");const i=mod(n*bytesToNumber(e),ORDER);if(i===0n)throw new Error("The tweak was out of range or the resulted private key is invalid");return e.set((0,utils_1$2.hexToBytes)(numberToHex(i))),e}secp256k1Compat.privateKeyTweakMul=privateKeyTweakMul;function signatureExport(e,t){const n=getSignature(e).toRawBytes();return output(t,72,getSignature(e).toRawBytes()).slice(0,n.length)}secp256k1Compat.signatureExport=signatureExport;function signatureImport(e,t){(0,utils_1$2.assertBytes)(e);const n=secp.Signature.fromDER(e);return output(t,64,(0,utils_1$2.hexToBytes)(n.toCompactHex()))}secp256k1Compat.signatureImport=signatureImport;function signatureNormalize(e){const t=getSignature(e);return t.s>ORDER/2n&&e.set(numberToBytes(ORDER-t.s),32),e}secp256k1Compat.signatureNormalize=signatureNormalize;function ecdh(e,t,n={},i){if((0,utils_1$2.assertBytes)(e,33,65),(0,utils_1$2.assertBytes)(t,32),typeof n!="object"||n===null)throw new TypeError("secp256k1.ecdh: options should be object");n.data!==void 0&&(0,utils_1$2.assertBytes)(n.data);const a=secp.Point.fromHex(secp.getSharedSecret(t,e));if(n.hashfn===void 0)return output(i,32,(0,sha256_1.sha256)(a.toRawBytes(!0)));if(typeof n.hashfn!="function")throw new TypeError("secp256k1.ecdh: options.hashfn should be function");n.xbuf!==void 0&&(0,utils_1$2.assertBytes)(n.xbuf,32),n.ybuf!==void 0&&(0,utils_1$2.assertBytes)(n.ybuf,32),(0,utils_1$2.assertBytes)(i,32);const o=n.xbuf||new Uint8Array(32);o.set(numberToBytes(a.x));const c=n.ybuf||new Uint8Array(32);c.set(numberToBytes(a.y));const d=n.hashfn(o,c,n.data);if(!(d instanceof Uint8Array)||d.length!==32)throw new Error("secp256k1.ecdh: invalid options.hashfn output");return output(i,32,d)}secp256k1Compat.ecdh=ecdh;function contextRandomize(e){e!==null&&(0,utils_1$2.assertBytes)(e,32)}secp256k1Compat.contextRandomize=contextRandomize;Object.defineProperty(crypto$2,"__esModule",{value:!0});crypto$2.createUnsafeIdentity=crypto$2.computeAddress=crypto$2.ethSign=crypto$2.createEthereumMessageHash=crypto$2.sign=crypto$2.recoverAddressFromEthSignature=crypto$2.recoverPublicKey=void 0;const eth_connect_1=ethConnectExports,secp256k1_1=secp256k1,secp256k1_compat_1=secp256k1Compat;function recoverPublicKey(e,t){if(e.length!==65)throw new Error("Invalid signature length"+e.length);const n=e.slice(0,e.length-1),i=e[64]===28?1:0;return(0,secp256k1_compat_1.ecdsaRecover)(n,i,t,!1).slice(1)}crypto$2.recoverPublicKey=recoverPublicKey;function sanitizeSignature(e){if(e.length!==65)throw new Error("Invalid ethereum signature");const t=e[64];if(t===0||t===1){const n=new Uint8Array(e);return n[64]=t+27,n}return e}function recoverAddressFromEthSignature(e,t){if(typeof e=="string"){if((0,eth_connect_1.isHex)(e))return recoverAddressFromEthSignature((0,eth_connect_1.hexToBytes)(e),t);throw new Error("String signatures must be encoded in hex")}return computeAddress$1(recoverPublicKey(sanitizeSignature(e),createEthereumMessageHash(t)))}crypto$2.recoverAddressFromEthSignature=recoverAddressFromEthSignature;function sign(e,t){const n=(0,secp256k1_compat_1.ecdsaSign)(t,e),i=n.recid===1?"1c":"1b";return(0,eth_connect_1.toHex)(n.signature)+i}crypto$2.sign=sign;function createEthereumMessageHash(e){const t=typeof e=="string"?(0,eth_connect_1.stringToUtf8Bytes)(e):e,n=(0,eth_connect_1.concatBytes)((0,eth_connect_1.stringToUtf8Bytes)(`Ethereum Signed Message:
`),(0,eth_connect_1.stringToUtf8Bytes)(String(t.length)),t);return(0,eth_connect_1.hexToBytes)((0,eth_connect_1.sha3)(n))}crypto$2.createEthereumMessageHash=createEthereumMessageHash;function ethSign(e,t){return sign(e,createEthereumMessageHash(t))}crypto$2.ethSign=ethSign;function computeAddress$1(e){const t=e.length===65&&e[0]===4?e.slice(1):e;return(0,eth_connect_1.getAddress)((0,eth_connect_1.sha3)(t).substring(24))}crypto$2.computeAddress=computeAddress$1;function createUnsafeIdentity(){const e=secp256k1_1.utils.randomPrivateKey(),t=(0,secp256k1_1.getPublicKey)(e).slice(1),n=computeAddress$1(t);return{privateKey:(0,eth_connect_1.bytesToHex)(e),publicKey:(0,eth_connect_1.bytesToHex)(t),address:n}}crypto$2.createUnsafeIdentity=createUnsafeIdentity;(function(e){var t=commonjsGlobal$1&&commonjsGlobal$1.__createBinding||(Object.create?function(ce,ye,xe,Oe){Oe===void 0&&(Oe=xe);var F=Object.getOwnPropertyDescriptor(ye,xe);(!F||("get"in F?!ye.__esModule:F.writable||F.configurable))&&(F={enumerable:!0,get:function(){return ye[xe]}}),Object.defineProperty(ce,Oe,F)}:function(ce,ye,xe,Oe){Oe===void 0&&(Oe=xe),ce[Oe]=ye[xe]}),n=commonjsGlobal$1&&commonjsGlobal$1.__setModuleDefault||(Object.create?function(ce,ye){Object.defineProperty(ce,"default",{enumerable:!0,value:ye})}:function(ce,ye){ce.default=ye}),i=commonjsGlobal$1&&commonjsGlobal$1.__importStar||function(ce){if(ce&&ce.__esModule)return ce;var ye={};if(ce!=null)for(var xe in ce)xe!=="default"&&Object.prototype.hasOwnProperty.call(ce,xe)&&t(ye,ce,xe);return n(ye,ce),ye},a=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(ce){return ce&&ce.__esModule?ce:{default:ce}};Object.defineProperty(e,"__esModule",{value:!0}),e.isValidEIP1271Signature=e.parseEmphemeralPayload=e.getSignedIdentitySignatureType=e.getEphemeralSignatureType=e.EIP_1654_SIGNED_ENTITY_VALIDATOR=e.ECDSA_EIP_1654_EPHEMERAL_VALIDATOR=e.ECDSA_PERSONAL_EPHEMERAL_VALIDATOR=e.ECDSA_SIGNED_ENTITY_VALIDATOR=e.SIGNER_VALIDATOR=e.Authenticator=e.ERC1654_MAGIC_VALUE=e.VALID_SIGNATURE=void 0;const o=i(ethConnectExports),c=SignatureValidator$1,d=types$1,u=utils$c,l=a(blocks),h=crypto$2;e.VALID_SIGNATURE="VALID_SIGNATURE",e.ERC1654_MAGIC_VALUE="1626ba7e";const p=132;var y;(function(ce){async function ye(H,_,m,b=Date.now()){let $="";if(!ce.isValidAuthChain(_))return{ok:!1,message:"ERROR: Malformed authChain"};for(const O of _){const te=fe(O.type);try{const{nextAuthority:Z}=await te($,O,{provider:m,dateToValidateExpirationInMillis:b});$=Z||""}catch(Z){return{ok:!1,message:`ERROR. Link type: ${O.type}. ${Z.message}.`}}}const g=$===H;return{ok:g,message:g?void 0:`ERROR: Invalid final authority. Expected: ${H}. Current ${$}.`}}ce.validateSignature=ye;function xe(H){for(const[_,m]of H.entries())if(_===0&&m.type!==d.AuthLinkType.SIGNER||m.type===d.AuthLinkType.SIGNER&&_!==0)return!1;return!0}ce.isValidAuthChain=xe;function Oe(H){return(0,o.hexToBytes)((0,o.sha3)((0,o.stringToUtf8Bytes)(H)))}ce.createEIP1271MessageHash=Oe;function F(H,_,m){return[{type:d.AuthLinkType.SIGNER,payload:_,signature:""},{type:U(m),payload:H,signature:m}]}ce.createSimpleAuthChain=F;function v(H,_,m,b){const $=(0,u.moveMinutes)(m),g=ce.getEphemeralMessage(_.address,$),O=ce.createSignature(H,g),te=ce.createSignature(_,b);return[{type:d.AuthLinkType.SIGNER,payload:H.address,signature:""},{type:d.AuthLinkType.ECDSA_PERSONAL_EPHEMERAL,payload:g,signature:O},{type:d.AuthLinkType.ECDSA_PERSONAL_SIGNED_ENTITY,payload:b,signature:te}]}ce.createAuthChain=v;async function C(H,_,m,b){const $=new Date;$.setMinutes($.getMinutes()+m);const g=ce.getEphemeralMessage(_.address,$),O=await b(g),te=[{type:d.AuthLinkType.SIGNER,payload:H,signature:""},{type:q(O),payload:g,signature:O}];return{ephemeralIdentity:_,expiration:$,authChain:te}}ce.initializeAuthChain=C;function I(H,_){const m=ce.createSignature(H.ephemeralIdentity,_);return[...H.authChain,{type:d.AuthLinkType.ECDSA_PERSONAL_SIGNED_ENTITY,payload:_,signature:m}]}ce.signPayload=I,ce.createEthereumMessageHash=h.createEthereumMessageHash;function B(H,_){return(0,h.ethSign)((0,o.hexToBytes)(H.privateKey),_)}ce.createSignature=B;function J(H){return H.length>0&&H[0].type===d.AuthLinkType.SIGNER?H[0].payload:"Invalid-Owner-Address"}ce.ownerAddress=J;function Y(H,_){return`Decentraland Login
Ephemeral address: ${H}
Expiration: ${_.toISOString()}`}ce.getEphemeralMessage=Y})(y=e.Authenticator||(e.Authenticator={}));const E=async(ce,ye)=>({nextAuthority:ye.payload});e.SIGNER_VALIDATOR=E;const x=async(ce,ye)=>{if(!ye.signature)throw new Error("Invalid AuthLink. 'signature' must be present for type 'ECDSA_SIGNED_ENTITY_VALIDATOR'");const xe=(0,h.recoverAddressFromEthSignature)(ye.signature,ye.payload),Oe=ce.toLocaleLowerCase(),F=xe.toLocaleLowerCase();if(Oe===F)return{nextAuthority:ye.payload};throw new Error(`Invalid signer address. Expected: ${Oe}. Actual: ${F}`)};e.ECDSA_SIGNED_ENTITY_VALIDATOR=x;const S=async(ce,ye,xe)=>{if(!ye.signature)throw new Error("Invalid AuthLink. 'signature' must be present for type 'ECDSA_PERSONAL_EPHEMERAL_VALIDATOR'");const{message:Oe,ephemeralAddress:F,expiration:v}=ee(ye.payload),C=xe.dateToValidateExpirationInMillis?xe.dateToValidateExpirationInMillis:Date.now();if(v>C){const I=(0,h.recoverAddressFromEthSignature)(ye.signature,Oe),B=ce.toLocaleLowerCase(),J=I.toLocaleLowerCase();if(B===J)return{nextAuthority:F};throw new Error(`Invalid signer address. Expected: ${B}. Actual: ${J}`)}throw new Error(`Ephemeral key expired. Expiration: ${v}. Test: ${C}`)};e.ECDSA_PERSONAL_EPHEMERAL_VALIDATOR=S;const k=async(ce,ye,xe)=>{if(!ye.signature)throw new Error("Invalid AuthLink. 'signature' must be present for type 'ECDSA_EIP_1654_EPHEMERAL_VALIDATOR'");const{message:Oe,ephemeralAddress:F,expiration:v}=ee(ye.payload),C=xe!=null&&xe.dateToValidateExpirationInMillis?xe==null?void 0:xe.dateToValidateExpirationInMillis:Date.now();if(v>C&&await ie(xe.provider,ce,Oe,ye.signature,C))return{nextAuthority:F};throw new Error(`Ephemeral key expired. Expiration: ${v}. Test: ${C}`)};e.ECDSA_EIP_1654_EPHEMERAL_VALIDATOR=k;const T=async(ce,ye,xe)=>{if(!ye.signature)throw new Error("Invalid AuthLink. 'signature' must be present for type 'EIP_1654_SIGNED_ENTITY_VALIDATOR'");if(await ie(xe.provider,ce,ye.payload,ye.signature,xe.dateToValidateExpirationInMillis))return{nextAuthority:ye.payload};throw new Error("Invalid validation")};e.EIP_1654_SIGNED_ENTITY_VALIDATOR=T;const L=async(ce,ye)=>({error:"Error Validator."});function q(ce){return ce.length===p?d.AuthLinkType.ECDSA_PERSONAL_EPHEMERAL:d.AuthLinkType.ECDSA_EIP_1654_EPHEMERAL}e.getEphemeralSignatureType=q;function U(ce){return ce.length===p?d.AuthLinkType.ECDSA_PERSONAL_SIGNED_ENTITY:d.AuthLinkType.ECDSA_EIP_1654_SIGNED_ENTITY}e.getSignedIdentitySignatureType=U;function ee(ce){const ye=ce.replace(/\r/g,""),xe=ye.split(`
`),Oe=xe[1].substring(19),F=xe[2].substring(12),v=Date.parse(F);return{message:ye,ephemeralAddress:Oe,expiration:v}}e.parseEmphemeralPayload=ee;async function W(ce,ye,xe,Oe){const F=y.createEIP1271MessageHash(ye),v=(0,o.hexToBytes)(xe);let C;try{C=(0,o.bytesToHex)(await ce.isValidSignature(F,v,Oe))}catch{}if(C===e.ERC1654_MAGIC_VALUE)return!0;const I=(0,h.createEthereumMessageHash)(ye);try{C=(0,o.bytesToHex)(await ce.isValidSignature(I,v,Oe))}catch{}return C===e.ERC1654_MAGIC_VALUE}e.isValidEIP1271Signature=W;async function ie(ce,ye,xe,Oe,F){if(!ce)throw new Error("Missing provider");const v=new o.default(ce),C=await(0,c.SignatureValidator)(v,ye);let I=await W(C,xe,Oe);if(I)return!0;const B=new l.default(v);try{const{block:J}=await B.getDate(F,!1);if(I=await W(C,xe,Oe,J),I)return!0}catch(J){throw new Error(`Invalid validation. Error: ${J.message}`)}throw new Error(`Invalid validation. Expected: ${e.ERC1654_MAGIC_VALUE}. Actual: ${I}`)}function fe(ce){switch(ce){case d.AuthLinkType.SIGNER:return e.SIGNER_VALIDATOR;case d.AuthLinkType.ECDSA_PERSONAL_EPHEMERAL:return e.ECDSA_PERSONAL_EPHEMERAL_VALIDATOR;case d.AuthLinkType.ECDSA_PERSONAL_SIGNED_ENTITY:return e.ECDSA_SIGNED_ENTITY_VALIDATOR;case d.AuthLinkType.ECDSA_EIP_1654_EPHEMERAL:return e.ECDSA_EIP_1654_EPHEMERAL_VALIDATOR;case d.AuthLinkType.ECDSA_EIP_1654_SIGNED_ENTITY:return e.EIP_1654_SIGNED_ENTITY_VALIDATOR;default:return L}}})(Authenticator);(function(e){var t=commonjsGlobal$1&&commonjsGlobal$1.__createBinding||(Object.create?function(i,a,o,c){c===void 0&&(c=o);var d=Object.getOwnPropertyDescriptor(a,o);(!d||("get"in d?!a.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return a[o]}}),Object.defineProperty(i,c,d)}:function(i,a,o,c){c===void 0&&(c=o),i[c]=a[o]}),n=commonjsGlobal$1&&commonjsGlobal$1.__exportStar||function(i,a){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(a,o)&&t(a,i,o)};Object.defineProperty(e,"__esModule",{value:!0}),n(Authenticator,e),n(types$1,e)})(dist$3);var minimalExports$1={},minimal$3={get exports(){return minimalExports$1},set exports(e){minimalExports$1=e}},indexMinimal$1={},minimal$2={},aspromise$1=asPromise;function asPromise(e,t){for(var n=new Array(arguments.length-1),i=0,a=2,o=!0;a<arguments.length;)n[i++]=arguments[a++];return new Promise(function(d,u){n[i]=function(h){if(o)if(o=!1,h)u(h);else{for(var p=new Array(arguments.length-1),y=0;y<p.length;)p[y++]=arguments[y];d.apply(null,p)}};try{e.apply(t||null,n)}catch(l){o&&(o=!1,u(l))}})}var base64$3={};(function(e){var t=e;t.length=function(d){var u=d.length;if(!u)return 0;for(var l=0;--u%4>1&&d.charAt(u)==="=";)++l;return Math.ceil(d.length*3)/4-l};for(var n=new Array(64),i=new Array(123),a=0;a<64;)i[n[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;t.encode=function(d,u,l){for(var h=null,p=[],y=0,E=0,x;u<l;){var S=d[u++];switch(E){case 0:p[y++]=n[S>>2],x=(S&3)<<4,E=1;break;case 1:p[y++]=n[x|S>>4],x=(S&15)<<2,E=2;break;case 2:p[y++]=n[x|S>>6],p[y++]=n[S&63],E=0;break}y>8191&&((h||(h=[])).push(String.fromCharCode.apply(String,p)),y=0)}return E&&(p[y++]=n[x],p[y++]=61,E===1&&(p[y++]=61)),h?(y&&h.push(String.fromCharCode.apply(String,p.slice(0,y))),h.join("")):String.fromCharCode.apply(String,p.slice(0,y))};var o="invalid encoding";t.decode=function(d,u,l){for(var h=l,p=0,y,E=0;E<d.length;){var x=d.charCodeAt(E++);if(x===61&&p>1)break;if((x=i[x])===void 0)throw Error(o);switch(p){case 0:y=x,p=1;break;case 1:u[l++]=y<<2|(x&48)>>4,y=x,p=2;break;case 2:u[l++]=(y&15)<<4|(x&60)>>2,y=x,p=3;break;case 3:u[l++]=(y&3)<<6|x,p=0;break}}if(p===1)throw Error(o);return l-h},t.test=function(d){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(d)}})(base64$3);var eventemitter$1=EventEmitter$1;function EventEmitter$1(){this._listeners={}}EventEmitter$1.prototype.on=function(t,n,i){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:n,ctx:i||this}),this};EventEmitter$1.prototype.off=function(t,n){if(t===void 0)this._listeners={};else if(n===void 0)this._listeners[t]=[];else for(var i=this._listeners[t],a=0;a<i.length;)i[a].fn===n?i.splice(a,1):++a;return this};EventEmitter$1.prototype.emit=function(t){var n=this._listeners[t];if(n){for(var i=[],a=1;a<arguments.length;)i.push(arguments[a++]);for(a=0;a<n.length;)n[a].fn.apply(n[a++].ctx,i)}return this};var float$1=factory(factory);function factory(e){return typeof Float32Array<"u"?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),i=n[3]===128;function a(u,l,h){t[0]=u,l[h]=n[0],l[h+1]=n[1],l[h+2]=n[2],l[h+3]=n[3]}function o(u,l,h){t[0]=u,l[h]=n[3],l[h+1]=n[2],l[h+2]=n[1],l[h+3]=n[0]}e.writeFloatLE=i?a:o,e.writeFloatBE=i?o:a;function c(u,l){return n[0]=u[l],n[1]=u[l+1],n[2]=u[l+2],n[3]=u[l+3],t[0]}function d(u,l){return n[3]=u[l],n[2]=u[l+1],n[1]=u[l+2],n[0]=u[l+3],t[0]}e.readFloatLE=i?c:d,e.readFloatBE=i?d:c}():function(){function t(i,a,o,c){var d=a<0?1:0;if(d&&(a=-a),a===0)i(1/a>0?0:2147483648,o,c);else if(isNaN(a))i(2143289344,o,c);else if(a>34028234663852886e22)i((d<<31|2139095040)>>>0,o,c);else if(a<11754943508222875e-54)i((d<<31|Math.round(a/1401298464324817e-60))>>>0,o,c);else{var u=Math.floor(Math.log(a)/Math.LN2),l=Math.round(a*Math.pow(2,-u)*8388608)&8388607;i((d<<31|u+127<<23|l)>>>0,o,c)}}e.writeFloatLE=t.bind(null,writeUintLE),e.writeFloatBE=t.bind(null,writeUintBE);function n(i,a,o){var c=i(a,o),d=(c>>31)*2+1,u=c>>>23&255,l=c&8388607;return u===255?l?NaN:d*(1/0):u===0?d*1401298464324817e-60*l:d*Math.pow(2,u-150)*(l+8388608)}e.readFloatLE=n.bind(null,readUintLE),e.readFloatBE=n.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),i=n[7]===128;function a(u,l,h){t[0]=u,l[h]=n[0],l[h+1]=n[1],l[h+2]=n[2],l[h+3]=n[3],l[h+4]=n[4],l[h+5]=n[5],l[h+6]=n[6],l[h+7]=n[7]}function o(u,l,h){t[0]=u,l[h]=n[7],l[h+1]=n[6],l[h+2]=n[5],l[h+3]=n[4],l[h+4]=n[3],l[h+5]=n[2],l[h+6]=n[1],l[h+7]=n[0]}e.writeDoubleLE=i?a:o,e.writeDoubleBE=i?o:a;function c(u,l){return n[0]=u[l],n[1]=u[l+1],n[2]=u[l+2],n[3]=u[l+3],n[4]=u[l+4],n[5]=u[l+5],n[6]=u[l+6],n[7]=u[l+7],t[0]}function d(u,l){return n[7]=u[l],n[6]=u[l+1],n[5]=u[l+2],n[4]=u[l+3],n[3]=u[l+4],n[2]=u[l+5],n[1]=u[l+6],n[0]=u[l+7],t[0]}e.readDoubleLE=i?c:d,e.readDoubleBE=i?d:c}():function(){function t(i,a,o,c,d,u){var l=c<0?1:0;if(l&&(c=-c),c===0)i(0,d,u+a),i(1/c>0?0:2147483648,d,u+o);else if(isNaN(c))i(0,d,u+a),i(2146959360,d,u+o);else if(c>17976931348623157e292)i(0,d,u+a),i((l<<31|2146435072)>>>0,d,u+o);else{var h;if(c<22250738585072014e-324)h=c/5e-324,i(h>>>0,d,u+a),i((l<<31|h/4294967296)>>>0,d,u+o);else{var p=Math.floor(Math.log(c)/Math.LN2);p===1024&&(p=1023),h=c*Math.pow(2,-p),i(h*4503599627370496>>>0,d,u+a),i((l<<31|p+1023<<20|h*1048576&1048575)>>>0,d,u+o)}}}e.writeDoubleLE=t.bind(null,writeUintLE,0,4),e.writeDoubleBE=t.bind(null,writeUintBE,4,0);function n(i,a,o,c,d){var u=i(c,d+a),l=i(c,d+o),h=(l>>31)*2+1,p=l>>>20&2047,y=4294967296*(l&1048575)+u;return p===2047?y?NaN:h*(1/0):p===0?h*5e-324*y:h*Math.pow(2,p-1075)*(y+4503599627370496)}e.readDoubleLE=n.bind(null,readUintLE,0,4),e.readDoubleBE=n.bind(null,readUintBE,4,0)}(),e}function writeUintLE(e,t,n){t[n]=e&255,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function writeUintBE(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=e&255}function readUintLE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function readUintBE(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var inquire_1$1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}var utf8$5={};(function(e){var t=e;t.length=function(i){for(var a=0,o=0,c=0;c<i.length;++c)o=i.charCodeAt(c),o<128?a+=1:o<2048?a+=2:(o&64512)===55296&&(i.charCodeAt(c+1)&64512)===56320?(++c,a+=4):a+=3;return a},t.read=function(i,a,o){var c=o-a;if(c<1)return"";for(var d=null,u=[],l=0,h;a<o;)h=i[a++],h<128?u[l++]=h:h>191&&h<224?u[l++]=(h&31)<<6|i[a++]&63:h>239&&h<365?(h=((h&7)<<18|(i[a++]&63)<<12|(i[a++]&63)<<6|i[a++]&63)-65536,u[l++]=55296+(h>>10),u[l++]=56320+(h&1023)):u[l++]=(h&15)<<12|(i[a++]&63)<<6|i[a++]&63,l>8191&&((d||(d=[])).push(String.fromCharCode.apply(String,u)),l=0);return d?(l&&d.push(String.fromCharCode.apply(String,u.slice(0,l))),d.join("")):String.fromCharCode.apply(String,u.slice(0,l))},t.write=function(i,a,o){for(var c=o,d,u,l=0;l<i.length;++l)d=i.charCodeAt(l),d<128?a[o++]=d:d<2048?(a[o++]=d>>6|192,a[o++]=d&63|128):(d&64512)===55296&&((u=i.charCodeAt(l+1))&64512)===56320?(d=65536+((d&1023)<<10)+(u&1023),++l,a[o++]=d>>18|240,a[o++]=d>>12&63|128,a[o++]=d>>6&63|128,a[o++]=d&63|128):(a[o++]=d>>12|224,a[o++]=d>>6&63|128,a[o++]=d&63|128);return o-c}})(utf8$5);var pool_1$1=pool;function pool(e,t,n){var i=n||8192,a=i>>>1,o=null,c=i;return function(u){if(u<1||u>a)return e(u);c+u>i&&(o=e(i),c=0);var l=t.call(o,c,c+=u);return c&7&&(c=(c|7)+1),l}}var longbits$1,hasRequiredLongbits$1;function requireLongbits$1(){if(hasRequiredLongbits$1)return longbits$1;hasRequiredLongbits$1=1,longbits$1=t;var e=requireMinimal$1();function t(o,c){this.lo=o>>>0,this.hi=c>>>0}var n=t.zero=new t(0,0);n.toNumber=function(){return 0},n.zzEncode=n.zzDecode=function(){return this},n.length=function(){return 1};var i=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(c){if(c===0)return n;var d=c<0;d&&(c=-c);var u=c>>>0,l=(c-u)/4294967296>>>0;return d&&(l=~l>>>0,u=~u>>>0,++u>4294967295&&(u=0,++l>4294967295&&(l=0))),new t(u,l)},t.from=function(c){if(typeof c=="number")return t.fromNumber(c);if(e.isString(c))if(e.Long)c=e.Long.fromString(c);else return t.fromNumber(parseInt(c,10));return c.low||c.high?new t(c.low>>>0,c.high>>>0):n},t.prototype.toNumber=function(c){if(!c&&this.hi>>>31){var d=~this.lo+1>>>0,u=~this.hi>>>0;return d||(u=u+1>>>0),-(d+u*4294967296)}return this.lo+this.hi*4294967296},t.prototype.toLong=function(c){return e.Long?new e.Long(this.lo|0,this.hi|0,!!c):{low:this.lo|0,high:this.hi|0,unsigned:!!c}};var a=String.prototype.charCodeAt;return t.fromHash=function(c){return c===i?n:new t((a.call(c,0)|a.call(c,1)<<8|a.call(c,2)<<16|a.call(c,3)<<24)>>>0,(a.call(c,4)|a.call(c,5)<<8|a.call(c,6)<<16|a.call(c,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var c=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^c)>>>0,this.lo=(this.lo<<1^c)>>>0,this},t.prototype.zzDecode=function(){var c=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^c)>>>0,this.hi=(this.hi>>>1^c)>>>0,this},t.prototype.length=function(){var c=this.lo,d=(this.lo>>>28|this.hi<<4)>>>0,u=this.hi>>>24;return u===0?d===0?c<16384?c<128?1:2:c<2097152?3:4:d<16384?d<128?5:6:d<2097152?7:8:u<128?9:10},longbits$1}var hasRequiredMinimal$1;function requireMinimal$1(){return hasRequiredMinimal$1||(hasRequiredMinimal$1=1,function(e){var t=e;t.asPromise=aspromise$1,t.base64=base64$3,t.EventEmitter=eventemitter$1,t.float=float$1,t.inquire=inquire_1$1,t.utf8=utf8$5,t.pool=pool_1$1,t.LongBits=requireLongbits$1(),t.isNode=!!(typeof commonjsGlobal$1<"u"&&commonjsGlobal$1&&commonjsGlobal$1.process&&commonjsGlobal$1.process.versions&&commonjsGlobal$1.process.versions.node),t.global=t.isNode&&commonjsGlobal$1||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal$1,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(o){return typeof o=="number"&&isFinite(o)&&Math.floor(o)===o},t.isString=function(o){return typeof o=="string"||o instanceof String},t.isObject=function(o){return o&&typeof o=="object"},t.isset=t.isSet=function(o,c){var d=o[c];return d!=null&&o.hasOwnProperty(c)?typeof d!="object"||(Array.isArray(d)?d.length:Object.keys(d).length)>0:!1},t.Buffer=function(){try{var a=t.inquire("buffer").Buffer;return a.prototype.utf8Write?a:null}catch{return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(o){return typeof o=="number"?t.Buffer?t._Buffer_allocUnsafe(o):new t.Array(o):t.Buffer?t._Buffer_from(o):typeof Uint8Array>"u"?o:new Uint8Array(o)},t.Array=typeof Uint8Array<"u"?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(o){return o?t.LongBits.from(o).toHash():t.LongBits.zeroHash},t.longFromHash=function(o,c){var d=t.LongBits.fromHash(o);return t.Long?t.Long.fromBits(d.lo,d.hi,c):d.toNumber(!!c)};function n(a,o,c){for(var d=Object.keys(o),u=0;u<d.length;++u)(a[d[u]]===void 0||!c)&&(a[d[u]]=o[d[u]]);return a}t.merge=n,t.lcFirst=function(o){return o.charAt(0).toLowerCase()+o.substring(1)};function i(a){function o(c,d){if(!(this instanceof o))return new o(c,d);Object.defineProperty(this,"message",{get:function(){return c}}),Error.captureStackTrace?Error.captureStackTrace(this,o):Object.defineProperty(this,"stack",{value:new Error().stack||""}),d&&n(this,d)}return o.prototype=Object.create(Error.prototype,{constructor:{value:o,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return a},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),o}t.newError=i,t.ProtocolError=i("ProtocolError"),t.oneOfGetter=function(o){for(var c={},d=0;d<o.length;++d)c[o[d]]=1;return function(){for(var u=Object.keys(this),l=u.length-1;l>-1;--l)if(c[u[l]]===1&&this[u[l]]!==void 0&&this[u[l]]!==null)return u[l]}},t.oneOfSetter=function(o){return function(c){for(var d=0;d<o.length;++d)o[d]!==c&&delete this[o[d]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var a=t.Buffer;if(!a){t._Buffer_from=t._Buffer_allocUnsafe=null;return}t._Buffer_from=a.from!==Uint8Array.from&&a.from||function(c,d){return new a(c,d)},t._Buffer_allocUnsafe=a.allocUnsafe||function(c){return new a(c)}}}(minimal$2)),minimal$2}var writer$3=Writer$3,util$9=requireMinimal$1(),BufferWriter$3,LongBits$3=util$9.LongBits,base64$2=util$9.base64,utf8$4=util$9.utf8;function Op$1(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function noop$1(){}function State$1(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer$3(){this.len=0,this.head=new Op$1(noop$1,0,0),this.tail=this.head,this.states=null}var create$3=function e(){return util$9.Buffer?function(){return(Writer$3.create=function(){return new BufferWriter$3})()}:function(){return new Writer$3}};Writer$3.create=create$3();Writer$3.alloc=function e(t){return new util$9.Array(t)};util$9.Array!==Array&&(Writer$3.alloc=util$9.pool(Writer$3.alloc,util$9.Array.prototype.subarray));Writer$3.prototype._push=function e(t,n,i){return this.tail=this.tail.next=new Op$1(t,n,i),this.len+=n,this};function writeByte$1(e,t,n){t[n]=e&255}function writeVarint32$1(e,t,n){for(;e>127;)t[n++]=e&127|128,e>>>=7;t[n]=e}function VarintOp$1(e,t){this.len=e,this.next=void 0,this.val=t}VarintOp$1.prototype=Object.create(Op$1.prototype);VarintOp$1.prototype.fn=writeVarint32$1;Writer$3.prototype.uint32=function e(t){return this.len+=(this.tail=this.tail.next=new VarintOp$1((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this};Writer$3.prototype.int32=function e(t){return t<0?this._push(writeVarint64$1,10,LongBits$3.fromNumber(t)):this.uint32(t)};Writer$3.prototype.sint32=function e(t){return this.uint32((t<<1^t>>31)>>>0)};function writeVarint64$1(e,t,n){for(;e.hi;)t[n++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=e.lo&127|128,e.lo=e.lo>>>7;t[n++]=e.lo}Writer$3.prototype.uint64=function e(t){var n=LongBits$3.from(t);return this._push(writeVarint64$1,n.length(),n)};Writer$3.prototype.int64=Writer$3.prototype.uint64;Writer$3.prototype.sint64=function e(t){var n=LongBits$3.from(t).zzEncode();return this._push(writeVarint64$1,n.length(),n)};Writer$3.prototype.bool=function e(t){return this._push(writeByte$1,1,t?1:0)};function writeFixed32$1(e,t,n){t[n]=e&255,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}Writer$3.prototype.fixed32=function e(t){return this._push(writeFixed32$1,4,t>>>0)};Writer$3.prototype.sfixed32=Writer$3.prototype.fixed32;Writer$3.prototype.fixed64=function e(t){var n=LongBits$3.from(t);return this._push(writeFixed32$1,4,n.lo)._push(writeFixed32$1,4,n.hi)};Writer$3.prototype.sfixed64=Writer$3.prototype.fixed64;Writer$3.prototype.float=function e(t){return this._push(util$9.float.writeFloatLE,4,t)};Writer$3.prototype.double=function e(t){return this._push(util$9.float.writeDoubleLE,8,t)};var writeBytes$1=util$9.Array.prototype.set?function e(t,n,i){n.set(t,i)}:function e(t,n,i){for(var a=0;a<t.length;++a)n[i+a]=t[a]};Writer$3.prototype.bytes=function e(t){var n=t.length>>>0;if(!n)return this._push(writeByte$1,1,0);if(util$9.isString(t)){var i=Writer$3.alloc(n=base64$2.length(t));base64$2.decode(t,i,0),t=i}return this.uint32(n)._push(writeBytes$1,n,t)};Writer$3.prototype.string=function e(t){var n=utf8$4.length(t);return n?this.uint32(n)._push(utf8$4.write,n,t):this._push(writeByte$1,1,0)};Writer$3.prototype.fork=function e(){return this.states=new State$1(this),this.head=this.tail=new Op$1(noop$1,0,0),this.len=0,this};Writer$3.prototype.reset=function e(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op$1(noop$1,0,0),this.len=0),this};Writer$3.prototype.ldelim=function e(){var t=this.head,n=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=t.next,this.tail=n,this.len+=i),this};Writer$3.prototype.finish=function e(){for(var t=this.head.next,n=this.constructor.alloc(this.len),i=0;t;)t.fn(t.val,n,i),i+=t.len,t=t.next;return n};Writer$3._configure=function(e){BufferWriter$3=e,Writer$3.create=create$3(),BufferWriter$3._configure()};var writer_buffer$1=BufferWriter$2,Writer$2=writer$3;(BufferWriter$2.prototype=Object.create(Writer$2.prototype)).constructor=BufferWriter$2;var util$8=requireMinimal$1();function BufferWriter$2(){Writer$2.call(this)}BufferWriter$2._configure=function(){BufferWriter$2.alloc=util$8._Buffer_allocUnsafe,BufferWriter$2.writeBytesBuffer=util$8.Buffer&&util$8.Buffer.prototype instanceof Uint8Array&&util$8.Buffer.prototype.set.name==="set"?function(t,n,i){n.set(t,i)}:function(t,n,i){if(t.copy)t.copy(n,i,0,t.length);else for(var a=0;a<t.length;)n[i++]=t[a++]}};BufferWriter$2.prototype.bytes=function e(t){util$8.isString(t)&&(t=util$8._Buffer_from(t,"base64"));var n=t.length>>>0;return this.uint32(n),n&&this._push(BufferWriter$2.writeBytesBuffer,n,t),this};function writeStringBuffer$1(e,t,n){e.length<40?util$8.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}BufferWriter$2.prototype.string=function e(t){var n=util$8.Buffer.byteLength(t);return this.uint32(n),n&&this._push(writeStringBuffer$1,n,t),this};BufferWriter$2._configure();var reader$1=Reader$3,util$7=requireMinimal$1(),BufferReader$3,LongBits$2=util$7.LongBits,utf8$3=util$7.utf8;function indexOutOfRange$1(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader$3(e){this.buf=e,this.pos=0,this.len=e.length}var create_array$1=typeof Uint8Array<"u"?function e(t){if(t instanceof Uint8Array||Array.isArray(t))return new Reader$3(t);throw Error("illegal buffer")}:function e(t){if(Array.isArray(t))return new Reader$3(t);throw Error("illegal buffer")},create$2=function e(){return util$7.Buffer?function(n){return(Reader$3.create=function(a){return util$7.Buffer.isBuffer(a)?new BufferReader$3(a):create_array$1(a)})(n)}:create_array$1};Reader$3.create=create$2();Reader$3.prototype._slice=util$7.Array.prototype.subarray||util$7.Array.prototype.slice;Reader$3.prototype.uint32=function e(){var t=4294967295;return function(){if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange$1(this,10);return t}}();Reader$3.prototype.int32=function e(){return this.uint32()|0};Reader$3.prototype.sint32=function e(){var t=this.uint32();return t>>>1^-(t&1)|0};function readLongVarint$1(){var e=new LongBits$2(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange$1(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange$1(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}Reader$3.prototype.bool=function e(){return this.uint32()!==0};function readFixed32_end$1(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}Reader$3.prototype.fixed32=function e(){if(this.pos+4>this.len)throw indexOutOfRange$1(this,4);return readFixed32_end$1(this.buf,this.pos+=4)};Reader$3.prototype.sfixed32=function e(){if(this.pos+4>this.len)throw indexOutOfRange$1(this,4);return readFixed32_end$1(this.buf,this.pos+=4)|0};function readFixed64$1(){if(this.pos+8>this.len)throw indexOutOfRange$1(this,8);return new LongBits$2(readFixed32_end$1(this.buf,this.pos+=4),readFixed32_end$1(this.buf,this.pos+=4))}Reader$3.prototype.float=function e(){if(this.pos+4>this.len)throw indexOutOfRange$1(this,4);var t=util$7.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t};Reader$3.prototype.double=function e(){if(this.pos+8>this.len)throw indexOutOfRange$1(this,4);var t=util$7.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t};Reader$3.prototype.bytes=function e(){var t=this.uint32(),n=this.pos,i=this.pos+t;if(i>this.len)throw indexOutOfRange$1(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(n,i):n===i?new this.buf.constructor(0):this._slice.call(this.buf,n,i)};Reader$3.prototype.string=function e(){var t=this.bytes();return utf8$3.read(t,0,t.length)};Reader$3.prototype.skip=function e(t){if(typeof t=="number"){if(this.pos+t>this.len)throw indexOutOfRange$1(this,t);this.pos+=t}else do if(this.pos>=this.len)throw indexOutOfRange$1(this);while(this.buf[this.pos++]&128);return this};Reader$3.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this};Reader$3._configure=function(e){BufferReader$3=e,Reader$3.create=create$2(),BufferReader$3._configure();var t=util$7.Long?"toLong":"toNumber";util$7.merge(Reader$3.prototype,{int64:function(){return readLongVarint$1.call(this)[t](!1)},uint64:function(){return readLongVarint$1.call(this)[t](!0)},sint64:function(){return readLongVarint$1.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64$1.call(this)[t](!0)},sfixed64:function(){return readFixed64$1.call(this)[t](!1)}})};var reader_buffer$1=BufferReader$2,Reader$2=reader$1;(BufferReader$2.prototype=Object.create(Reader$2.prototype)).constructor=BufferReader$2;var util$6=requireMinimal$1();function BufferReader$2(e){Reader$2.call(this,e)}BufferReader$2._configure=function(){util$6.Buffer&&(BufferReader$2.prototype._slice=util$6.Buffer.prototype.slice)};BufferReader$2.prototype.string=function e(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))};BufferReader$2._configure();var rpc$1={},service$1=Service$1,util$5=requireMinimal$1();(Service$1.prototype=Object.create(util$5.EventEmitter.prototype)).constructor=Service$1;function Service$1(e,t,n){if(typeof e!="function")throw TypeError("rpcImpl must be a function");util$5.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!n}Service$1.prototype.rpcCall=function e(t,n,i,a,o){if(!a)throw TypeError("request must be specified");var c=this;if(!o)return util$5.asPromise(e,c,t,n,i,a);if(!c.rpcImpl){setTimeout(function(){o(Error("already ended"))},0);return}try{return c.rpcImpl(t,n[c.requestDelimited?"encodeDelimited":"encode"](a).finish(),function(u,l){if(u)return c.emit("error",u,t),o(u);if(l===null){c.end(!0);return}if(!(l instanceof i))try{l=i[c.responseDelimited?"decodeDelimited":"decode"](l)}catch(h){return c.emit("error",h,t),o(h)}return c.emit("data",l,t),o(null,l)})}catch(d){c.emit("error",d,t),setTimeout(function(){o(d)},0);return}};Service$1.prototype.end=function e(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(e){var t=e;t.Service=service$1})(rpc$1);var roots$1={};(function(e){var t=e;t.build="minimal",t.Writer=writer$3,t.BufferWriter=writer_buffer$1,t.Reader=reader$1,t.BufferReader=reader_buffer$1,t.util=requireMinimal$1(),t.rpc=rpc$1,t.roots=roots$1,t.configure=n;function n(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}n()})(indexMinimal$1);(function(e){e.exports=indexMinimal$1})(minimal$3);const _m0$1=getDefaultExportFromCjs$1(minimalExports$1);function createBasePosition$1(){return{x:0,y:0,z:0}}const Position$2={encode(e,t=_m0$1.Writer.create()){return e.x!==0&&t.uint32(13).float(e.x),e.y!==0&&t.uint32(21).float(e.y),e.z!==0&&t.uint32(29).float(e.z),t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBasePosition$1();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==13)break;a.x=n.float();continue;case 2:if(o!==21)break;a.y=n.float();continue;case 3:if(o!==29)break;a.z=n.float();continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{x:isSet$4(e.x)?Number(e.x):0,y:isSet$4(e.y)?Number(e.y):0,z:isSet$4(e.z)?Number(e.z):0}},toJSON(e){const t={};return e.x!==void 0&&(t.x=e.x),e.y!==void 0&&(t.y=e.y),e.z!==void 0&&(t.z=e.z),t},create(e){return Position$2.fromPartial(e??{})},fromPartial(e){const t=createBasePosition$1();return t.x=e.x??0,t.y=e.y??0,t.z=e.z??0,t}};function isSet$4(e){return e!=null}function kickedReasonFromJSON(e){switch(e){case 0:case"KR_NEW_SESSION":return 0;case-1:case"UNRECOGNIZED":default:return-1}}function kickedReasonToJSON(e){switch(e){case 0:return"KR_NEW_SESSION";case-1:default:return"UNRECOGNIZED"}}function createBaseChallengeResponseMessage(){return{challengeToSign:"",alreadyConnected:!1}}const ChallengeResponseMessage={encode(e,t=_m0$1.Writer.create()){return e.challengeToSign!==""&&t.uint32(10).string(e.challengeToSign),e.alreadyConnected===!0&&t.uint32(16).bool(e.alreadyConnected),t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseChallengeResponseMessage();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==10)break;a.challengeToSign=n.string();continue;case 2:if(o!==16)break;a.alreadyConnected=n.bool();continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{challengeToSign:isSet$3(e.challengeToSign)?String(e.challengeToSign):"",alreadyConnected:isSet$3(e.alreadyConnected)?!!e.alreadyConnected:!1}},toJSON(e){const t={};return e.challengeToSign!==void 0&&(t.challengeToSign=e.challengeToSign),e.alreadyConnected!==void 0&&(t.alreadyConnected=e.alreadyConnected),t},create(e){return ChallengeResponseMessage.fromPartial(e??{})},fromPartial(e){const t=createBaseChallengeResponseMessage();return t.challengeToSign=e.challengeToSign??"",t.alreadyConnected=e.alreadyConnected??!1,t}};function createBaseWelcomeMessage(){return{peerId:""}}const WelcomeMessage={encode(e,t=_m0$1.Writer.create()){return e.peerId!==""&&t.uint32(10).string(e.peerId),t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseWelcomeMessage();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==10)break;a.peerId=n.string();continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{peerId:isSet$3(e.peerId)?String(e.peerId):""}},toJSON(e){const t={};return e.peerId!==void 0&&(t.peerId=e.peerId),t},create(e){return WelcomeMessage.fromPartial(e??{})},fromPartial(e){const t=createBaseWelcomeMessage();return t.peerId=e.peerId??"",t}};function createBaseIslandChangedMessage(){return{islandId:"",connStr:"",fromIslandId:void 0,peers:{}}}const IslandChangedMessage={encode(e,t=_m0$1.Writer.create()){return e.islandId!==""&&t.uint32(10).string(e.islandId),e.connStr!==""&&t.uint32(18).string(e.connStr),e.fromIslandId!==void 0&&t.uint32(26).string(e.fromIslandId),Object.entries(e.peers).forEach(([n,i])=>{IslandChangedMessage_PeersEntry.encode({key:n,value:i},t.uint32(34).fork()).ldelim()}),t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseIslandChangedMessage();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==10)break;a.islandId=n.string();continue;case 2:if(o!==18)break;a.connStr=n.string();continue;case 3:if(o!==26)break;a.fromIslandId=n.string();continue;case 4:if(o!==34)break;const c=IslandChangedMessage_PeersEntry.decode(n,n.uint32());c.value!==void 0&&(a.peers[c.key]=c.value);continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{islandId:isSet$3(e.islandId)?String(e.islandId):"",connStr:isSet$3(e.connStr)?String(e.connStr):"",fromIslandId:isSet$3(e.fromIslandId)?String(e.fromIslandId):void 0,peers:isObject$1(e.peers)?Object.entries(e.peers).reduce((t,[n,i])=>(t[n]=Position$2.fromJSON(i),t),{}):{}}},toJSON(e){const t={};return e.islandId!==void 0&&(t.islandId=e.islandId),e.connStr!==void 0&&(t.connStr=e.connStr),e.fromIslandId!==void 0&&(t.fromIslandId=e.fromIslandId),t.peers={},e.peers&&Object.entries(e.peers).forEach(([n,i])=>{t.peers[n]=Position$2.toJSON(i)}),t},create(e){return IslandChangedMessage.fromPartial(e??{})},fromPartial(e){const t=createBaseIslandChangedMessage();return t.islandId=e.islandId??"",t.connStr=e.connStr??"",t.fromIslandId=e.fromIslandId??void 0,t.peers=Object.entries(e.peers??{}).reduce((n,[i,a])=>(a!==void 0&&(n[i]=Position$2.fromPartial(a)),n),{}),t}};function createBaseIslandChangedMessage_PeersEntry(){return{key:"",value:void 0}}const IslandChangedMessage_PeersEntry={encode(e,t=_m0$1.Writer.create()){return e.key!==""&&t.uint32(10).string(e.key),e.value!==void 0&&Position$2.encode(e.value,t.uint32(18).fork()).ldelim(),t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseIslandChangedMessage_PeersEntry();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==10)break;a.key=n.string();continue;case 2:if(o!==18)break;a.value=Position$2.decode(n,n.uint32());continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{key:isSet$3(e.key)?String(e.key):"",value:isSet$3(e.value)?Position$2.fromJSON(e.value):void 0}},toJSON(e){const t={};return e.key!==void 0&&(t.key=e.key),e.value!==void 0&&(t.value=e.value?Position$2.toJSON(e.value):void 0),t},create(e){return IslandChangedMessage_PeersEntry.fromPartial(e??{})},fromPartial(e){const t=createBaseIslandChangedMessage_PeersEntry();return t.key=e.key??"",t.value=e.value!==void 0&&e.value!==null?Position$2.fromPartial(e.value):void 0,t}};function createBaseLeftIslandMessage(){return{islandId:"",peerId:""}}const LeftIslandMessage={encode(e,t=_m0$1.Writer.create()){return e.islandId!==""&&t.uint32(10).string(e.islandId),e.peerId!==""&&t.uint32(18).string(e.peerId),t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseLeftIslandMessage();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==10)break;a.islandId=n.string();continue;case 2:if(o!==18)break;a.peerId=n.string();continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{islandId:isSet$3(e.islandId)?String(e.islandId):"",peerId:isSet$3(e.peerId)?String(e.peerId):""}},toJSON(e){const t={};return e.islandId!==void 0&&(t.islandId=e.islandId),e.peerId!==void 0&&(t.peerId=e.peerId),t},create(e){return LeftIslandMessage.fromPartial(e??{})},fromPartial(e){const t=createBaseLeftIslandMessage();return t.islandId=e.islandId??"",t.peerId=e.peerId??"",t}};function createBaseJoinIslandMessage(){return{islandId:"",peerId:""}}const JoinIslandMessage={encode(e,t=_m0$1.Writer.create()){return e.islandId!==""&&t.uint32(10).string(e.islandId),e.peerId!==""&&t.uint32(18).string(e.peerId),t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseJoinIslandMessage();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==10)break;a.islandId=n.string();continue;case 2:if(o!==18)break;a.peerId=n.string();continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{islandId:isSet$3(e.islandId)?String(e.islandId):"",peerId:isSet$3(e.peerId)?String(e.peerId):""}},toJSON(e){const t={};return e.islandId!==void 0&&(t.islandId=e.islandId),e.peerId!==void 0&&(t.peerId=e.peerId),t},create(e){return JoinIslandMessage.fromPartial(e??{})},fromPartial(e){const t=createBaseJoinIslandMessage();return t.islandId=e.islandId??"",t.peerId=e.peerId??"",t}};function createBaseKickedMessage(){return{reason:0}}const KickedMessage={encode(e,t=_m0$1.Writer.create()){return e.reason!==0&&t.uint32(8).int32(e.reason),t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseKickedMessage();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==8)break;a.reason=n.int32();continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{reason:isSet$3(e.reason)?kickedReasonFromJSON(e.reason):0}},toJSON(e){const t={};return e.reason!==void 0&&(t.reason=kickedReasonToJSON(e.reason)),t},create(e){return KickedMessage.fromPartial(e??{})},fromPartial(e){const t=createBaseKickedMessage();return t.reason=e.reason??0,t}};function createBaseServerPacket(){return{message:void 0}}const ServerPacket={encode(e,t=_m0$1.Writer.create()){var n;switch((n=e.message)==null?void 0:n.$case){case"challengeResponse":ChallengeResponseMessage.encode(e.message.challengeResponse,t.uint32(10).fork()).ldelim();break;case"welcome":WelcomeMessage.encode(e.message.welcome,t.uint32(18).fork()).ldelim();break;case"islandChanged":IslandChangedMessage.encode(e.message.islandChanged,t.uint32(26).fork()).ldelim();break;case"leftIsland":LeftIslandMessage.encode(e.message.leftIsland,t.uint32(34).fork()).ldelim();break;case"joinIsland":JoinIslandMessage.encode(e.message.joinIsland,t.uint32(42).fork()).ldelim();break;case"kicked":KickedMessage.encode(e.message.kicked,t.uint32(50).fork()).ldelim();break}return t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseServerPacket();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==10)break;a.message={$case:"challengeResponse",challengeResponse:ChallengeResponseMessage.decode(n,n.uint32())};continue;case 2:if(o!==18)break;a.message={$case:"welcome",welcome:WelcomeMessage.decode(n,n.uint32())};continue;case 3:if(o!==26)break;a.message={$case:"islandChanged",islandChanged:IslandChangedMessage.decode(n,n.uint32())};continue;case 4:if(o!==34)break;a.message={$case:"leftIsland",leftIsland:LeftIslandMessage.decode(n,n.uint32())};continue;case 5:if(o!==42)break;a.message={$case:"joinIsland",joinIsland:JoinIslandMessage.decode(n,n.uint32())};continue;case 6:if(o!==50)break;a.message={$case:"kicked",kicked:KickedMessage.decode(n,n.uint32())};continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{message:isSet$3(e.challengeResponse)?{$case:"challengeResponse",challengeResponse:ChallengeResponseMessage.fromJSON(e.challengeResponse)}:isSet$3(e.welcome)?{$case:"welcome",welcome:WelcomeMessage.fromJSON(e.welcome)}:isSet$3(e.islandChanged)?{$case:"islandChanged",islandChanged:IslandChangedMessage.fromJSON(e.islandChanged)}:isSet$3(e.leftIsland)?{$case:"leftIsland",leftIsland:LeftIslandMessage.fromJSON(e.leftIsland)}:isSet$3(e.joinIsland)?{$case:"joinIsland",joinIsland:JoinIslandMessage.fromJSON(e.joinIsland)}:isSet$3(e.kicked)?{$case:"kicked",kicked:KickedMessage.fromJSON(e.kicked)}:void 0}},toJSON(e){var n,i,a,o,c,d,u,l,h,p,y,E,x,S,k,T,L,q;const t={};return((n=e.message)==null?void 0:n.$case)==="challengeResponse"&&(t.challengeResponse=(i=e.message)!=null&&i.challengeResponse?ChallengeResponseMessage.toJSON((a=e.message)==null?void 0:a.challengeResponse):void 0),((o=e.message)==null?void 0:o.$case)==="welcome"&&(t.welcome=(c=e.message)!=null&&c.welcome?WelcomeMessage.toJSON((d=e.message)==null?void 0:d.welcome):void 0),((u=e.message)==null?void 0:u.$case)==="islandChanged"&&(t.islandChanged=(l=e.message)!=null&&l.islandChanged?IslandChangedMessage.toJSON((h=e.message)==null?void 0:h.islandChanged):void 0),((p=e.message)==null?void 0:p.$case)==="leftIsland"&&(t.leftIsland=(y=e.message)!=null&&y.leftIsland?LeftIslandMessage.toJSON((E=e.message)==null?void 0:E.leftIsland):void 0),((x=e.message)==null?void 0:x.$case)==="joinIsland"&&(t.joinIsland=(S=e.message)!=null&&S.joinIsland?JoinIslandMessage.toJSON((k=e.message)==null?void 0:k.joinIsland):void 0),((T=e.message)==null?void 0:T.$case)==="kicked"&&(t.kicked=(L=e.message)!=null&&L.kicked?KickedMessage.toJSON((q=e.message)==null?void 0:q.kicked):void 0),t},create(e){return ServerPacket.fromPartial(e??{})},fromPartial(e){var n,i,a,o,c,d,u,l,h,p,y,E,x,S,k,T,L,q;const t=createBaseServerPacket();return((n=e.message)==null?void 0:n.$case)==="challengeResponse"&&((i=e.message)==null?void 0:i.challengeResponse)!==void 0&&((a=e.message)==null?void 0:a.challengeResponse)!==null&&(t.message={$case:"challengeResponse",challengeResponse:ChallengeResponseMessage.fromPartial(e.message.challengeResponse)}),((o=e.message)==null?void 0:o.$case)==="welcome"&&((c=e.message)==null?void 0:c.welcome)!==void 0&&((d=e.message)==null?void 0:d.welcome)!==null&&(t.message={$case:"welcome",welcome:WelcomeMessage.fromPartial(e.message.welcome)}),((u=e.message)==null?void 0:u.$case)==="islandChanged"&&((l=e.message)==null?void 0:l.islandChanged)!==void 0&&((h=e.message)==null?void 0:h.islandChanged)!==null&&(t.message={$case:"islandChanged",islandChanged:IslandChangedMessage.fromPartial(e.message.islandChanged)}),((p=e.message)==null?void 0:p.$case)==="leftIsland"&&((y=e.message)==null?void 0:y.leftIsland)!==void 0&&((E=e.message)==null?void 0:E.leftIsland)!==null&&(t.message={$case:"leftIsland",leftIsland:LeftIslandMessage.fromPartial(e.message.leftIsland)}),((x=e.message)==null?void 0:x.$case)==="joinIsland"&&((S=e.message)==null?void 0:S.joinIsland)!==void 0&&((k=e.message)==null?void 0:k.joinIsland)!==null&&(t.message={$case:"joinIsland",joinIsland:JoinIslandMessage.fromPartial(e.message.joinIsland)}),((T=e.message)==null?void 0:T.$case)==="kicked"&&((L=e.message)==null?void 0:L.kicked)!==void 0&&((q=e.message)==null?void 0:q.kicked)!==null&&(t.message={$case:"kicked",kicked:KickedMessage.fromPartial(e.message.kicked)}),t}};function createBaseChallengeRequestMessage(){return{address:""}}const ChallengeRequestMessage={encode(e,t=_m0$1.Writer.create()){return e.address!==""&&t.uint32(10).string(e.address),t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseChallengeRequestMessage();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==10)break;a.address=n.string();continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{address:isSet$3(e.address)?String(e.address):""}},toJSON(e){const t={};return e.address!==void 0&&(t.address=e.address),t},create(e){return ChallengeRequestMessage.fromPartial(e??{})},fromPartial(e){const t=createBaseChallengeRequestMessage();return t.address=e.address??"",t}};function createBaseSignedChallengeMessage(){return{authChainJson:""}}const SignedChallengeMessage={encode(e,t=_m0$1.Writer.create()){return e.authChainJson!==""&&t.uint32(10).string(e.authChainJson),t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseSignedChallengeMessage();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==10)break;a.authChainJson=n.string();continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{authChainJson:isSet$3(e.authChainJson)?String(e.authChainJson):""}},toJSON(e){const t={};return e.authChainJson!==void 0&&(t.authChainJson=e.authChainJson),t},create(e){return SignedChallengeMessage.fromPartial(e??{})},fromPartial(e){const t=createBaseSignedChallengeMessage();return t.authChainJson=e.authChainJson??"",t}};function createBaseHeartbeat(){return{position:void 0,desiredRoom:void 0}}const Heartbeat={encode(e,t=_m0$1.Writer.create()){return e.position!==void 0&&Position$2.encode(e.position,t.uint32(10).fork()).ldelim(),e.desiredRoom!==void 0&&t.uint32(18).string(e.desiredRoom),t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseHeartbeat();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==10)break;a.position=Position$2.decode(n,n.uint32());continue;case 2:if(o!==18)break;a.desiredRoom=n.string();continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{position:isSet$3(e.position)?Position$2.fromJSON(e.position):void 0,desiredRoom:isSet$3(e.desiredRoom)?String(e.desiredRoom):void 0}},toJSON(e){const t={};return e.position!==void 0&&(t.position=e.position?Position$2.toJSON(e.position):void 0),e.desiredRoom!==void 0&&(t.desiredRoom=e.desiredRoom),t},create(e){return Heartbeat.fromPartial(e??{})},fromPartial(e){const t=createBaseHeartbeat();return t.position=e.position!==void 0&&e.position!==null?Position$2.fromPartial(e.position):void 0,t.desiredRoom=e.desiredRoom??void 0,t}};function createBaseClientPacket(){return{message:void 0}}const ClientPacket={encode(e,t=_m0$1.Writer.create()){var n;switch((n=e.message)==null?void 0:n.$case){case"challengeRequest":ChallengeRequestMessage.encode(e.message.challengeRequest,t.uint32(10).fork()).ldelim();break;case"signedChallenge":SignedChallengeMessage.encode(e.message.signedChallenge,t.uint32(18).fork()).ldelim();break;case"heartbeat":Heartbeat.encode(e.message.heartbeat,t.uint32(26).fork()).ldelim();break}return t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseClientPacket();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==10)break;a.message={$case:"challengeRequest",challengeRequest:ChallengeRequestMessage.decode(n,n.uint32())};continue;case 2:if(o!==18)break;a.message={$case:"signedChallenge",signedChallenge:SignedChallengeMessage.decode(n,n.uint32())};continue;case 3:if(o!==26)break;a.message={$case:"heartbeat",heartbeat:Heartbeat.decode(n,n.uint32())};continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{message:isSet$3(e.challengeRequest)?{$case:"challengeRequest",challengeRequest:ChallengeRequestMessage.fromJSON(e.challengeRequest)}:isSet$3(e.signedChallenge)?{$case:"signedChallenge",signedChallenge:SignedChallengeMessage.fromJSON(e.signedChallenge)}:isSet$3(e.heartbeat)?{$case:"heartbeat",heartbeat:Heartbeat.fromJSON(e.heartbeat)}:void 0}},toJSON(e){var n,i,a,o,c,d,u,l,h;const t={};return((n=e.message)==null?void 0:n.$case)==="challengeRequest"&&(t.challengeRequest=(i=e.message)!=null&&i.challengeRequest?ChallengeRequestMessage.toJSON((a=e.message)==null?void 0:a.challengeRequest):void 0),((o=e.message)==null?void 0:o.$case)==="signedChallenge"&&(t.signedChallenge=(c=e.message)!=null&&c.signedChallenge?SignedChallengeMessage.toJSON((d=e.message)==null?void 0:d.signedChallenge):void 0),((u=e.message)==null?void 0:u.$case)==="heartbeat"&&(t.heartbeat=(l=e.message)!=null&&l.heartbeat?Heartbeat.toJSON((h=e.message)==null?void 0:h.heartbeat):void 0),t},create(e){return ClientPacket.fromPartial(e??{})},fromPartial(e){var n,i,a,o,c,d,u,l,h;const t=createBaseClientPacket();return((n=e.message)==null?void 0:n.$case)==="challengeRequest"&&((i=e.message)==null?void 0:i.challengeRequest)!==void 0&&((a=e.message)==null?void 0:a.challengeRequest)!==null&&(t.message={$case:"challengeRequest",challengeRequest:ChallengeRequestMessage.fromPartial(e.message.challengeRequest)}),((o=e.message)==null?void 0:o.$case)==="signedChallenge"&&((c=e.message)==null?void 0:c.signedChallenge)!==void 0&&((d=e.message)==null?void 0:d.signedChallenge)!==null&&(t.message={$case:"signedChallenge",signedChallenge:SignedChallengeMessage.fromPartial(e.message.signedChallenge)}),((u=e.message)==null?void 0:u.$case)==="heartbeat"&&((l=e.message)==null?void 0:l.heartbeat)!==void 0&&((h=e.message)==null?void 0:h.heartbeat)!==null&&(t.message={$case:"heartbeat",heartbeat:Heartbeat.fromPartial(e.message.heartbeat)}),t}};function isObject$1(e){return typeof e=="object"&&e!==null}function isSet$3(e){return e!=null}class ManagedPromise{constructor(){pt(this,"promise");pt(this,"resolve");pt(this,"reject");this.promise=new Promise((t,n)=>{this.resolve=t,this.reject=n})}then(t,n){return this.promise.then(t,n)}}class Emitter{constructor(){pt(this,"receivers",new Map)}on(t,n){return this.getOrCreateSet(t).add(n),this}off(t,n){return this.getOrCreateSet(t).delete(n),this}offAll(){return this.receivers.clear(),this}emit(t){this.getOrCreateSet(t.$case).forEach(n=>n(t)),this.getOrCreateSet("*").forEach(n=>n(t))}getOrCreateSet(t){let n=this.receivers.get(t);return n||this.receivers.set(t,n=new Set),n}}const Events={stream,next};async function*stream(e,t){let n=new ManagedPromise;for(e.on(t,i=>{n.resolve(i),n=new ManagedPromise});;)yield n}async function next(e,t){return(await stream(e,t).next()).value}const version$j="logger/5.7.0";let _permanentCensorErrors=!1,_censorErrors=!1;const LogLevels={debug:1,default:2,info:2,warning:3,error:4,off:5};let _logLevel=LogLevels.default,_globalLogger=null;function _checkNormalize(){try{const e=[];if(["NFD","NFC","NFKD","NFKC"].forEach(t=>{try{if("test".normalize(t)!=="test")throw new Error("bad normalize")}catch{e.push(t)}}),e.length)throw new Error("missing "+e.join(", "));if(String.fromCharCode(233).normalize("NFD")!==String.fromCharCode(101,769))throw new Error("broken implementation")}catch(e){return e.message}return null}const _normalizeError=_checkNormalize();var LogLevel$1;(function(e){e.DEBUG="DEBUG",e.INFO="INFO",e.WARNING="WARNING",e.ERROR="ERROR",e.OFF="OFF"})(LogLevel$1||(LogLevel$1={}));var ErrorCode;(function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.NOT_IMPLEMENTED="NOT_IMPLEMENTED",e.UNSUPPORTED_OPERATION="UNSUPPORTED_OPERATION",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.TIMEOUT="TIMEOUT",e.BUFFER_OVERRUN="BUFFER_OVERRUN",e.NUMERIC_FAULT="NUMERIC_FAULT",e.MISSING_NEW="MISSING_NEW",e.INVALID_ARGUMENT="INVALID_ARGUMENT",e.MISSING_ARGUMENT="MISSING_ARGUMENT",e.UNEXPECTED_ARGUMENT="UNEXPECTED_ARGUMENT",e.CALL_EXCEPTION="CALL_EXCEPTION",e.INSUFFICIENT_FUNDS="INSUFFICIENT_FUNDS",e.NONCE_EXPIRED="NONCE_EXPIRED",e.REPLACEMENT_UNDERPRICED="REPLACEMENT_UNDERPRICED",e.UNPREDICTABLE_GAS_LIMIT="UNPREDICTABLE_GAS_LIMIT",e.TRANSACTION_REPLACED="TRANSACTION_REPLACED",e.ACTION_REJECTED="ACTION_REJECTED"})(ErrorCode||(ErrorCode={}));const HEX="0123456789abcdef";class Logger{constructor(t){Object.defineProperty(this,"version",{enumerable:!0,value:t,writable:!1})}_log(t,n){const i=t.toLowerCase();LogLevels[i]==null&&this.throwArgumentError("invalid log level name","logLevel",t),!(_logLevel>LogLevels[i])&&console.log.apply(console,n)}debug(...t){this._log(Logger.levels.DEBUG,t)}info(...t){this._log(Logger.levels.INFO,t)}warn(...t){this._log(Logger.levels.WARNING,t)}makeError(t,n,i){if(_censorErrors)return this.makeError("censored error",n,{});n||(n=Logger.errors.UNKNOWN_ERROR),i||(i={});const a=[];Object.keys(i).forEach(u=>{const l=i[u];try{if(l instanceof Uint8Array){let h="";for(let p=0;p<l.length;p++)h+=HEX[l[p]>>4],h+=HEX[l[p]&15];a.push(u+"=Uint8Array(0x"+h+")")}else a.push(u+"="+JSON.stringify(l))}catch{a.push(u+"="+JSON.stringify(i[u].toString()))}}),a.push(`code=${n}`),a.push(`version=${this.version}`);const o=t;let c="";switch(n){case ErrorCode.NUMERIC_FAULT:{c="NUMERIC_FAULT";const u=t;switch(u){case"overflow":case"underflow":case"division-by-zero":c+="-"+u;break;case"negative-power":case"negative-width":c+="-unsupported";break;case"unbound-bitwise-result":c+="-unbound-result";break}break}case ErrorCode.CALL_EXCEPTION:case ErrorCode.INSUFFICIENT_FUNDS:case ErrorCode.MISSING_NEW:case ErrorCode.NONCE_EXPIRED:case ErrorCode.REPLACEMENT_UNDERPRICED:case ErrorCode.TRANSACTION_REPLACED:case ErrorCode.UNPREDICTABLE_GAS_LIMIT:c=n;break}c&&(t+=" [ See: https://links.ethers.org/v5-errors-"+c+" ]"),a.length&&(t+=" ("+a.join(", ")+")");const d=new Error(t);return d.reason=o,d.code=n,Object.keys(i).forEach(function(u){d[u]=i[u]}),d}throwError(t,n,i){throw this.makeError(t,n,i)}throwArgumentError(t,n,i){return this.throwError(t,Logger.errors.INVALID_ARGUMENT,{argument:n,value:i})}assert(t,n,i,a){t||this.throwError(n,i,a)}assertArgument(t,n,i,a){t||this.throwArgumentError(n,i,a)}checkNormalize(t){_normalizeError&&this.throwError("platform missing String.prototype.normalize",Logger.errors.UNSUPPORTED_OPERATION,{operation:"String.prototype.normalize",form:_normalizeError})}checkSafeUint53(t,n){typeof t=="number"&&(n==null&&(n="value not safe"),(t<0||t>=9007199254740991)&&this.throwError(n,Logger.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"out-of-safe-range",value:t}),t%1&&this.throwError(n,Logger.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"non-integer",value:t}))}checkArgumentCount(t,n,i){i?i=": "+i:i="",t<n&&this.throwError("missing argument"+i,Logger.errors.MISSING_ARGUMENT,{count:t,expectedCount:n}),t>n&&this.throwError("too many arguments"+i,Logger.errors.UNEXPECTED_ARGUMENT,{count:t,expectedCount:n})}checkNew(t,n){(t===Object||t==null)&&this.throwError("missing new",Logger.errors.MISSING_NEW,{name:n.name})}checkAbstract(t,n){t===n?this.throwError("cannot instantiate abstract class "+JSON.stringify(n.name)+" directly; use a sub-class",Logger.errors.UNSUPPORTED_OPERATION,{name:t.name,operation:"new"}):(t===Object||t==null)&&this.throwError("missing new",Logger.errors.MISSING_NEW,{name:n.name})}static globalLogger(){return _globalLogger||(_globalLogger=new Logger(version$j)),_globalLogger}static setCensorship(t,n){if(!t&&n&&this.globalLogger().throwError("cannot permanently disable censorship",Logger.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"}),_permanentCensorErrors){if(!t)return;this.globalLogger().throwError("error censorship permanent",Logger.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"})}_censorErrors=!!t,_permanentCensorErrors=!!n}static setLogLevel(t){const n=LogLevels[t.toLowerCase()];if(n==null){Logger.globalLogger().warn("invalid log level - "+t);return}_logLevel=n}static from(t){return new Logger(t)}}Logger.errors=ErrorCode;Logger.levels=LogLevel$1;const version$i="bytes/5.7.0",logger$h=new Logger(version$i);function isHexable(e){return!!e.toHexString}function addSlice(e){return e.slice||(e.slice=function(){const t=Array.prototype.slice.call(arguments);return addSlice(new Uint8Array(Array.prototype.slice.apply(e,t)))}),e}function isBytesLike(e){return isHexString(e)&&!(e.length%2)||isBytes(e)}function isInteger(e){return typeof e=="number"&&e==e&&e%1===0}function isBytes(e){if(e==null)return!1;if(e.constructor===Uint8Array)return!0;if(typeof e=="string"||!isInteger(e.length)||e.length<0)return!1;for(let t=0;t<e.length;t++){const n=e[t];if(!isInteger(n)||n<0||n>=256)return!1}return!0}function arrayify(e,t){if(t||(t={}),typeof e=="number"){logger$h.checkSafeUint53(e,"invalid arrayify value");const n=[];for(;e;)n.unshift(e&255),e=parseInt(String(e/256));return n.length===0&&n.push(0),addSlice(new Uint8Array(n))}if(t.allowMissingPrefix&&typeof e=="string"&&e.substring(0,2)!=="0x"&&(e="0x"+e),isHexable(e)&&(e=e.toHexString()),isHexString(e)){let n=e.substring(2);n.length%2&&(t.hexPad==="left"?n="0"+n:t.hexPad==="right"?n+="0":logger$h.throwArgumentError("hex data is odd-length","value",e));const i=[];for(let a=0;a<n.length;a+=2)i.push(parseInt(n.substring(a,a+2),16));return addSlice(new Uint8Array(i))}return isBytes(e)?addSlice(new Uint8Array(e)):logger$h.throwArgumentError("invalid arrayify value","value",e)}function concat(e){const t=e.map(a=>arrayify(a)),n=t.reduce((a,o)=>a+o.length,0),i=new Uint8Array(n);return t.reduce((a,o)=>(i.set(o,a),a+o.length),0),addSlice(i)}function stripZeros(e){let t=arrayify(e);if(t.length===0)return t;let n=0;for(;n<t.length&&t[n]===0;)n++;return n&&(t=t.slice(n)),t}function zeroPad(e,t){e=arrayify(e),e.length>t&&logger$h.throwArgumentError("value out of range","value",arguments[0]);const n=new Uint8Array(t);return n.set(e,t-e.length),addSlice(n)}function isHexString(e,t){return!(typeof e!="string"||!e.match(/^0x[0-9A-Fa-f]*$/)||t&&e.length!==2+2*t)}const HexCharacters="0123456789abcdef";function hexlify(e,t){if(t||(t={}),typeof e=="number"){logger$h.checkSafeUint53(e,"invalid hexlify value");let n="";for(;e;)n=HexCharacters[e&15]+n,e=Math.floor(e/16);return n.length?(n.length%2&&(n="0"+n),"0x"+n):"0x00"}if(typeof e=="bigint")return e=e.toString(16),e.length%2?"0x0"+e:"0x"+e;if(t.allowMissingPrefix&&typeof e=="string"&&e.substring(0,2)!=="0x"&&(e="0x"+e),isHexable(e))return e.toHexString();if(isHexString(e))return e.length%2&&(t.hexPad==="left"?e="0x0"+e.substring(2):t.hexPad==="right"?e+="0":logger$h.throwArgumentError("hex data is odd-length","value",e)),e.toLowerCase();if(isBytes(e)){let n="0x";for(let i=0;i<e.length;i++){let a=e[i];n+=HexCharacters[(a&240)>>4]+HexCharacters[a&15]}return n}return logger$h.throwArgumentError("invalid hexlify value","value",e)}function hexDataLength(e){if(typeof e!="string")e=hexlify(e);else if(!isHexString(e)||e.length%2)return null;return(e.length-2)/2}function hexDataSlice(e,t,n){return typeof e!="string"?e=hexlify(e):(!isHexString(e)||e.length%2)&&logger$h.throwArgumentError("invalid hexData","value",e),t=2+2*t,n!=null?"0x"+e.substring(t,2+2*n):"0x"+e.substring(t)}function hexConcat(e){let t="0x";return e.forEach(n=>{t+=hexlify(n).substring(2)}),t}function hexZeroPad(e,t){for(typeof e!="string"?e=hexlify(e):isHexString(e)||logger$h.throwArgumentError("invalid hex string","value",e),e.length>2*t+2&&logger$h.throwArgumentError("value out of range","value",arguments[1]);e.length<2*t+2;)e="0x0"+e.substring(2);return e}function splitSignature(e){const t={r:"0x",s:"0x",_vs:"0x",recoveryParam:0,v:0,yParityAndS:"0x",compact:"0x"};if(isBytesLike(e)){let n=arrayify(e);n.length===64?(t.v=27+(n[32]>>7),n[32]&=127,t.r=hexlify(n.slice(0,32)),t.s=hexlify(n.slice(32,64))):n.length===65?(t.r=hexlify(n.slice(0,32)),t.s=hexlify(n.slice(32,64)),t.v=n[64]):logger$h.throwArgumentError("invalid signature string","signature",e),t.v<27&&(t.v===0||t.v===1?t.v+=27:logger$h.throwArgumentError("signature invalid v byte","signature",e)),t.recoveryParam=1-t.v%2,t.recoveryParam&&(n[32]|=128),t._vs=hexlify(n.slice(32,64))}else{if(t.r=e.r,t.s=e.s,t.v=e.v,t.recoveryParam=e.recoveryParam,t._vs=e._vs,t._vs!=null){const a=zeroPad(arrayify(t._vs),32);t._vs=hexlify(a);const o=a[0]>=128?1:0;t.recoveryParam==null?t.recoveryParam=o:t.recoveryParam!==o&&logger$h.throwArgumentError("signature recoveryParam mismatch _vs","signature",e),a[0]&=127;const c=hexlify(a);t.s==null?t.s=c:t.s!==c&&logger$h.throwArgumentError("signature v mismatch _vs","signature",e)}if(t.recoveryParam==null)t.v==null?logger$h.throwArgumentError("signature missing v and recoveryParam","signature",e):t.v===0||t.v===1?t.recoveryParam=t.v:t.recoveryParam=1-t.v%2;else if(t.v==null)t.v=27+t.recoveryParam;else{const a=t.v===0||t.v===1?t.v:1-t.v%2;t.recoveryParam!==a&&logger$h.throwArgumentError("signature recoveryParam mismatch v","signature",e)}t.r==null||!isHexString(t.r)?logger$h.throwArgumentError("signature missing or invalid r","signature",e):t.r=hexZeroPad(t.r,32),t.s==null||!isHexString(t.s)?logger$h.throwArgumentError("signature missing or invalid s","signature",e):t.s=hexZeroPad(t.s,32);const n=arrayify(t.s);n[0]>=128&&logger$h.throwArgumentError("signature s out of range","signature",e),t.recoveryParam&&(n[0]|=128);const i=hexlify(n);t._vs&&(isHexString(t._vs)||logger$h.throwArgumentError("signature invalid _vs","signature",e),t._vs=hexZeroPad(t._vs,32)),t._vs==null?t._vs=i:t._vs!==i&&logger$h.throwArgumentError("signature _vs mismatch v and s","signature",e)}return t.yParityAndS=t._vs,t.compact=t.r+t.yParityAndS.substring(2),t}function joinSignature(e){return e=splitSignature(e),hexlify(concat([e.r,e.s,e.recoveryParam?"0x1c":"0x1b"]))}var bnExports={},bn={get exports(){return bnExports},set exports(e){bnExports=e}};(function(e){(function(t,n){function i(F,v){if(!F)throw new Error(v||"Assertion failed")}function a(F,v){F.super_=v;var C=function(){};C.prototype=v.prototype,F.prototype=new C,F.prototype.constructor=F}function o(F,v,C){if(o.isBN(F))return F;this.negative=0,this.words=null,this.length=0,this.red=null,F!==null&&((v==="le"||v==="be")&&(C=v,v=10),this._init(F||0,v||10,C||"be"))}typeof t=="object"?t.exports=o:n.BN=o,o.BN=o,o.wordSize=26;var c;try{typeof window<"u"&&typeof window.Buffer<"u"?c=window.Buffer:c=require$$0.Buffer}catch{}o.isBN=function(v){return v instanceof o?!0:v!==null&&typeof v=="object"&&v.constructor.wordSize===o.wordSize&&Array.isArray(v.words)},o.max=function(v,C){return v.cmp(C)>0?v:C},o.min=function(v,C){return v.cmp(C)<0?v:C},o.prototype._init=function(v,C,I){if(typeof v=="number")return this._initNumber(v,C,I);if(typeof v=="object")return this._initArray(v,C,I);C==="hex"&&(C=16),i(C===(C|0)&&C>=2&&C<=36),v=v.toString().replace(/\s+/g,"");var B=0;v[0]==="-"&&(B++,this.negative=1),B<v.length&&(C===16?this._parseHex(v,B,I):(this._parseBase(v,C,B),I==="le"&&this._initArray(this.toArray(),C,I)))},o.prototype._initNumber=function(v,C,I){v<0&&(this.negative=1,v=-v),v<67108864?(this.words=[v&67108863],this.length=1):v<4503599627370496?(this.words=[v&67108863,v/67108864&67108863],this.length=2):(i(v<9007199254740992),this.words=[v&67108863,v/67108864&67108863,1],this.length=3),I==="le"&&this._initArray(this.toArray(),C,I)},o.prototype._initArray=function(v,C,I){if(i(typeof v.length=="number"),v.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(v.length/3),this.words=new Array(this.length);for(var B=0;B<this.length;B++)this.words[B]=0;var J,Y,H=0;if(I==="be")for(B=v.length-1,J=0;B>=0;B-=3)Y=v[B]|v[B-1]<<8|v[B-2]<<16,this.words[J]|=Y<<H&67108863,this.words[J+1]=Y>>>26-H&67108863,H+=24,H>=26&&(H-=26,J++);else if(I==="le")for(B=0,J=0;B<v.length;B+=3)Y=v[B]|v[B+1]<<8|v[B+2]<<16,this.words[J]|=Y<<H&67108863,this.words[J+1]=Y>>>26-H&67108863,H+=24,H>=26&&(H-=26,J++);return this._strip()};function d(F,v){var C=F.charCodeAt(v);if(C>=48&&C<=57)return C-48;if(C>=65&&C<=70)return C-55;if(C>=97&&C<=102)return C-87;i(!1,"Invalid character in "+F)}function u(F,v,C){var I=d(F,C);return C-1>=v&&(I|=d(F,C-1)<<4),I}o.prototype._parseHex=function(v,C,I){this.length=Math.ceil((v.length-C)/6),this.words=new Array(this.length);for(var B=0;B<this.length;B++)this.words[B]=0;var J=0,Y=0,H;if(I==="be")for(B=v.length-1;B>=C;B-=2)H=u(v,C,B)<<J,this.words[Y]|=H&67108863,J>=18?(J-=18,Y+=1,this.words[Y]|=H>>>26):J+=8;else{var _=v.length-C;for(B=_%2===0?C+1:C;B<v.length;B+=2)H=u(v,C,B)<<J,this.words[Y]|=H&67108863,J>=18?(J-=18,Y+=1,this.words[Y]|=H>>>26):J+=8}this._strip()};function l(F,v,C,I){for(var B=0,J=0,Y=Math.min(F.length,C),H=v;H<Y;H++){var _=F.charCodeAt(H)-48;B*=I,_>=49?J=_-49+10:_>=17?J=_-17+10:J=_,i(_>=0&&J<I,"Invalid character"),B+=J}return B}o.prototype._parseBase=function(v,C,I){this.words=[0],this.length=1;for(var B=0,J=1;J<=67108863;J*=C)B++;B--,J=J/C|0;for(var Y=v.length-I,H=Y%B,_=Math.min(Y,Y-H)+I,m=0,b=I;b<_;b+=B)m=l(v,b,b+B,C),this.imuln(J),this.words[0]+m<67108864?this.words[0]+=m:this._iaddn(m);if(H!==0){var $=1;for(m=l(v,b,v.length,C),b=0;b<H;b++)$*=C;this.imuln($),this.words[0]+m<67108864?this.words[0]+=m:this._iaddn(m)}this._strip()},o.prototype.copy=function(v){v.words=new Array(this.length);for(var C=0;C<this.length;C++)v.words[C]=this.words[C];v.length=this.length,v.negative=this.negative,v.red=this.red};function h(F,v){F.words=v.words,F.length=v.length,F.negative=v.negative,F.red=v.red}if(o.prototype._move=function(v){h(v,this)},o.prototype.clone=function(){var v=new o(null);return this.copy(v),v},o.prototype._expand=function(v){for(;this.length<v;)this.words[this.length++]=0;return this},o.prototype._strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},o.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},typeof Symbol<"u"&&typeof Symbol.for=="function")try{o.prototype[Symbol.for("nodejs.util.inspect.custom")]=p}catch{o.prototype.inspect=p}else o.prototype.inspect=p;function p(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var y=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],E=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],x=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];o.prototype.toString=function(v,C){v=v||10,C=C|0||1;var I;if(v===16||v==="hex"){I="";for(var B=0,J=0,Y=0;Y<this.length;Y++){var H=this.words[Y],_=((H<<B|J)&16777215).toString(16);J=H>>>24-B&16777215,B+=2,B>=26&&(B-=26,Y--),J!==0||Y!==this.length-1?I=y[6-_.length]+_+I:I=_+I}for(J!==0&&(I=J.toString(16)+I);I.length%C!==0;)I="0"+I;return this.negative!==0&&(I="-"+I),I}if(v===(v|0)&&v>=2&&v<=36){var m=E[v],b=x[v];I="";var $=this.clone();for($.negative=0;!$.isZero();){var g=$.modrn(b).toString(v);$=$.idivn(b),$.isZero()?I=g+I:I=y[m-g.length]+g+I}for(this.isZero()&&(I="0"+I);I.length%C!==0;)I="0"+I;return this.negative!==0&&(I="-"+I),I}i(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var v=this.words[0];return this.length===2?v+=this.words[1]*67108864:this.length===3&&this.words[2]===1?v+=4503599627370496+this.words[1]*67108864:this.length>2&&i(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-v:v},o.prototype.toJSON=function(){return this.toString(16,2)},c&&(o.prototype.toBuffer=function(v,C){return this.toArrayLike(c,v,C)}),o.prototype.toArray=function(v,C){return this.toArrayLike(Array,v,C)};var S=function(v,C){return v.allocUnsafe?v.allocUnsafe(C):new v(C)};o.prototype.toArrayLike=function(v,C,I){this._strip();var B=this.byteLength(),J=I||Math.max(1,B);i(B<=J,"byte array longer than desired length"),i(J>0,"Requested array length <= 0");var Y=S(v,J),H=C==="le"?"LE":"BE";return this["_toArrayLike"+H](Y,B),Y},o.prototype._toArrayLikeLE=function(v,C){for(var I=0,B=0,J=0,Y=0;J<this.length;J++){var H=this.words[J]<<Y|B;v[I++]=H&255,I<v.length&&(v[I++]=H>>8&255),I<v.length&&(v[I++]=H>>16&255),Y===6?(I<v.length&&(v[I++]=H>>24&255),B=0,Y=0):(B=H>>>24,Y+=2)}if(I<v.length)for(v[I++]=B;I<v.length;)v[I++]=0},o.prototype._toArrayLikeBE=function(v,C){for(var I=v.length-1,B=0,J=0,Y=0;J<this.length;J++){var H=this.words[J]<<Y|B;v[I--]=H&255,I>=0&&(v[I--]=H>>8&255),I>=0&&(v[I--]=H>>16&255),Y===6?(I>=0&&(v[I--]=H>>24&255),B=0,Y=0):(B=H>>>24,Y+=2)}if(I>=0)for(v[I--]=B;I>=0;)v[I--]=0},Math.clz32?o.prototype._countBits=function(v){return 32-Math.clz32(v)}:o.prototype._countBits=function(v){var C=v,I=0;return C>=4096&&(I+=13,C>>>=13),C>=64&&(I+=7,C>>>=7),C>=8&&(I+=4,C>>>=4),C>=2&&(I+=2,C>>>=2),I+C},o.prototype._zeroBits=function(v){if(v===0)return 26;var C=v,I=0;return C&8191||(I+=13,C>>>=13),C&127||(I+=7,C>>>=7),C&15||(I+=4,C>>>=4),C&3||(I+=2,C>>>=2),C&1||I++,I},o.prototype.bitLength=function(){var v=this.words[this.length-1],C=this._countBits(v);return(this.length-1)*26+C};function k(F){for(var v=new Array(F.bitLength()),C=0;C<v.length;C++){var I=C/26|0,B=C%26;v[C]=F.words[I]>>>B&1}return v}o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var v=0,C=0;C<this.length;C++){var I=this._zeroBits(this.words[C]);if(v+=I,I!==26)break}return v},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(v){return this.negative!==0?this.abs().inotn(v).iaddn(1):this.clone()},o.prototype.fromTwos=function(v){return this.testn(v-1)?this.notn(v).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return this.negative!==0},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(v){for(;this.length<v.length;)this.words[this.length++]=0;for(var C=0;C<v.length;C++)this.words[C]=this.words[C]|v.words[C];return this._strip()},o.prototype.ior=function(v){return i((this.negative|v.negative)===0),this.iuor(v)},o.prototype.or=function(v){return this.length>v.length?this.clone().ior(v):v.clone().ior(this)},o.prototype.uor=function(v){return this.length>v.length?this.clone().iuor(v):v.clone().iuor(this)},o.prototype.iuand=function(v){var C;this.length>v.length?C=v:C=this;for(var I=0;I<C.length;I++)this.words[I]=this.words[I]&v.words[I];return this.length=C.length,this._strip()},o.prototype.iand=function(v){return i((this.negative|v.negative)===0),this.iuand(v)},o.prototype.and=function(v){return this.length>v.length?this.clone().iand(v):v.clone().iand(this)},o.prototype.uand=function(v){return this.length>v.length?this.clone().iuand(v):v.clone().iuand(this)},o.prototype.iuxor=function(v){var C,I;this.length>v.length?(C=this,I=v):(C=v,I=this);for(var B=0;B<I.length;B++)this.words[B]=C.words[B]^I.words[B];if(this!==C)for(;B<C.length;B++)this.words[B]=C.words[B];return this.length=C.length,this._strip()},o.prototype.ixor=function(v){return i((this.negative|v.negative)===0),this.iuxor(v)},o.prototype.xor=function(v){return this.length>v.length?this.clone().ixor(v):v.clone().ixor(this)},o.prototype.uxor=function(v){return this.length>v.length?this.clone().iuxor(v):v.clone().iuxor(this)},o.prototype.inotn=function(v){i(typeof v=="number"&&v>=0);var C=Math.ceil(v/26)|0,I=v%26;this._expand(C),I>0&&C--;for(var B=0;B<C;B++)this.words[B]=~this.words[B]&67108863;return I>0&&(this.words[B]=~this.words[B]&67108863>>26-I),this._strip()},o.prototype.notn=function(v){return this.clone().inotn(v)},o.prototype.setn=function(v,C){i(typeof v=="number"&&v>=0);var I=v/26|0,B=v%26;return this._expand(I+1),C?this.words[I]=this.words[I]|1<<B:this.words[I]=this.words[I]&~(1<<B),this._strip()},o.prototype.iadd=function(v){var C;if(this.negative!==0&&v.negative===0)return this.negative=0,C=this.isub(v),this.negative^=1,this._normSign();if(this.negative===0&&v.negative!==0)return v.negative=0,C=this.isub(v),v.negative=1,C._normSign();var I,B;this.length>v.length?(I=this,B=v):(I=v,B=this);for(var J=0,Y=0;Y<B.length;Y++)C=(I.words[Y]|0)+(B.words[Y]|0)+J,this.words[Y]=C&67108863,J=C>>>26;for(;J!==0&&Y<I.length;Y++)C=(I.words[Y]|0)+J,this.words[Y]=C&67108863,J=C>>>26;if(this.length=I.length,J!==0)this.words[this.length]=J,this.length++;else if(I!==this)for(;Y<I.length;Y++)this.words[Y]=I.words[Y];return this},o.prototype.add=function(v){var C;return v.negative!==0&&this.negative===0?(v.negative=0,C=this.sub(v),v.negative^=1,C):v.negative===0&&this.negative!==0?(this.negative=0,C=v.sub(this),this.negative=1,C):this.length>v.length?this.clone().iadd(v):v.clone().iadd(this)},o.prototype.isub=function(v){if(v.negative!==0){v.negative=0;var C=this.iadd(v);return v.negative=1,C._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(v),this.negative=1,this._normSign();var I=this.cmp(v);if(I===0)return this.negative=0,this.length=1,this.words[0]=0,this;var B,J;I>0?(B=this,J=v):(B=v,J=this);for(var Y=0,H=0;H<J.length;H++)C=(B.words[H]|0)-(J.words[H]|0)+Y,Y=C>>26,this.words[H]=C&67108863;for(;Y!==0&&H<B.length;H++)C=(B.words[H]|0)+Y,Y=C>>26,this.words[H]=C&67108863;if(Y===0&&H<B.length&&B!==this)for(;H<B.length;H++)this.words[H]=B.words[H];return this.length=Math.max(this.length,H),B!==this&&(this.negative=1),this._strip()},o.prototype.sub=function(v){return this.clone().isub(v)};function T(F,v,C){C.negative=v.negative^F.negative;var I=F.length+v.length|0;C.length=I,I=I-1|0;var B=F.words[0]|0,J=v.words[0]|0,Y=B*J,H=Y&67108863,_=Y/67108864|0;C.words[0]=H;for(var m=1;m<I;m++){for(var b=_>>>26,$=_&67108863,g=Math.min(m,v.length-1),O=Math.max(0,m-F.length+1);O<=g;O++){var te=m-O|0;B=F.words[te]|0,J=v.words[O]|0,Y=B*J+$,b+=Y/67108864|0,$=Y&67108863}C.words[m]=$|0,_=b|0}return _!==0?C.words[m]=_|0:C.length--,C._strip()}var L=function(v,C,I){var B=v.words,J=C.words,Y=I.words,H=0,_,m,b,$=B[0]|0,g=$&8191,O=$>>>13,te=B[1]|0,Z=te&8191,ae=te>>>13,be=B[2]|0,ke=be&8191,Ae=be>>>13,dt=B[3]|0,qe=dt&8191,et=dt>>>13,Ke=B[4]|0,gt=Ke&8191,at=Ke>>>13,Lt=B[5]|0,Ge=Lt&8191,st=Lt>>>13,Qe=B[6]|0,We=Qe&8191,ze=Qe>>>13,ut=B[7]|0,rt=ut&8191,Ze=ut>>>13,er=B[8]|0,Ye=er&8191,yt=er>>>13,Vt=B[9]|0,$t=Vt&8191,bt=Vt>>>13,Zt=J[0]|0,Rt=Zt&8191,kt=Zt>>>13,jt=J[1]|0,Pt=jt&8191,Nt=jt>>>13,tr=J[2]|0,Ot=tr&8191,vt=tr>>>13,rr=J[3]|0,St=rr&8191,G=rr>>>13,M=J[4]|0,X=M&8191,oe=M>>>13,ve=J[5]|0,Ce=ve&8191,Me=ve>>>13,He=J[6]|0,Je=He&8191,j=He>>>13,V=J[7]|0,Q=V&8191,se=V>>>13,pe=J[8]|0,De=pe&8191,Ee=pe>>>13,nt=J[9]|0,Te=nt&8191,ct=nt>>>13;I.negative=v.negative^C.negative,I.length=19,_=Math.imul(g,Rt),m=Math.imul(g,kt),m=m+Math.imul(O,Rt)|0,b=Math.imul(O,kt);var Ne=(H+_|0)+((m&8191)<<13)|0;H=(b+(m>>>13)|0)+(Ne>>>26)|0,Ne&=67108863,_=Math.imul(Z,Rt),m=Math.imul(Z,kt),m=m+Math.imul(ae,Rt)|0,b=Math.imul(ae,kt),_=_+Math.imul(g,Pt)|0,m=m+Math.imul(g,Nt)|0,m=m+Math.imul(O,Pt)|0,b=b+Math.imul(O,Nt)|0;var Le=(H+_|0)+((m&8191)<<13)|0;H=(b+(m>>>13)|0)+(Le>>>26)|0,Le&=67108863,_=Math.imul(ke,Rt),m=Math.imul(ke,kt),m=m+Math.imul(Ae,Rt)|0,b=Math.imul(Ae,kt),_=_+Math.imul(Z,Pt)|0,m=m+Math.imul(Z,Nt)|0,m=m+Math.imul(ae,Pt)|0,b=b+Math.imul(ae,Nt)|0,_=_+Math.imul(g,Ot)|0,m=m+Math.imul(g,vt)|0,m=m+Math.imul(O,Ot)|0,b=b+Math.imul(O,vt)|0;var wt=(H+_|0)+((m&8191)<<13)|0;H=(b+(m>>>13)|0)+(wt>>>26)|0,wt&=67108863,_=Math.imul(qe,Rt),m=Math.imul(qe,kt),m=m+Math.imul(et,Rt)|0,b=Math.imul(et,kt),_=_+Math.imul(ke,Pt)|0,m=m+Math.imul(ke,Nt)|0,m=m+Math.imul(Ae,Pt)|0,b=b+Math.imul(Ae,Nt)|0,_=_+Math.imul(Z,Ot)|0,m=m+Math.imul(Z,vt)|0,m=m+Math.imul(ae,Ot)|0,b=b+Math.imul(ae,vt)|0,_=_+Math.imul(g,St)|0,m=m+Math.imul(g,G)|0,m=m+Math.imul(O,St)|0,b=b+Math.imul(O,G)|0;var ot=(H+_|0)+((m&8191)<<13)|0;H=(b+(m>>>13)|0)+(ot>>>26)|0,ot&=67108863,_=Math.imul(gt,Rt),m=Math.imul(gt,kt),m=m+Math.imul(at,Rt)|0,b=Math.imul(at,kt),_=_+Math.imul(qe,Pt)|0,m=m+Math.imul(qe,Nt)|0,m=m+Math.imul(et,Pt)|0,b=b+Math.imul(et,Nt)|0,_=_+Math.imul(ke,Ot)|0,m=m+Math.imul(ke,vt)|0,m=m+Math.imul(Ae,Ot)|0,b=b+Math.imul(Ae,vt)|0,_=_+Math.imul(Z,St)|0,m=m+Math.imul(Z,G)|0,m=m+Math.imul(ae,St)|0,b=b+Math.imul(ae,G)|0,_=_+Math.imul(g,X)|0,m=m+Math.imul(g,oe)|0,m=m+Math.imul(O,X)|0,b=b+Math.imul(O,oe)|0;var At=(H+_|0)+((m&8191)<<13)|0;H=(b+(m>>>13)|0)+(At>>>26)|0,At&=67108863,_=Math.imul(Ge,Rt),m=Math.imul(Ge,kt),m=m+Math.imul(st,Rt)|0,b=Math.imul(st,kt),_=_+Math.imul(gt,Pt)|0,m=m+Math.imul(gt,Nt)|0,m=m+Math.imul(at,Pt)|0,b=b+Math.imul(at,Nt)|0,_=_+Math.imul(qe,Ot)|0,m=m+Math.imul(qe,vt)|0,m=m+Math.imul(et,Ot)|0,b=b+Math.imul(et,vt)|0,_=_+Math.imul(ke,St)|0,m=m+Math.imul(ke,G)|0,m=m+Math.imul(Ae,St)|0,b=b+Math.imul(Ae,G)|0,_=_+Math.imul(Z,X)|0,m=m+Math.imul(Z,oe)|0,m=m+Math.imul(ae,X)|0,b=b+Math.imul(ae,oe)|0,_=_+Math.imul(g,Ce)|0,m=m+Math.imul(g,Me)|0,m=m+Math.imul(O,Ce)|0,b=b+Math.imul(O,Me)|0;var zt=(H+_|0)+((m&8191)<<13)|0;H=(b+(m>>>13)|0)+(zt>>>26)|0,zt&=67108863,_=Math.imul(We,Rt),m=Math.imul(We,kt),m=m+Math.imul(ze,Rt)|0,b=Math.imul(ze,kt),_=_+Math.imul(Ge,Pt)|0,m=m+Math.imul(Ge,Nt)|0,m=m+Math.imul(st,Pt)|0,b=b+Math.imul(st,Nt)|0,_=_+Math.imul(gt,Ot)|0,m=m+Math.imul(gt,vt)|0,m=m+Math.imul(at,Ot)|0,b=b+Math.imul(at,vt)|0,_=_+Math.imul(qe,St)|0,m=m+Math.imul(qe,G)|0,m=m+Math.imul(et,St)|0,b=b+Math.imul(et,G)|0,_=_+Math.imul(ke,X)|0,m=m+Math.imul(ke,oe)|0,m=m+Math.imul(Ae,X)|0,b=b+Math.imul(Ae,oe)|0,_=_+Math.imul(Z,Ce)|0,m=m+Math.imul(Z,Me)|0,m=m+Math.imul(ae,Ce)|0,b=b+Math.imul(ae,Me)|0,_=_+Math.imul(g,Je)|0,m=m+Math.imul(g,j)|0,m=m+Math.imul(O,Je)|0,b=b+Math.imul(O,j)|0;var Ut=(H+_|0)+((m&8191)<<13)|0;H=(b+(m>>>13)|0)+(Ut>>>26)|0,Ut&=67108863,_=Math.imul(rt,Rt),m=Math.imul(rt,kt),m=m+Math.imul(Ze,Rt)|0,b=Math.imul(Ze,kt),_=_+Math.imul(We,Pt)|0,m=m+Math.imul(We,Nt)|0,m=m+Math.imul(ze,Pt)|0,b=b+Math.imul(ze,Nt)|0,_=_+Math.imul(Ge,Ot)|0,m=m+Math.imul(Ge,vt)|0,m=m+Math.imul(st,Ot)|0,b=b+Math.imul(st,vt)|0,_=_+Math.imul(gt,St)|0,m=m+Math.imul(gt,G)|0,m=m+Math.imul(at,St)|0,b=b+Math.imul(at,G)|0,_=_+Math.imul(qe,X)|0,m=m+Math.imul(qe,oe)|0,m=m+Math.imul(et,X)|0,b=b+Math.imul(et,oe)|0,_=_+Math.imul(ke,Ce)|0,m=m+Math.imul(ke,Me)|0,m=m+Math.imul(Ae,Ce)|0,b=b+Math.imul(Ae,Me)|0,_=_+Math.imul(Z,Je)|0,m=m+Math.imul(Z,j)|0,m=m+Math.imul(ae,Je)|0,b=b+Math.imul(ae,j)|0,_=_+Math.imul(g,Q)|0,m=m+Math.imul(g,se)|0,m=m+Math.imul(O,Q)|0,b=b+Math.imul(O,se)|0;var xr=(H+_|0)+((m&8191)<<13)|0;H=(b+(m>>>13)|0)+(xr>>>26)|0,xr&=67108863,_=Math.imul(Ye,Rt),m=Math.imul(Ye,kt),m=m+Math.imul(yt,Rt)|0,b=Math.imul(yt,kt),_=_+Math.imul(rt,Pt)|0,m=m+Math.imul(rt,Nt)|0,m=m+Math.imul(Ze,Pt)|0,b=b+Math.imul(Ze,Nt)|0,_=_+Math.imul(We,Ot)|0,m=m+Math.imul(We,vt)|0,m=m+Math.imul(ze,Ot)|0,b=b+Math.imul(ze,vt)|0,_=_+Math.imul(Ge,St)|0,m=m+Math.imul(Ge,G)|0,m=m+Math.imul(st,St)|0,b=b+Math.imul(st,G)|0,_=_+Math.imul(gt,X)|0,m=m+Math.imul(gt,oe)|0,m=m+Math.imul(at,X)|0,b=b+Math.imul(at,oe)|0,_=_+Math.imul(qe,Ce)|0,m=m+Math.imul(qe,Me)|0,m=m+Math.imul(et,Ce)|0,b=b+Math.imul(et,Me)|0,_=_+Math.imul(ke,Je)|0,m=m+Math.imul(ke,j)|0,m=m+Math.imul(Ae,Je)|0,b=b+Math.imul(Ae,j)|0,_=_+Math.imul(Z,Q)|0,m=m+Math.imul(Z,se)|0,m=m+Math.imul(ae,Q)|0,b=b+Math.imul(ae,se)|0,_=_+Math.imul(g,De)|0,m=m+Math.imul(g,Ee)|0,m=m+Math.imul(O,De)|0,b=b+Math.imul(O,Ee)|0;var hr=(H+_|0)+((m&8191)<<13)|0;H=(b+(m>>>13)|0)+(hr>>>26)|0,hr&=67108863,_=Math.imul($t,Rt),m=Math.imul($t,kt),m=m+Math.imul(bt,Rt)|0,b=Math.imul(bt,kt),_=_+Math.imul(Ye,Pt)|0,m=m+Math.imul(Ye,Nt)|0,m=m+Math.imul(yt,Pt)|0,b=b+Math.imul(yt,Nt)|0,_=_+Math.imul(rt,Ot)|0,m=m+Math.imul(rt,vt)|0,m=m+Math.imul(Ze,Ot)|0,b=b+Math.imul(Ze,vt)|0,_=_+Math.imul(We,St)|0,m=m+Math.imul(We,G)|0,m=m+Math.imul(ze,St)|0,b=b+Math.imul(ze,G)|0,_=_+Math.imul(Ge,X)|0,m=m+Math.imul(Ge,oe)|0,m=m+Math.imul(st,X)|0,b=b+Math.imul(st,oe)|0,_=_+Math.imul(gt,Ce)|0,m=m+Math.imul(gt,Me)|0,m=m+Math.imul(at,Ce)|0,b=b+Math.imul(at,Me)|0,_=_+Math.imul(qe,Je)|0,m=m+Math.imul(qe,j)|0,m=m+Math.imul(et,Je)|0,b=b+Math.imul(et,j)|0,_=_+Math.imul(ke,Q)|0,m=m+Math.imul(ke,se)|0,m=m+Math.imul(Ae,Q)|0,b=b+Math.imul(Ae,se)|0,_=_+Math.imul(Z,De)|0,m=m+Math.imul(Z,Ee)|0,m=m+Math.imul(ae,De)|0,b=b+Math.imul(ae,Ee)|0,_=_+Math.imul(g,Te)|0,m=m+Math.imul(g,ct)|0,m=m+Math.imul(O,Te)|0,b=b+Math.imul(O,ct)|0;var pr=(H+_|0)+((m&8191)<<13)|0;H=(b+(m>>>13)|0)+(pr>>>26)|0,pr&=67108863,_=Math.imul($t,Pt),m=Math.imul($t,Nt),m=m+Math.imul(bt,Pt)|0,b=Math.imul(bt,Nt),_=_+Math.imul(Ye,Ot)|0,m=m+Math.imul(Ye,vt)|0,m=m+Math.imul(yt,Ot)|0,b=b+Math.imul(yt,vt)|0,_=_+Math.imul(rt,St)|0,m=m+Math.imul(rt,G)|0,m=m+Math.imul(Ze,St)|0,b=b+Math.imul(Ze,G)|0,_=_+Math.imul(We,X)|0,m=m+Math.imul(We,oe)|0,m=m+Math.imul(ze,X)|0,b=b+Math.imul(ze,oe)|0,_=_+Math.imul(Ge,Ce)|0,m=m+Math.imul(Ge,Me)|0,m=m+Math.imul(st,Ce)|0,b=b+Math.imul(st,Me)|0,_=_+Math.imul(gt,Je)|0,m=m+Math.imul(gt,j)|0,m=m+Math.imul(at,Je)|0,b=b+Math.imul(at,j)|0,_=_+Math.imul(qe,Q)|0,m=m+Math.imul(qe,se)|0,m=m+Math.imul(et,Q)|0,b=b+Math.imul(et,se)|0,_=_+Math.imul(ke,De)|0,m=m+Math.imul(ke,Ee)|0,m=m+Math.imul(Ae,De)|0,b=b+Math.imul(Ae,Ee)|0,_=_+Math.imul(Z,Te)|0,m=m+Math.imul(Z,ct)|0,m=m+Math.imul(ae,Te)|0,b=b+Math.imul(ae,ct)|0;var vr=(H+_|0)+((m&8191)<<13)|0;H=(b+(m>>>13)|0)+(vr>>>26)|0,vr&=67108863,_=Math.imul($t,Ot),m=Math.imul($t,vt),m=m+Math.imul(bt,Ot)|0,b=Math.imul(bt,vt),_=_+Math.imul(Ye,St)|0,m=m+Math.imul(Ye,G)|0,m=m+Math.imul(yt,St)|0,b=b+Math.imul(yt,G)|0,_=_+Math.imul(rt,X)|0,m=m+Math.imul(rt,oe)|0,m=m+Math.imul(Ze,X)|0,b=b+Math.imul(Ze,oe)|0,_=_+Math.imul(We,Ce)|0,m=m+Math.imul(We,Me)|0,m=m+Math.imul(ze,Ce)|0,b=b+Math.imul(ze,Me)|0,_=_+Math.imul(Ge,Je)|0,m=m+Math.imul(Ge,j)|0,m=m+Math.imul(st,Je)|0,b=b+Math.imul(st,j)|0,_=_+Math.imul(gt,Q)|0,m=m+Math.imul(gt,se)|0,m=m+Math.imul(at,Q)|0,b=b+Math.imul(at,se)|0,_=_+Math.imul(qe,De)|0,m=m+Math.imul(qe,Ee)|0,m=m+Math.imul(et,De)|0,b=b+Math.imul(et,Ee)|0,_=_+Math.imul(ke,Te)|0,m=m+Math.imul(ke,ct)|0,m=m+Math.imul(Ae,Te)|0,b=b+Math.imul(Ae,ct)|0;var Er=(H+_|0)+((m&8191)<<13)|0;H=(b+(m>>>13)|0)+(Er>>>26)|0,Er&=67108863,_=Math.imul($t,St),m=Math.imul($t,G),m=m+Math.imul(bt,St)|0,b=Math.imul(bt,G),_=_+Math.imul(Ye,X)|0,m=m+Math.imul(Ye,oe)|0,m=m+Math.imul(yt,X)|0,b=b+Math.imul(yt,oe)|0,_=_+Math.imul(rt,Ce)|0,m=m+Math.imul(rt,Me)|0,m=m+Math.imul(Ze,Ce)|0,b=b+Math.imul(Ze,Me)|0,_=_+Math.imul(We,Je)|0,m=m+Math.imul(We,j)|0,m=m+Math.imul(ze,Je)|0,b=b+Math.imul(ze,j)|0,_=_+Math.imul(Ge,Q)|0,m=m+Math.imul(Ge,se)|0,m=m+Math.imul(st,Q)|0,b=b+Math.imul(st,se)|0,_=_+Math.imul(gt,De)|0,m=m+Math.imul(gt,Ee)|0,m=m+Math.imul(at,De)|0,b=b+Math.imul(at,Ee)|0,_=_+Math.imul(qe,Te)|0,m=m+Math.imul(qe,ct)|0,m=m+Math.imul(et,Te)|0,b=b+Math.imul(et,ct)|0;var ur=(H+_|0)+((m&8191)<<13)|0;H=(b+(m>>>13)|0)+(ur>>>26)|0,ur&=67108863,_=Math.imul($t,X),m=Math.imul($t,oe),m=m+Math.imul(bt,X)|0,b=Math.imul(bt,oe),_=_+Math.imul(Ye,Ce)|0,m=m+Math.imul(Ye,Me)|0,m=m+Math.imul(yt,Ce)|0,b=b+Math.imul(yt,Me)|0,_=_+Math.imul(rt,Je)|0,m=m+Math.imul(rt,j)|0,m=m+Math.imul(Ze,Je)|0,b=b+Math.imul(Ze,j)|0,_=_+Math.imul(We,Q)|0,m=m+Math.imul(We,se)|0,m=m+Math.imul(ze,Q)|0,b=b+Math.imul(ze,se)|0,_=_+Math.imul(Ge,De)|0,m=m+Math.imul(Ge,Ee)|0,m=m+Math.imul(st,De)|0,b=b+Math.imul(st,Ee)|0,_=_+Math.imul(gt,Te)|0,m=m+Math.imul(gt,ct)|0,m=m+Math.imul(at,Te)|0,b=b+Math.imul(at,ct)|0;var yr=(H+_|0)+((m&8191)<<13)|0;H=(b+(m>>>13)|0)+(yr>>>26)|0,yr&=67108863,_=Math.imul($t,Ce),m=Math.imul($t,Me),m=m+Math.imul(bt,Ce)|0,b=Math.imul(bt,Me),_=_+Math.imul(Ye,Je)|0,m=m+Math.imul(Ye,j)|0,m=m+Math.imul(yt,Je)|0,b=b+Math.imul(yt,j)|0,_=_+Math.imul(rt,Q)|0,m=m+Math.imul(rt,se)|0,m=m+Math.imul(Ze,Q)|0,b=b+Math.imul(Ze,se)|0,_=_+Math.imul(We,De)|0,m=m+Math.imul(We,Ee)|0,m=m+Math.imul(ze,De)|0,b=b+Math.imul(ze,Ee)|0,_=_+Math.imul(Ge,Te)|0,m=m+Math.imul(Ge,ct)|0,m=m+Math.imul(st,Te)|0,b=b+Math.imul(st,ct)|0;var $r=(H+_|0)+((m&8191)<<13)|0;H=(b+(m>>>13)|0)+($r>>>26)|0,$r&=67108863,_=Math.imul($t,Je),m=Math.imul($t,j),m=m+Math.imul(bt,Je)|0,b=Math.imul(bt,j),_=_+Math.imul(Ye,Q)|0,m=m+Math.imul(Ye,se)|0,m=m+Math.imul(yt,Q)|0,b=b+Math.imul(yt,se)|0,_=_+Math.imul(rt,De)|0,m=m+Math.imul(rt,Ee)|0,m=m+Math.imul(Ze,De)|0,b=b+Math.imul(Ze,Ee)|0,_=_+Math.imul(We,Te)|0,m=m+Math.imul(We,ct)|0,m=m+Math.imul(ze,Te)|0,b=b+Math.imul(ze,ct)|0;var Qt=(H+_|0)+((m&8191)<<13)|0;H=(b+(m>>>13)|0)+(Qt>>>26)|0,Qt&=67108863,_=Math.imul($t,Q),m=Math.imul($t,se),m=m+Math.imul(bt,Q)|0,b=Math.imul(bt,se),_=_+Math.imul(Ye,De)|0,m=m+Math.imul(Ye,Ee)|0,m=m+Math.imul(yt,De)|0,b=b+Math.imul(yt,Ee)|0,_=_+Math.imul(rt,Te)|0,m=m+Math.imul(rt,ct)|0,m=m+Math.imul(Ze,Te)|0,b=b+Math.imul(Ze,ct)|0;var Tr=(H+_|0)+((m&8191)<<13)|0;H=(b+(m>>>13)|0)+(Tr>>>26)|0,Tr&=67108863,_=Math.imul($t,De),m=Math.imul($t,Ee),m=m+Math.imul(bt,De)|0,b=Math.imul(bt,Ee),_=_+Math.imul(Ye,Te)|0,m=m+Math.imul(Ye,ct)|0,m=m+Math.imul(yt,Te)|0,b=b+Math.imul(yt,ct)|0;var Lr=(H+_|0)+((m&8191)<<13)|0;H=(b+(m>>>13)|0)+(Lr>>>26)|0,Lr&=67108863,_=Math.imul($t,Te),m=Math.imul($t,ct),m=m+Math.imul(bt,Te)|0,b=Math.imul(bt,ct);var Rr=(H+_|0)+((m&8191)<<13)|0;return H=(b+(m>>>13)|0)+(Rr>>>26)|0,Rr&=67108863,Y[0]=Ne,Y[1]=Le,Y[2]=wt,Y[3]=ot,Y[4]=At,Y[5]=zt,Y[6]=Ut,Y[7]=xr,Y[8]=hr,Y[9]=pr,Y[10]=vr,Y[11]=Er,Y[12]=ur,Y[13]=yr,Y[14]=$r,Y[15]=Qt,Y[16]=Tr,Y[17]=Lr,Y[18]=Rr,H!==0&&(Y[19]=H,I.length++),I};Math.imul||(L=T);function q(F,v,C){C.negative=v.negative^F.negative,C.length=F.length+v.length;for(var I=0,B=0,J=0;J<C.length-1;J++){var Y=B;B=0;for(var H=I&67108863,_=Math.min(J,v.length-1),m=Math.max(0,J-F.length+1);m<=_;m++){var b=J-m,$=F.words[b]|0,g=v.words[m]|0,O=$*g,te=O&67108863;Y=Y+(O/67108864|0)|0,te=te+H|0,H=te&67108863,Y=Y+(te>>>26)|0,B+=Y>>>26,Y&=67108863}C.words[J]=H,I=Y,Y=B}return I!==0?C.words[J]=I:C.length--,C._strip()}function U(F,v,C){return q(F,v,C)}o.prototype.mulTo=function(v,C){var I,B=this.length+v.length;return this.length===10&&v.length===10?I=L(this,v,C):B<63?I=T(this,v,C):B<1024?I=q(this,v,C):I=U(this,v,C),I},o.prototype.mul=function(v){var C=new o(null);return C.words=new Array(this.length+v.length),this.mulTo(v,C)},o.prototype.mulf=function(v){var C=new o(null);return C.words=new Array(this.length+v.length),U(this,v,C)},o.prototype.imul=function(v){return this.clone().mulTo(v,this)},o.prototype.imuln=function(v){var C=v<0;C&&(v=-v),i(typeof v=="number"),i(v<67108864);for(var I=0,B=0;B<this.length;B++){var J=(this.words[B]|0)*v,Y=(J&67108863)+(I&67108863);I>>=26,I+=J/67108864|0,I+=Y>>>26,this.words[B]=Y&67108863}return I!==0&&(this.words[B]=I,this.length++),C?this.ineg():this},o.prototype.muln=function(v){return this.clone().imuln(v)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(v){var C=k(v);if(C.length===0)return new o(1);for(var I=this,B=0;B<C.length&&C[B]===0;B++,I=I.sqr());if(++B<C.length)for(var J=I.sqr();B<C.length;B++,J=J.sqr())C[B]!==0&&(I=I.mul(J));return I},o.prototype.iushln=function(v){i(typeof v=="number"&&v>=0);var C=v%26,I=(v-C)/26,B=67108863>>>26-C<<26-C,J;if(C!==0){var Y=0;for(J=0;J<this.length;J++){var H=this.words[J]&B,_=(this.words[J]|0)-H<<C;this.words[J]=_|Y,Y=H>>>26-C}Y&&(this.words[J]=Y,this.length++)}if(I!==0){for(J=this.length-1;J>=0;J--)this.words[J+I]=this.words[J];for(J=0;J<I;J++)this.words[J]=0;this.length+=I}return this._strip()},o.prototype.ishln=function(v){return i(this.negative===0),this.iushln(v)},o.prototype.iushrn=function(v,C,I){i(typeof v=="number"&&v>=0);var B;C?B=(C-C%26)/26:B=0;var J=v%26,Y=Math.min((v-J)/26,this.length),H=67108863^67108863>>>J<<J,_=I;if(B-=Y,B=Math.max(0,B),_){for(var m=0;m<Y;m++)_.words[m]=this.words[m];_.length=Y}if(Y!==0)if(this.length>Y)for(this.length-=Y,m=0;m<this.length;m++)this.words[m]=this.words[m+Y];else this.words[0]=0,this.length=1;var b=0;for(m=this.length-1;m>=0&&(b!==0||m>=B);m--){var $=this.words[m]|0;this.words[m]=b<<26-J|$>>>J,b=$&H}return _&&b!==0&&(_.words[_.length++]=b),this.length===0&&(this.words[0]=0,this.length=1),this._strip()},o.prototype.ishrn=function(v,C,I){return i(this.negative===0),this.iushrn(v,C,I)},o.prototype.shln=function(v){return this.clone().ishln(v)},o.prototype.ushln=function(v){return this.clone().iushln(v)},o.prototype.shrn=function(v){return this.clone().ishrn(v)},o.prototype.ushrn=function(v){return this.clone().iushrn(v)},o.prototype.testn=function(v){i(typeof v=="number"&&v>=0);var C=v%26,I=(v-C)/26,B=1<<C;if(this.length<=I)return!1;var J=this.words[I];return!!(J&B)},o.prototype.imaskn=function(v){i(typeof v=="number"&&v>=0);var C=v%26,I=(v-C)/26;if(i(this.negative===0,"imaskn works only with positive numbers"),this.length<=I)return this;if(C!==0&&I++,this.length=Math.min(I,this.length),C!==0){var B=67108863^67108863>>>C<<C;this.words[this.length-1]&=B}return this._strip()},o.prototype.maskn=function(v){return this.clone().imaskn(v)},o.prototype.iaddn=function(v){return i(typeof v=="number"),i(v<67108864),v<0?this.isubn(-v):this.negative!==0?this.length===1&&(this.words[0]|0)<=v?(this.words[0]=v-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(v),this.negative=1,this):this._iaddn(v)},o.prototype._iaddn=function(v){this.words[0]+=v;for(var C=0;C<this.length&&this.words[C]>=67108864;C++)this.words[C]-=67108864,C===this.length-1?this.words[C+1]=1:this.words[C+1]++;return this.length=Math.max(this.length,C+1),this},o.prototype.isubn=function(v){if(i(typeof v=="number"),i(v<67108864),v<0)return this.iaddn(-v);if(this.negative!==0)return this.negative=0,this.iaddn(v),this.negative=1,this;if(this.words[0]-=v,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var C=0;C<this.length&&this.words[C]<0;C++)this.words[C]+=67108864,this.words[C+1]-=1;return this._strip()},o.prototype.addn=function(v){return this.clone().iaddn(v)},o.prototype.subn=function(v){return this.clone().isubn(v)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(v,C,I){var B=v.length+I,J;this._expand(B);var Y,H=0;for(J=0;J<v.length;J++){Y=(this.words[J+I]|0)+H;var _=(v.words[J]|0)*C;Y-=_&67108863,H=(Y>>26)-(_/67108864|0),this.words[J+I]=Y&67108863}for(;J<this.length-I;J++)Y=(this.words[J+I]|0)+H,H=Y>>26,this.words[J+I]=Y&67108863;if(H===0)return this._strip();for(i(H===-1),H=0,J=0;J<this.length;J++)Y=-(this.words[J]|0)+H,H=Y>>26,this.words[J]=Y&67108863;return this.negative=1,this._strip()},o.prototype._wordDiv=function(v,C){var I=this.length-v.length,B=this.clone(),J=v,Y=J.words[J.length-1]|0,H=this._countBits(Y);I=26-H,I!==0&&(J=J.ushln(I),B.iushln(I),Y=J.words[J.length-1]|0);var _=B.length-J.length,m;if(C!=="mod"){m=new o(null),m.length=_+1,m.words=new Array(m.length);for(var b=0;b<m.length;b++)m.words[b]=0}var $=B.clone()._ishlnsubmul(J,1,_);$.negative===0&&(B=$,m&&(m.words[_]=1));for(var g=_-1;g>=0;g--){var O=(B.words[J.length+g]|0)*67108864+(B.words[J.length+g-1]|0);for(O=Math.min(O/Y|0,67108863),B._ishlnsubmul(J,O,g);B.negative!==0;)O--,B.negative=0,B._ishlnsubmul(J,1,g),B.isZero()||(B.negative^=1);m&&(m.words[g]=O)}return m&&m._strip(),B._strip(),C!=="div"&&I!==0&&B.iushrn(I),{div:m||null,mod:B}},o.prototype.divmod=function(v,C,I){if(i(!v.isZero()),this.isZero())return{div:new o(0),mod:new o(0)};var B,J,Y;return this.negative!==0&&v.negative===0?(Y=this.neg().divmod(v,C),C!=="mod"&&(B=Y.div.neg()),C!=="div"&&(J=Y.mod.neg(),I&&J.negative!==0&&J.iadd(v)),{div:B,mod:J}):this.negative===0&&v.negative!==0?(Y=this.divmod(v.neg(),C),C!=="mod"&&(B=Y.div.neg()),{div:B,mod:Y.mod}):this.negative&v.negative?(Y=this.neg().divmod(v.neg(),C),C!=="div"&&(J=Y.mod.neg(),I&&J.negative!==0&&J.isub(v)),{div:Y.div,mod:J}):v.length>this.length||this.cmp(v)<0?{div:new o(0),mod:this}:v.length===1?C==="div"?{div:this.divn(v.words[0]),mod:null}:C==="mod"?{div:null,mod:new o(this.modrn(v.words[0]))}:{div:this.divn(v.words[0]),mod:new o(this.modrn(v.words[0]))}:this._wordDiv(v,C)},o.prototype.div=function(v){return this.divmod(v,"div",!1).div},o.prototype.mod=function(v){return this.divmod(v,"mod",!1).mod},o.prototype.umod=function(v){return this.divmod(v,"mod",!0).mod},o.prototype.divRound=function(v){var C=this.divmod(v);if(C.mod.isZero())return C.div;var I=C.div.negative!==0?C.mod.isub(v):C.mod,B=v.ushrn(1),J=v.andln(1),Y=I.cmp(B);return Y<0||J===1&&Y===0?C.div:C.div.negative!==0?C.div.isubn(1):C.div.iaddn(1)},o.prototype.modrn=function(v){var C=v<0;C&&(v=-v),i(v<=67108863);for(var I=(1<<26)%v,B=0,J=this.length-1;J>=0;J--)B=(I*B+(this.words[J]|0))%v;return C?-B:B},o.prototype.modn=function(v){return this.modrn(v)},o.prototype.idivn=function(v){var C=v<0;C&&(v=-v),i(v<=67108863);for(var I=0,B=this.length-1;B>=0;B--){var J=(this.words[B]|0)+I*67108864;this.words[B]=J/v|0,I=J%v}return this._strip(),C?this.ineg():this},o.prototype.divn=function(v){return this.clone().idivn(v)},o.prototype.egcd=function(v){i(v.negative===0),i(!v.isZero());var C=this,I=v.clone();C.negative!==0?C=C.umod(v):C=C.clone();for(var B=new o(1),J=new o(0),Y=new o(0),H=new o(1),_=0;C.isEven()&&I.isEven();)C.iushrn(1),I.iushrn(1),++_;for(var m=I.clone(),b=C.clone();!C.isZero();){for(var $=0,g=1;!(C.words[0]&g)&&$<26;++$,g<<=1);if($>0)for(C.iushrn($);$-- >0;)(B.isOdd()||J.isOdd())&&(B.iadd(m),J.isub(b)),B.iushrn(1),J.iushrn(1);for(var O=0,te=1;!(I.words[0]&te)&&O<26;++O,te<<=1);if(O>0)for(I.iushrn(O);O-- >0;)(Y.isOdd()||H.isOdd())&&(Y.iadd(m),H.isub(b)),Y.iushrn(1),H.iushrn(1);C.cmp(I)>=0?(C.isub(I),B.isub(Y),J.isub(H)):(I.isub(C),Y.isub(B),H.isub(J))}return{a:Y,b:H,gcd:I.iushln(_)}},o.prototype._invmp=function(v){i(v.negative===0),i(!v.isZero());var C=this,I=v.clone();C.negative!==0?C=C.umod(v):C=C.clone();for(var B=new o(1),J=new o(0),Y=I.clone();C.cmpn(1)>0&&I.cmpn(1)>0;){for(var H=0,_=1;!(C.words[0]&_)&&H<26;++H,_<<=1);if(H>0)for(C.iushrn(H);H-- >0;)B.isOdd()&&B.iadd(Y),B.iushrn(1);for(var m=0,b=1;!(I.words[0]&b)&&m<26;++m,b<<=1);if(m>0)for(I.iushrn(m);m-- >0;)J.isOdd()&&J.iadd(Y),J.iushrn(1);C.cmp(I)>=0?(C.isub(I),B.isub(J)):(I.isub(C),J.isub(B))}var $;return C.cmpn(1)===0?$=B:$=J,$.cmpn(0)<0&&$.iadd(v),$},o.prototype.gcd=function(v){if(this.isZero())return v.abs();if(v.isZero())return this.abs();var C=this.clone(),I=v.clone();C.negative=0,I.negative=0;for(var B=0;C.isEven()&&I.isEven();B++)C.iushrn(1),I.iushrn(1);do{for(;C.isEven();)C.iushrn(1);for(;I.isEven();)I.iushrn(1);var J=C.cmp(I);if(J<0){var Y=C;C=I,I=Y}else if(J===0||I.cmpn(1)===0)break;C.isub(I)}while(!0);return I.iushln(B)},o.prototype.invm=function(v){return this.egcd(v).a.umod(v)},o.prototype.isEven=function(){return(this.words[0]&1)===0},o.prototype.isOdd=function(){return(this.words[0]&1)===1},o.prototype.andln=function(v){return this.words[0]&v},o.prototype.bincn=function(v){i(typeof v=="number");var C=v%26,I=(v-C)/26,B=1<<C;if(this.length<=I)return this._expand(I+1),this.words[I]|=B,this;for(var J=B,Y=I;J!==0&&Y<this.length;Y++){var H=this.words[Y]|0;H+=J,J=H>>>26,H&=67108863,this.words[Y]=H}return J!==0&&(this.words[Y]=J,this.length++),this},o.prototype.isZero=function(){return this.length===1&&this.words[0]===0},o.prototype.cmpn=function(v){var C=v<0;if(this.negative!==0&&!C)return-1;if(this.negative===0&&C)return 1;this._strip();var I;if(this.length>1)I=1;else{C&&(v=-v),i(v<=67108863,"Number is too big");var B=this.words[0]|0;I=B===v?0:B<v?-1:1}return this.negative!==0?-I|0:I},o.prototype.cmp=function(v){if(this.negative!==0&&v.negative===0)return-1;if(this.negative===0&&v.negative!==0)return 1;var C=this.ucmp(v);return this.negative!==0?-C|0:C},o.prototype.ucmp=function(v){if(this.length>v.length)return 1;if(this.length<v.length)return-1;for(var C=0,I=this.length-1;I>=0;I--){var B=this.words[I]|0,J=v.words[I]|0;if(B!==J){B<J?C=-1:B>J&&(C=1);break}}return C},o.prototype.gtn=function(v){return this.cmpn(v)===1},o.prototype.gt=function(v){return this.cmp(v)===1},o.prototype.gten=function(v){return this.cmpn(v)>=0},o.prototype.gte=function(v){return this.cmp(v)>=0},o.prototype.ltn=function(v){return this.cmpn(v)===-1},o.prototype.lt=function(v){return this.cmp(v)===-1},o.prototype.lten=function(v){return this.cmpn(v)<=0},o.prototype.lte=function(v){return this.cmp(v)<=0},o.prototype.eqn=function(v){return this.cmpn(v)===0},o.prototype.eq=function(v){return this.cmp(v)===0},o.red=function(v){return new xe(v)},o.prototype.toRed=function(v){return i(!this.red,"Already a number in reduction context"),i(this.negative===0,"red works only with positives"),v.convertTo(this)._forceRed(v)},o.prototype.fromRed=function(){return i(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(v){return this.red=v,this},o.prototype.forceRed=function(v){return i(!this.red,"Already a number in reduction context"),this._forceRed(v)},o.prototype.redAdd=function(v){return i(this.red,"redAdd works only with red numbers"),this.red.add(this,v)},o.prototype.redIAdd=function(v){return i(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,v)},o.prototype.redSub=function(v){return i(this.red,"redSub works only with red numbers"),this.red.sub(this,v)},o.prototype.redISub=function(v){return i(this.red,"redISub works only with red numbers"),this.red.isub(this,v)},o.prototype.redShl=function(v){return i(this.red,"redShl works only with red numbers"),this.red.shl(this,v)},o.prototype.redMul=function(v){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,v),this.red.mul(this,v)},o.prototype.redIMul=function(v){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,v),this.red.imul(this,v)},o.prototype.redSqr=function(){return i(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return i(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return i(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return i(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return i(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(v){return i(this.red&&!v.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,v)};var ee={k256:null,p224:null,p192:null,p25519:null};function W(F,v){this.name=F,this.p=new o(v,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}W.prototype._tmp=function(){var v=new o(null);return v.words=new Array(Math.ceil(this.n/13)),v},W.prototype.ireduce=function(v){var C=v,I;do this.split(C,this.tmp),C=this.imulK(C),C=C.iadd(this.tmp),I=C.bitLength();while(I>this.n);var B=I<this.n?-1:C.ucmp(this.p);return B===0?(C.words[0]=0,C.length=1):B>0?C.isub(this.p):C.strip!==void 0?C.strip():C._strip(),C},W.prototype.split=function(v,C){v.iushrn(this.n,0,C)},W.prototype.imulK=function(v){return v.imul(this.k)};function ie(){W.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}a(ie,W),ie.prototype.split=function(v,C){for(var I=4194303,B=Math.min(v.length,9),J=0;J<B;J++)C.words[J]=v.words[J];if(C.length=B,v.length<=9){v.words[0]=0,v.length=1;return}var Y=v.words[9];for(C.words[C.length++]=Y&I,J=10;J<v.length;J++){var H=v.words[J]|0;v.words[J-10]=(H&I)<<4|Y>>>22,Y=H}Y>>>=22,v.words[J-10]=Y,Y===0&&v.length>10?v.length-=10:v.length-=9},ie.prototype.imulK=function(v){v.words[v.length]=0,v.words[v.length+1]=0,v.length+=2;for(var C=0,I=0;I<v.length;I++){var B=v.words[I]|0;C+=B*977,v.words[I]=C&67108863,C=B*64+(C/67108864|0)}return v.words[v.length-1]===0&&(v.length--,v.words[v.length-1]===0&&v.length--),v};function fe(){W.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}a(fe,W);function ce(){W.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}a(ce,W);function ye(){W.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}a(ye,W),ye.prototype.imulK=function(v){for(var C=0,I=0;I<v.length;I++){var B=(v.words[I]|0)*19+C,J=B&67108863;B>>>=26,v.words[I]=J,C=B}return C!==0&&(v.words[v.length++]=C),v},o._prime=function(v){if(ee[v])return ee[v];var C;if(v==="k256")C=new ie;else if(v==="p224")C=new fe;else if(v==="p192")C=new ce;else if(v==="p25519")C=new ye;else throw new Error("Unknown prime "+v);return ee[v]=C,C};function xe(F){if(typeof F=="string"){var v=o._prime(F);this.m=v.p,this.prime=v}else i(F.gtn(1),"modulus must be greater than 1"),this.m=F,this.prime=null}xe.prototype._verify1=function(v){i(v.negative===0,"red works only with positives"),i(v.red,"red works only with red numbers")},xe.prototype._verify2=function(v,C){i((v.negative|C.negative)===0,"red works only with positives"),i(v.red&&v.red===C.red,"red works only with red numbers")},xe.prototype.imod=function(v){return this.prime?this.prime.ireduce(v)._forceRed(this):(h(v,v.umod(this.m)._forceRed(this)),v)},xe.prototype.neg=function(v){return v.isZero()?v.clone():this.m.sub(v)._forceRed(this)},xe.prototype.add=function(v,C){this._verify2(v,C);var I=v.add(C);return I.cmp(this.m)>=0&&I.isub(this.m),I._forceRed(this)},xe.prototype.iadd=function(v,C){this._verify2(v,C);var I=v.iadd(C);return I.cmp(this.m)>=0&&I.isub(this.m),I},xe.prototype.sub=function(v,C){this._verify2(v,C);var I=v.sub(C);return I.cmpn(0)<0&&I.iadd(this.m),I._forceRed(this)},xe.prototype.isub=function(v,C){this._verify2(v,C);var I=v.isub(C);return I.cmpn(0)<0&&I.iadd(this.m),I},xe.prototype.shl=function(v,C){return this._verify1(v),this.imod(v.ushln(C))},xe.prototype.imul=function(v,C){return this._verify2(v,C),this.imod(v.imul(C))},xe.prototype.mul=function(v,C){return this._verify2(v,C),this.imod(v.mul(C))},xe.prototype.isqr=function(v){return this.imul(v,v.clone())},xe.prototype.sqr=function(v){return this.mul(v,v)},xe.prototype.sqrt=function(v){if(v.isZero())return v.clone();var C=this.m.andln(3);if(i(C%2===1),C===3){var I=this.m.add(new o(1)).iushrn(2);return this.pow(v,I)}for(var B=this.m.subn(1),J=0;!B.isZero()&&B.andln(1)===0;)J++,B.iushrn(1);i(!B.isZero());var Y=new o(1).toRed(this),H=Y.redNeg(),_=this.m.subn(1).iushrn(1),m=this.m.bitLength();for(m=new o(2*m*m).toRed(this);this.pow(m,_).cmp(H)!==0;)m.redIAdd(H);for(var b=this.pow(m,B),$=this.pow(v,B.addn(1).iushrn(1)),g=this.pow(v,B),O=J;g.cmp(Y)!==0;){for(var te=g,Z=0;te.cmp(Y)!==0;Z++)te=te.redSqr();i(Z<O);var ae=this.pow(b,new o(1).iushln(O-Z-1));$=$.redMul(ae),b=ae.redSqr(),g=g.redMul(b),O=Z}return $},xe.prototype.invm=function(v){var C=v._invmp(this.m);return C.negative!==0?(C.negative=0,this.imod(C).redNeg()):this.imod(C)},xe.prototype.pow=function(v,C){if(C.isZero())return new o(1).toRed(this);if(C.cmpn(1)===0)return v.clone();var I=4,B=new Array(1<<I);B[0]=new o(1).toRed(this),B[1]=v;for(var J=2;J<B.length;J++)B[J]=this.mul(B[J-1],v);var Y=B[0],H=0,_=0,m=C.bitLength()%26;for(m===0&&(m=26),J=C.length-1;J>=0;J--){for(var b=C.words[J],$=m-1;$>=0;$--){var g=b>>$&1;if(Y!==B[0]&&(Y=this.sqr(Y)),g===0&&H===0){_=0;continue}H<<=1,H|=g,_++,!(_!==I&&(J!==0||$!==0))&&(Y=this.mul(Y,B[H]),_=0,H=0)}m=26}return Y},xe.prototype.convertTo=function(v){var C=v.umod(this.m);return C===v?C.clone():C},xe.prototype.convertFrom=function(v){var C=v.clone();return C.red=null,C},o.mont=function(v){return new Oe(v)};function Oe(F){xe.call(this,F),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}a(Oe,xe),Oe.prototype.convertTo=function(v){return this.imod(v.ushln(this.shift))},Oe.prototype.convertFrom=function(v){var C=this.imod(v.mul(this.rinv));return C.red=null,C},Oe.prototype.imul=function(v,C){if(v.isZero()||C.isZero())return v.words[0]=0,v.length=1,v;var I=v.imul(C),B=I.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),J=I.isub(B).iushrn(this.shift),Y=J;return J.cmp(this.m)>=0?Y=J.isub(this.m):J.cmpn(0)<0&&(Y=J.iadd(this.m)),Y._forceRed(this)},Oe.prototype.mul=function(v,C){if(v.isZero()||C.isZero())return new o(0)._forceRed(this);var I=v.mul(C),B=I.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),J=I.isub(B).iushrn(this.shift),Y=J;return J.cmp(this.m)>=0?Y=J.isub(this.m):J.cmpn(0)<0&&(Y=J.iadd(this.m)),Y._forceRed(this)},Oe.prototype.invm=function(v){var C=this.imod(v._invmp(this.m).mul(this.r2));return C._forceRed(this)}})(e,commonjsGlobal$1)})(bn);const BN$1=bnExports,version$h="bignumber/5.7.0";var BN=BN$1.BN;const logger$g=new Logger(version$h),_constructorGuard$1={},MAX_SAFE=9007199254740991;let _warnedToStringRadix=!1;class BigNumber{constructor(t,n){t!==_constructorGuard$1&&logger$g.throwError("cannot call constructor directly; use BigNumber.from",Logger.errors.UNSUPPORTED_OPERATION,{operation:"new (BigNumber)"}),this._hex=n,this._isBigNumber=!0,Object.freeze(this)}fromTwos(t){return toBigNumber(toBN(this).fromTwos(t))}toTwos(t){return toBigNumber(toBN(this).toTwos(t))}abs(){return this._hex[0]==="-"?BigNumber.from(this._hex.substring(1)):this}add(t){return toBigNumber(toBN(this).add(toBN(t)))}sub(t){return toBigNumber(toBN(this).sub(toBN(t)))}div(t){return BigNumber.from(t).isZero()&&throwFault("division-by-zero","div"),toBigNumber(toBN(this).div(toBN(t)))}mul(t){return toBigNumber(toBN(this).mul(toBN(t)))}mod(t){const n=toBN(t);return n.isNeg()&&throwFault("division-by-zero","mod"),toBigNumber(toBN(this).umod(n))}pow(t){const n=toBN(t);return n.isNeg()&&throwFault("negative-power","pow"),toBigNumber(toBN(this).pow(n))}and(t){const n=toBN(t);return(this.isNegative()||n.isNeg())&&throwFault("unbound-bitwise-result","and"),toBigNumber(toBN(this).and(n))}or(t){const n=toBN(t);return(this.isNegative()||n.isNeg())&&throwFault("unbound-bitwise-result","or"),toBigNumber(toBN(this).or(n))}xor(t){const n=toBN(t);return(this.isNegative()||n.isNeg())&&throwFault("unbound-bitwise-result","xor"),toBigNumber(toBN(this).xor(n))}mask(t){return(this.isNegative()||t<0)&&throwFault("negative-width","mask"),toBigNumber(toBN(this).maskn(t))}shl(t){return(this.isNegative()||t<0)&&throwFault("negative-width","shl"),toBigNumber(toBN(this).shln(t))}shr(t){return(this.isNegative()||t<0)&&throwFault("negative-width","shr"),toBigNumber(toBN(this).shrn(t))}eq(t){return toBN(this).eq(toBN(t))}lt(t){return toBN(this).lt(toBN(t))}lte(t){return toBN(this).lte(toBN(t))}gt(t){return toBN(this).gt(toBN(t))}gte(t){return toBN(this).gte(toBN(t))}isNegative(){return this._hex[0]==="-"}isZero(){return toBN(this).isZero()}toNumber(){try{return toBN(this).toNumber()}catch{throwFault("overflow","toNumber",this.toString())}return null}toBigInt(){try{return BigInt(this.toString())}catch{}return logger$g.throwError("this platform does not support BigInt",Logger.errors.UNSUPPORTED_OPERATION,{value:this.toString()})}toString(){return arguments.length>0&&(arguments[0]===10?_warnedToStringRadix||(_warnedToStringRadix=!0,logger$g.warn("BigNumber.toString does not accept any parameters; base-10 is assumed")):arguments[0]===16?logger$g.throwError("BigNumber.toString does not accept any parameters; use bigNumber.toHexString()",Logger.errors.UNEXPECTED_ARGUMENT,{}):logger$g.throwError("BigNumber.toString does not accept parameters",Logger.errors.UNEXPECTED_ARGUMENT,{})),toBN(this).toString(10)}toHexString(){return this._hex}toJSON(t){return{type:"BigNumber",hex:this.toHexString()}}static from(t){if(t instanceof BigNumber)return t;if(typeof t=="string")return t.match(/^-?0x[0-9a-f]+$/i)?new BigNumber(_constructorGuard$1,toHex$1(t)):t.match(/^-?[0-9]+$/)?new BigNumber(_constructorGuard$1,toHex$1(new BN(t))):logger$g.throwArgumentError("invalid BigNumber string","value",t);if(typeof t=="number")return t%1&&throwFault("underflow","BigNumber.from",t),(t>=MAX_SAFE||t<=-MAX_SAFE)&&throwFault("overflow","BigNumber.from",t),BigNumber.from(String(t));const n=t;if(typeof n=="bigint")return BigNumber.from(n.toString());if(isBytes(n))return BigNumber.from(hexlify(n));if(n)if(n.toHexString){const i=n.toHexString();if(typeof i=="string")return BigNumber.from(i)}else{let i=n._hex;if(i==null&&n.type==="BigNumber"&&(i=n.hex),typeof i=="string"&&(isHexString(i)||i[0]==="-"&&isHexString(i.substring(1))))return BigNumber.from(i)}return logger$g.throwArgumentError("invalid BigNumber value","value",t)}static isBigNumber(t){return!!(t&&t._isBigNumber)}}function toHex$1(e){if(typeof e!="string")return toHex$1(e.toString(16));if(e[0]==="-")return e=e.substring(1),e[0]==="-"&&logger$g.throwArgumentError("invalid hex","value",e),e=toHex$1(e),e==="0x00"?e:"-"+e;if(e.substring(0,2)!=="0x"&&(e="0x"+e),e==="0x")return"0x00";for(e.length%2&&(e="0x0"+e.substring(2));e.length>4&&e.substring(0,4)==="0x00";)e="0x"+e.substring(4);return e}function toBigNumber(e){return BigNumber.from(toHex$1(e))}function toBN(e){const t=BigNumber.from(e).toHexString();return t[0]==="-"?new BN("-"+t.substring(3),16):new BN(t.substring(2),16)}function throwFault(e,t,n){const i={fault:e,operation:t};return n!=null&&(i.value=n),logger$g.throwError(e,Logger.errors.NUMERIC_FAULT,i)}function _base36To16(e){return new BN(e,36).toString(16)}var sha3Exports={},sha3$1={get exports(){return sha3Exports},set exports(e){sha3Exports=e}};/**
 * [js-sha3]{@link https://github.com/emn178/js-sha3}
 *
 * @version 0.8.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2015-2018
 * @license MIT
 */(function(e){(function(){var t="input is invalid type",n="finalize already called",i=typeof window=="object",a=i?window:{};a.JS_SHA3_NO_WINDOW&&(i=!1);var o=!i&&typeof self=="object",c=!a.JS_SHA3_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;c?a=commonjsGlobal$1:o&&(a=self);var d=!a.JS_SHA3_NO_COMMON_JS&&!0&&e.exports,u=!a.JS_SHA3_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",l="0123456789abcdef".split(""),h=[31,7936,2031616,520093696],p=[4,1024,262144,67108864],y=[1,256,65536,16777216],E=[6,1536,393216,100663296],x=[0,8,16,24],S=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],k=[224,256,384,512],T=[128,256],L=["hex","buffer","arrayBuffer","array","digest"],q={128:168,256:136};(a.JS_SHA3_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(g){return Object.prototype.toString.call(g)==="[object Array]"}),u&&(a.JS_SHA3_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(g){return typeof g=="object"&&g.buffer&&g.buffer.constructor===ArrayBuffer});for(var U=function(g,O,te){return function(Z){return new m(g,O,g).update(Z)[te]()}},ee=function(g,O,te){return function(Z,ae){return new m(g,O,ae).update(Z)[te]()}},W=function(g,O,te){return function(Z,ae,be,ke){return v["cshake"+g].update(Z,ae,be,ke)[te]()}},ie=function(g,O,te){return function(Z,ae,be,ke){return v["kmac"+g].update(Z,ae,be,ke)[te]()}},fe=function(g,O,te,Z){for(var ae=0;ae<L.length;++ae){var be=L[ae];g[be]=O(te,Z,be)}return g},ce=function(g,O){var te=U(g,O,"hex");return te.create=function(){return new m(g,O,g)},te.update=function(Z){return te.create().update(Z)},fe(te,U,g,O)},ye=function(g,O){var te=ee(g,O,"hex");return te.create=function(Z){return new m(g,O,Z)},te.update=function(Z,ae){return te.create(ae).update(Z)},fe(te,ee,g,O)},xe=function(g,O){var te=q[g],Z=W(g,O,"hex");return Z.create=function(ae,be,ke){return!be&&!ke?v["shake"+g].create(ae):new m(g,O,ae).bytepad([be,ke],te)},Z.update=function(ae,be,ke,Ae){return Z.create(be,ke,Ae).update(ae)},fe(Z,W,g,O)},Oe=function(g,O){var te=q[g],Z=ie(g,O,"hex");return Z.create=function(ae,be,ke){return new b(g,O,be).bytepad(["KMAC",ke],te).bytepad([ae],te)},Z.update=function(ae,be,ke,Ae){return Z.create(ae,ke,Ae).update(be)},fe(Z,ie,g,O)},F=[{name:"keccak",padding:y,bits:k,createMethod:ce},{name:"sha3",padding:E,bits:k,createMethod:ce},{name:"shake",padding:h,bits:T,createMethod:ye},{name:"cshake",padding:p,bits:T,createMethod:xe},{name:"kmac",padding:p,bits:T,createMethod:Oe}],v={},C=[],I=0;I<F.length;++I)for(var B=F[I],J=B.bits,Y=0;Y<J.length;++Y){var H=B.name+"_"+J[Y];if(C.push(H),v[H]=B.createMethod(J[Y],B.padding),B.name!=="sha3"){var _=B.name+J[Y];C.push(_),v[_]=v[H]}}function m(g,O,te){this.blocks=[],this.s=[],this.padding=O,this.outputBits=te,this.reset=!0,this.finalized=!1,this.block=0,this.start=0,this.blockCount=1600-(g<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=te>>5,this.extraBytes=(te&31)>>3;for(var Z=0;Z<50;++Z)this.s[Z]=0}m.prototype.update=function(g){if(this.finalized)throw new Error(n);var O,te=typeof g;if(te!=="string"){if(te==="object"){if(g===null)throw new Error(t);if(u&&g.constructor===ArrayBuffer)g=new Uint8Array(g);else if(!Array.isArray(g)&&(!u||!ArrayBuffer.isView(g)))throw new Error(t)}else throw new Error(t);O=!0}for(var Z=this.blocks,ae=this.byteCount,be=g.length,ke=this.blockCount,Ae=0,dt=this.s,qe,et;Ae<be;){if(this.reset)for(this.reset=!1,Z[0]=this.block,qe=1;qe<ke+1;++qe)Z[qe]=0;if(O)for(qe=this.start;Ae<be&&qe<ae;++Ae)Z[qe>>2]|=g[Ae]<<x[qe++&3];else for(qe=this.start;Ae<be&&qe<ae;++Ae)et=g.charCodeAt(Ae),et<128?Z[qe>>2]|=et<<x[qe++&3]:et<2048?(Z[qe>>2]|=(192|et>>6)<<x[qe++&3],Z[qe>>2]|=(128|et&63)<<x[qe++&3]):et<55296||et>=57344?(Z[qe>>2]|=(224|et>>12)<<x[qe++&3],Z[qe>>2]|=(128|et>>6&63)<<x[qe++&3],Z[qe>>2]|=(128|et&63)<<x[qe++&3]):(et=65536+((et&1023)<<10|g.charCodeAt(++Ae)&1023),Z[qe>>2]|=(240|et>>18)<<x[qe++&3],Z[qe>>2]|=(128|et>>12&63)<<x[qe++&3],Z[qe>>2]|=(128|et>>6&63)<<x[qe++&3],Z[qe>>2]|=(128|et&63)<<x[qe++&3]);if(this.lastByteIndex=qe,qe>=ae){for(this.start=qe-ae,this.block=Z[ke],qe=0;qe<ke;++qe)dt[qe]^=Z[qe];$(dt),this.reset=!0}else this.start=qe}return this},m.prototype.encode=function(g,O){var te=g&255,Z=1,ae=[te];for(g=g>>8,te=g&255;te>0;)ae.unshift(te),g=g>>8,te=g&255,++Z;return O?ae.push(Z):ae.unshift(Z),this.update(ae),ae.length},m.prototype.encodeString=function(g){var O,te=typeof g;if(te!=="string"){if(te==="object"){if(g===null)throw new Error(t);if(u&&g.constructor===ArrayBuffer)g=new Uint8Array(g);else if(!Array.isArray(g)&&(!u||!ArrayBuffer.isView(g)))throw new Error(t)}else throw new Error(t);O=!0}var Z=0,ae=g.length;if(O)Z=ae;else for(var be=0;be<g.length;++be){var ke=g.charCodeAt(be);ke<128?Z+=1:ke<2048?Z+=2:ke<55296||ke>=57344?Z+=3:(ke=65536+((ke&1023)<<10|g.charCodeAt(++be)&1023),Z+=4)}return Z+=this.encode(Z*8),this.update(g),Z},m.prototype.bytepad=function(g,O){for(var te=this.encode(O),Z=0;Z<g.length;++Z)te+=this.encodeString(g[Z]);var ae=O-te%O,be=[];return be.length=ae,this.update(be),this},m.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var g=this.blocks,O=this.lastByteIndex,te=this.blockCount,Z=this.s;if(g[O>>2]|=this.padding[O&3],this.lastByteIndex===this.byteCount)for(g[0]=g[te],O=1;O<te+1;++O)g[O]=0;for(g[te-1]|=2147483648,O=0;O<te;++O)Z[O]^=g[O];$(Z)}},m.prototype.toString=m.prototype.hex=function(){this.finalize();for(var g=this.blockCount,O=this.s,te=this.outputBlocks,Z=this.extraBytes,ae=0,be=0,ke="",Ae;be<te;){for(ae=0;ae<g&&be<te;++ae,++be)Ae=O[ae],ke+=l[Ae>>4&15]+l[Ae&15]+l[Ae>>12&15]+l[Ae>>8&15]+l[Ae>>20&15]+l[Ae>>16&15]+l[Ae>>28&15]+l[Ae>>24&15];be%g===0&&($(O),ae=0)}return Z&&(Ae=O[ae],ke+=l[Ae>>4&15]+l[Ae&15],Z>1&&(ke+=l[Ae>>12&15]+l[Ae>>8&15]),Z>2&&(ke+=l[Ae>>20&15]+l[Ae>>16&15])),ke},m.prototype.arrayBuffer=function(){this.finalize();var g=this.blockCount,O=this.s,te=this.outputBlocks,Z=this.extraBytes,ae=0,be=0,ke=this.outputBits>>3,Ae;Z?Ae=new ArrayBuffer(te+1<<2):Ae=new ArrayBuffer(ke);for(var dt=new Uint32Array(Ae);be<te;){for(ae=0;ae<g&&be<te;++ae,++be)dt[be]=O[ae];be%g===0&&$(O)}return Z&&(dt[ae]=O[ae],Ae=Ae.slice(0,ke)),Ae},m.prototype.buffer=m.prototype.arrayBuffer,m.prototype.digest=m.prototype.array=function(){this.finalize();for(var g=this.blockCount,O=this.s,te=this.outputBlocks,Z=this.extraBytes,ae=0,be=0,ke=[],Ae,dt;be<te;){for(ae=0;ae<g&&be<te;++ae,++be)Ae=be<<2,dt=O[ae],ke[Ae]=dt&255,ke[Ae+1]=dt>>8&255,ke[Ae+2]=dt>>16&255,ke[Ae+3]=dt>>24&255;be%g===0&&$(O)}return Z&&(Ae=be<<2,dt=O[ae],ke[Ae]=dt&255,Z>1&&(ke[Ae+1]=dt>>8&255),Z>2&&(ke[Ae+2]=dt>>16&255)),ke};function b(g,O,te){m.call(this,g,O,te)}b.prototype=new m,b.prototype.finalize=function(){return this.encode(this.outputBits,!0),m.prototype.finalize.call(this)};var $=function(g){var O,te,Z,ae,be,ke,Ae,dt,qe,et,Ke,gt,at,Lt,Ge,st,Qe,We,ze,ut,rt,Ze,er,Ye,yt,Vt,$t,bt,Zt,Rt,kt,jt,Pt,Nt,tr,Ot,vt,rr,St,G,M,X,oe,ve,Ce,Me,He,Je,j,V,Q,se,pe,De,Ee,nt,Te,ct,Ne,Le,wt,ot,At;for(Z=0;Z<48;Z+=2)ae=g[0]^g[10]^g[20]^g[30]^g[40],be=g[1]^g[11]^g[21]^g[31]^g[41],ke=g[2]^g[12]^g[22]^g[32]^g[42],Ae=g[3]^g[13]^g[23]^g[33]^g[43],dt=g[4]^g[14]^g[24]^g[34]^g[44],qe=g[5]^g[15]^g[25]^g[35]^g[45],et=g[6]^g[16]^g[26]^g[36]^g[46],Ke=g[7]^g[17]^g[27]^g[37]^g[47],gt=g[8]^g[18]^g[28]^g[38]^g[48],at=g[9]^g[19]^g[29]^g[39]^g[49],O=gt^(ke<<1|Ae>>>31),te=at^(Ae<<1|ke>>>31),g[0]^=O,g[1]^=te,g[10]^=O,g[11]^=te,g[20]^=O,g[21]^=te,g[30]^=O,g[31]^=te,g[40]^=O,g[41]^=te,O=ae^(dt<<1|qe>>>31),te=be^(qe<<1|dt>>>31),g[2]^=O,g[3]^=te,g[12]^=O,g[13]^=te,g[22]^=O,g[23]^=te,g[32]^=O,g[33]^=te,g[42]^=O,g[43]^=te,O=ke^(et<<1|Ke>>>31),te=Ae^(Ke<<1|et>>>31),g[4]^=O,g[5]^=te,g[14]^=O,g[15]^=te,g[24]^=O,g[25]^=te,g[34]^=O,g[35]^=te,g[44]^=O,g[45]^=te,O=dt^(gt<<1|at>>>31),te=qe^(at<<1|gt>>>31),g[6]^=O,g[7]^=te,g[16]^=O,g[17]^=te,g[26]^=O,g[27]^=te,g[36]^=O,g[37]^=te,g[46]^=O,g[47]^=te,O=et^(ae<<1|be>>>31),te=Ke^(be<<1|ae>>>31),g[8]^=O,g[9]^=te,g[18]^=O,g[19]^=te,g[28]^=O,g[29]^=te,g[38]^=O,g[39]^=te,g[48]^=O,g[49]^=te,Lt=g[0],Ge=g[1],Me=g[11]<<4|g[10]>>>28,He=g[10]<<4|g[11]>>>28,bt=g[20]<<3|g[21]>>>29,Zt=g[21]<<3|g[20]>>>29,Le=g[31]<<9|g[30]>>>23,wt=g[30]<<9|g[31]>>>23,X=g[40]<<18|g[41]>>>14,oe=g[41]<<18|g[40]>>>14,Nt=g[2]<<1|g[3]>>>31,tr=g[3]<<1|g[2]>>>31,st=g[13]<<12|g[12]>>>20,Qe=g[12]<<12|g[13]>>>20,Je=g[22]<<10|g[23]>>>22,j=g[23]<<10|g[22]>>>22,Rt=g[33]<<13|g[32]>>>19,kt=g[32]<<13|g[33]>>>19,ot=g[42]<<2|g[43]>>>30,At=g[43]<<2|g[42]>>>30,De=g[5]<<30|g[4]>>>2,Ee=g[4]<<30|g[5]>>>2,Ot=g[14]<<6|g[15]>>>26,vt=g[15]<<6|g[14]>>>26,We=g[25]<<11|g[24]>>>21,ze=g[24]<<11|g[25]>>>21,V=g[34]<<15|g[35]>>>17,Q=g[35]<<15|g[34]>>>17,jt=g[45]<<29|g[44]>>>3,Pt=g[44]<<29|g[45]>>>3,Ye=g[6]<<28|g[7]>>>4,yt=g[7]<<28|g[6]>>>4,nt=g[17]<<23|g[16]>>>9,Te=g[16]<<23|g[17]>>>9,rr=g[26]<<25|g[27]>>>7,St=g[27]<<25|g[26]>>>7,ut=g[36]<<21|g[37]>>>11,rt=g[37]<<21|g[36]>>>11,se=g[47]<<24|g[46]>>>8,pe=g[46]<<24|g[47]>>>8,ve=g[8]<<27|g[9]>>>5,Ce=g[9]<<27|g[8]>>>5,Vt=g[18]<<20|g[19]>>>12,$t=g[19]<<20|g[18]>>>12,ct=g[29]<<7|g[28]>>>25,Ne=g[28]<<7|g[29]>>>25,G=g[38]<<8|g[39]>>>24,M=g[39]<<8|g[38]>>>24,Ze=g[48]<<14|g[49]>>>18,er=g[49]<<14|g[48]>>>18,g[0]=Lt^~st&We,g[1]=Ge^~Qe&ze,g[10]=Ye^~Vt&bt,g[11]=yt^~$t&Zt,g[20]=Nt^~Ot&rr,g[21]=tr^~vt&St,g[30]=ve^~Me&Je,g[31]=Ce^~He&j,g[40]=De^~nt&ct,g[41]=Ee^~Te&Ne,g[2]=st^~We&ut,g[3]=Qe^~ze&rt,g[12]=Vt^~bt&Rt,g[13]=$t^~Zt&kt,g[22]=Ot^~rr&G,g[23]=vt^~St&M,g[32]=Me^~Je&V,g[33]=He^~j&Q,g[42]=nt^~ct&Le,g[43]=Te^~Ne&wt,g[4]=We^~ut&Ze,g[5]=ze^~rt&er,g[14]=bt^~Rt&jt,g[15]=Zt^~kt&Pt,g[24]=rr^~G&X,g[25]=St^~M&oe,g[34]=Je^~V&se,g[35]=j^~Q&pe,g[44]=ct^~Le&ot,g[45]=Ne^~wt&At,g[6]=ut^~Ze&Lt,g[7]=rt^~er&Ge,g[16]=Rt^~jt&Ye,g[17]=kt^~Pt&yt,g[26]=G^~X&Nt,g[27]=M^~oe&tr,g[36]=V^~se&ve,g[37]=Q^~pe&Ce,g[46]=Le^~ot&De,g[47]=wt^~At&Ee,g[8]=Ze^~Lt&st,g[9]=er^~Ge&Qe,g[18]=jt^~Ye&Vt,g[19]=Pt^~yt&$t,g[28]=X^~Nt&Ot,g[29]=oe^~tr&vt,g[38]=se^~ve&Me,g[39]=pe^~Ce&He,g[48]=ot^~De&nt,g[49]=At^~Ee&Te,g[0]^=S[Z],g[1]^=S[Z+1]};if(d)e.exports=v;else for(I=0;I<C.length;++I)a[C[I]]=v[C[I]]})()})(sha3$1);const sha3=sha3Exports;function keccak256(e){return"0x"+sha3.keccak_256(arrayify(e))}const version$g="rlp/5.7.0",logger$f=new Logger(version$g);function arrayifyInteger(e){const t=[];for(;e;)t.unshift(e&255),e>>=8;return t}function _encode(e){if(Array.isArray(e)){let i=[];if(e.forEach(function(o){i=i.concat(_encode(o))}),i.length<=55)return i.unshift(192+i.length),i;const a=arrayifyInteger(i.length);return a.unshift(247+a.length),a.concat(i)}isBytesLike(e)||logger$f.throwArgumentError("RLP object must be BytesLike","object",e);const t=Array.prototype.slice.call(arrayify(e));if(t.length===1&&t[0]<=127)return t;if(t.length<=55)return t.unshift(128+t.length),t;const n=arrayifyInteger(t.length);return n.unshift(183+n.length),n.concat(t)}function encode(e){return hexlify(_encode(e))}const version$f="address/5.7.0",logger$e=new Logger(version$f);function getChecksumAddress(e){isHexString(e,20)||logger$e.throwArgumentError("invalid address","address",e),e=e.toLowerCase();const t=e.substring(2).split(""),n=new Uint8Array(40);for(let a=0;a<40;a++)n[a]=t[a].charCodeAt(0);const i=arrayify(keccak256(n));for(let a=0;a<40;a+=2)i[a>>1]>>4>=8&&(t[a]=t[a].toUpperCase()),(i[a>>1]&15)>=8&&(t[a+1]=t[a+1].toUpperCase());return"0x"+t.join("")}const MAX_SAFE_INTEGER=9007199254740991;function log10(e){return Math.log10?Math.log10(e):Math.log(e)/Math.LN10}const ibanLookup={};for(let e=0;e<10;e++)ibanLookup[String(e)]=String(e);for(let e=0;e<26;e++)ibanLookup[String.fromCharCode(65+e)]=String(10+e);const safeDigits=Math.floor(log10(MAX_SAFE_INTEGER));function ibanChecksum(e){e=e.toUpperCase(),e=e.substring(4)+e.substring(0,2)+"00";let t=e.split("").map(i=>ibanLookup[i]).join("");for(;t.length>=safeDigits;){let i=t.substring(0,safeDigits);t=parseInt(i,10)%97+t.substring(i.length)}let n=String(98-parseInt(t,10)%97);for(;n.length<2;)n="0"+n;return n}function getAddress(e){let t=null;if(typeof e!="string"&&logger$e.throwArgumentError("invalid address","address",e),e.match(/^(0x)?[0-9a-fA-F]{40}$/))e.substring(0,2)!=="0x"&&(e="0x"+e),t=getChecksumAddress(e),e.match(/([A-F].*[a-f])|([a-f].*[A-F])/)&&t!==e&&logger$e.throwArgumentError("bad address checksum","address",e);else if(e.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){for(e.substring(2,4)!==ibanChecksum(e)&&logger$e.throwArgumentError("bad icap checksum","address",e),t=_base36To16(e.substring(4));t.length<40;)t="0"+t;t=getChecksumAddress("0x"+t)}else logger$e.throwArgumentError("invalid address","address",e);return t}const version$e="properties/5.7.0";var __awaiter$5=globalThis&&globalThis.__awaiter||function(e,t,n,i){function a(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function d(h){try{l(i.next(h))}catch(p){c(p)}}function u(h){try{l(i.throw(h))}catch(p){c(p)}}function l(h){h.done?o(h.value):a(h.value).then(d,u)}l((i=i.apply(e,t||[])).next())})};const logger$d=new Logger(version$e);function defineReadOnly(e,t,n){Object.defineProperty(e,t,{enumerable:!0,value:n,writable:!1})}function resolveProperties(e){return __awaiter$5(this,void 0,void 0,function*(){const t=Object.keys(e).map(i=>{const a=e[i];return Promise.resolve(a).then(o=>({key:i,value:o}))});return(yield Promise.all(t)).reduce((i,a)=>(i[a.key]=a.value,i),{})})}function checkProperties(e,t){(!e||typeof e!="object")&&logger$d.throwArgumentError("invalid object","object",e),Object.keys(e).forEach(n=>{t[n]||logger$d.throwArgumentError("invalid object key - "+n,"transaction:"+n,e)})}function shallowCopy(e){const t={};for(const n in e)t[n]=e[n];return t}const opaque={bigint:!0,boolean:!0,function:!0,number:!0,string:!0};function _isFrozen(e){if(e==null||opaque[typeof e])return!0;if(Array.isArray(e)||typeof e=="object"){if(!Object.isFrozen(e))return!1;const t=Object.keys(e);for(let n=0;n<t.length;n++){let i=null;try{i=e[t[n]]}catch{continue}if(!_isFrozen(i))return!1}return!0}return logger$d.throwArgumentError(`Cannot deepCopy ${typeof e}`,"object",e)}function _deepCopy(e){if(_isFrozen(e))return e;if(Array.isArray(e))return Object.freeze(e.map(t=>deepCopy(t)));if(typeof e=="object"){const t={};for(const n in e){const i=e[n];i!==void 0&&defineReadOnly(t,n,deepCopy(i))}return t}return logger$d.throwArgumentError(`Cannot deepCopy ${typeof e}`,"object",e)}function deepCopy(e){return _deepCopy(e)}class Description{constructor(t){for(const n in t)this[n]=deepCopy(t[n])}}const version$d="abstract-provider/5.7.0";var __awaiter$4=globalThis&&globalThis.__awaiter||function(e,t,n,i){function a(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function d(h){try{l(i.next(h))}catch(p){c(p)}}function u(h){try{l(i.throw(h))}catch(p){c(p)}}function l(h){h.done?o(h.value):a(h.value).then(d,u)}l((i=i.apply(e,t||[])).next())})};const logger$c=new Logger(version$d);class Provider{constructor(){logger$c.checkAbstract(new.target,Provider),defineReadOnly(this,"_isProvider",!0)}getFeeData(){return __awaiter$4(this,void 0,void 0,function*(){const{block:t,gasPrice:n}=yield resolveProperties({block:this.getBlock("latest"),gasPrice:this.getGasPrice().catch(c=>null)});let i=null,a=null,o=null;return t&&t.baseFeePerGas&&(i=t.baseFeePerGas,o=BigNumber.from("1500000000"),a=t.baseFeePerGas.mul(2).add(o)),{lastBaseFeePerGas:i,maxFeePerGas:a,maxPriorityFeePerGas:o,gasPrice:n}})}addListener(t,n){return this.on(t,n)}removeListener(t,n){return this.off(t,n)}static isProvider(t){return!!(t&&t._isProvider)}}const version$c="abstract-signer/5.7.0";var __awaiter$3=globalThis&&globalThis.__awaiter||function(e,t,n,i){function a(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function d(h){try{l(i.next(h))}catch(p){c(p)}}function u(h){try{l(i.throw(h))}catch(p){c(p)}}function l(h){h.done?o(h.value):a(h.value).then(d,u)}l((i=i.apply(e,t||[])).next())})};const logger$b=new Logger(version$c),allowedTransactionKeys$1=["accessList","ccipReadEnabled","chainId","customData","data","from","gasLimit","gasPrice","maxFeePerGas","maxPriorityFeePerGas","nonce","to","type","value"],forwardErrors=[Logger.errors.INSUFFICIENT_FUNDS,Logger.errors.NONCE_EXPIRED,Logger.errors.REPLACEMENT_UNDERPRICED];class Signer{constructor(){logger$b.checkAbstract(new.target,Signer),defineReadOnly(this,"_isSigner",!0)}getBalance(t){return __awaiter$3(this,void 0,void 0,function*(){return this._checkProvider("getBalance"),yield this.provider.getBalance(this.getAddress(),t)})}getTransactionCount(t){return __awaiter$3(this,void 0,void 0,function*(){return this._checkProvider("getTransactionCount"),yield this.provider.getTransactionCount(this.getAddress(),t)})}estimateGas(t){return __awaiter$3(this,void 0,void 0,function*(){this._checkProvider("estimateGas");const n=yield resolveProperties(this.checkTransaction(t));return yield this.provider.estimateGas(n)})}call(t,n){return __awaiter$3(this,void 0,void 0,function*(){this._checkProvider("call");const i=yield resolveProperties(this.checkTransaction(t));return yield this.provider.call(i,n)})}sendTransaction(t){return __awaiter$3(this,void 0,void 0,function*(){this._checkProvider("sendTransaction");const n=yield this.populateTransaction(t),i=yield this.signTransaction(n);return yield this.provider.sendTransaction(i)})}getChainId(){return __awaiter$3(this,void 0,void 0,function*(){return this._checkProvider("getChainId"),(yield this.provider.getNetwork()).chainId})}getGasPrice(){return __awaiter$3(this,void 0,void 0,function*(){return this._checkProvider("getGasPrice"),yield this.provider.getGasPrice()})}getFeeData(){return __awaiter$3(this,void 0,void 0,function*(){return this._checkProvider("getFeeData"),yield this.provider.getFeeData()})}resolveName(t){return __awaiter$3(this,void 0,void 0,function*(){return this._checkProvider("resolveName"),yield this.provider.resolveName(t)})}checkTransaction(t){for(const i in t)allowedTransactionKeys$1.indexOf(i)===-1&&logger$b.throwArgumentError("invalid transaction key: "+i,"transaction",t);const n=shallowCopy(t);return n.from==null?n.from=this.getAddress():n.from=Promise.all([Promise.resolve(n.from),this.getAddress()]).then(i=>(i[0].toLowerCase()!==i[1].toLowerCase()&&logger$b.throwArgumentError("from address mismatch","transaction",t),i[0])),n}populateTransaction(t){return __awaiter$3(this,void 0,void 0,function*(){const n=yield resolveProperties(this.checkTransaction(t));n.to!=null&&(n.to=Promise.resolve(n.to).then(a=>__awaiter$3(this,void 0,void 0,function*(){if(a==null)return null;const o=yield this.resolveName(a);return o==null&&logger$b.throwArgumentError("provided ENS name resolves to null","tx.to",a),o})),n.to.catch(a=>{}));const i=n.maxFeePerGas!=null||n.maxPriorityFeePerGas!=null;if(n.gasPrice!=null&&(n.type===2||i)?logger$b.throwArgumentError("eip-1559 transaction do not support gasPrice","transaction",t):(n.type===0||n.type===1)&&i&&logger$b.throwArgumentError("pre-eip-1559 transaction do not support maxFeePerGas/maxPriorityFeePerGas","transaction",t),(n.type===2||n.type==null)&&n.maxFeePerGas!=null&&n.maxPriorityFeePerGas!=null)n.type=2;else if(n.type===0||n.type===1)n.gasPrice==null&&(n.gasPrice=this.getGasPrice());else{const a=yield this.getFeeData();if(n.type==null)if(a.maxFeePerGas!=null&&a.maxPriorityFeePerGas!=null)if(n.type=2,n.gasPrice!=null){const o=n.gasPrice;delete n.gasPrice,n.maxFeePerGas=o,n.maxPriorityFeePerGas=o}else n.maxFeePerGas==null&&(n.maxFeePerGas=a.maxFeePerGas),n.maxPriorityFeePerGas==null&&(n.maxPriorityFeePerGas=a.maxPriorityFeePerGas);else a.gasPrice!=null?(i&&logger$b.throwError("network does not support EIP-1559",Logger.errors.UNSUPPORTED_OPERATION,{operation:"populateTransaction"}),n.gasPrice==null&&(n.gasPrice=a.gasPrice),n.type=0):logger$b.throwError("failed to get consistent fee data",Logger.errors.UNSUPPORTED_OPERATION,{operation:"signer.getFeeData"});else n.type===2&&(n.maxFeePerGas==null&&(n.maxFeePerGas=a.maxFeePerGas),n.maxPriorityFeePerGas==null&&(n.maxPriorityFeePerGas=a.maxPriorityFeePerGas))}return n.nonce==null&&(n.nonce=this.getTransactionCount("pending")),n.gasLimit==null&&(n.gasLimit=this.estimateGas(n).catch(a=>{if(forwardErrors.indexOf(a.code)>=0)throw a;return logger$b.throwError("cannot estimate gas; transaction may fail or may require manual gas limit",Logger.errors.UNPREDICTABLE_GAS_LIMIT,{error:a,tx:n})})),n.chainId==null?n.chainId=this.getChainId():n.chainId=Promise.all([Promise.resolve(n.chainId),this.getChainId()]).then(a=>(a[1]!==0&&a[0]!==a[1]&&logger$b.throwArgumentError("chainId address mismatch","transaction",t),a[0])),yield resolveProperties(n)})}_checkProvider(t){this.provider||logger$b.throwError("missing provider",Logger.errors.UNSUPPORTED_OPERATION,{operation:t||"_checkProvider"})}static isSigner(t){return!!(t&&t._isSigner)}}const version$b="strings/5.7.0",logger$a=new Logger(version$b);var UnicodeNormalizationForm;(function(e){e.current="",e.NFC="NFC",e.NFD="NFD",e.NFKC="NFKC",e.NFKD="NFKD"})(UnicodeNormalizationForm||(UnicodeNormalizationForm={}));var Utf8ErrorReason;(function(e){e.UNEXPECTED_CONTINUE="unexpected continuation byte",e.BAD_PREFIX="bad codepoint prefix",e.OVERRUN="string overrun",e.MISSING_CONTINUE="missing continuation byte",e.OUT_OF_RANGE="out of UTF-8 range",e.UTF16_SURROGATE="UTF-16 surrogate",e.OVERLONG="overlong representation"})(Utf8ErrorReason||(Utf8ErrorReason={}));function toUtf8Bytes(e,t=UnicodeNormalizationForm.current){t!=UnicodeNormalizationForm.current&&(logger$a.checkNormalize(),e=e.normalize(t));let n=[];for(let i=0;i<e.length;i++){const a=e.charCodeAt(i);if(a<128)n.push(a);else if(a<2048)n.push(a>>6|192),n.push(a&63|128);else if((a&64512)==55296){i++;const o=e.charCodeAt(i);if(i>=e.length||(o&64512)!==56320)throw new Error("invalid utf-8 string");const c=65536+((a&1023)<<10)+(o&1023);n.push(c>>18|240),n.push(c>>12&63|128),n.push(c>>6&63|128),n.push(c&63|128)}else n.push(a>>12|224),n.push(a>>6&63|128),n.push(a&63|128)}return arrayify(n)}function id(e){return keccak256(toUtf8Bytes(e))}const version$a="hash/5.7.0",messagePrefix=`Ethereum Signed Message:
`;function hashMessage(e){return typeof e=="string"&&(e=toUtf8Bytes(e)),keccak256(concat([toUtf8Bytes(messagePrefix),toUtf8Bytes(String(e.length)),e]))}var __awaiter$2=globalThis&&globalThis.__awaiter||function(e,t,n,i){function a(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function d(h){try{l(i.next(h))}catch(p){c(p)}}function u(h){try{l(i.throw(h))}catch(p){c(p)}}function l(h){h.done?o(h.value):a(h.value).then(d,u)}l((i=i.apply(e,t||[])).next())})};const logger$9=new Logger(version$a),padding=new Uint8Array(32);padding.fill(0);const NegativeOne=BigNumber.from(-1),Zero=BigNumber.from(0),One=BigNumber.from(1),MaxUint256=BigNumber.from("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function hexPadRight(e){const t=arrayify(e),n=t.length%32;return n?hexConcat([t,padding.slice(n)]):hexlify(t)}const hexTrue=hexZeroPad(One.toHexString(),32),hexFalse=hexZeroPad(Zero.toHexString(),32),domainFieldTypes={name:"string",version:"string",chainId:"uint256",verifyingContract:"address",salt:"bytes32"},domainFieldNames=["name","version","chainId","verifyingContract","salt"];function checkString(e){return function(t){return typeof t!="string"&&logger$9.throwArgumentError(`invalid domain value for ${JSON.stringify(e)}`,`domain.${e}`,t),t}}const domainChecks={name:checkString("name"),version:checkString("version"),chainId:function(e){try{return BigNumber.from(e).toString()}catch{}return logger$9.throwArgumentError('invalid domain value for "chainId"',"domain.chainId",e)},verifyingContract:function(e){try{return getAddress(e).toLowerCase()}catch{}return logger$9.throwArgumentError('invalid domain value "verifyingContract"',"domain.verifyingContract",e)},salt:function(e){try{const t=arrayify(e);if(t.length!==32)throw new Error("bad length");return hexlify(t)}catch{}return logger$9.throwArgumentError('invalid domain value "salt"',"domain.salt",e)}};function getBaseEncoder(e){{const t=e.match(/^(u?)int(\d*)$/);if(t){const n=t[1]==="",i=parseInt(t[2]||"256");(i%8!==0||i>256||t[2]&&t[2]!==String(i))&&logger$9.throwArgumentError("invalid numeric width","type",e);const a=MaxUint256.mask(n?i-1:i),o=n?a.add(One).mul(NegativeOne):Zero;return function(c){const d=BigNumber.from(c);return(d.lt(o)||d.gt(a))&&logger$9.throwArgumentError(`value out-of-bounds for ${e}`,"value",c),hexZeroPad(d.toTwos(256).toHexString(),32)}}}{const t=e.match(/^bytes(\d+)$/);if(t){const n=parseInt(t[1]);return(n===0||n>32||t[1]!==String(n))&&logger$9.throwArgumentError("invalid bytes width","type",e),function(i){return arrayify(i).length!==n&&logger$9.throwArgumentError(`invalid length for ${e}`,"value",i),hexPadRight(i)}}}switch(e){case"address":return function(t){return hexZeroPad(getAddress(t),32)};case"bool":return function(t){return t?hexTrue:hexFalse};case"bytes":return function(t){return keccak256(t)};case"string":return function(t){return id(t)}}return null}function encodeType(e,t){return`${e}(${t.map(({name:n,type:i})=>i+" "+n).join(",")})`}class TypedDataEncoder{constructor(t){defineReadOnly(this,"types",Object.freeze(deepCopy(t))),defineReadOnly(this,"_encoderCache",{}),defineReadOnly(this,"_types",{});const n={},i={},a={};Object.keys(t).forEach(d=>{n[d]={},i[d]=[],a[d]={}});for(const d in t){const u={};t[d].forEach(l=>{u[l.name]&&logger$9.throwArgumentError(`duplicate variable name ${JSON.stringify(l.name)} in ${JSON.stringify(d)}`,"types",t),u[l.name]=!0;const h=l.type.match(/^([^\x5b]*)(\x5b|$)/)[1];h===d&&logger$9.throwArgumentError(`circular type reference to ${JSON.stringify(h)}`,"types",t),!getBaseEncoder(h)&&(i[h]||logger$9.throwArgumentError(`unknown type ${JSON.stringify(h)}`,"types",t),i[h].push(d),n[d][h]=!0)})}const o=Object.keys(i).filter(d=>i[d].length===0);o.length===0?logger$9.throwArgumentError("missing primary type","types",t):o.length>1&&logger$9.throwArgumentError(`ambiguous primary types or unused types: ${o.map(d=>JSON.stringify(d)).join(", ")}`,"types",t),defineReadOnly(this,"primaryType",o[0]);function c(d,u){u[d]&&logger$9.throwArgumentError(`circular type reference to ${JSON.stringify(d)}`,"types",t),u[d]=!0,Object.keys(n[d]).forEach(l=>{i[l]&&(c(l,u),Object.keys(u).forEach(h=>{a[h][l]=!0}))}),delete u[d]}c(this.primaryType,{});for(const d in a){const u=Object.keys(a[d]);u.sort(),this._types[d]=encodeType(d,t[d])+u.map(l=>encodeType(l,t[l])).join("")}}getEncoder(t){let n=this._encoderCache[t];return n||(n=this._encoderCache[t]=this._getEncoder(t)),n}_getEncoder(t){{const a=getBaseEncoder(t);if(a)return a}const n=t.match(/^(.*)(\x5b(\d*)\x5d)$/);if(n){const a=n[1],o=this.getEncoder(a),c=parseInt(n[3]);return d=>{c>=0&&d.length!==c&&logger$9.throwArgumentError("array length mismatch; expected length ${ arrayLength }","value",d);let u=d.map(o);return this._types[a]&&(u=u.map(keccak256)),keccak256(hexConcat(u))}}const i=this.types[t];if(i){const a=id(this._types[t]);return o=>{const c=i.map(({name:d,type:u})=>{const l=this.getEncoder(u)(o[d]);return this._types[u]?keccak256(l):l});return c.unshift(a),hexConcat(c)}}return logger$9.throwArgumentError(`unknown type: ${t}`,"type",t)}encodeType(t){const n=this._types[t];return n||logger$9.throwArgumentError(`unknown type: ${JSON.stringify(t)}`,"name",t),n}encodeData(t,n){return this.getEncoder(t)(n)}hashStruct(t,n){return keccak256(this.encodeData(t,n))}encode(t){return this.encodeData(this.primaryType,t)}hash(t){return this.hashStruct(this.primaryType,t)}_visit(t,n,i){if(getBaseEncoder(t))return i(t,n);const a=t.match(/^(.*)(\x5b(\d*)\x5d)$/);if(a){const c=a[1],d=parseInt(a[3]);return d>=0&&n.length!==d&&logger$9.throwArgumentError("array length mismatch; expected length ${ arrayLength }","value",n),n.map(u=>this._visit(c,u,i))}const o=this.types[t];return o?o.reduce((c,{name:d,type:u})=>(c[d]=this._visit(u,n[d],i),c),{}):logger$9.throwArgumentError(`unknown type: ${t}`,"type",t)}visit(t,n){return this._visit(this.primaryType,t,n)}static from(t){return new TypedDataEncoder(t)}static getPrimaryType(t){return TypedDataEncoder.from(t).primaryType}static hashStruct(t,n,i){return TypedDataEncoder.from(n).hashStruct(t,i)}static hashDomain(t){const n=[];for(const i in t){const a=domainFieldTypes[i];a||logger$9.throwArgumentError(`invalid typed-data domain key: ${JSON.stringify(i)}`,"domain",t),n.push({name:i,type:a})}return n.sort((i,a)=>domainFieldNames.indexOf(i.name)-domainFieldNames.indexOf(a.name)),TypedDataEncoder.hashStruct("EIP712Domain",{EIP712Domain:n},t)}static encode(t,n,i){return hexConcat(["0x1901",TypedDataEncoder.hashDomain(t),TypedDataEncoder.from(n).hash(i)])}static hash(t,n,i){return keccak256(TypedDataEncoder.encode(t,n,i))}static resolveNames(t,n,i,a){return __awaiter$2(this,void 0,void 0,function*(){t=shallowCopy(t);const o={};t.verifyingContract&&!isHexString(t.verifyingContract,20)&&(o[t.verifyingContract]="0x");const c=TypedDataEncoder.from(n);c.visit(i,(d,u)=>(d==="address"&&!isHexString(u,20)&&(o[u]="0x"),u));for(const d in o)o[d]=yield a(d);return t.verifyingContract&&o[t.verifyingContract]&&(t.verifyingContract=o[t.verifyingContract]),i=c.visit(i,(d,u)=>d==="address"&&o[u]?o[u]:u),{domain:t,value:i}})}static getPayload(t,n,i){TypedDataEncoder.hashDomain(t);const a={},o=[];domainFieldNames.forEach(u=>{const l=t[u];l!=null&&(a[u]=domainChecks[u](l),o.push({name:u,type:domainFieldTypes[u]}))});const c=TypedDataEncoder.from(n),d=shallowCopy(n);return d.EIP712Domain?logger$9.throwArgumentError("types must not contain EIP712Domain type","types.EIP712Domain",n):d.EIP712Domain=o,c.encode(i),{types:d,domain:a,primaryType:c.primaryType,message:c.visit(i,(u,l)=>{if(u.match(/^bytes(\d*)/))return hexlify(arrayify(l));if(u.match(/^u?int/))return BigNumber.from(l).toString();switch(u){case"address":return l.toLowerCase();case"bool":return!!l;case"string":return typeof l!="string"&&logger$9.throwArgumentError("invalid string","value",l),l}return logger$9.throwArgumentError("unsupported type","type",u)})}}}class BaseX{constructor(t){defineReadOnly(this,"alphabet",t),defineReadOnly(this,"base",t.length),defineReadOnly(this,"_alphabetMap",{}),defineReadOnly(this,"_leader",t.charAt(0));for(let n=0;n<t.length;n++)this._alphabetMap[t.charAt(n)]=n}encode(t){let n=arrayify(t);if(n.length===0)return"";let i=[0];for(let o=0;o<n.length;++o){let c=n[o];for(let d=0;d<i.length;++d)c+=i[d]<<8,i[d]=c%this.base,c=c/this.base|0;for(;c>0;)i.push(c%this.base),c=c/this.base|0}let a="";for(let o=0;n[o]===0&&o<n.length-1;++o)a+=this._leader;for(let o=i.length-1;o>=0;--o)a+=this.alphabet[i[o]];return a}decode(t){if(typeof t!="string")throw new TypeError("Expected String");let n=[];if(t.length===0)return new Uint8Array(n);n.push(0);for(let i=0;i<t.length;i++){let a=this._alphabetMap[t[i]];if(a===void 0)throw new Error("Non-base"+this.base+" character");let o=a;for(let c=0;c<n.length;++c)o+=n[c]*this.base,n[c]=o&255,o>>=8;for(;o>0;)n.push(o&255),o>>=8}for(let i=0;t[i]===this._leader&&i<t.length-1;++i)n.push(0);return arrayify(new Uint8Array(n.reverse()))}}new BaseX("abcdefghijklmnopqrstuvwxyz234567");const Base58=new BaseX("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");var hash={},utils$9={},minimalisticAssert$1=assert$b;function assert$b(e,t){if(!e)throw new Error(t||"Assertion failed")}assert$b.equal=function e(t,n,i){if(t!=n)throw new Error(i||"Assertion failed: "+t+" != "+n)};var inherits_browserExports={},inherits_browser$1={get exports(){return inherits_browserExports},set exports(e){inherits_browserExports=e}};typeof Object.create=="function"?inherits_browser$1.exports=function(t,n){n&&(t.super_=n,t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:inherits_browser$1.exports=function(t,n){if(n){t.super_=n;var i=function(){};i.prototype=n.prototype,t.prototype=new i,t.prototype.constructor=t}};var assert$a=minimalisticAssert$1,inherits=inherits_browserExports;utils$9.inherits=inherits;function isSurrogatePair(e,t){return(e.charCodeAt(t)&64512)!==55296||t<0||t+1>=e.length?!1:(e.charCodeAt(t+1)&64512)===56320}function toArray(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var n=[];if(typeof e=="string")if(t){if(t==="hex")for(e=e.replace(/[^a-z0-9]+/ig,""),e.length%2!==0&&(e="0"+e),a=0;a<e.length;a+=2)n.push(parseInt(e[a]+e[a+1],16))}else for(var i=0,a=0;a<e.length;a++){var o=e.charCodeAt(a);o<128?n[i++]=o:o<2048?(n[i++]=o>>6|192,n[i++]=o&63|128):isSurrogatePair(e,a)?(o=65536+((o&1023)<<10)+(e.charCodeAt(++a)&1023),n[i++]=o>>18|240,n[i++]=o>>12&63|128,n[i++]=o>>6&63|128,n[i++]=o&63|128):(n[i++]=o>>12|224,n[i++]=o>>6&63|128,n[i++]=o&63|128)}else for(a=0;a<e.length;a++)n[a]=e[a]|0;return n}utils$9.toArray=toArray;function toHex(e){for(var t="",n=0;n<e.length;n++)t+=zero2(e[n].toString(16));return t}utils$9.toHex=toHex;function htonl(e){var t=e>>>24|e>>>8&65280|e<<8&16711680|(e&255)<<24;return t>>>0}utils$9.htonl=htonl;function toHex32(e,t){for(var n="",i=0;i<e.length;i++){var a=e[i];t==="little"&&(a=htonl(a)),n+=zero8(a.toString(16))}return n}utils$9.toHex32=toHex32;function zero2(e){return e.length===1?"0"+e:e}utils$9.zero2=zero2;function zero8(e){return e.length===7?"0"+e:e.length===6?"00"+e:e.length===5?"000"+e:e.length===4?"0000"+e:e.length===3?"00000"+e:e.length===2?"000000"+e:e.length===1?"0000000"+e:e}utils$9.zero8=zero8;function join32(e,t,n,i){var a=n-t;assert$a(a%4===0);for(var o=new Array(a/4),c=0,d=t;c<o.length;c++,d+=4){var u;i==="big"?u=e[d]<<24|e[d+1]<<16|e[d+2]<<8|e[d+3]:u=e[d+3]<<24|e[d+2]<<16|e[d+1]<<8|e[d],o[c]=u>>>0}return o}utils$9.join32=join32;function split32(e,t){for(var n=new Array(e.length*4),i=0,a=0;i<e.length;i++,a+=4){var o=e[i];t==="big"?(n[a]=o>>>24,n[a+1]=o>>>16&255,n[a+2]=o>>>8&255,n[a+3]=o&255):(n[a+3]=o>>>24,n[a+2]=o>>>16&255,n[a+1]=o>>>8&255,n[a]=o&255)}return n}utils$9.split32=split32;function rotr32$1(e,t){return e>>>t|e<<32-t}utils$9.rotr32=rotr32$1;function rotl32$2(e,t){return e<<t|e>>>32-t}utils$9.rotl32=rotl32$2;function sum32$3(e,t){return e+t>>>0}utils$9.sum32=sum32$3;function sum32_3$1(e,t,n){return e+t+n>>>0}utils$9.sum32_3=sum32_3$1;function sum32_4$2(e,t,n,i){return e+t+n+i>>>0}utils$9.sum32_4=sum32_4$2;function sum32_5$2(e,t,n,i,a){return e+t+n+i+a>>>0}utils$9.sum32_5=sum32_5$2;function sum64$1(e,t,n,i){var a=e[t],o=e[t+1],c=i+o>>>0,d=(c<i?1:0)+n+a;e[t]=d>>>0,e[t+1]=c}utils$9.sum64=sum64$1;function sum64_hi$1(e,t,n,i){var a=t+i>>>0,o=(a<t?1:0)+e+n;return o>>>0}utils$9.sum64_hi=sum64_hi$1;function sum64_lo$1(e,t,n,i){var a=t+i;return a>>>0}utils$9.sum64_lo=sum64_lo$1;function sum64_4_hi$1(e,t,n,i,a,o,c,d){var u=0,l=t;l=l+i>>>0,u+=l<t?1:0,l=l+o>>>0,u+=l<o?1:0,l=l+d>>>0,u+=l<d?1:0;var h=e+n+a+c+u;return h>>>0}utils$9.sum64_4_hi=sum64_4_hi$1;function sum64_4_lo$1(e,t,n,i,a,o,c,d){var u=t+i+o+d;return u>>>0}utils$9.sum64_4_lo=sum64_4_lo$1;function sum64_5_hi$1(e,t,n,i,a,o,c,d,u,l){var h=0,p=t;p=p+i>>>0,h+=p<t?1:0,p=p+o>>>0,h+=p<o?1:0,p=p+d>>>0,h+=p<d?1:0,p=p+l>>>0,h+=p<l?1:0;var y=e+n+a+c+u+h;return y>>>0}utils$9.sum64_5_hi=sum64_5_hi$1;function sum64_5_lo$1(e,t,n,i,a,o,c,d,u,l){var h=t+i+o+d+l;return h>>>0}utils$9.sum64_5_lo=sum64_5_lo$1;function rotr64_hi$1(e,t,n){var i=t<<32-n|e>>>n;return i>>>0}utils$9.rotr64_hi=rotr64_hi$1;function rotr64_lo$1(e,t,n){var i=e<<32-n|t>>>n;return i>>>0}utils$9.rotr64_lo=rotr64_lo$1;function shr64_hi$1(e,t,n){return e>>>n}utils$9.shr64_hi=shr64_hi$1;function shr64_lo$1(e,t,n){var i=e<<32-n|t>>>n;return i>>>0}utils$9.shr64_lo=shr64_lo$1;var common$5={},utils$8=utils$9,assert$9=minimalisticAssert$1;function BlockHash$4(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}common$5.BlockHash=BlockHash$4;BlockHash$4.prototype.update=function e(t,n){if(t=utils$8.toArray(t,n),this.pending?this.pending=this.pending.concat(t):this.pending=t,this.pendingTotal+=t.length,this.pending.length>=this._delta8){t=this.pending;var i=t.length%this._delta8;this.pending=t.slice(t.length-i,t.length),this.pending.length===0&&(this.pending=null),t=utils$8.join32(t,0,t.length-i,this.endian);for(var a=0;a<t.length;a+=this._delta32)this._update(t,a,a+this._delta32)}return this};BlockHash$4.prototype.digest=function e(t){return this.update(this._pad()),assert$9(this.pending===null),this._digest(t)};BlockHash$4.prototype._pad=function e(){var t=this.pendingTotal,n=this._delta8,i=n-(t+this.padLength)%n,a=new Array(i+this.padLength);a[0]=128;for(var o=1;o<i;o++)a[o]=0;if(t<<=3,this.endian==="big"){for(var c=8;c<this.padLength;c++)a[o++]=0;a[o++]=0,a[o++]=0,a[o++]=0,a[o++]=0,a[o++]=t>>>24&255,a[o++]=t>>>16&255,a[o++]=t>>>8&255,a[o++]=t&255}else for(a[o++]=t&255,a[o++]=t>>>8&255,a[o++]=t>>>16&255,a[o++]=t>>>24&255,a[o++]=0,a[o++]=0,a[o++]=0,a[o++]=0,c=8;c<this.padLength;c++)a[o++]=0;return a};var sha={},common$4={},utils$7=utils$9,rotr32=utils$7.rotr32;function ft_1$1(e,t,n,i){if(e===0)return ch32$1(t,n,i);if(e===1||e===3)return p32(t,n,i);if(e===2)return maj32$1(t,n,i)}common$4.ft_1=ft_1$1;function ch32$1(e,t,n){return e&t^~e&n}common$4.ch32=ch32$1;function maj32$1(e,t,n){return e&t^e&n^t&n}common$4.maj32=maj32$1;function p32(e,t,n){return e^t^n}common$4.p32=p32;function s0_256$1(e){return rotr32(e,2)^rotr32(e,13)^rotr32(e,22)}common$4.s0_256=s0_256$1;function s1_256$1(e){return rotr32(e,6)^rotr32(e,11)^rotr32(e,25)}common$4.s1_256=s1_256$1;function g0_256$1(e){return rotr32(e,7)^rotr32(e,18)^e>>>3}common$4.g0_256=g0_256$1;function g1_256$1(e){return rotr32(e,17)^rotr32(e,19)^e>>>10}common$4.g1_256=g1_256$1;var utils$6=utils$9,common$3=common$5,shaCommon$1=common$4,rotl32$1=utils$6.rotl32,sum32$2=utils$6.sum32,sum32_5$1=utils$6.sum32_5,ft_1=shaCommon$1.ft_1,BlockHash$3=common$3.BlockHash,sha1_K=[1518500249,1859775393,2400959708,3395469782];function SHA1(){if(!(this instanceof SHA1))return new SHA1;BlockHash$3.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}utils$6.inherits(SHA1,BlockHash$3);var _1=SHA1;SHA1.blockSize=512;SHA1.outSize=160;SHA1.hmacStrength=80;SHA1.padLength=64;SHA1.prototype._update=function e(t,n){for(var i=this.W,a=0;a<16;a++)i[a]=t[n+a];for(;a<i.length;a++)i[a]=rotl32$1(i[a-3]^i[a-8]^i[a-14]^i[a-16],1);var o=this.h[0],c=this.h[1],d=this.h[2],u=this.h[3],l=this.h[4];for(a=0;a<i.length;a++){var h=~~(a/20),p=sum32_5$1(rotl32$1(o,5),ft_1(h,c,d,u),l,i[a],sha1_K[h]);l=u,u=d,d=rotl32$1(c,30),c=o,o=p}this.h[0]=sum32$2(this.h[0],o),this.h[1]=sum32$2(this.h[1],c),this.h[2]=sum32$2(this.h[2],d),this.h[3]=sum32$2(this.h[3],u),this.h[4]=sum32$2(this.h[4],l)};SHA1.prototype._digest=function e(t){return t==="hex"?utils$6.toHex32(this.h,"big"):utils$6.split32(this.h,"big")};var utils$5=utils$9,common$2=common$5,shaCommon=common$4,assert$8=minimalisticAssert$1,sum32$1=utils$5.sum32,sum32_4$1=utils$5.sum32_4,sum32_5=utils$5.sum32_5,ch32=shaCommon.ch32,maj32=shaCommon.maj32,s0_256=shaCommon.s0_256,s1_256=shaCommon.s1_256,g0_256=shaCommon.g0_256,g1_256=shaCommon.g1_256,BlockHash$2=common$2.BlockHash,sha256_K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function SHA256$1(){if(!(this instanceof SHA256$1))return new SHA256$1;BlockHash$2.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=sha256_K,this.W=new Array(64)}utils$5.inherits(SHA256$1,BlockHash$2);var _256=SHA256$1;SHA256$1.blockSize=512;SHA256$1.outSize=256;SHA256$1.hmacStrength=192;SHA256$1.padLength=64;SHA256$1.prototype._update=function e(t,n){for(var i=this.W,a=0;a<16;a++)i[a]=t[n+a];for(;a<i.length;a++)i[a]=sum32_4$1(g1_256(i[a-2]),i[a-7],g0_256(i[a-15]),i[a-16]);var o=this.h[0],c=this.h[1],d=this.h[2],u=this.h[3],l=this.h[4],h=this.h[5],p=this.h[6],y=this.h[7];for(assert$8(this.k.length===i.length),a=0;a<i.length;a++){var E=sum32_5(y,s1_256(l),ch32(l,h,p),this.k[a],i[a]),x=sum32$1(s0_256(o),maj32(o,c,d));y=p,p=h,h=l,l=sum32$1(u,E),u=d,d=c,c=o,o=sum32$1(E,x)}this.h[0]=sum32$1(this.h[0],o),this.h[1]=sum32$1(this.h[1],c),this.h[2]=sum32$1(this.h[2],d),this.h[3]=sum32$1(this.h[3],u),this.h[4]=sum32$1(this.h[4],l),this.h[5]=sum32$1(this.h[5],h),this.h[6]=sum32$1(this.h[6],p),this.h[7]=sum32$1(this.h[7],y)};SHA256$1.prototype._digest=function e(t){return t==="hex"?utils$5.toHex32(this.h,"big"):utils$5.split32(this.h,"big")};var utils$4=utils$9,SHA256=_256;function SHA224(){if(!(this instanceof SHA224))return new SHA224;SHA256.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}utils$4.inherits(SHA224,SHA256);var _224=SHA224;SHA224.blockSize=512;SHA224.outSize=224;SHA224.hmacStrength=192;SHA224.padLength=64;SHA224.prototype._digest=function e(t){return t==="hex"?utils$4.toHex32(this.h.slice(0,7),"big"):utils$4.split32(this.h.slice(0,7),"big")};var utils$3=utils$9,common$1=common$5,assert$7=minimalisticAssert$1,rotr64_hi=utils$3.rotr64_hi,rotr64_lo=utils$3.rotr64_lo,shr64_hi=utils$3.shr64_hi,shr64_lo=utils$3.shr64_lo,sum64=utils$3.sum64,sum64_hi=utils$3.sum64_hi,sum64_lo=utils$3.sum64_lo,sum64_4_hi=utils$3.sum64_4_hi,sum64_4_lo=utils$3.sum64_4_lo,sum64_5_hi=utils$3.sum64_5_hi,sum64_5_lo=utils$3.sum64_5_lo,BlockHash$1=common$1.BlockHash,sha512_K=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function SHA512$1(){if(!(this instanceof SHA512$1))return new SHA512$1;BlockHash$1.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=sha512_K,this.W=new Array(160)}utils$3.inherits(SHA512$1,BlockHash$1);var _512=SHA512$1;SHA512$1.blockSize=1024;SHA512$1.outSize=512;SHA512$1.hmacStrength=192;SHA512$1.padLength=128;SHA512$1.prototype._prepareBlock=function e(t,n){for(var i=this.W,a=0;a<32;a++)i[a]=t[n+a];for(;a<i.length;a+=2){var o=g1_512_hi(i[a-4],i[a-3]),c=g1_512_lo(i[a-4],i[a-3]),d=i[a-14],u=i[a-13],l=g0_512_hi(i[a-30],i[a-29]),h=g0_512_lo(i[a-30],i[a-29]),p=i[a-32],y=i[a-31];i[a]=sum64_4_hi(o,c,d,u,l,h,p,y),i[a+1]=sum64_4_lo(o,c,d,u,l,h,p,y)}};SHA512$1.prototype._update=function e(t,n){this._prepareBlock(t,n);var i=this.W,a=this.h[0],o=this.h[1],c=this.h[2],d=this.h[3],u=this.h[4],l=this.h[5],h=this.h[6],p=this.h[7],y=this.h[8],E=this.h[9],x=this.h[10],S=this.h[11],k=this.h[12],T=this.h[13],L=this.h[14],q=this.h[15];assert$7(this.k.length===i.length);for(var U=0;U<i.length;U+=2){var ee=L,W=q,ie=s1_512_hi(y,E),fe=s1_512_lo(y,E),ce=ch64_hi(y,E,x,S,k),ye=ch64_lo(y,E,x,S,k,T),xe=this.k[U],Oe=this.k[U+1],F=i[U],v=i[U+1],C=sum64_5_hi(ee,W,ie,fe,ce,ye,xe,Oe,F,v),I=sum64_5_lo(ee,W,ie,fe,ce,ye,xe,Oe,F,v);ee=s0_512_hi(a,o),W=s0_512_lo(a,o),ie=maj64_hi(a,o,c,d,u),fe=maj64_lo(a,o,c,d,u,l);var B=sum64_hi(ee,W,ie,fe),J=sum64_lo(ee,W,ie,fe);L=k,q=T,k=x,T=S,x=y,S=E,y=sum64_hi(h,p,C,I),E=sum64_lo(p,p,C,I),h=u,p=l,u=c,l=d,c=a,d=o,a=sum64_hi(C,I,B,J),o=sum64_lo(C,I,B,J)}sum64(this.h,0,a,o),sum64(this.h,2,c,d),sum64(this.h,4,u,l),sum64(this.h,6,h,p),sum64(this.h,8,y,E),sum64(this.h,10,x,S),sum64(this.h,12,k,T),sum64(this.h,14,L,q)};SHA512$1.prototype._digest=function e(t){return t==="hex"?utils$3.toHex32(this.h,"big"):utils$3.split32(this.h,"big")};function ch64_hi(e,t,n,i,a){var o=e&n^~e&a;return o<0&&(o+=4294967296),o}function ch64_lo(e,t,n,i,a,o){var c=t&i^~t&o;return c<0&&(c+=4294967296),c}function maj64_hi(e,t,n,i,a){var o=e&n^e&a^n&a;return o<0&&(o+=4294967296),o}function maj64_lo(e,t,n,i,a,o){var c=t&i^t&o^i&o;return c<0&&(c+=4294967296),c}function s0_512_hi(e,t){var n=rotr64_hi(e,t,28),i=rotr64_hi(t,e,2),a=rotr64_hi(t,e,7),o=n^i^a;return o<0&&(o+=4294967296),o}function s0_512_lo(e,t){var n=rotr64_lo(e,t,28),i=rotr64_lo(t,e,2),a=rotr64_lo(t,e,7),o=n^i^a;return o<0&&(o+=4294967296),o}function s1_512_hi(e,t){var n=rotr64_hi(e,t,14),i=rotr64_hi(e,t,18),a=rotr64_hi(t,e,9),o=n^i^a;return o<0&&(o+=4294967296),o}function s1_512_lo(e,t){var n=rotr64_lo(e,t,14),i=rotr64_lo(e,t,18),a=rotr64_lo(t,e,9),o=n^i^a;return o<0&&(o+=4294967296),o}function g0_512_hi(e,t){var n=rotr64_hi(e,t,1),i=rotr64_hi(e,t,8),a=shr64_hi(e,t,7),o=n^i^a;return o<0&&(o+=4294967296),o}function g0_512_lo(e,t){var n=rotr64_lo(e,t,1),i=rotr64_lo(e,t,8),a=shr64_lo(e,t,7),o=n^i^a;return o<0&&(o+=4294967296),o}function g1_512_hi(e,t){var n=rotr64_hi(e,t,19),i=rotr64_hi(t,e,29),a=shr64_hi(e,t,6),o=n^i^a;return o<0&&(o+=4294967296),o}function g1_512_lo(e,t){var n=rotr64_lo(e,t,19),i=rotr64_lo(t,e,29),a=shr64_lo(e,t,6),o=n^i^a;return o<0&&(o+=4294967296),o}var utils$2=utils$9,SHA512=_512;function SHA384(){if(!(this instanceof SHA384))return new SHA384;SHA512.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}utils$2.inherits(SHA384,SHA512);var _384=SHA384;SHA384.blockSize=1024;SHA384.outSize=384;SHA384.hmacStrength=192;SHA384.padLength=128;SHA384.prototype._digest=function e(t){return t==="hex"?utils$2.toHex32(this.h.slice(0,12),"big"):utils$2.split32(this.h.slice(0,12),"big")};sha.sha1=_1;sha.sha224=_224;sha.sha256=_256;sha.sha384=_384;sha.sha512=_512;var ripemd={},utils$1=utils$9,common=common$5,rotl32=utils$1.rotl32,sum32=utils$1.sum32,sum32_3=utils$1.sum32_3,sum32_4=utils$1.sum32_4,BlockHash=common.BlockHash;function RIPEMD160(){if(!(this instanceof RIPEMD160))return new RIPEMD160;BlockHash.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}utils$1.inherits(RIPEMD160,BlockHash);ripemd.ripemd160=RIPEMD160;RIPEMD160.blockSize=512;RIPEMD160.outSize=160;RIPEMD160.hmacStrength=192;RIPEMD160.padLength=64;RIPEMD160.prototype._update=function e(t,n){for(var i=this.h[0],a=this.h[1],o=this.h[2],c=this.h[3],d=this.h[4],u=i,l=a,h=o,p=c,y=d,E=0;E<80;E++){var x=sum32(rotl32(sum32_4(i,f(E,a,o,c),t[r$1[E]+n],K(E)),s[E]),d);i=d,d=c,c=rotl32(o,10),o=a,a=x,x=sum32(rotl32(sum32_4(u,f(79-E,l,h,p),t[rh[E]+n],Kh(E)),sh[E]),y),u=y,y=p,p=rotl32(h,10),h=l,l=x}x=sum32_3(this.h[1],o,p),this.h[1]=sum32_3(this.h[2],c,y),this.h[2]=sum32_3(this.h[3],d,u),this.h[3]=sum32_3(this.h[4],i,l),this.h[4]=sum32_3(this.h[0],a,h),this.h[0]=x};RIPEMD160.prototype._digest=function e(t){return t==="hex"?utils$1.toHex32(this.h,"little"):utils$1.split32(this.h,"little")};function f(e,t,n,i){return e<=15?t^n^i:e<=31?t&n|~t&i:e<=47?(t|~n)^i:e<=63?t&i|n&~i:t^(n|~i)}function K(e){return e<=15?0:e<=31?1518500249:e<=47?1859775393:e<=63?2400959708:2840853838}function Kh(e){return e<=15?1352829926:e<=31?1548603684:e<=47?1836072691:e<=63?2053994217:0}var r$1=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],rh=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],s=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],sh=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],utils=utils$9,assert$6=minimalisticAssert$1;function Hmac(e,t,n){if(!(this instanceof Hmac))return new Hmac(e,t,n);this.Hash=e,this.blockSize=e.blockSize/8,this.outSize=e.outSize/8,this.inner=null,this.outer=null,this._init(utils.toArray(t,n))}var hmac=Hmac;Hmac.prototype._init=function e(t){t.length>this.blockSize&&(t=new this.Hash().update(t).digest()),assert$6(t.length<=this.blockSize);for(var n=t.length;n<this.blockSize;n++)t.push(0);for(n=0;n<t.length;n++)t[n]^=54;for(this.inner=new this.Hash().update(t),n=0;n<t.length;n++)t[n]^=106;this.outer=new this.Hash().update(t)};Hmac.prototype.update=function e(t,n){return this.inner.update(t,n),this};Hmac.prototype.digest=function e(t){return this.outer.update(this.inner.digest()),this.outer.digest(t)};(function(e){var t=e;t.utils=utils$9,t.common=common$5,t.sha=sha,t.ripemd=ripemd,t.hmac=hmac,t.sha1=t.sha.sha1,t.sha256=t.sha.sha256,t.sha224=t.sha.sha224,t.sha384=t.sha.sha384,t.sha512=t.sha.sha512,t.ripemd160=t.ripemd.ripemd160})(hash);var SupportedAlgorithm;(function(e){e.sha256="sha256",e.sha512="sha512"})(SupportedAlgorithm||(SupportedAlgorithm={}));const version$9="sha2/5.7.0",logger$8=new Logger(version$9);function ripemd160(e){return"0x"+hash.ripemd160().update(arrayify(e)).digest("hex")}function sha256(e){return"0x"+hash.sha256().update(arrayify(e)).digest("hex")}function computeHmac(e,t,n){return SupportedAlgorithm[e]||logger$8.throwError("unsupported algorithm "+e,Logger.errors.UNSUPPORTED_OPERATION,{operation:"hmac",algorithm:e}),"0x"+hash.hmac(hash[e],arrayify(t)).update(arrayify(n)).digest("hex")}function pbkdf2$1(e,t,n,i,a){e=arrayify(e),t=arrayify(t);let o,c=1;const d=new Uint8Array(i),u=new Uint8Array(t.length+4);u.set(t);let l,h;for(let p=1;p<=c;p++){u[t.length]=p>>24&255,u[t.length+1]=p>>16&255,u[t.length+2]=p>>8&255,u[t.length+3]=p&255;let y=arrayify(computeHmac(a,e,u));o||(o=y.length,h=new Uint8Array(o),c=Math.ceil(i/o),l=i-(c-1)*o),h.set(y);for(let S=1;S<n;S++){y=arrayify(computeHmac(a,e,y));for(let k=0;k<o;k++)h[k]^=y[k]}const E=(p-1)*o,x=p===c?l:o;d.set(arrayify(h).slice(0,x),E)}return hexlify(d)}function createCommonjsModule(e,t,n){return n={path:t,exports:{},require:function(i,a){return commonjsRequire(i,a??n.path)}},e(n,n.exports),n.exports}function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var minimalisticAssert=assert;function assert(e,t){if(!e)throw new Error(t||"Assertion failed")}assert.equal=function e(t,n,i){if(t!=n)throw new Error(i||"Assertion failed: "+t+" != "+n)};var utils_1=createCommonjsModule(function(e,t){var n=t;function i(c,d){if(Array.isArray(c))return c.slice();if(!c)return[];var u=[];if(typeof c!="string"){for(var l=0;l<c.length;l++)u[l]=c[l]|0;return u}if(d==="hex"){c=c.replace(/[^a-z0-9]+/ig,""),c.length%2!==0&&(c="0"+c);for(var l=0;l<c.length;l+=2)u.push(parseInt(c[l]+c[l+1],16))}else for(var l=0;l<c.length;l++){var h=c.charCodeAt(l),p=h>>8,y=h&255;p?u.push(p,y):u.push(y)}return u}n.toArray=i;function a(c){return c.length===1?"0"+c:c}n.zero2=a;function o(c){for(var d="",u=0;u<c.length;u++)d+=a(c[u].toString(16));return d}n.toHex=o,n.encode=function(d,u){return u==="hex"?o(d):d}}),utils_1$1=createCommonjsModule(function(e,t){var n=t;n.assert=minimalisticAssert,n.toArray=utils_1.toArray,n.zero2=utils_1.zero2,n.toHex=utils_1.toHex,n.encode=utils_1.encode;function i(u,l,h){var p=new Array(Math.max(u.bitLength(),h)+1);p.fill(0);for(var y=1<<l+1,E=u.clone(),x=0;x<p.length;x++){var S,k=E.andln(y-1);E.isOdd()?(k>(y>>1)-1?S=(y>>1)-k:S=k,E.isubn(S)):S=0,p[x]=S,E.iushrn(1)}return p}n.getNAF=i;function a(u,l){var h=[[],[]];u=u.clone(),l=l.clone();for(var p=0,y=0,E;u.cmpn(-p)>0||l.cmpn(-y)>0;){var x=u.andln(3)+p&3,S=l.andln(3)+y&3;x===3&&(x=-1),S===3&&(S=-1);var k;x&1?(E=u.andln(7)+p&7,(E===3||E===5)&&S===2?k=-x:k=x):k=0,h[0].push(k);var T;S&1?(E=l.andln(7)+y&7,(E===3||E===5)&&x===2?T=-S:T=S):T=0,h[1].push(T),2*p===k+1&&(p=1-p),2*y===T+1&&(y=1-y),u.iushrn(1),l.iushrn(1)}return h}n.getJSF=a;function o(u,l,h){var p="_"+l;u.prototype[l]=function(){return this[p]!==void 0?this[p]:this[p]=h.call(this)}}n.cachedProperty=o;function c(u){return typeof u=="string"?n.toArray(u,"hex"):u}n.parseBytes=c;function d(u){return new BN$1(u,"hex","le")}n.intFromLE=d}),getNAF=utils_1$1.getNAF,getJSF=utils_1$1.getJSF,assert$1=utils_1$1.assert;function BaseCurve(e,t){this.type=e,this.p=new BN$1(t.p,16),this.red=t.prime?BN$1.red(t.prime):BN$1.mont(this.p),this.zero=new BN$1(0).toRed(this.red),this.one=new BN$1(1).toRed(this.red),this.two=new BN$1(2).toRed(this.red),this.n=t.n&&new BN$1(t.n,16),this.g=t.g&&this.pointFromJSON(t.g,t.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var n=this.n&&this.p.div(this.n);!n||n.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}var base=BaseCurve;BaseCurve.prototype.point=function e(){throw new Error("Not implemented")};BaseCurve.prototype.validate=function e(){throw new Error("Not implemented")};BaseCurve.prototype._fixedNafMul=function e(t,n){assert$1(t.precomputed);var i=t._getDoubles(),a=getNAF(n,1,this._bitLength),o=(1<<i.step+1)-(i.step%2===0?2:1);o/=3;var c=[],d,u;for(d=0;d<a.length;d+=i.step){u=0;for(var l=d+i.step-1;l>=d;l--)u=(u<<1)+a[l];c.push(u)}for(var h=this.jpoint(null,null,null),p=this.jpoint(null,null,null),y=o;y>0;y--){for(d=0;d<c.length;d++)u=c[d],u===y?p=p.mixedAdd(i.points[d]):u===-y&&(p=p.mixedAdd(i.points[d].neg()));h=h.add(p)}return h.toP()};BaseCurve.prototype._wnafMul=function e(t,n){var i=4,a=t._getNAFPoints(i);i=a.wnd;for(var o=a.points,c=getNAF(n,i,this._bitLength),d=this.jpoint(null,null,null),u=c.length-1;u>=0;u--){for(var l=0;u>=0&&c[u]===0;u--)l++;if(u>=0&&l++,d=d.dblp(l),u<0)break;var h=c[u];assert$1(h!==0),t.type==="affine"?h>0?d=d.mixedAdd(o[h-1>>1]):d=d.mixedAdd(o[-h-1>>1].neg()):h>0?d=d.add(o[h-1>>1]):d=d.add(o[-h-1>>1].neg())}return t.type==="affine"?d.toP():d};BaseCurve.prototype._wnafMulAdd=function e(t,n,i,a,o){var c=this._wnafT1,d=this._wnafT2,u=this._wnafT3,l=0,h,p,y;for(h=0;h<a;h++){y=n[h];var E=y._getNAFPoints(t);c[h]=E.wnd,d[h]=E.points}for(h=a-1;h>=1;h-=2){var x=h-1,S=h;if(c[x]!==1||c[S]!==1){u[x]=getNAF(i[x],c[x],this._bitLength),u[S]=getNAF(i[S],c[S],this._bitLength),l=Math.max(u[x].length,l),l=Math.max(u[S].length,l);continue}var k=[n[x],null,null,n[S]];n[x].y.cmp(n[S].y)===0?(k[1]=n[x].add(n[S]),k[2]=n[x].toJ().mixedAdd(n[S].neg())):n[x].y.cmp(n[S].y.redNeg())===0?(k[1]=n[x].toJ().mixedAdd(n[S]),k[2]=n[x].add(n[S].neg())):(k[1]=n[x].toJ().mixedAdd(n[S]),k[2]=n[x].toJ().mixedAdd(n[S].neg()));var T=[-3,-1,-5,-7,0,7,5,1,3],L=getJSF(i[x],i[S]);for(l=Math.max(L[0].length,l),u[x]=new Array(l),u[S]=new Array(l),p=0;p<l;p++){var q=L[0][p]|0,U=L[1][p]|0;u[x][p]=T[(q+1)*3+(U+1)],u[S][p]=0,d[x]=k}}var ee=this.jpoint(null,null,null),W=this._wnafT4;for(h=l;h>=0;h--){for(var ie=0;h>=0;){var fe=!0;for(p=0;p<a;p++)W[p]=u[p][h]|0,W[p]!==0&&(fe=!1);if(!fe)break;ie++,h--}if(h>=0&&ie++,ee=ee.dblp(ie),h<0)break;for(p=0;p<a;p++){var ce=W[p];ce!==0&&(ce>0?y=d[p][ce-1>>1]:ce<0&&(y=d[p][-ce-1>>1].neg()),y.type==="affine"?ee=ee.mixedAdd(y):ee=ee.add(y))}}for(h=0;h<a;h++)d[h]=null;return o?ee:ee.toP()};function BasePoint(e,t){this.curve=e,this.type=t,this.precomputed=null}BaseCurve.BasePoint=BasePoint;BasePoint.prototype.eq=function e(){throw new Error("Not implemented")};BasePoint.prototype.validate=function e(){return this.curve.validate(this)};BaseCurve.prototype.decodePoint=function e(t,n){t=utils_1$1.toArray(t,n);var i=this.p.byteLength();if((t[0]===4||t[0]===6||t[0]===7)&&t.length-1===2*i){t[0]===6?assert$1(t[t.length-1]%2===0):t[0]===7&&assert$1(t[t.length-1]%2===1);var a=this.point(t.slice(1,1+i),t.slice(1+i,1+2*i));return a}else if((t[0]===2||t[0]===3)&&t.length-1===i)return this.pointFromX(t.slice(1,1+i),t[0]===3);throw new Error("Unknown point format")};BasePoint.prototype.encodeCompressed=function e(t){return this.encode(t,!0)};BasePoint.prototype._encode=function e(t){var n=this.curve.p.byteLength(),i=this.getX().toArray("be",n);return t?[this.getY().isEven()?2:3].concat(i):[4].concat(i,this.getY().toArray("be",n))};BasePoint.prototype.encode=function e(t,n){return utils_1$1.encode(this._encode(n),t)};BasePoint.prototype.precompute=function e(t){if(this.precomputed)return this;var n={doubles:null,naf:null,beta:null};return n.naf=this._getNAFPoints(8),n.doubles=this._getDoubles(4,t),n.beta=this._getBeta(),this.precomputed=n,this};BasePoint.prototype._hasDoubles=function e(t){if(!this.precomputed)return!1;var n=this.precomputed.doubles;return n?n.points.length>=Math.ceil((t.bitLength()+1)/n.step):!1};BasePoint.prototype._getDoubles=function e(t,n){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var i=[this],a=this,o=0;o<n;o+=t){for(var c=0;c<t;c++)a=a.dbl();i.push(a)}return{step:t,points:i}};BasePoint.prototype._getNAFPoints=function e(t){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var n=[this],i=(1<<t)-1,a=i===1?null:this.dbl(),o=1;o<i;o++)n[o]=n[o-1].add(a);return{wnd:t,points:n}};BasePoint.prototype._getBeta=function e(){return null};BasePoint.prototype.dblp=function e(t){for(var n=this,i=0;i<t;i++)n=n.dbl();return n};var inherits_browser=createCommonjsModule(function(e){typeof Object.create=="function"?e.exports=function(n,i){i&&(n.super_=i,n.prototype=Object.create(i.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(n,i){if(i){n.super_=i;var a=function(){};a.prototype=i.prototype,n.prototype=new a,n.prototype.constructor=n}}}),assert$2=utils_1$1.assert;function ShortCurve(e){base.call(this,"short",e),this.a=new BN$1(e.a,16).toRed(this.red),this.b=new BN$1(e.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=this.a.fromRed().cmpn(0)===0,this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0,this.endo=this._getEndomorphism(e),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}inherits_browser(ShortCurve,base);var short_1=ShortCurve;ShortCurve.prototype._getEndomorphism=function e(t){if(!(!this.zeroA||!this.g||!this.n||this.p.modn(3)!==1)){var n,i;if(t.beta)n=new BN$1(t.beta,16).toRed(this.red);else{var a=this._getEndoRoots(this.p);n=a[0].cmp(a[1])<0?a[0]:a[1],n=n.toRed(this.red)}if(t.lambda)i=new BN$1(t.lambda,16);else{var o=this._getEndoRoots(this.n);this.g.mul(o[0]).x.cmp(this.g.x.redMul(n))===0?i=o[0]:(i=o[1],assert$2(this.g.mul(i).x.cmp(this.g.x.redMul(n))===0))}var c;return t.basis?c=t.basis.map(function(d){return{a:new BN$1(d.a,16),b:new BN$1(d.b,16)}}):c=this._getEndoBasis(i),{beta:n,lambda:i,basis:c}}};ShortCurve.prototype._getEndoRoots=function e(t){var n=t===this.p?this.red:BN$1.mont(t),i=new BN$1(2).toRed(n).redInvm(),a=i.redNeg(),o=new BN$1(3).toRed(n).redNeg().redSqrt().redMul(i),c=a.redAdd(o).fromRed(),d=a.redSub(o).fromRed();return[c,d]};ShortCurve.prototype._getEndoBasis=function e(t){for(var n=this.n.ushrn(Math.floor(this.n.bitLength()/2)),i=t,a=this.n.clone(),o=new BN$1(1),c=new BN$1(0),d=new BN$1(0),u=new BN$1(1),l,h,p,y,E,x,S,k=0,T,L;i.cmpn(0)!==0;){var q=a.div(i);T=a.sub(q.mul(i)),L=d.sub(q.mul(o));var U=u.sub(q.mul(c));if(!p&&T.cmp(n)<0)l=S.neg(),h=o,p=T.neg(),y=L;else if(p&&++k===2)break;S=T,a=i,i=T,d=o,o=L,u=c,c=U}E=T.neg(),x=L;var ee=p.sqr().add(y.sqr()),W=E.sqr().add(x.sqr());return W.cmp(ee)>=0&&(E=l,x=h),p.negative&&(p=p.neg(),y=y.neg()),E.negative&&(E=E.neg(),x=x.neg()),[{a:p,b:y},{a:E,b:x}]};ShortCurve.prototype._endoSplit=function e(t){var n=this.endo.basis,i=n[0],a=n[1],o=a.b.mul(t).divRound(this.n),c=i.b.neg().mul(t).divRound(this.n),d=o.mul(i.a),u=c.mul(a.a),l=o.mul(i.b),h=c.mul(a.b),p=t.sub(d).sub(u),y=l.add(h).neg();return{k1:p,k2:y}};ShortCurve.prototype.pointFromX=function e(t,n){t=new BN$1(t,16),t.red||(t=t.toRed(this.red));var i=t.redSqr().redMul(t).redIAdd(t.redMul(this.a)).redIAdd(this.b),a=i.redSqrt();if(a.redSqr().redSub(i).cmp(this.zero)!==0)throw new Error("invalid point");var o=a.fromRed().isOdd();return(n&&!o||!n&&o)&&(a=a.redNeg()),this.point(t,a)};ShortCurve.prototype.validate=function e(t){if(t.inf)return!0;var n=t.x,i=t.y,a=this.a.redMul(n),o=n.redSqr().redMul(n).redIAdd(a).redIAdd(this.b);return i.redSqr().redISub(o).cmpn(0)===0};ShortCurve.prototype._endoWnafMulAdd=function e(t,n,i){for(var a=this._endoWnafT1,o=this._endoWnafT2,c=0;c<t.length;c++){var d=this._endoSplit(n[c]),u=t[c],l=u._getBeta();d.k1.negative&&(d.k1.ineg(),u=u.neg(!0)),d.k2.negative&&(d.k2.ineg(),l=l.neg(!0)),a[c*2]=u,a[c*2+1]=l,o[c*2]=d.k1,o[c*2+1]=d.k2}for(var h=this._wnafMulAdd(1,a,o,c*2,i),p=0;p<c*2;p++)a[p]=null,o[p]=null;return h};function Point(e,t,n,i){base.BasePoint.call(this,e,"affine"),t===null&&n===null?(this.x=null,this.y=null,this.inf=!0):(this.x=new BN$1(t,16),this.y=new BN$1(n,16),i&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}inherits_browser(Point,base.BasePoint);ShortCurve.prototype.point=function e(t,n,i){return new Point(this,t,n,i)};ShortCurve.prototype.pointFromJSON=function e(t,n){return Point.fromJSON(this,t,n)};Point.prototype._getBeta=function e(){if(this.curve.endo){var t=this.precomputed;if(t&&t.beta)return t.beta;var n=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(t){var i=this.curve,a=function(o){return i.point(o.x.redMul(i.endo.beta),o.y)};t.beta=n,n.precomputed={beta:null,naf:t.naf&&{wnd:t.naf.wnd,points:t.naf.points.map(a)},doubles:t.doubles&&{step:t.doubles.step,points:t.doubles.points.map(a)}}}return n}};Point.prototype.toJSON=function e(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]};Point.fromJSON=function e(t,n,i){typeof n=="string"&&(n=JSON.parse(n));var a=t.point(n[0],n[1],i);if(!n[2])return a;function o(d){return t.point(d[0],d[1],i)}var c=n[2];return a.precomputed={beta:null,doubles:c.doubles&&{step:c.doubles.step,points:[a].concat(c.doubles.points.map(o))},naf:c.naf&&{wnd:c.naf.wnd,points:[a].concat(c.naf.points.map(o))}},a};Point.prototype.inspect=function e(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"};Point.prototype.isInfinity=function e(){return this.inf};Point.prototype.add=function e(t){if(this.inf)return t;if(t.inf)return this;if(this.eq(t))return this.dbl();if(this.neg().eq(t))return this.curve.point(null,null);if(this.x.cmp(t.x)===0)return this.curve.point(null,null);var n=this.y.redSub(t.y);n.cmpn(0)!==0&&(n=n.redMul(this.x.redSub(t.x).redInvm()));var i=n.redSqr().redISub(this.x).redISub(t.x),a=n.redMul(this.x.redSub(i)).redISub(this.y);return this.curve.point(i,a)};Point.prototype.dbl=function e(){if(this.inf)return this;var t=this.y.redAdd(this.y);if(t.cmpn(0)===0)return this.curve.point(null,null);var n=this.curve.a,i=this.x.redSqr(),a=t.redInvm(),o=i.redAdd(i).redIAdd(i).redIAdd(n).redMul(a),c=o.redSqr().redISub(this.x.redAdd(this.x)),d=o.redMul(this.x.redSub(c)).redISub(this.y);return this.curve.point(c,d)};Point.prototype.getX=function e(){return this.x.fromRed()};Point.prototype.getY=function e(){return this.y.fromRed()};Point.prototype.mul=function e(t){return t=new BN$1(t,16),this.isInfinity()?this:this._hasDoubles(t)?this.curve._fixedNafMul(this,t):this.curve.endo?this.curve._endoWnafMulAdd([this],[t]):this.curve._wnafMul(this,t)};Point.prototype.mulAdd=function e(t,n,i){var a=[this,n],o=[t,i];return this.curve.endo?this.curve._endoWnafMulAdd(a,o):this.curve._wnafMulAdd(1,a,o,2)};Point.prototype.jmulAdd=function e(t,n,i){var a=[this,n],o=[t,i];return this.curve.endo?this.curve._endoWnafMulAdd(a,o,!0):this.curve._wnafMulAdd(1,a,o,2,!0)};Point.prototype.eq=function e(t){return this===t||this.inf===t.inf&&(this.inf||this.x.cmp(t.x)===0&&this.y.cmp(t.y)===0)};Point.prototype.neg=function e(t){if(this.inf)return this;var n=this.curve.point(this.x,this.y.redNeg());if(t&&this.precomputed){var i=this.precomputed,a=function(o){return o.neg()};n.precomputed={naf:i.naf&&{wnd:i.naf.wnd,points:i.naf.points.map(a)},doubles:i.doubles&&{step:i.doubles.step,points:i.doubles.points.map(a)}}}return n};Point.prototype.toJ=function e(){if(this.inf)return this.curve.jpoint(null,null,null);var t=this.curve.jpoint(this.x,this.y,this.curve.one);return t};function JPoint(e,t,n,i){base.BasePoint.call(this,e,"jacobian"),t===null&&n===null&&i===null?(this.x=this.curve.one,this.y=this.curve.one,this.z=new BN$1(0)):(this.x=new BN$1(t,16),this.y=new BN$1(n,16),this.z=new BN$1(i,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}inherits_browser(JPoint,base.BasePoint);ShortCurve.prototype.jpoint=function e(t,n,i){return new JPoint(this,t,n,i)};JPoint.prototype.toP=function e(){if(this.isInfinity())return this.curve.point(null,null);var t=this.z.redInvm(),n=t.redSqr(),i=this.x.redMul(n),a=this.y.redMul(n).redMul(t);return this.curve.point(i,a)};JPoint.prototype.neg=function e(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)};JPoint.prototype.add=function e(t){if(this.isInfinity())return t;if(t.isInfinity())return this;var n=t.z.redSqr(),i=this.z.redSqr(),a=this.x.redMul(n),o=t.x.redMul(i),c=this.y.redMul(n.redMul(t.z)),d=t.y.redMul(i.redMul(this.z)),u=a.redSub(o),l=c.redSub(d);if(u.cmpn(0)===0)return l.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var h=u.redSqr(),p=h.redMul(u),y=a.redMul(h),E=l.redSqr().redIAdd(p).redISub(y).redISub(y),x=l.redMul(y.redISub(E)).redISub(c.redMul(p)),S=this.z.redMul(t.z).redMul(u);return this.curve.jpoint(E,x,S)};JPoint.prototype.mixedAdd=function e(t){if(this.isInfinity())return t.toJ();if(t.isInfinity())return this;var n=this.z.redSqr(),i=this.x,a=t.x.redMul(n),o=this.y,c=t.y.redMul(n).redMul(this.z),d=i.redSub(a),u=o.redSub(c);if(d.cmpn(0)===0)return u.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var l=d.redSqr(),h=l.redMul(d),p=i.redMul(l),y=u.redSqr().redIAdd(h).redISub(p).redISub(p),E=u.redMul(p.redISub(y)).redISub(o.redMul(h)),x=this.z.redMul(d);return this.curve.jpoint(y,E,x)};JPoint.prototype.dblp=function e(t){if(t===0)return this;if(this.isInfinity())return this;if(!t)return this.dbl();var n;if(this.curve.zeroA||this.curve.threeA){var i=this;for(n=0;n<t;n++)i=i.dbl();return i}var a=this.curve.a,o=this.curve.tinv,c=this.x,d=this.y,u=this.z,l=u.redSqr().redSqr(),h=d.redAdd(d);for(n=0;n<t;n++){var p=c.redSqr(),y=h.redSqr(),E=y.redSqr(),x=p.redAdd(p).redIAdd(p).redIAdd(a.redMul(l)),S=c.redMul(y),k=x.redSqr().redISub(S.redAdd(S)),T=S.redISub(k),L=x.redMul(T);L=L.redIAdd(L).redISub(E);var q=h.redMul(u);n+1<t&&(l=l.redMul(E)),c=k,u=q,h=L}return this.curve.jpoint(c,h.redMul(o),u)};JPoint.prototype.dbl=function e(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()};JPoint.prototype._zeroDbl=function e(){var t,n,i;if(this.zOne){var a=this.x.redSqr(),o=this.y.redSqr(),c=o.redSqr(),d=this.x.redAdd(o).redSqr().redISub(a).redISub(c);d=d.redIAdd(d);var u=a.redAdd(a).redIAdd(a),l=u.redSqr().redISub(d).redISub(d),h=c.redIAdd(c);h=h.redIAdd(h),h=h.redIAdd(h),t=l,n=u.redMul(d.redISub(l)).redISub(h),i=this.y.redAdd(this.y)}else{var p=this.x.redSqr(),y=this.y.redSqr(),E=y.redSqr(),x=this.x.redAdd(y).redSqr().redISub(p).redISub(E);x=x.redIAdd(x);var S=p.redAdd(p).redIAdd(p),k=S.redSqr(),T=E.redIAdd(E);T=T.redIAdd(T),T=T.redIAdd(T),t=k.redISub(x).redISub(x),n=S.redMul(x.redISub(t)).redISub(T),i=this.y.redMul(this.z),i=i.redIAdd(i)}return this.curve.jpoint(t,n,i)};JPoint.prototype._threeDbl=function e(){var t,n,i;if(this.zOne){var a=this.x.redSqr(),o=this.y.redSqr(),c=o.redSqr(),d=this.x.redAdd(o).redSqr().redISub(a).redISub(c);d=d.redIAdd(d);var u=a.redAdd(a).redIAdd(a).redIAdd(this.curve.a),l=u.redSqr().redISub(d).redISub(d);t=l;var h=c.redIAdd(c);h=h.redIAdd(h),h=h.redIAdd(h),n=u.redMul(d.redISub(l)).redISub(h),i=this.y.redAdd(this.y)}else{var p=this.z.redSqr(),y=this.y.redSqr(),E=this.x.redMul(y),x=this.x.redSub(p).redMul(this.x.redAdd(p));x=x.redAdd(x).redIAdd(x);var S=E.redIAdd(E);S=S.redIAdd(S);var k=S.redAdd(S);t=x.redSqr().redISub(k),i=this.y.redAdd(this.z).redSqr().redISub(y).redISub(p);var T=y.redSqr();T=T.redIAdd(T),T=T.redIAdd(T),T=T.redIAdd(T),n=x.redMul(S.redISub(t)).redISub(T)}return this.curve.jpoint(t,n,i)};JPoint.prototype._dbl=function e(){var t=this.curve.a,n=this.x,i=this.y,a=this.z,o=a.redSqr().redSqr(),c=n.redSqr(),d=i.redSqr(),u=c.redAdd(c).redIAdd(c).redIAdd(t.redMul(o)),l=n.redAdd(n);l=l.redIAdd(l);var h=l.redMul(d),p=u.redSqr().redISub(h.redAdd(h)),y=h.redISub(p),E=d.redSqr();E=E.redIAdd(E),E=E.redIAdd(E),E=E.redIAdd(E);var x=u.redMul(y).redISub(E),S=i.redAdd(i).redMul(a);return this.curve.jpoint(p,x,S)};JPoint.prototype.trpl=function e(){if(!this.curve.zeroA)return this.dbl().add(this);var t=this.x.redSqr(),n=this.y.redSqr(),i=this.z.redSqr(),a=n.redSqr(),o=t.redAdd(t).redIAdd(t),c=o.redSqr(),d=this.x.redAdd(n).redSqr().redISub(t).redISub(a);d=d.redIAdd(d),d=d.redAdd(d).redIAdd(d),d=d.redISub(c);var u=d.redSqr(),l=a.redIAdd(a);l=l.redIAdd(l),l=l.redIAdd(l),l=l.redIAdd(l);var h=o.redIAdd(d).redSqr().redISub(c).redISub(u).redISub(l),p=n.redMul(h);p=p.redIAdd(p),p=p.redIAdd(p);var y=this.x.redMul(u).redISub(p);y=y.redIAdd(y),y=y.redIAdd(y);var E=this.y.redMul(h.redMul(l.redISub(h)).redISub(d.redMul(u)));E=E.redIAdd(E),E=E.redIAdd(E),E=E.redIAdd(E);var x=this.z.redAdd(d).redSqr().redISub(i).redISub(u);return this.curve.jpoint(y,E,x)};JPoint.prototype.mul=function e(t,n){return t=new BN$1(t,n),this.curve._wnafMul(this,t)};JPoint.prototype.eq=function e(t){if(t.type==="affine")return this.eq(t.toJ());if(this===t)return!0;var n=this.z.redSqr(),i=t.z.redSqr();if(this.x.redMul(i).redISub(t.x.redMul(n)).cmpn(0)!==0)return!1;var a=n.redMul(this.z),o=i.redMul(t.z);return this.y.redMul(o).redISub(t.y.redMul(a)).cmpn(0)===0};JPoint.prototype.eqXToP=function e(t){var n=this.z.redSqr(),i=t.toRed(this.curve.red).redMul(n);if(this.x.cmp(i)===0)return!0;for(var a=t.clone(),o=this.curve.redN.redMul(n);;){if(a.iadd(this.curve.n),a.cmp(this.curve.p)>=0)return!1;if(i.redIAdd(o),this.x.cmp(i)===0)return!0}};JPoint.prototype.inspect=function e(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"};JPoint.prototype.isInfinity=function e(){return this.z.cmpn(0)===0};var curve_1=createCommonjsModule(function(e,t){var n=t;n.base=base,n.short=short_1,n.mont=null,n.edwards=null}),curves_1=createCommonjsModule(function(e,t){var n=t,i=utils_1$1.assert;function a(d){d.type==="short"?this.curve=new curve_1.short(d):d.type==="edwards"?this.curve=new curve_1.edwards(d):this.curve=new curve_1.mont(d),this.g=this.curve.g,this.n=this.curve.n,this.hash=d.hash,i(this.g.validate(),"Invalid curve"),i(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}n.PresetCurve=a;function o(d,u){Object.defineProperty(n,d,{configurable:!0,enumerable:!0,get:function(){var l=new a(u);return Object.defineProperty(n,d,{configurable:!0,enumerable:!0,value:l}),l}})}o("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:hash.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),o("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:hash.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),o("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:hash.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),o("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:hash.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),o("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:hash.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),o("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:hash.sha256,gRed:!1,g:["9"]}),o("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:hash.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});var c;try{c=null.crash()}catch{c=void 0}o("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:hash.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",c]})});function HmacDRBG(e){if(!(this instanceof HmacDRBG))return new HmacDRBG(e);this.hash=e.hash,this.predResist=!!e.predResist,this.outLen=this.hash.outSize,this.minEntropy=e.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var t=utils_1.toArray(e.entropy,e.entropyEnc||"hex"),n=utils_1.toArray(e.nonce,e.nonceEnc||"hex"),i=utils_1.toArray(e.pers,e.persEnc||"hex");minimalisticAssert(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(t,n,i)}var hmacDrbg=HmacDRBG;HmacDRBG.prototype._init=function e(t,n,i){var a=t.concat(n).concat(i);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var o=0;o<this.V.length;o++)this.K[o]=0,this.V[o]=1;this._update(a),this._reseed=1,this.reseedInterval=281474976710656};HmacDRBG.prototype._hmac=function e(){return new hash.hmac(this.hash,this.K)};HmacDRBG.prototype._update=function e(t){var n=this._hmac().update(this.V).update([0]);t&&(n=n.update(t)),this.K=n.digest(),this.V=this._hmac().update(this.V).digest(),t&&(this.K=this._hmac().update(this.V).update([1]).update(t).digest(),this.V=this._hmac().update(this.V).digest())};HmacDRBG.prototype.reseed=function e(t,n,i,a){typeof n!="string"&&(a=i,i=n,n=null),t=utils_1.toArray(t,n),i=utils_1.toArray(i,a),minimalisticAssert(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(t.concat(i||[])),this._reseed=1};HmacDRBG.prototype.generate=function e(t,n,i,a){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");typeof n!="string"&&(a=i,i=n,n=null),i&&(i=utils_1.toArray(i,a||"hex"),this._update(i));for(var o=[];o.length<t;)this.V=this._hmac().update(this.V).digest(),o=o.concat(this.V);var c=o.slice(0,t);return this._update(i),this._reseed++,utils_1.encode(c,n)};var assert$3=utils_1$1.assert;function KeyPair(e,t){this.ec=e,this.priv=null,this.pub=null,t.priv&&this._importPrivate(t.priv,t.privEnc),t.pub&&this._importPublic(t.pub,t.pubEnc)}var key=KeyPair;KeyPair.fromPublic=function e(t,n,i){return n instanceof KeyPair?n:new KeyPair(t,{pub:n,pubEnc:i})};KeyPair.fromPrivate=function e(t,n,i){return n instanceof KeyPair?n:new KeyPair(t,{priv:n,privEnc:i})};KeyPair.prototype.validate=function e(){var t=this.getPublic();return t.isInfinity()?{result:!1,reason:"Invalid public key"}:t.validate()?t.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}};KeyPair.prototype.getPublic=function e(t,n){return typeof t=="string"&&(n=t,t=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),n?this.pub.encode(n,t):this.pub};KeyPair.prototype.getPrivate=function e(t){return t==="hex"?this.priv.toString(16,2):this.priv};KeyPair.prototype._importPrivate=function e(t,n){this.priv=new BN$1(t,n||16),this.priv=this.priv.umod(this.ec.curve.n)};KeyPair.prototype._importPublic=function e(t,n){if(t.x||t.y){this.ec.curve.type==="mont"?assert$3(t.x,"Need x coordinate"):(this.ec.curve.type==="short"||this.ec.curve.type==="edwards")&&assert$3(t.x&&t.y,"Need both x and y coordinate"),this.pub=this.ec.curve.point(t.x,t.y);return}this.pub=this.ec.curve.decodePoint(t,n)};KeyPair.prototype.derive=function e(t){return t.validate()||assert$3(t.validate(),"public point not validated"),t.mul(this.priv).getX()};KeyPair.prototype.sign=function e(t,n,i){return this.ec.sign(t,this,n,i)};KeyPair.prototype.verify=function e(t,n){return this.ec.verify(t,n,this)};KeyPair.prototype.inspect=function e(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"};var assert$4=utils_1$1.assert;function Signature(e,t){if(e instanceof Signature)return e;this._importDER(e,t)||(assert$4(e.r&&e.s,"Signature without r or s"),this.r=new BN$1(e.r,16),this.s=new BN$1(e.s,16),e.recoveryParam===void 0?this.recoveryParam=null:this.recoveryParam=e.recoveryParam)}var signature=Signature;function Position$1(){this.place=0}function getLength(e,t){var n=e[t.place++];if(!(n&128))return n;var i=n&15;if(i===0||i>4)return!1;for(var a=0,o=0,c=t.place;o<i;o++,c++)a<<=8,a|=e[c],a>>>=0;return a<=127?!1:(t.place=c,a)}function rmPadding(e){for(var t=0,n=e.length-1;!e[t]&&!(e[t+1]&128)&&t<n;)t++;return t===0?e:e.slice(t)}Signature.prototype._importDER=function e(t,n){t=utils_1$1.toArray(t,n);var i=new Position$1;if(t[i.place++]!==48)return!1;var a=getLength(t,i);if(a===!1||a+i.place!==t.length||t[i.place++]!==2)return!1;var o=getLength(t,i);if(o===!1)return!1;var c=t.slice(i.place,o+i.place);if(i.place+=o,t[i.place++]!==2)return!1;var d=getLength(t,i);if(d===!1||t.length!==d+i.place)return!1;var u=t.slice(i.place,d+i.place);if(c[0]===0)if(c[1]&128)c=c.slice(1);else return!1;if(u[0]===0)if(u[1]&128)u=u.slice(1);else return!1;return this.r=new BN$1(c),this.s=new BN$1(u),this.recoveryParam=null,!0};function constructLength(e,t){if(t<128){e.push(t);return}var n=1+(Math.log(t)/Math.LN2>>>3);for(e.push(n|128);--n;)e.push(t>>>(n<<3)&255);e.push(t)}Signature.prototype.toDER=function e(t){var n=this.r.toArray(),i=this.s.toArray();for(n[0]&128&&(n=[0].concat(n)),i[0]&128&&(i=[0].concat(i)),n=rmPadding(n),i=rmPadding(i);!i[0]&&!(i[1]&128);)i=i.slice(1);var a=[2];constructLength(a,n.length),a=a.concat(n),a.push(2),constructLength(a,i.length);var o=a.concat(i),c=[48];return constructLength(c,o.length),c=c.concat(o),utils_1$1.encode(c,t)};var rand=function(){throw new Error("unsupported")},assert$5=utils_1$1.assert;function EC(e){if(!(this instanceof EC))return new EC(e);typeof e=="string"&&(assert$5(Object.prototype.hasOwnProperty.call(curves_1,e),"Unknown curve "+e),e=curves_1[e]),e instanceof curves_1.PresetCurve&&(e={curve:e}),this.curve=e.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=e.curve.g,this.g.precompute(e.curve.n.bitLength()+1),this.hash=e.hash||e.curve.hash}var ec=EC;EC.prototype.keyPair=function e(t){return new key(this,t)};EC.prototype.keyFromPrivate=function e(t,n){return key.fromPrivate(this,t,n)};EC.prototype.keyFromPublic=function e(t,n){return key.fromPublic(this,t,n)};EC.prototype.genKeyPair=function e(t){t||(t={});for(var n=new hmacDrbg({hash:this.hash,pers:t.pers,persEnc:t.persEnc||"utf8",entropy:t.entropy||rand(this.hash.hmacStrength),entropyEnc:t.entropy&&t.entropyEnc||"utf8",nonce:this.n.toArray()}),i=this.n.byteLength(),a=this.n.sub(new BN$1(2));;){var o=new BN$1(n.generate(i));if(!(o.cmp(a)>0))return o.iaddn(1),this.keyFromPrivate(o)}};EC.prototype._truncateToN=function e(t,n){var i=t.byteLength()*8-this.n.bitLength();return i>0&&(t=t.ushrn(i)),!n&&t.cmp(this.n)>=0?t.sub(this.n):t};EC.prototype.sign=function e(t,n,i,a){typeof i=="object"&&(a=i,i=null),a||(a={}),n=this.keyFromPrivate(n,i),t=this._truncateToN(new BN$1(t,16));for(var o=this.n.byteLength(),c=n.getPrivate().toArray("be",o),d=t.toArray("be",o),u=new hmacDrbg({hash:this.hash,entropy:c,nonce:d,pers:a.pers,persEnc:a.persEnc||"utf8"}),l=this.n.sub(new BN$1(1)),h=0;;h++){var p=a.k?a.k(h):new BN$1(u.generate(this.n.byteLength()));if(p=this._truncateToN(p,!0),!(p.cmpn(1)<=0||p.cmp(l)>=0)){var y=this.g.mul(p);if(!y.isInfinity()){var E=y.getX(),x=E.umod(this.n);if(x.cmpn(0)!==0){var S=p.invm(this.n).mul(x.mul(n.getPrivate()).iadd(t));if(S=S.umod(this.n),S.cmpn(0)!==0){var k=(y.getY().isOdd()?1:0)|(E.cmp(x)!==0?2:0);return a.canonical&&S.cmp(this.nh)>0&&(S=this.n.sub(S),k^=1),new signature({r:x,s:S,recoveryParam:k})}}}}}};EC.prototype.verify=function e(t,n,i,a){t=this._truncateToN(new BN$1(t,16)),i=this.keyFromPublic(i,a),n=new signature(n,"hex");var o=n.r,c=n.s;if(o.cmpn(1)<0||o.cmp(this.n)>=0||c.cmpn(1)<0||c.cmp(this.n)>=0)return!1;var d=c.invm(this.n),u=d.mul(t).umod(this.n),l=d.mul(o).umod(this.n),h;return this.curve._maxwellTrick?(h=this.g.jmulAdd(u,i.getPublic(),l),h.isInfinity()?!1:h.eqXToP(o)):(h=this.g.mulAdd(u,i.getPublic(),l),h.isInfinity()?!1:h.getX().umod(this.n).cmp(o)===0)};EC.prototype.recoverPubKey=function(e,t,n,i){assert$5((3&n)===n,"The recovery param is more than two bits"),t=new signature(t,i);var a=this.n,o=new BN$1(e),c=t.r,d=t.s,u=n&1,l=n>>1;if(c.cmp(this.curve.p.umod(this.curve.n))>=0&&l)throw new Error("Unable to find sencond key candinate");l?c=this.curve.pointFromX(c.add(this.curve.n),u):c=this.curve.pointFromX(c,u);var h=t.r.invm(a),p=a.sub(o).mul(h).umod(a),y=d.mul(h).umod(a);return this.g.mulAdd(p,c,y)};EC.prototype.getKeyRecoveryParam=function(e,t,n,i){if(t=new signature(t,i),t.recoveryParam!==null)return t.recoveryParam;for(var a=0;a<4;a++){var o;try{o=this.recoverPubKey(e,t,a)}catch{continue}if(o.eq(n))return a}throw new Error("Unable to find valid recovery factor")};var elliptic_1=createCommonjsModule(function(e,t){var n=t;n.version="6.5.4",n.utils=utils_1$1,n.rand=function(){throw new Error("unsupported")},n.curve=curve_1,n.curves=curves_1,n.ec=ec,n.eddsa=null}),EC$1=elliptic_1.ec;const version$8="signing-key/5.7.0",logger$7=new Logger(version$8);let _curve=null;function getCurve(){return _curve||(_curve=new EC$1("secp256k1")),_curve}class SigningKey{constructor(t){defineReadOnly(this,"curve","secp256k1"),defineReadOnly(this,"privateKey",hexlify(t)),hexDataLength(this.privateKey)!==32&&logger$7.throwArgumentError("invalid private key","privateKey","[[ REDACTED ]]");const n=getCurve().keyFromPrivate(arrayify(this.privateKey));defineReadOnly(this,"publicKey","0x"+n.getPublic(!1,"hex")),defineReadOnly(this,"compressedPublicKey","0x"+n.getPublic(!0,"hex")),defineReadOnly(this,"_isSigningKey",!0)}_addPoint(t){const n=getCurve().keyFromPublic(arrayify(this.publicKey)),i=getCurve().keyFromPublic(arrayify(t));return"0x"+n.pub.add(i.pub).encodeCompressed("hex")}signDigest(t){const n=getCurve().keyFromPrivate(arrayify(this.privateKey)),i=arrayify(t);i.length!==32&&logger$7.throwArgumentError("bad digest length","digest",t);const a=n.sign(i,{canonical:!0});return splitSignature({recoveryParam:a.recoveryParam,r:hexZeroPad("0x"+a.r.toString(16),32),s:hexZeroPad("0x"+a.s.toString(16),32)})}computeSharedSecret(t){const n=getCurve().keyFromPrivate(arrayify(this.privateKey)),i=getCurve().keyFromPublic(arrayify(computePublicKey(t)));return hexZeroPad("0x"+n.derive(i.getPublic()).toString(16),32)}static isSigningKey(t){return!!(t&&t._isSigningKey)}}function computePublicKey(e,t){const n=arrayify(e);if(n.length===32){const i=new SigningKey(n);return t?"0x"+getCurve().keyFromPrivate(n).getPublic(!0,"hex"):i.publicKey}else{if(n.length===33)return t?hexlify(n):"0x"+getCurve().keyFromPublic(n).getPublic(!1,"hex");if(n.length===65)return t?"0x"+getCurve().keyFromPublic(n).getPublic(!0,"hex"):hexlify(n)}return logger$7.throwArgumentError("invalid public or private key","key","[REDACTED]")}const version$7="transactions/5.7.0",logger$6=new Logger(version$7);var TransactionTypes;(function(e){e[e.legacy=0]="legacy",e[e.eip2930=1]="eip2930",e[e.eip1559=2]="eip1559"})(TransactionTypes||(TransactionTypes={}));const transactionFields=[{name:"nonce",maxLength:32,numeric:!0},{name:"gasPrice",maxLength:32,numeric:!0},{name:"gasLimit",maxLength:32,numeric:!0},{name:"to",length:20},{name:"value",maxLength:32,numeric:!0},{name:"data"}],allowedTransactionKeys={chainId:!0,data:!0,gasLimit:!0,gasPrice:!0,nonce:!0,to:!0,type:!0,value:!0};function computeAddress(e){const t=computePublicKey(e);return getAddress(hexDataSlice(keccak256(hexDataSlice(t,1)),12))}function formatNumber(e,t){const n=stripZeros(BigNumber.from(e).toHexString());return n.length>32&&logger$6.throwArgumentError("invalid length for "+t,"transaction:"+t,e),n}function accessSetify(e,t){return{address:getAddress(e),storageKeys:(t||[]).map((n,i)=>(hexDataLength(n)!==32&&logger$6.throwArgumentError("invalid access list storageKey",`accessList[${e}:${i}]`,n),n.toLowerCase()))}}function accessListify(e){if(Array.isArray(e))return e.map((n,i)=>Array.isArray(n)?(n.length>2&&logger$6.throwArgumentError("access list expected to be [ address, storageKeys[] ]",`value[${i}]`,n),accessSetify(n[0],n[1])):accessSetify(n.address,n.storageKeys));const t=Object.keys(e).map(n=>{const i=e[n].reduce((a,o)=>(a[o]=!0,a),{});return accessSetify(n,Object.keys(i).sort())});return t.sort((n,i)=>n.address.localeCompare(i.address)),t}function formatAccessList(e){return accessListify(e).map(t=>[t.address,t.storageKeys])}function _serializeEip1559(e,t){if(e.gasPrice!=null){const i=BigNumber.from(e.gasPrice),a=BigNumber.from(e.maxFeePerGas||0);i.eq(a)||logger$6.throwArgumentError("mismatch EIP-1559 gasPrice != maxFeePerGas","tx",{gasPrice:i,maxFeePerGas:a})}const n=[formatNumber(e.chainId||0,"chainId"),formatNumber(e.nonce||0,"nonce"),formatNumber(e.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),formatNumber(e.maxFeePerGas||0,"maxFeePerGas"),formatNumber(e.gasLimit||0,"gasLimit"),e.to!=null?getAddress(e.to):"0x",formatNumber(e.value||0,"value"),e.data||"0x",formatAccessList(e.accessList||[])];if(t){const i=splitSignature(t);n.push(formatNumber(i.recoveryParam,"recoveryParam")),n.push(stripZeros(i.r)),n.push(stripZeros(i.s))}return hexConcat(["0x02",encode(n)])}function _serializeEip2930(e,t){const n=[formatNumber(e.chainId||0,"chainId"),formatNumber(e.nonce||0,"nonce"),formatNumber(e.gasPrice||0,"gasPrice"),formatNumber(e.gasLimit||0,"gasLimit"),e.to!=null?getAddress(e.to):"0x",formatNumber(e.value||0,"value"),e.data||"0x",formatAccessList(e.accessList||[])];if(t){const i=splitSignature(t);n.push(formatNumber(i.recoveryParam,"recoveryParam")),n.push(stripZeros(i.r)),n.push(stripZeros(i.s))}return hexConcat(["0x01",encode(n)])}function _serialize(e,t){checkProperties(e,allowedTransactionKeys);const n=[];transactionFields.forEach(function(c){let d=e[c.name]||[];const u={};c.numeric&&(u.hexPad="left"),d=arrayify(hexlify(d,u)),c.length&&d.length!==c.length&&d.length>0&&logger$6.throwArgumentError("invalid length for "+c.name,"transaction:"+c.name,d),c.maxLength&&(d=stripZeros(d),d.length>c.maxLength&&logger$6.throwArgumentError("invalid length for "+c.name,"transaction:"+c.name,d)),n.push(hexlify(d))});let i=0;if(e.chainId!=null?(i=e.chainId,typeof i!="number"&&logger$6.throwArgumentError("invalid transaction.chainId","transaction",e)):t&&!isBytesLike(t)&&t.v>28&&(i=Math.floor((t.v-35)/2)),i!==0&&(n.push(hexlify(i)),n.push("0x"),n.push("0x")),!t)return encode(n);const a=splitSignature(t);let o=27+a.recoveryParam;return i!==0?(n.pop(),n.pop(),n.pop(),o+=i*2+8,a.v>28&&a.v!==o&&logger$6.throwArgumentError("transaction.chainId/signature.v mismatch","signature",t)):a.v!==o&&logger$6.throwArgumentError("transaction.chainId/signature.v mismatch","signature",t),n.push(hexlify(o)),n.push(stripZeros(arrayify(a.r))),n.push(stripZeros(arrayify(a.s))),encode(n)}function serialize(e,t){if(e.type==null||e.type===0)return e.accessList!=null&&logger$6.throwArgumentError("untyped transactions do not support accessList; include type: 1","transaction",e),_serialize(e,t);switch(e.type){case 1:return _serializeEip2930(e,t);case 2:return _serializeEip1559(e,t)}return logger$6.throwError(`unsupported transaction type: ${e.type}`,Logger.errors.UNSUPPORTED_OPERATION,{operation:"serializeTransaction",transactionType:e.type})}const version$6="wordlists/5.7.0",logger$5=new Logger(version$6);class Wordlist{constructor(t){logger$5.checkAbstract(new.target,Wordlist),defineReadOnly(this,"locale",t)}split(t){return t.toLowerCase().split(/ +/g)}join(t){return t.join(" ")}static check(t){const n=[];for(let i=0;i<2048;i++){const a=t.getWord(i);if(i!==t.getWordIndex(a))return"0x";n.push(a)}return id(n.join(`
`)+`
`)}static register(t,n){n||(n=t.locale)}}const words="AbandonAbilityAbleAboutAboveAbsentAbsorbAbstractAbsurdAbuseAccessAccidentAccountAccuseAchieveAcidAcousticAcquireAcrossActActionActorActressActualAdaptAddAddictAddressAdjustAdmitAdultAdvanceAdviceAerobicAffairAffordAfraidAgainAgeAgentAgreeAheadAimAirAirportAisleAlarmAlbumAlcoholAlertAlienAllAlleyAllowAlmostAloneAlphaAlreadyAlsoAlterAlwaysAmateurAmazingAmongAmountAmusedAnalystAnchorAncientAngerAngleAngryAnimalAnkleAnnounceAnnualAnotherAnswerAntennaAntiqueAnxietyAnyApartApologyAppearAppleApproveAprilArchArcticAreaArenaArgueArmArmedArmorArmyAroundArrangeArrestArriveArrowArtArtefactArtistArtworkAskAspectAssaultAssetAssistAssumeAsthmaAthleteAtomAttackAttendAttitudeAttractAuctionAuditAugustAuntAuthorAutoAutumnAverageAvocadoAvoidAwakeAwareAwayAwesomeAwfulAwkwardAxisBabyBachelorBaconBadgeBagBalanceBalconyBallBambooBananaBannerBarBarelyBargainBarrelBaseBasicBasketBattleBeachBeanBeautyBecauseBecomeBeefBeforeBeginBehaveBehindBelieveBelowBeltBenchBenefitBestBetrayBetterBetweenBeyondBicycleBidBikeBindBiologyBirdBirthBitterBlackBladeBlameBlanketBlastBleakBlessBlindBloodBlossomBlouseBlueBlurBlushBoardBoatBodyBoilBombBoneBonusBookBoostBorderBoringBorrowBossBottomBounceBoxBoyBracketBrainBrandBrassBraveBreadBreezeBrickBridgeBriefBrightBringBriskBroccoliBrokenBronzeBroomBrotherBrownBrushBubbleBuddyBudgetBuffaloBuildBulbBulkBulletBundleBunkerBurdenBurgerBurstBusBusinessBusyButterBuyerBuzzCabbageCabinCableCactusCageCakeCallCalmCameraCampCanCanalCancelCandyCannonCanoeCanvasCanyonCapableCapitalCaptainCarCarbonCardCargoCarpetCarryCartCaseCashCasinoCastleCasualCatCatalogCatchCategoryCattleCaughtCauseCautionCaveCeilingCeleryCementCensusCenturyCerealCertainChairChalkChampionChangeChaosChapterChargeChaseChatCheapCheckCheeseChefCherryChestChickenChiefChildChimneyChoiceChooseChronicChuckleChunkChurnCigarCinnamonCircleCitizenCityCivilClaimClapClarifyClawClayCleanClerkCleverClickClientCliffClimbClinicClipClockClogCloseClothCloudClownClubClumpClusterClutchCoachCoastCoconutCodeCoffeeCoilCoinCollectColorColumnCombineComeComfortComicCommonCompanyConcertConductConfirmCongressConnectConsiderControlConvinceCookCoolCopperCopyCoralCoreCornCorrectCostCottonCouchCountryCoupleCourseCousinCoverCoyoteCrackCradleCraftCramCraneCrashCraterCrawlCrazyCreamCreditCreekCrewCricketCrimeCrispCriticCropCrossCrouchCrowdCrucialCruelCruiseCrumbleCrunchCrushCryCrystalCubeCultureCupCupboardCuriousCurrentCurtainCurveCushionCustomCuteCycleDadDamageDampDanceDangerDaringDashDaughterDawnDayDealDebateDebrisDecadeDecemberDecideDeclineDecorateDecreaseDeerDefenseDefineDefyDegreeDelayDeliverDemandDemiseDenialDentistDenyDepartDependDepositDepthDeputyDeriveDescribeDesertDesignDeskDespairDestroyDetailDetectDevelopDeviceDevoteDiagramDialDiamondDiaryDiceDieselDietDifferDigitalDignityDilemmaDinnerDinosaurDirectDirtDisagreeDiscoverDiseaseDishDismissDisorderDisplayDistanceDivertDivideDivorceDizzyDoctorDocumentDogDollDolphinDomainDonateDonkeyDonorDoorDoseDoubleDoveDraftDragonDramaDrasticDrawDreamDressDriftDrillDrinkDripDriveDropDrumDryDuckDumbDuneDuringDustDutchDutyDwarfDynamicEagerEagleEarlyEarnEarthEasilyEastEasyEchoEcologyEconomyEdgeEditEducateEffortEggEightEitherElbowElderElectricElegantElementElephantElevatorEliteElseEmbarkEmbodyEmbraceEmergeEmotionEmployEmpowerEmptyEnableEnactEndEndlessEndorseEnemyEnergyEnforceEngageEngineEnhanceEnjoyEnlistEnoughEnrichEnrollEnsureEnterEntireEntryEnvelopeEpisodeEqualEquipEraEraseErodeErosionErrorEruptEscapeEssayEssenceEstateEternalEthicsEvidenceEvilEvokeEvolveExactExampleExcessExchangeExciteExcludeExcuseExecuteExerciseExhaustExhibitExileExistExitExoticExpandExpectExpireExplainExposeExpressExtendExtraEyeEyebrowFabricFaceFacultyFadeFaintFaithFallFalseFameFamilyFamousFanFancyFantasyFarmFashionFatFatalFatherFatigueFaultFavoriteFeatureFebruaryFederalFeeFeedFeelFemaleFenceFestivalFetchFeverFewFiberFictionFieldFigureFileFilmFilterFinalFindFineFingerFinishFireFirmFirstFiscalFishFitFitnessFixFlagFlameFlashFlatFlavorFleeFlightFlipFloatFlockFloorFlowerFluidFlushFlyFoamFocusFogFoilFoldFollowFoodFootForceForestForgetForkFortuneForumForwardFossilFosterFoundFoxFragileFrameFrequentFreshFriendFringeFrogFrontFrostFrownFrozenFruitFuelFunFunnyFurnaceFuryFutureGadgetGainGalaxyGalleryGameGapGarageGarbageGardenGarlicGarmentGasGaspGateGatherGaugeGazeGeneralGeniusGenreGentleGenuineGestureGhostGiantGiftGiggleGingerGiraffeGirlGiveGladGlanceGlareGlassGlideGlimpseGlobeGloomGloryGloveGlowGlueGoatGoddessGoldGoodGooseGorillaGospelGossipGovernGownGrabGraceGrainGrantGrapeGrassGravityGreatGreenGridGriefGritGroceryGroupGrowGruntGuardGuessGuideGuiltGuitarGunGymHabitHairHalfHammerHamsterHandHappyHarborHardHarshHarvestHatHaveHawkHazardHeadHealthHeartHeavyHedgehogHeightHelloHelmetHelpHenHeroHiddenHighHillHintHipHireHistoryHobbyHockeyHoldHoleHolidayHollowHomeHoneyHoodHopeHornHorrorHorseHospitalHostHotelHourHoverHubHugeHumanHumbleHumorHundredHungryHuntHurdleHurryHurtHusbandHybridIceIconIdeaIdentifyIdleIgnoreIllIllegalIllnessImageImitateImmenseImmuneImpactImposeImproveImpulseInchIncludeIncomeIncreaseIndexIndicateIndoorIndustryInfantInflictInformInhaleInheritInitialInjectInjuryInmateInnerInnocentInputInquiryInsaneInsectInsideInspireInstallIntactInterestIntoInvestInviteInvolveIronIslandIsolateIssueItemIvoryJacketJaguarJarJazzJealousJeansJellyJewelJobJoinJokeJourneyJoyJudgeJuiceJumpJungleJuniorJunkJustKangarooKeenKeepKetchupKeyKickKidKidneyKindKingdomKissKitKitchenKiteKittenKiwiKneeKnifeKnockKnowLabLabelLaborLadderLadyLakeLampLanguageLaptopLargeLaterLatinLaughLaundryLavaLawLawnLawsuitLayerLazyLeaderLeafLearnLeaveLectureLeftLegLegalLegendLeisureLemonLendLengthLensLeopardLessonLetterLevelLiarLibertyLibraryLicenseLifeLiftLightLikeLimbLimitLinkLionLiquidListLittleLiveLizardLoadLoanLobsterLocalLockLogicLonelyLongLoopLotteryLoudLoungeLoveLoyalLuckyLuggageLumberLunarLunchLuxuryLyricsMachineMadMagicMagnetMaidMailMainMajorMakeMammalManManageMandateMangoMansionManualMapleMarbleMarchMarginMarineMarketMarriageMaskMassMasterMatchMaterialMathMatrixMatterMaximumMazeMeadowMeanMeasureMeatMechanicMedalMediaMelodyMeltMemberMemoryMentionMenuMercyMergeMeritMerryMeshMessageMetalMethodMiddleMidnightMilkMillionMimicMindMinimumMinorMinuteMiracleMirrorMiseryMissMistakeMixMixedMixtureMobileModelModifyMomMomentMonitorMonkeyMonsterMonthMoonMoralMoreMorningMosquitoMotherMotionMotorMountainMouseMoveMovieMuchMuffinMuleMultiplyMuscleMuseumMushroomMusicMustMutualMyselfMysteryMythNaiveNameNapkinNarrowNastyNationNatureNearNeckNeedNegativeNeglectNeitherNephewNerveNestNetNetworkNeutralNeverNewsNextNiceNightNobleNoiseNomineeNoodleNormalNorthNoseNotableNoteNothingNoticeNovelNowNuclearNumberNurseNutOakObeyObjectObligeObscureObserveObtainObviousOccurOceanOctoberOdorOffOfferOfficeOftenOilOkayOldOliveOlympicOmitOnceOneOnionOnlineOnlyOpenOperaOpinionOpposeOptionOrangeOrbitOrchardOrderOrdinaryOrganOrientOriginalOrphanOstrichOtherOutdoorOuterOutputOutsideOvalOvenOverOwnOwnerOxygenOysterOzonePactPaddlePagePairPalacePalmPandaPanelPanicPantherPaperParadeParentParkParrotPartyPassPatchPathPatientPatrolPatternPausePavePaymentPeacePeanutPearPeasantPelicanPenPenaltyPencilPeoplePepperPerfectPermitPersonPetPhonePhotoPhrasePhysicalPianoPicnicPicturePiecePigPigeonPillPilotPinkPioneerPipePistolPitchPizzaPlacePlanetPlasticPlatePlayPleasePledgePluckPlugPlungePoemPoetPointPolarPolePolicePondPonyPoolPopularPortionPositionPossiblePostPotatoPotteryPovertyPowderPowerPracticePraisePredictPreferPreparePresentPrettyPreventPricePridePrimaryPrintPriorityPrisonPrivatePrizeProblemProcessProduceProfitProgramProjectPromoteProofPropertyProsperProtectProudProvidePublicPuddingPullPulpPulsePumpkinPunchPupilPuppyPurchasePurityPurposePursePushPutPuzzlePyramidQualityQuantumQuarterQuestionQuickQuitQuizQuoteRabbitRaccoonRaceRackRadarRadioRailRainRaiseRallyRampRanchRandomRangeRapidRareRateRatherRavenRawRazorReadyRealReasonRebelRebuildRecallReceiveRecipeRecordRecycleReduceReflectReformRefuseRegionRegretRegularRejectRelaxReleaseReliefRelyRemainRememberRemindRemoveRenderRenewRentReopenRepairRepeatReplaceReportRequireRescueResembleResistResourceResponseResultRetireRetreatReturnReunionRevealReviewRewardRhythmRibRibbonRiceRichRideRidgeRifleRightRigidRingRiotRippleRiskRitualRivalRiverRoadRoastRobotRobustRocketRomanceRoofRookieRoomRoseRotateRoughRoundRouteRoyalRubberRudeRugRuleRunRunwayRuralSadSaddleSadnessSafeSailSaladSalmonSalonSaltSaluteSameSampleSandSatisfySatoshiSauceSausageSaveSayScaleScanScareScatterSceneSchemeSchoolScienceScissorsScorpionScoutScrapScreenScriptScrubSeaSearchSeasonSeatSecondSecretSectionSecuritySeedSeekSegmentSelectSellSeminarSeniorSenseSentenceSeriesServiceSessionSettleSetupSevenShadowShaftShallowShareShedShellSheriffShieldShiftShineShipShiverShockShoeShootShopShortShoulderShoveShrimpShrugShuffleShySiblingSickSideSiegeSightSignSilentSilkSillySilverSimilarSimpleSinceSingSirenSisterSituateSixSizeSkateSketchSkiSkillSkinSkirtSkullSlabSlamSleepSlenderSliceSlideSlightSlimSloganSlotSlowSlushSmallSmartSmileSmokeSmoothSnackSnakeSnapSniffSnowSoapSoccerSocialSockSodaSoftSolarSoldierSolidSolutionSolveSomeoneSongSoonSorrySortSoulSoundSoupSourceSouthSpaceSpareSpatialSpawnSpeakSpecialSpeedSpellSpendSphereSpiceSpiderSpikeSpinSpiritSplitSpoilSponsorSpoonSportSpotSpraySpreadSpringSpySquareSqueezeSquirrelStableStadiumStaffStageStairsStampStandStartStateStaySteakSteelStemStepStereoStickStillStingStockStomachStoneStoolStoryStoveStrategyStreetStrikeStrongStruggleStudentStuffStumbleStyleSubjectSubmitSubwaySuccessSuchSuddenSufferSugarSuggestSuitSummerSunSunnySunsetSuperSupplySupremeSureSurfaceSurgeSurpriseSurroundSurveySuspectSustainSwallowSwampSwapSwarmSwearSweetSwiftSwimSwingSwitchSwordSymbolSymptomSyrupSystemTableTackleTagTailTalentTalkTankTapeTargetTaskTasteTattooTaxiTeachTeamTellTenTenantTennisTentTermTestTextThankThatThemeThenTheoryThereTheyThingThisThoughtThreeThriveThrowThumbThunderTicketTideTigerTiltTimberTimeTinyTipTiredTissueTitleToastTobaccoTodayToddlerToeTogetherToiletTokenTomatoTomorrowToneTongueTonightToolToothTopTopicToppleTorchTornadoTortoiseTossTotalTouristTowardTowerTownToyTrackTradeTrafficTragicTrainTransferTrapTrashTravelTrayTreatTreeTrendTrialTribeTrickTriggerTrimTripTrophyTroubleTruckTrueTrulyTrumpetTrustTruthTryTubeTuitionTumbleTunaTunnelTurkeyTurnTurtleTwelveTwentyTwiceTwinTwistTwoTypeTypicalUglyUmbrellaUnableUnawareUncleUncoverUnderUndoUnfairUnfoldUnhappyUniformUniqueUnitUniverseUnknownUnlockUntilUnusualUnveilUpdateUpgradeUpholdUponUpperUpsetUrbanUrgeUsageUseUsedUsefulUselessUsualUtilityVacantVacuumVagueValidValleyValveVanVanishVaporVariousVastVaultVehicleVelvetVendorVentureVenueVerbVerifyVersionVeryVesselVeteranViableVibrantViciousVictoryVideoViewVillageVintageViolinVirtualVirusVisaVisitVisualVitalVividVocalVoiceVoidVolcanoVolumeVoteVoyageWageWagonWaitWalkWallWalnutWantWarfareWarmWarriorWashWaspWasteWaterWaveWayWealthWeaponWearWeaselWeatherWebWeddingWeekendWeirdWelcomeWestWetWhaleWhatWheatWheelWhenWhereWhipWhisperWideWidthWifeWildWillWinWindowWineWingWinkWinnerWinterWireWisdomWiseWishWitnessWolfWomanWonderWoodWoolWordWorkWorldWorryWorthWrapWreckWrestleWristWriteWrongYardYearYellowYouYoungYouthZebraZeroZoneZoo";let wordlist=null;function loadWords(e){if(wordlist==null&&(wordlist=words.replace(/([A-Z])/g," $1").toLowerCase().substring(1).split(" "),Wordlist.check(e)!=="0x3c8acc1e7b08d8e76f9fda015ef48dc8c710a73cb7e0f77b2c18a9b5a7adde60"))throw wordlist=null,new Error("BIP39 Wordlist for en (English) FAILED")}class LangEn extends Wordlist{constructor(){super("en")}getWord(t){return loadWords(this),wordlist[t]}getWordIndex(t){return loadWords(this),wordlist.indexOf(t)}}const langEn=new LangEn;Wordlist.register(langEn);const wordlists={en:langEn},version$5="hdnode/5.7.0",logger$4=new Logger(version$5),N=BigNumber.from("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),MasterSecret=toUtf8Bytes("Bitcoin seed"),HardenedBit=2147483648;function getUpperMask(e){return(1<<e)-1<<8-e}function getLowerMask(e){return(1<<e)-1}function bytes32(e){return hexZeroPad(hexlify(e),32)}function base58check(e){return Base58.encode(concat([e,hexDataSlice(sha256(sha256(e)),0,4)]))}function getWordlist(e){if(e==null)return wordlists.en;if(typeof e=="string"){const t=wordlists[e];return t==null&&logger$4.throwArgumentError("unknown locale","wordlist",e),t}return e}const _constructorGuard={},defaultPath="m/44'/60'/0'/0/0";class HDNode{constructor(t,n,i,a,o,c,d,u){if(t!==_constructorGuard)throw new Error("HDNode constructor cannot be called directly");if(n){const l=new SigningKey(n);defineReadOnly(this,"privateKey",l.privateKey),defineReadOnly(this,"publicKey",l.compressedPublicKey)}else defineReadOnly(this,"privateKey",null),defineReadOnly(this,"publicKey",hexlify(i));defineReadOnly(this,"parentFingerprint",a),defineReadOnly(this,"fingerprint",hexDataSlice(ripemd160(sha256(this.publicKey)),0,4)),defineReadOnly(this,"address",computeAddress(this.publicKey)),defineReadOnly(this,"chainCode",o),defineReadOnly(this,"index",c),defineReadOnly(this,"depth",d),u==null?(defineReadOnly(this,"mnemonic",null),defineReadOnly(this,"path",null)):typeof u=="string"?(defineReadOnly(this,"mnemonic",null),defineReadOnly(this,"path",u)):(defineReadOnly(this,"mnemonic",u),defineReadOnly(this,"path",u.path))}get extendedKey(){if(this.depth>=256)throw new Error("Depth too large!");return base58check(concat([this.privateKey!=null?"0x0488ADE4":"0x0488B21E",hexlify(this.depth),this.parentFingerprint,hexZeroPad(hexlify(this.index),4),this.chainCode,this.privateKey!=null?concat(["0x00",this.privateKey]):this.publicKey]))}neuter(){return new HDNode(_constructorGuard,null,this.publicKey,this.parentFingerprint,this.chainCode,this.index,this.depth,this.path)}_derive(t){if(t>4294967295)throw new Error("invalid index - "+String(t));let n=this.path;n&&(n+="/"+(t&~HardenedBit));const i=new Uint8Array(37);if(t&HardenedBit){if(!this.privateKey)throw new Error("cannot derive child of neutered node");i.set(arrayify(this.privateKey),1),n&&(n+="'")}else i.set(arrayify(this.publicKey));for(let p=24;p>=0;p-=8)i[33+(p>>3)]=t>>24-p&255;const a=arrayify(computeHmac(SupportedAlgorithm.sha512,this.chainCode,i)),o=a.slice(0,32),c=a.slice(32);let d=null,u=null;this.privateKey?d=bytes32(BigNumber.from(o).add(this.privateKey).mod(N)):u=new SigningKey(hexlify(o))._addPoint(this.publicKey);let l=n;const h=this.mnemonic;return h&&(l=Object.freeze({phrase:h.phrase,path:n,locale:h.locale||"en"})),new HDNode(_constructorGuard,d,u,this.fingerprint,bytes32(c),t,this.depth+1,l)}derivePath(t){const n=t.split("/");if(n.length===0||n[0]==="m"&&this.depth!==0)throw new Error("invalid path - "+t);n[0]==="m"&&n.shift();let i=this;for(let a=0;a<n.length;a++){const o=n[a];if(o.match(/^[0-9]+'$/)){const c=parseInt(o.substring(0,o.length-1));if(c>=HardenedBit)throw new Error("invalid path index - "+o);i=i._derive(HardenedBit+c)}else if(o.match(/^[0-9]+$/)){const c=parseInt(o);if(c>=HardenedBit)throw new Error("invalid path index - "+o);i=i._derive(c)}else throw new Error("invalid path component - "+o)}return i}static _fromSeed(t,n){const i=arrayify(t);if(i.length<16||i.length>64)throw new Error("invalid seed");const a=arrayify(computeHmac(SupportedAlgorithm.sha512,MasterSecret,i));return new HDNode(_constructorGuard,bytes32(a.slice(0,32)),null,"0x00000000",bytes32(a.slice(32)),0,0,n)}static fromMnemonic(t,n,i){return i=getWordlist(i),t=entropyToMnemonic(mnemonicToEntropy(t,i),i),HDNode._fromSeed(mnemonicToSeed(t,n),{phrase:t,path:"m",locale:i.locale})}static fromSeed(t){return HDNode._fromSeed(t,null)}static fromExtendedKey(t){const n=Base58.decode(t);(n.length!==82||base58check(n.slice(0,78))!==t)&&logger$4.throwArgumentError("invalid extended key","extendedKey","[REDACTED]");const i=n[4],a=hexlify(n.slice(5,9)),o=parseInt(hexlify(n.slice(9,13)).substring(2),16),c=hexlify(n.slice(13,45)),d=n.slice(45,78);switch(hexlify(n.slice(0,4))){case"0x0488b21e":case"0x043587cf":return new HDNode(_constructorGuard,null,hexlify(d),a,c,o,i,null);case"0x0488ade4":case"0x04358394 ":if(d[0]!==0)break;return new HDNode(_constructorGuard,hexlify(d.slice(1)),null,a,c,o,i,null)}return logger$4.throwArgumentError("invalid extended key","extendedKey","[REDACTED]")}}function mnemonicToSeed(e,t){t||(t="");const n=toUtf8Bytes("mnemonic"+t,UnicodeNormalizationForm.NFKD);return pbkdf2$1(toUtf8Bytes(e,UnicodeNormalizationForm.NFKD),n,2048,64,"sha512")}function mnemonicToEntropy(e,t){t=getWordlist(t),logger$4.checkNormalize();const n=t.split(e);if(n.length%3!==0)throw new Error("invalid mnemonic");const i=arrayify(new Uint8Array(Math.ceil(11*n.length/8)));let a=0;for(let l=0;l<n.length;l++){let h=t.getWordIndex(n[l].normalize("NFKD"));if(h===-1)throw new Error("invalid mnemonic");for(let p=0;p<11;p++)h&1<<10-p&&(i[a>>3]|=1<<7-a%8),a++}const o=32*n.length/3,c=n.length/3,d=getUpperMask(c);if((arrayify(sha256(i.slice(0,o/8)))[0]&d)!==(i[i.length-1]&d))throw new Error("invalid checksum");return hexlify(i.slice(0,o/8))}function entropyToMnemonic(e,t){if(t=getWordlist(t),e=arrayify(e),e.length%4!==0||e.length<16||e.length>32)throw new Error("invalid entropy");const n=[0];let i=11;for(let c=0;c<e.length;c++)i>8?(n[n.length-1]<<=8,n[n.length-1]|=e[c],i-=8):(n[n.length-1]<<=i,n[n.length-1]|=e[c]>>8-i,n.push(e[c]&getLowerMask(8-i)),i+=3);const a=e.length/4,o=arrayify(sha256(e))[0]&getUpperMask(a);return n[n.length-1]<<=a,n[n.length-1]|=o>>8-a,t.join(n.map(c=>t.getWord(c)))}const version$4="random/5.7.0",logger$3=new Logger(version$4);function getGlobal(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}const anyGlobal=getGlobal();let crypto$1=anyGlobal.crypto||anyGlobal.msCrypto;(!crypto$1||!crypto$1.getRandomValues)&&(logger$3.warn("WARNING: Missing strong random number source"),crypto$1={getRandomValues:function(e){return logger$3.throwError("no secure random source avaialble",Logger.errors.UNSUPPORTED_OPERATION,{operation:"crypto.getRandomValues"})}});function randomBytes(e){(e<=0||e>1024||e%1||e!=e)&&logger$3.throwArgumentError("invalid length","length",e);const t=new Uint8Array(e);return crypto$1.getRandomValues(t),arrayify(t)}var aesJsExports={},aesJs={get exports(){return aesJsExports},set exports(e){aesJsExports=e}};(function(e,t){(function(n){function i(_){return parseInt(_)===_}function a(_){if(!i(_.length))return!1;for(var m=0;m<_.length;m++)if(!i(_[m])||_[m]<0||_[m]>255)return!1;return!0}function o(_,m){if(_.buffer&&ArrayBuffer.isView(_)&&_.name==="Uint8Array")return m&&(_.slice?_=_.slice():_=Array.prototype.slice.call(_)),_;if(Array.isArray(_)){if(!a(_))throw new Error("Array contains invalid value: "+_);return new Uint8Array(_)}if(i(_.length)&&a(_))return new Uint8Array(_);throw new Error("unsupported array-like object")}function c(_){return new Uint8Array(_)}function d(_,m,b,$,g){($!=null||g!=null)&&(_.slice?_=_.slice($,g):_=Array.prototype.slice.call(_,$,g)),m.set(_,b)}var u=function(){function _(b){var $=[],g=0;for(b=encodeURI(b);g<b.length;){var O=b.charCodeAt(g++);O===37?($.push(parseInt(b.substr(g,2),16)),g+=2):$.push(O)}return o($)}function m(b){for(var $=[],g=0;g<b.length;){var O=b[g];O<128?($.push(String.fromCharCode(O)),g++):O>191&&O<224?($.push(String.fromCharCode((O&31)<<6|b[g+1]&63)),g+=2):($.push(String.fromCharCode((O&15)<<12|(b[g+1]&63)<<6|b[g+2]&63)),g+=3)}return $.join("")}return{toBytes:_,fromBytes:m}}(),l=function(){function _($){for(var g=[],O=0;O<$.length;O+=2)g.push(parseInt($.substr(O,2),16));return g}var m="0123456789abcdef";function b($){for(var g=[],O=0;O<$.length;O++){var te=$[O];g.push(m[(te&240)>>4]+m[te&15])}return g.join("")}return{toBytes:_,fromBytes:b}}(),h={16:10,24:12,32:14},p=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],y=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],E=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],x=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],S=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],k=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],T=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],L=[1374988112,2118214995,437757123,975658646,1001089995,530400753,2902087851,1273168787,540080725,2910219766,2295101073,4110568485,1340463100,3307916247,641025152,3043140495,3736164937,632953703,1172967064,1576976609,3274667266,2169303058,2370213795,1809054150,59727847,361929877,3211623147,2505202138,3569255213,1484005843,1239443753,2395588676,1975683434,4102977912,2572697195,666464733,3202437046,4035489047,3374361702,2110667444,1675577880,3843699074,2538681184,1649639237,2976151520,3144396420,4269907996,4178062228,1883793496,2403728665,2497604743,1383856311,2876494627,1917518562,3810496343,1716890410,3001755655,800440835,2261089178,3543599269,807962610,599762354,33778362,3977675356,2328828971,2809771154,4077384432,1315562145,1708848333,101039829,3509871135,3299278474,875451293,2733856160,92987698,2767645557,193195065,1080094634,1584504582,3178106961,1042385657,2531067453,3711829422,1306967366,2438237621,1908694277,67556463,1615861247,429456164,3602770327,2302690252,1742315127,2968011453,126454664,3877198648,2043211483,2709260871,2084704233,4169408201,0,159417987,841739592,504459436,1817866830,4245618683,260388950,1034867998,908933415,168810852,1750902305,2606453969,607530554,202008497,2472011535,3035535058,463180190,2160117071,1641816226,1517767529,470948374,3801332234,3231722213,1008918595,303765277,235474187,4069246893,766945465,337553864,1475418501,2943682380,4003061179,2743034109,4144047775,1551037884,1147550661,1543208500,2336434550,3408119516,3069049960,3102011747,3610369226,1113818384,328671808,2227573024,2236228733,3535486456,2935566865,3341394285,496906059,3702665459,226906860,2009195472,733156972,2842737049,294930682,1206477858,2835123396,2700099354,1451044056,573804783,2269728455,3644379585,2362090238,2564033334,2801107407,2776292904,3669462566,1068351396,742039012,1350078989,1784663195,1417561698,4136440770,2430122216,775550814,2193862645,2673705150,1775276924,1876241833,3475313331,3366754619,270040487,3902563182,3678124923,3441850377,1851332852,3969562369,2203032232,3868552805,2868897406,566021896,4011190502,3135740889,1248802510,3936291284,699432150,832877231,708780849,3332740144,899835584,1951317047,4236429990,3767586992,866637845,4043610186,1106041591,2144161806,395441711,1984812685,1139781709,3433712980,3835036895,2664543715,1282050075,3240894392,1181045119,2640243204,25965917,4203181171,4211818798,3009879386,2463879762,3910161971,1842759443,2597806476,933301370,1509430414,3943906441,3467192302,3076639029,3776767469,2051518780,2631065433,1441952575,404016761,1942435775,1408749034,1610459739,3745345300,2017778566,3400528769,3110650942,941896748,3265478751,371049330,3168937228,675039627,4279080257,967311729,135050206,3635733660,1683407248,2076935265,3576870512,1215061108,3501741890],q=[1347548327,1400783205,3273267108,2520393566,3409685355,4045380933,2880240216,2471224067,1428173050,4138563181,2441661558,636813900,4233094615,3620022987,2149987652,2411029155,1239331162,1730525723,2554718734,3781033664,46346101,310463728,2743944855,3328955385,3875770207,2501218972,3955191162,3667219033,768917123,3545789473,692707433,1150208456,1786102409,2029293177,1805211710,3710368113,3065962831,401639597,1724457132,3028143674,409198410,2196052529,1620529459,1164071807,3769721975,2226875310,486441376,2499348523,1483753576,428819965,2274680428,3075636216,598438867,3799141122,1474502543,711349675,129166120,53458370,2592523643,2782082824,4063242375,2988687269,3120694122,1559041666,730517276,2460449204,4042459122,2706270690,3446004468,3573941694,533804130,2328143614,2637442643,2695033685,839224033,1973745387,957055980,2856345839,106852767,1371368976,4181598602,1033297158,2933734917,1179510461,3046200461,91341917,1862534868,4284502037,605657339,2547432937,3431546947,2003294622,3182487618,2282195339,954669403,3682191598,1201765386,3917234703,3388507166,0,2198438022,1211247597,2887651696,1315723890,4227665663,1443857720,507358933,657861945,1678381017,560487590,3516619604,975451694,2970356327,261314535,3535072918,2652609425,1333838021,2724322336,1767536459,370938394,182621114,3854606378,1128014560,487725847,185469197,2918353863,3106780840,3356761769,2237133081,1286567175,3152976349,4255350624,2683765030,3160175349,3309594171,878443390,1988838185,3704300486,1756818940,1673061617,3403100636,272786309,1075025698,545572369,2105887268,4174560061,296679730,1841768865,1260232239,4091327024,3960309330,3497509347,1814803222,2578018489,4195456072,575138148,3299409036,446754879,3629546796,4011996048,3347532110,3252238545,4270639778,915985419,3483825537,681933534,651868046,2755636671,3828103837,223377554,2607439820,1649704518,3270937875,3901806776,1580087799,4118987695,3198115200,2087309459,2842678573,3016697106,1003007129,2802849917,1860738147,2077965243,164439672,4100872472,32283319,2827177882,1709610350,2125135846,136428751,3874428392,3652904859,3460984630,3572145929,3593056380,2939266226,824852259,818324884,3224740454,930369212,2801566410,2967507152,355706840,1257309336,4148292826,243256656,790073846,2373340630,1296297904,1422699085,3756299780,3818836405,457992840,3099667487,2135319889,77422314,1560382517,1945798516,788204353,1521706781,1385356242,870912086,325965383,2358957921,2050466060,2388260884,2313884476,4006521127,901210569,3990953189,1014646705,1503449823,1062597235,2031621326,3212035895,3931371469,1533017514,350174575,2256028891,2177544179,1052338372,741876788,1606591296,1914052035,213705253,2334669897,1107234197,1899603969,3725069491,2631447780,2422494913,1635502980,1893020342,1950903388,1120974935],U=[2807058932,1699970625,2764249623,1586903591,1808481195,1173430173,1487645946,59984867,4199882800,1844882806,1989249228,1277555970,3623636965,3419915562,1149249077,2744104290,1514790577,459744698,244860394,3235995134,1963115311,4027744588,2544078150,4190530515,1608975247,2627016082,2062270317,1507497298,2200818878,567498868,1764313568,3359936201,2305455554,2037970062,1047239e3,1910319033,1337376481,2904027272,2892417312,984907214,1243112415,830661914,861968209,2135253587,2011214180,2927934315,2686254721,731183368,1750626376,4246310725,1820824798,4172763771,3542330227,48394827,2404901663,2871682645,671593195,3254988725,2073724613,145085239,2280796200,2779915199,1790575107,2187128086,472615631,3029510009,4075877127,3802222185,4107101658,3201631749,1646252340,4270507174,1402811438,1436590835,3778151818,3950355702,3963161475,4020912224,2667994737,273792366,2331590177,104699613,95345982,3175501286,2377486676,1560637892,3564045318,369057872,4213447064,3919042237,1137477952,2658625497,1119727848,2340947849,1530455833,4007360968,172466556,266959938,516552836,0,2256734592,3980931627,1890328081,1917742170,4294704398,945164165,3575528878,958871085,3647212047,2787207260,1423022939,775562294,1739656202,3876557655,2530391278,2443058075,3310321856,547512796,1265195639,437656594,3121275539,719700128,3762502690,387781147,218828297,3350065803,2830708150,2848461854,428169201,122466165,3720081049,1627235199,648017665,4122762354,1002783846,2117360635,695634755,3336358691,4234721005,4049844452,3704280881,2232435299,574624663,287343814,612205898,1039717051,840019705,2708326185,793451934,821288114,1391201670,3822090177,376187827,3113855344,1224348052,1679968233,2361698556,1058709744,752375421,2431590963,1321699145,3519142200,2734591178,188127444,2177869557,3727205754,2384911031,3215212461,2648976442,2450346104,3432737375,1180849278,331544205,3102249176,4150144569,2952102595,2159976285,2474404304,766078933,313773861,2570832044,2108100632,1668212892,3145456443,2013908262,418672217,3070356634,2594734927,1852171925,3867060991,3473416636,3907448597,2614737639,919489135,164948639,2094410160,2997825956,590424639,2486224549,1723872674,3157750862,3399941250,3501252752,3625268135,2555048196,3673637356,1343127501,4130281361,3599595085,2957853679,1297403050,81781910,3051593425,2283490410,532201772,1367295589,3926170974,895287692,1953757831,1093597963,492483431,3528626907,1446242576,1192455638,1636604631,209336225,344873464,1015671571,669961897,3375740769,3857572124,2973530695,3747192018,1933530610,3464042516,935293895,3454686199,2858115069,1863638845,3683022916,4085369519,3292445032,875313188,1080017571,3279033885,621591778,1233856572,2504130317,24197544,3017672716,3835484340,3247465558,2220981195,3060847922,1551124588,1463996600],ee=[4104605777,1097159550,396673818,660510266,2875968315,2638606623,4200115116,3808662347,821712160,1986918061,3430322568,38544885,3856137295,718002117,893681702,1654886325,2975484382,3122358053,3926825029,4274053469,796197571,1290801793,1184342925,3556361835,2405426947,2459735317,1836772287,1381620373,3196267988,1948373848,3764988233,3385345166,3263785589,2390325492,1480485785,3111247143,3780097726,2293045232,548169417,3459953789,3746175075,439452389,1362321559,1400849762,1685577905,1806599355,2174754046,137073913,1214797936,1174215055,3731654548,2079897426,1943217067,1258480242,529487843,1437280870,3945269170,3049390895,3313212038,923313619,679998e3,3215307299,57326082,377642221,3474729866,2041877159,133361907,1776460110,3673476453,96392454,878845905,2801699524,777231668,4082475170,2330014213,4142626212,2213296395,1626319424,1906247262,1846563261,562755902,3708173718,1040559837,3871163981,1418573201,3294430577,114585348,1343618912,2566595609,3186202582,1078185097,3651041127,3896688048,2307622919,425408743,3371096953,2081048481,1108339068,2216610296,0,2156299017,736970802,292596766,1517440620,251657213,2235061775,2933202493,758720310,265905162,1554391400,1532285339,908999204,174567692,1474760595,4002861748,2610011675,3234156416,3693126241,2001430874,303699484,2478443234,2687165888,585122620,454499602,151849742,2345119218,3064510765,514443284,4044981591,1963412655,2581445614,2137062819,19308535,1928707164,1715193156,4219352155,1126790795,600235211,3992742070,3841024952,836553431,1669664834,2535604243,3323011204,1243905413,3141400786,4180808110,698445255,2653899549,2989552604,2253581325,3252932727,3004591147,1891211689,2487810577,3915653703,4237083816,4030667424,2100090966,865136418,1229899655,953270745,3399679628,3557504664,4118925222,2061379749,3079546586,2915017791,983426092,2022837584,1607244650,2118541908,2366882550,3635996816,972512814,3283088770,1568718495,3499326569,3576539503,621982671,2895723464,410887952,2623762152,1002142683,645401037,1494807662,2595684844,1335535747,2507040230,4293295786,3167684641,367585007,3885750714,1865862730,2668221674,2960971305,2763173681,1059270954,2777952454,2724642869,1320957812,2194319100,2429595872,2815956275,77089521,3973773121,3444575871,2448830231,1305906550,4021308739,2857194700,2516901860,3518358430,1787304780,740276417,1699839814,1592394909,2352307457,2272556026,188821243,1729977011,3687994002,274084841,3594982253,3613494426,2701949495,4162096729,322734571,2837966542,1640576439,484830689,1202797690,3537852828,4067639125,349075736,3342319475,4157467219,4255800159,1030690015,1155237496,2951971274,1757691577,607398968,2738905026,499347990,3794078908,1011452712,227885567,2818666809,213114376,3034881240,1455525988,3414450555,850817237,1817998408,3092726480],W=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],ie=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],fe=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],ce=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];function ye(_){for(var m=[],b=0;b<_.length;b+=4)m.push(_[b]<<24|_[b+1]<<16|_[b+2]<<8|_[b+3]);return m}var xe=function(_){if(!(this instanceof xe))throw Error("AES must be instanitated with `new`");Object.defineProperty(this,"key",{value:o(_,!0)}),this._prepare()};xe.prototype._prepare=function(){var _=h[this.key.length];if(_==null)throw new Error("invalid key size (must be 16, 24 or 32 bytes)");this._Ke=[],this._Kd=[];for(var m=0;m<=_;m++)this._Ke.push([0,0,0,0]),this._Kd.push([0,0,0,0]);for(var b=(_+1)*4,$=this.key.length/4,g=ye(this.key),O,m=0;m<$;m++)O=m>>2,this._Ke[O][m%4]=g[m],this._Kd[_-O][m%4]=g[m];for(var te=0,Z=$,ae;Z<b;){if(ae=g[$-1],g[0]^=y[ae>>16&255]<<24^y[ae>>8&255]<<16^y[ae&255]<<8^y[ae>>24&255]^p[te]<<24,te+=1,$!=8)for(var m=1;m<$;m++)g[m]^=g[m-1];else{for(var m=1;m<$/2;m++)g[m]^=g[m-1];ae=g[$/2-1],g[$/2]^=y[ae&255]^y[ae>>8&255]<<8^y[ae>>16&255]<<16^y[ae>>24&255]<<24;for(var m=$/2+1;m<$;m++)g[m]^=g[m-1]}for(var m=0,be,ke;m<$&&Z<b;)be=Z>>2,ke=Z%4,this._Ke[be][ke]=g[m],this._Kd[_-be][ke]=g[m++],Z++}for(var be=1;be<_;be++)for(var ke=0;ke<4;ke++)ae=this._Kd[be][ke],this._Kd[be][ke]=W[ae>>24&255]^ie[ae>>16&255]^fe[ae>>8&255]^ce[ae&255]},xe.prototype.encrypt=function(_){if(_.length!=16)throw new Error("invalid plaintext size (must be 16 bytes)");for(var m=this._Ke.length-1,b=[0,0,0,0],$=ye(_),g=0;g<4;g++)$[g]^=this._Ke[0][g];for(var O=1;O<m;O++){for(var g=0;g<4;g++)b[g]=x[$[g]>>24&255]^S[$[(g+1)%4]>>16&255]^k[$[(g+2)%4]>>8&255]^T[$[(g+3)%4]&255]^this._Ke[O][g];$=b.slice()}for(var te=c(16),Z,g=0;g<4;g++)Z=this._Ke[m][g],te[4*g]=(y[$[g]>>24&255]^Z>>24)&255,te[4*g+1]=(y[$[(g+1)%4]>>16&255]^Z>>16)&255,te[4*g+2]=(y[$[(g+2)%4]>>8&255]^Z>>8)&255,te[4*g+3]=(y[$[(g+3)%4]&255]^Z)&255;return te},xe.prototype.decrypt=function(_){if(_.length!=16)throw new Error("invalid ciphertext size (must be 16 bytes)");for(var m=this._Kd.length-1,b=[0,0,0,0],$=ye(_),g=0;g<4;g++)$[g]^=this._Kd[0][g];for(var O=1;O<m;O++){for(var g=0;g<4;g++)b[g]=L[$[g]>>24&255]^q[$[(g+3)%4]>>16&255]^U[$[(g+2)%4]>>8&255]^ee[$[(g+1)%4]&255]^this._Kd[O][g];$=b.slice()}for(var te=c(16),Z,g=0;g<4;g++)Z=this._Kd[m][g],te[4*g]=(E[$[g]>>24&255]^Z>>24)&255,te[4*g+1]=(E[$[(g+3)%4]>>16&255]^Z>>16)&255,te[4*g+2]=(E[$[(g+2)%4]>>8&255]^Z>>8)&255,te[4*g+3]=(E[$[(g+1)%4]&255]^Z)&255;return te};var Oe=function(_){if(!(this instanceof Oe))throw Error("AES must be instanitated with `new`");this.description="Electronic Code Block",this.name="ecb",this._aes=new xe(_)};Oe.prototype.encrypt=function(_){if(_=o(_),_.length%16!==0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var m=c(_.length),b=c(16),$=0;$<_.length;$+=16)d(_,b,0,$,$+16),b=this._aes.encrypt(b),d(b,m,$);return m},Oe.prototype.decrypt=function(_){if(_=o(_),_.length%16!==0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var m=c(_.length),b=c(16),$=0;$<_.length;$+=16)d(_,b,0,$,$+16),b=this._aes.decrypt(b),d(b,m,$);return m};var F=function(_,m){if(!(this instanceof F))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Block Chaining",this.name="cbc",!m)m=c(16);else if(m.length!=16)throw new Error("invalid initialation vector size (must be 16 bytes)");this._lastCipherblock=o(m,!0),this._aes=new xe(_)};F.prototype.encrypt=function(_){if(_=o(_),_.length%16!==0)throw new Error("invalid plaintext size (must be multiple of 16 bytes)");for(var m=c(_.length),b=c(16),$=0;$<_.length;$+=16){d(_,b,0,$,$+16);for(var g=0;g<16;g++)b[g]^=this._lastCipherblock[g];this._lastCipherblock=this._aes.encrypt(b),d(this._lastCipherblock,m,$)}return m},F.prototype.decrypt=function(_){if(_=o(_),_.length%16!==0)throw new Error("invalid ciphertext size (must be multiple of 16 bytes)");for(var m=c(_.length),b=c(16),$=0;$<_.length;$+=16){d(_,b,0,$,$+16),b=this._aes.decrypt(b);for(var g=0;g<16;g++)m[$+g]=b[g]^this._lastCipherblock[g];d(_,this._lastCipherblock,0,$,$+16)}return m};var v=function(_,m,b){if(!(this instanceof v))throw Error("AES must be instanitated with `new`");if(this.description="Cipher Feedback",this.name="cfb",!m)m=c(16);else if(m.length!=16)throw new Error("invalid initialation vector size (must be 16 size)");b||(b=1),this.segmentSize=b,this._shiftRegister=o(m,!0),this._aes=new xe(_)};v.prototype.encrypt=function(_){if(_.length%this.segmentSize!=0)throw new Error("invalid plaintext size (must be segmentSize bytes)");for(var m=o(_,!0),b,$=0;$<m.length;$+=this.segmentSize){b=this._aes.encrypt(this._shiftRegister);for(var g=0;g<this.segmentSize;g++)m[$+g]^=b[g];d(this._shiftRegister,this._shiftRegister,0,this.segmentSize),d(m,this._shiftRegister,16-this.segmentSize,$,$+this.segmentSize)}return m},v.prototype.decrypt=function(_){if(_.length%this.segmentSize!=0)throw new Error("invalid ciphertext size (must be segmentSize bytes)");for(var m=o(_,!0),b,$=0;$<m.length;$+=this.segmentSize){b=this._aes.encrypt(this._shiftRegister);for(var g=0;g<this.segmentSize;g++)m[$+g]^=b[g];d(this._shiftRegister,this._shiftRegister,0,this.segmentSize),d(_,this._shiftRegister,16-this.segmentSize,$,$+this.segmentSize)}return m};var C=function(_,m){if(!(this instanceof C))throw Error("AES must be instanitated with `new`");if(this.description="Output Feedback",this.name="ofb",!m)m=c(16);else if(m.length!=16)throw new Error("invalid initialation vector size (must be 16 bytes)");this._lastPrecipher=o(m,!0),this._lastPrecipherIndex=16,this._aes=new xe(_)};C.prototype.encrypt=function(_){for(var m=o(_,!0),b=0;b<m.length;b++)this._lastPrecipherIndex===16&&(this._lastPrecipher=this._aes.encrypt(this._lastPrecipher),this._lastPrecipherIndex=0),m[b]^=this._lastPrecipher[this._lastPrecipherIndex++];return m},C.prototype.decrypt=C.prototype.encrypt;var I=function(_){if(!(this instanceof I))throw Error("Counter must be instanitated with `new`");_!==0&&!_&&(_=1),typeof _=="number"?(this._counter=c(16),this.setValue(_)):this.setBytes(_)};I.prototype.setValue=function(_){if(typeof _!="number"||parseInt(_)!=_)throw new Error("invalid counter value (must be an integer)");for(var m=15;m>=0;--m)this._counter[m]=_%256,_=_>>8},I.prototype.setBytes=function(_){if(_=o(_,!0),_.length!=16)throw new Error("invalid counter bytes size (must be 16 bytes)");this._counter=_},I.prototype.increment=function(){for(var _=15;_>=0;_--)if(this._counter[_]===255)this._counter[_]=0;else{this._counter[_]++;break}};var B=function(_,m){if(!(this instanceof B))throw Error("AES must be instanitated with `new`");this.description="Counter",this.name="ctr",m instanceof I||(m=new I(m)),this._counter=m,this._remainingCounter=null,this._remainingCounterIndex=16,this._aes=new xe(_)};B.prototype.encrypt=function(_){for(var m=o(_,!0),b=0;b<m.length;b++)this._remainingCounterIndex===16&&(this._remainingCounter=this._aes.encrypt(this._counter._counter),this._remainingCounterIndex=0,this._counter.increment()),m[b]^=this._remainingCounter[this._remainingCounterIndex++];return m},B.prototype.decrypt=B.prototype.encrypt;function J(_){_=o(_,!0);var m=16-_.length%16,b=c(_.length+m);d(_,b);for(var $=_.length;$<b.length;$++)b[$]=m;return b}function Y(_){if(_=o(_,!0),_.length<16)throw new Error("PKCS#7 invalid length");var m=_[_.length-1];if(m>16)throw new Error("PKCS#7 padding byte out of range");for(var b=_.length-m,$=0;$<m;$++)if(_[b+$]!==m)throw new Error("PKCS#7 invalid padding byte");var g=c(b);return d(_,g,0,0,b),g}var H={AES:xe,Counter:I,ModeOfOperation:{ecb:Oe,cbc:F,cfb:v,ofb:C,ctr:B},utils:{hex:l,utf8:u},padding:{pkcs7:{pad:J,strip:Y}},_arrayTest:{coerceArray:o,createArray:c,copyArray:d}};e.exports=H})()})(aesJs);const aes=aesJsExports,version$3="json-wallets/5.7.0";function looseArrayify(e){return typeof e=="string"&&e.substring(0,2)!=="0x"&&(e="0x"+e),arrayify(e)}function zpad(e,t){for(e=String(e);e.length<t;)e="0"+e;return e}function getPassword(e){return typeof e=="string"?toUtf8Bytes(e,UnicodeNormalizationForm.NFKC):arrayify(e)}function searchPath(e,t){let n=e;const i=t.toLowerCase().split("/");for(let a=0;a<i.length;a++){let o=null;for(const c in n)if(c.toLowerCase()===i[a]){o=n[c];break}if(o===null)return null;n=o}return n}function uuidV4(e){const t=arrayify(e);t[6]=t[6]&15|64,t[8]=t[8]&63|128;const n=hexlify(t);return[n.substring(2,10),n.substring(10,14),n.substring(14,18),n.substring(18,22),n.substring(22,34)].join("-")}const logger$2=new Logger(version$3);class CrowdsaleAccount extends Description{isCrowdsaleAccount(t){return!!(t&&t._isCrowdsaleAccount)}}function decrypt$1(e,t){const n=JSON.parse(e);t=getPassword(t);const i=getAddress(searchPath(n,"ethaddr")),a=looseArrayify(searchPath(n,"encseed"));(!a||a.length%16!==0)&&logger$2.throwArgumentError("invalid encseed","json",e);const o=arrayify(pbkdf2$1(t,t,2e3,32,"sha256")).slice(0,16),c=a.slice(0,16),d=a.slice(16),u=new aes.ModeOfOperation.cbc(o,c),l=aes.padding.pkcs7.strip(arrayify(u.decrypt(d)));let h="";for(let E=0;E<l.length;E++)h+=String.fromCharCode(l[E]);const p=toUtf8Bytes(h),y=keccak256(p);return new CrowdsaleAccount({_isCrowdsaleAccount:!0,address:i,privateKey:y})}function isCrowdsaleWallet(e){let t=null;try{t=JSON.parse(e)}catch{return!1}return t.encseed&&t.ethaddr}function isKeystoreWallet(e){let t=null;try{t=JSON.parse(e)}catch{return!1}return!(!t.version||parseInt(t.version)!==t.version||parseInt(t.version)!==3)}var scryptExports={},scrypt$1={get exports(){return scryptExports},set exports(e){scryptExports=e}};(function(e,t){(function(n){function a(S){const k=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);let T=1779033703,L=3144134277,q=1013904242,U=2773480762,ee=1359893119,W=2600822924,ie=528734635,fe=1541459225;const ce=new Uint32Array(64);function ye(B){let J=0,Y=B.length;for(;Y>=64;){let H=T,_=L,m=q,b=U,$=ee,g=W,O=ie,te=fe,Z,ae,be,ke,Ae;for(ae=0;ae<16;ae++)be=J+ae*4,ce[ae]=(B[be]&255)<<24|(B[be+1]&255)<<16|(B[be+2]&255)<<8|B[be+3]&255;for(ae=16;ae<64;ae++)Z=ce[ae-2],ke=(Z>>>17|Z<<32-17)^(Z>>>19|Z<<32-19)^Z>>>10,Z=ce[ae-15],Ae=(Z>>>7|Z<<32-7)^(Z>>>18|Z<<32-18)^Z>>>3,ce[ae]=(ke+ce[ae-7]|0)+(Ae+ce[ae-16]|0)|0;for(ae=0;ae<64;ae++)ke=((($>>>6|$<<32-6)^($>>>11|$<<32-11)^($>>>25|$<<32-25))+($&g^~$&O)|0)+(te+(k[ae]+ce[ae]|0)|0)|0,Ae=((H>>>2|H<<32-2)^(H>>>13|H<<32-13)^(H>>>22|H<<32-22))+(H&_^H&m^_&m)|0,te=O,O=g,g=$,$=b+ke|0,b=m,m=_,_=H,H=ke+Ae|0;T=T+H|0,L=L+_|0,q=q+m|0,U=U+b|0,ee=ee+$|0,W=W+g|0,ie=ie+O|0,fe=fe+te|0,J+=64,Y-=64}}ye(S);let xe,Oe=S.length%64,F=S.length/536870912|0,v=S.length<<3,C=Oe<56?56:120,I=S.slice(S.length-Oe,S.length);for(I.push(128),xe=Oe+1;xe<C;xe++)I.push(0);return I.push(F>>>24&255),I.push(F>>>16&255),I.push(F>>>8&255),I.push(F>>>0&255),I.push(v>>>24&255),I.push(v>>>16&255),I.push(v>>>8&255),I.push(v>>>0&255),ye(I),[T>>>24&255,T>>>16&255,T>>>8&255,T>>>0&255,L>>>24&255,L>>>16&255,L>>>8&255,L>>>0&255,q>>>24&255,q>>>16&255,q>>>8&255,q>>>0&255,U>>>24&255,U>>>16&255,U>>>8&255,U>>>0&255,ee>>>24&255,ee>>>16&255,ee>>>8&255,ee>>>0&255,W>>>24&255,W>>>16&255,W>>>8&255,W>>>0&255,ie>>>24&255,ie>>>16&255,ie>>>8&255,ie>>>0&255,fe>>>24&255,fe>>>16&255,fe>>>8&255,fe>>>0&255]}function o(S,k,T){S=S.length<=64?S:a(S);const L=64+k.length+4,q=new Array(L),U=new Array(64);let ee,W=[];for(ee=0;ee<64;ee++)q[ee]=54;for(ee=0;ee<S.length;ee++)q[ee]^=S[ee];for(ee=0;ee<k.length;ee++)q[64+ee]=k[ee];for(ee=L-4;ee<L;ee++)q[ee]=0;for(ee=0;ee<64;ee++)U[ee]=92;for(ee=0;ee<S.length;ee++)U[ee]^=S[ee];function ie(){for(let fe=L-1;fe>=L-4;fe--){if(q[fe]++,q[fe]<=255)return;q[fe]=0}}for(;T>=32;)ie(),W=W.concat(a(U.concat(a(q)))),T-=32;return T>0&&(ie(),W=W.concat(a(U.concat(a(q))).slice(0,T))),W}function c(S,k,T,L,q){let U;for(h(S,(2*T-1)*16,q,0,16),U=0;U<2*T;U++)l(S,U*16,q,16),u(q,L),h(q,0,S,k+U*16,16);for(U=0;U<T;U++)h(S,k+U*2*16,S,U*16,16);for(U=0;U<T;U++)h(S,k+(U*2+1)*16,S,(U+T)*16,16)}function d(S,k){return S<<k|S>>>32-k}function u(S,k){h(S,0,k,0,16);for(let T=8;T>0;T-=2)k[4]^=d(k[0]+k[12],7),k[8]^=d(k[4]+k[0],9),k[12]^=d(k[8]+k[4],13),k[0]^=d(k[12]+k[8],18),k[9]^=d(k[5]+k[1],7),k[13]^=d(k[9]+k[5],9),k[1]^=d(k[13]+k[9],13),k[5]^=d(k[1]+k[13],18),k[14]^=d(k[10]+k[6],7),k[2]^=d(k[14]+k[10],9),k[6]^=d(k[2]+k[14],13),k[10]^=d(k[6]+k[2],18),k[3]^=d(k[15]+k[11],7),k[7]^=d(k[3]+k[15],9),k[11]^=d(k[7]+k[3],13),k[15]^=d(k[11]+k[7],18),k[1]^=d(k[0]+k[3],7),k[2]^=d(k[1]+k[0],9),k[3]^=d(k[2]+k[1],13),k[0]^=d(k[3]+k[2],18),k[6]^=d(k[5]+k[4],7),k[7]^=d(k[6]+k[5],9),k[4]^=d(k[7]+k[6],13),k[5]^=d(k[4]+k[7],18),k[11]^=d(k[10]+k[9],7),k[8]^=d(k[11]+k[10],9),k[9]^=d(k[8]+k[11],13),k[10]^=d(k[9]+k[8],18),k[12]^=d(k[15]+k[14],7),k[13]^=d(k[12]+k[15],9),k[14]^=d(k[13]+k[12],13),k[15]^=d(k[14]+k[13],18);for(let T=0;T<16;++T)S[T]+=k[T]}function l(S,k,T,L){for(let q=0;q<L;q++)T[q]^=S[k+q]}function h(S,k,T,L,q){for(;q--;)T[L++]=S[k++]}function p(S){if(!S||typeof S.length!="number")return!1;for(let k=0;k<S.length;k++){const T=S[k];if(typeof T!="number"||T%1||T<0||T>=256)return!1}return!0}function y(S,k){if(typeof S!="number"||S%1)throw new Error("invalid "+k);return S}function E(S,k,T,L,q,U,ee){if(T=y(T,"N"),L=y(L,"r"),q=y(q,"p"),U=y(U,"dkLen"),T===0||T&T-1)throw new Error("N must be power of 2");if(T>2147483647/128/L)throw new Error("N too large");if(L>2147483647/128/q)throw new Error("r too large");if(!p(S))throw new Error("password must be an array or buffer");if(S=Array.prototype.slice.call(S),!p(k))throw new Error("salt must be an array or buffer");k=Array.prototype.slice.call(k);let W=o(S,k,q*128*L);const ie=new Uint32Array(q*32*L);for(let $=0;$<ie.length;$++){const g=$*4;ie[$]=(W[g+3]&255)<<24|(W[g+2]&255)<<16|(W[g+1]&255)<<8|(W[g+0]&255)<<0}const fe=new Uint32Array(64*L),ce=new Uint32Array(32*L*T),ye=32*L,xe=new Uint32Array(16),Oe=new Uint32Array(16),F=q*T*2;let v=0,C=null,I=!1,B=0,J=0,Y,H;const _=ee?parseInt(1e3/L):4294967295,m=typeof setImmediate<"u"?setImmediate:setTimeout,b=function(){if(I)return ee(new Error("cancelled"),v/F);let $;switch(B){case 0:H=J*32*L,h(ie,H,fe,0,ye),B=1,Y=0;case 1:$=T-Y,$>_&&($=_);for(let O=0;O<$;O++)h(fe,0,ce,(Y+O)*ye,ye),c(fe,ye,L,xe,Oe);if(Y+=$,v+=$,ee){const O=parseInt(1e3*v/F);if(O!==C){if(I=ee(null,v/F),I)break;C=O}}if(Y<T)break;Y=0,B=2;case 2:$=T-Y,$>_&&($=_);for(let O=0;O<$;O++){const te=(2*L-1)*16,Z=fe[te]&T-1;l(ce,Z*ye,fe,ye),c(fe,ye,L,xe,Oe)}if(Y+=$,v+=$,ee){const O=parseInt(1e3*v/F);if(O!==C){if(I=ee(null,v/F),I)break;C=O}}if(Y<T)break;if(h(fe,0,ie,H,ye),J++,J<q){B=0;break}W=[];for(let O=0;O<ie.length;O++)W.push(ie[O]>>0&255),W.push(ie[O]>>8&255),W.push(ie[O]>>16&255),W.push(ie[O]>>24&255);const g=o(S,W,U);return ee&&ee(null,1,g),g}ee&&m(b)};if(!ee)for(;;){const $=b();if($!=null)return $}b()}const x={scrypt:function(S,k,T,L,q,U,ee){return new Promise(function(W,ie){let fe=0;ee&&ee(0),E(S,k,T,L,q,U,function(ce,ye,xe){if(ce)ie(ce);else if(xe)ee&&fe!==1&&ee(1),W(new Uint8Array(xe));else if(ee&&ye!==fe)return fe=ye,ee(ye)})})},syncScrypt:function(S,k,T,L,q,U){return new Uint8Array(E(S,k,T,L,q,U))}};e.exports=x})()})(scrypt$1);const scrypt=scryptExports;var __awaiter$1=globalThis&&globalThis.__awaiter||function(e,t,n,i){function a(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function d(h){try{l(i.next(h))}catch(p){c(p)}}function u(h){try{l(i.throw(h))}catch(p){c(p)}}function l(h){h.done?o(h.value):a(h.value).then(d,u)}l((i=i.apply(e,t||[])).next())})};const logger$1=new Logger(version$3);function hasMnemonic$1(e){return e!=null&&e.mnemonic&&e.mnemonic.phrase}class KeystoreAccount extends Description{isKeystoreAccount(t){return!!(t&&t._isKeystoreAccount)}}function _decrypt(e,t,n){if(searchPath(e,"crypto/cipher")==="aes-128-ctr"){const a=looseArrayify(searchPath(e,"crypto/cipherparams/iv")),o=new aes.Counter(a),c=new aes.ModeOfOperation.ctr(t,o);return arrayify(c.decrypt(n))}return null}function _getAccount(e,t){const n=looseArrayify(searchPath(e,"crypto/ciphertext"));if(hexlify(keccak256(concat([t.slice(16,32),n]))).substring(2)!==searchPath(e,"crypto/mac").toLowerCase())throw new Error("invalid password");const a=_decrypt(e,t.slice(0,16),n);a||logger$1.throwError("unsupported cipher",Logger.errors.UNSUPPORTED_OPERATION,{operation:"decrypt"});const o=t.slice(32,64),c=computeAddress(a);if(e.address){let u=e.address.toLowerCase();if(u.substring(0,2)!=="0x"&&(u="0x"+u),getAddress(u)!==c)throw new Error("address mismatch")}const d={_isKeystoreAccount:!0,address:c,privateKey:hexlify(a)};if(searchPath(e,"x-ethers/version")==="0.1"){const u=looseArrayify(searchPath(e,"x-ethers/mnemonicCiphertext")),l=looseArrayify(searchPath(e,"x-ethers/mnemonicCounter")),h=new aes.Counter(l),p=new aes.ModeOfOperation.ctr(o,h),y=searchPath(e,"x-ethers/path")||defaultPath,E=searchPath(e,"x-ethers/locale")||"en",x=arrayify(p.decrypt(u));try{const S=entropyToMnemonic(x,E),k=HDNode.fromMnemonic(S,null,E).derivePath(y);if(k.privateKey!=d.privateKey)throw new Error("mnemonic mismatch");d.mnemonic=k.mnemonic}catch(S){if(S.code!==Logger.errors.INVALID_ARGUMENT||S.argument!=="wordlist")throw S}}return new KeystoreAccount(d)}function pbkdf2Sync(e,t,n,i,a){return arrayify(pbkdf2$1(e,t,n,i,a))}function pbkdf2(e,t,n,i,a){return Promise.resolve(pbkdf2Sync(e,t,n,i,a))}function _computeKdfKey(e,t,n,i,a){const o=getPassword(t),c=searchPath(e,"crypto/kdf");if(c&&typeof c=="string"){const d=function(u,l){return logger$1.throwArgumentError("invalid key-derivation function parameters",u,l)};if(c.toLowerCase()==="scrypt"){const u=looseArrayify(searchPath(e,"crypto/kdfparams/salt")),l=parseInt(searchPath(e,"crypto/kdfparams/n")),h=parseInt(searchPath(e,"crypto/kdfparams/r")),p=parseInt(searchPath(e,"crypto/kdfparams/p"));(!l||!h||!p)&&d("kdf",c),l&l-1&&d("N",l);const y=parseInt(searchPath(e,"crypto/kdfparams/dklen"));return y!==32&&d("dklen",y),i(o,u,l,h,p,64,a)}else if(c.toLowerCase()==="pbkdf2"){const u=looseArrayify(searchPath(e,"crypto/kdfparams/salt"));let l=null;const h=searchPath(e,"crypto/kdfparams/prf");h==="hmac-sha256"?l="sha256":h==="hmac-sha512"?l="sha512":d("prf",h);const p=parseInt(searchPath(e,"crypto/kdfparams/c")),y=parseInt(searchPath(e,"crypto/kdfparams/dklen"));return y!==32&&d("dklen",y),n(o,u,p,y,l)}}return logger$1.throwArgumentError("unsupported key-derivation function","kdf",c)}function decryptSync(e,t){const n=JSON.parse(e),i=_computeKdfKey(n,t,pbkdf2Sync,scrypt.syncScrypt);return _getAccount(n,i)}function decrypt(e,t,n){return __awaiter$1(this,void 0,void 0,function*(){const i=JSON.parse(e),a=yield _computeKdfKey(i,t,pbkdf2,scrypt.scrypt,n);return _getAccount(i,a)})}function encrypt(e,t,n,i){try{if(getAddress(e.address)!==computeAddress(e.privateKey))throw new Error("address/privateKey mismatch");if(hasMnemonic$1(e)){const k=e.mnemonic;if(HDNode.fromMnemonic(k.phrase,null,k.locale).derivePath(k.path||defaultPath).privateKey!=e.privateKey)throw new Error("mnemonic mismatch")}}catch(k){return Promise.reject(k)}typeof n=="function"&&!i&&(i=n,n={}),n||(n={});const a=arrayify(e.privateKey),o=getPassword(t);let c=null,d=null,u=null;if(hasMnemonic$1(e)){const k=e.mnemonic;c=arrayify(mnemonicToEntropy(k.phrase,k.locale||"en")),d=k.path||defaultPath,u=k.locale||"en"}let l=n.client;l||(l="ethers.js");let h=null;n.salt?h=arrayify(n.salt):h=randomBytes(32);let p=null;if(n.iv){if(p=arrayify(n.iv),p.length!==16)throw new Error("invalid iv")}else p=randomBytes(16);let y=null;if(n.uuid){if(y=arrayify(n.uuid),y.length!==16)throw new Error("invalid uuid")}else y=randomBytes(16);let E=1<<17,x=8,S=1;return n.scrypt&&(n.scrypt.N&&(E=n.scrypt.N),n.scrypt.r&&(x=n.scrypt.r),n.scrypt.p&&(S=n.scrypt.p)),scrypt.scrypt(o,h,E,x,S,64,i).then(k=>{k=arrayify(k);const T=k.slice(0,16),L=k.slice(16,32),q=k.slice(32,64),U=new aes.Counter(p),ee=new aes.ModeOfOperation.ctr(T,U),W=arrayify(ee.encrypt(a)),ie=keccak256(concat([L,W])),fe={address:e.address.substring(2).toLowerCase(),id:uuidV4(y),version:3,crypto:{cipher:"aes-128-ctr",cipherparams:{iv:hexlify(p).substring(2)},ciphertext:hexlify(W).substring(2),kdf:"scrypt",kdfparams:{salt:hexlify(h).substring(2),n:E,dklen:32,p:S,r:x},mac:ie.substring(2)}};if(c){const ce=randomBytes(16),ye=new aes.Counter(ce),xe=new aes.ModeOfOperation.ctr(q,ye),Oe=arrayify(xe.encrypt(c)),F=new Date,v=F.getUTCFullYear()+"-"+zpad(F.getUTCMonth()+1,2)+"-"+zpad(F.getUTCDate(),2)+"T"+zpad(F.getUTCHours(),2)+"-"+zpad(F.getUTCMinutes(),2)+"-"+zpad(F.getUTCSeconds(),2)+".0Z";fe["x-ethers"]={client:l,gethFilename:"UTC--"+v+"--"+fe.address,mnemonicCounter:hexlify(ce).substring(2),mnemonicCiphertext:hexlify(Oe).substring(2),path:d,locale:u,version:"0.1"}}return JSON.stringify(fe)})}function decryptJsonWallet(e,t,n){if(isCrowdsaleWallet(e)){n&&n(0);const i=decrypt$1(e,t);return n&&n(1),Promise.resolve(i)}return isKeystoreWallet(e)?decrypt(e,t,n):Promise.reject(new Error("invalid JSON wallet"))}function decryptJsonWalletSync(e,t){if(isCrowdsaleWallet(e))return decrypt$1(e,t);if(isKeystoreWallet(e))return decryptSync(e,t);throw new Error("invalid JSON wallet")}const version$2="wallet/5.7.0";var __awaiter=globalThis&&globalThis.__awaiter||function(e,t,n,i){function a(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function d(h){try{l(i.next(h))}catch(p){c(p)}}function u(h){try{l(i.throw(h))}catch(p){c(p)}}function l(h){h.done?o(h.value):a(h.value).then(d,u)}l((i=i.apply(e,t||[])).next())})};const logger=new Logger(version$2);function isAccount(e){return e!=null&&isHexString(e.privateKey,32)&&e.address!=null}function hasMnemonic(e){const t=e.mnemonic;return t&&t.phrase}class Wallet extends Signer{constructor(t,n){if(super(),isAccount(t)){const i=new SigningKey(t.privateKey);if(defineReadOnly(this,"_signingKey",()=>i),defineReadOnly(this,"address",computeAddress(this.publicKey)),this.address!==getAddress(t.address)&&logger.throwArgumentError("privateKey/address mismatch","privateKey","[REDACTED]"),hasMnemonic(t)){const a=t.mnemonic;defineReadOnly(this,"_mnemonic",()=>({phrase:a.phrase,path:a.path||defaultPath,locale:a.locale||"en"}));const o=this.mnemonic,c=HDNode.fromMnemonic(o.phrase,null,o.locale).derivePath(o.path);computeAddress(c.privateKey)!==this.address&&logger.throwArgumentError("mnemonic/address mismatch","privateKey","[REDACTED]")}else defineReadOnly(this,"_mnemonic",()=>null)}else{if(SigningKey.isSigningKey(t))t.curve!=="secp256k1"&&logger.throwArgumentError("unsupported curve; must be secp256k1","privateKey","[REDACTED]"),defineReadOnly(this,"_signingKey",()=>t);else{typeof t=="string"&&t.match(/^[0-9a-f]*$/i)&&t.length===64&&(t="0x"+t);const i=new SigningKey(t);defineReadOnly(this,"_signingKey",()=>i)}defineReadOnly(this,"_mnemonic",()=>null),defineReadOnly(this,"address",computeAddress(this.publicKey))}n&&!Provider.isProvider(n)&&logger.throwArgumentError("invalid provider","provider",n),defineReadOnly(this,"provider",n||null)}get mnemonic(){return this._mnemonic()}get privateKey(){return this._signingKey().privateKey}get publicKey(){return this._signingKey().publicKey}getAddress(){return Promise.resolve(this.address)}connect(t){return new Wallet(this,t)}signTransaction(t){return resolveProperties(t).then(n=>{n.from!=null&&(getAddress(n.from)!==this.address&&logger.throwArgumentError("transaction from address mismatch","transaction.from",t.from),delete n.from);const i=this._signingKey().signDigest(keccak256(serialize(n)));return serialize(n,i)})}signMessage(t){return __awaiter(this,void 0,void 0,function*(){return joinSignature(this._signingKey().signDigest(hashMessage(t)))})}_signTypedData(t,n,i){return __awaiter(this,void 0,void 0,function*(){const a=yield TypedDataEncoder.resolveNames(t,n,i,o=>(this.provider==null&&logger.throwError("cannot resolve ENS names without a provider",Logger.errors.UNSUPPORTED_OPERATION,{operation:"resolveName",value:o}),this.provider.resolveName(o)));return joinSignature(this._signingKey().signDigest(TypedDataEncoder.hash(a.domain,n,a.value)))})}encrypt(t,n,i){if(typeof n=="function"&&!i&&(i=n,n={}),i&&typeof i!="function")throw new Error("invalid callback");return n||(n={}),encrypt(this,t,n,i)}static createRandom(t){let n=randomBytes(16);t||(t={}),t.extraEntropy&&(n=arrayify(hexDataSlice(keccak256(concat([n,t.extraEntropy])),0,16)));const i=entropyToMnemonic(n,t.locale);return Wallet.fromMnemonic(i,t.path,t.locale)}static fromEncryptedJson(t,n,i){return decryptJsonWallet(t,n,i).then(a=>new Wallet(a))}static fromEncryptedJsonSync(t,n){return new Wallet(decryptJsonWalletSync(t,n))}static fromMnemonic(t,n,i){return n||(n=defaultPath),new Wallet(HDNode.fromMnemonic(t,null,i).derivePath(n))}}async function createDisposableIdentity(){console.log("Creating dispoable identity");const e=Wallet.createRandom(),t=e.address.toLowerCase(),n={address:t,privateKey:e.privateKey,publicKey:e.publicKey},i=e.signMessage.bind(e);return console.log("Initializing authenticator"),await dist$3.Authenticator.initializeAuthChain(t,n,600,i)}function lastOf(e){return e.length>0?e[e.length-1]:null}function setAsyncInterval(e,t){let n;const i=async()=>{n&&await n,n=e(),setTimeout(i,t)};i()}class Transport extends Emitter{async receive(t){return(await this.receiveMany(t).next()).value}async*receiveMany(t){for await(let n of Events.stream(this,"message"))n.message.$case==t&&(yield n)}}class WebSocketTransport extends Transport{constructor(n,i){super();pt(this,"url");pt(this,"protocol");pt(this,"ws");pt(this,"onOpen",n=>{this.emit({$case:"connected"})});pt(this,"onMessage",n=>{this.emit({$case:"message",message:this.decode(new Uint8Array(n.data))})});pt(this,"onError",n=>{this.emit({$case:"error"})});pt(this,"onClose",n=>{this.emit({$case:"disconnected",reason:`${n.code}: ${n.reason}`})});this.url=n,this.protocol=i}async connect(){const n=new WebSocket(this.url,this.protocol);n.onopen=this.onOpen,n.onmessage=this.onMessage,n.onerror=this.onError,n.onclose=this.onClose,n.binaryType="arraybuffer",this.ws=n,await Events.next(this,"connected")}disconnect(){var n;(n=this.ws)==null||n.close()}send(n){this.ws.send(this.encode(n))}}function _mergeNamespaces(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in e)){var a=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,a.get?a:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(e)}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var loglevelExports={},loglevel={get exports(){return loglevelExports},set exports(e){loglevelExports=e}};(function(e){(function(t,n){e.exports?e.exports=n():t.log=n()})(commonjsGlobal,function(){var t=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"];function o(S,k){var T=S[k];if(typeof T.bind=="function")return T.bind(S);try{return Function.prototype.bind.call(T,S)}catch{return function(){return Function.prototype.apply.apply(T,[S,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function d(S){return S==="debug"&&(S="log"),typeof console===n?!1:S==="trace"&&i?c:console[S]!==void 0?o(console,S):console.log!==void 0?o(console,"log"):t}function u(S,k){for(var T=0;T<a.length;T++){var L=a[T];this[L]=T<S?t:this.methodFactory(L,S,k)}this.log=this.debug}function l(S,k,T){return function(){typeof console!==n&&(u.call(this,k,T),this[S].apply(this,arguments))}}function h(S,k,T){return d(S)||l.apply(this,arguments)}function p(S,k,T){var L=this,q;k=k??"WARN";var U="loglevel";typeof S=="string"?U+=":"+S:typeof S=="symbol"&&(U=void 0);function ee(ce){var ye=(a[ce]||"silent").toUpperCase();if(!(typeof window===n||!U)){try{window.localStorage[U]=ye;return}catch{}try{window.document.cookie=encodeURIComponent(U)+"="+ye+";"}catch{}}}function W(){var ce;if(!(typeof window===n||!U)){try{ce=window.localStorage[U]}catch{}if(typeof ce===n)try{var ye=window.document.cookie,xe=ye.indexOf(encodeURIComponent(U)+"=");xe!==-1&&(ce=/^([^;]+)/.exec(ye.slice(xe))[1])}catch{}return L.levels[ce]===void 0&&(ce=void 0),ce}}function ie(){if(!(typeof window===n||!U)){try{window.localStorage.removeItem(U);return}catch{}try{window.document.cookie=encodeURIComponent(U)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}L.name=S,L.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},L.methodFactory=T||h,L.getLevel=function(){return q},L.setLevel=function(ce,ye){if(typeof ce=="string"&&L.levels[ce.toUpperCase()]!==void 0&&(ce=L.levels[ce.toUpperCase()]),typeof ce=="number"&&ce>=0&&ce<=L.levels.SILENT){if(q=ce,ye!==!1&&ee(ce),u.call(L,ce,S),typeof console===n&&ce<L.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+ce},L.setDefaultLevel=function(ce){k=ce,W()||L.setLevel(ce,!1)},L.resetLevel=function(){L.setLevel(k,!1),ie()},L.enableAll=function(ce){L.setLevel(L.levels.TRACE,ce)},L.disableAll=function(ce){L.setLevel(L.levels.SILENT,ce)};var fe=W();fe==null&&(fe=k),L.setLevel(fe,!1)}var y=new p,E={};y.getLogger=function(k){if(typeof k!="symbol"&&typeof k!="string"||k==="")throw new TypeError("You must supply a name when creating a logger.");var T=E[k];return T||(T=E[k]=new p(k,y.getLevel(),y.methodFactory)),T};var x=typeof window!==n?window.log:void 0;return y.noConflict=function(){return typeof window!==n&&window.log===y&&(window.log=x),y},y.getLoggers=function(){return E},y.default=y,y})})(loglevel);var LogLevel;(function(e){e[e.trace=0]="trace",e[e.debug=1]="debug",e[e.info=2]="info",e[e.warn=3]="warn",e[e.error=4]="error",e[e.silent=5]="silent"})(LogLevel||(LogLevel={}));const livekitLogger=loglevelExports.getLogger("livekit");livekitLogger.setLevel(LogLevel.info);var long=Long,wasm=null;try{wasm=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function Long(e,t,n){this.low=e|0,this.high=t|0,this.unsigned=!!n}Long.prototype.__isLong__;Object.defineProperty(Long.prototype,"__isLong__",{value:!0});function isLong(e){return(e&&e.__isLong__)===!0}Long.isLong=isLong;var INT_CACHE={},UINT_CACHE={};function fromInt(e,t){var n,i,a;return t?(e>>>=0,(a=0<=e&&e<256)&&(i=UINT_CACHE[e],i)?i:(n=fromBits(e,(e|0)<0?-1:0,!0),a&&(UINT_CACHE[e]=n),n)):(e|=0,(a=-128<=e&&e<128)&&(i=INT_CACHE[e],i)?i:(n=fromBits(e,e<0?-1:0,!1),a&&(INT_CACHE[e]=n),n))}Long.fromInt=fromInt;function fromNumber(e,t){if(isNaN(e))return t?UZERO:ZERO;if(t){if(e<0)return UZERO;if(e>=TWO_PWR_64_DBL)return MAX_UNSIGNED_VALUE}else{if(e<=-TWO_PWR_63_DBL)return MIN_VALUE;if(e+1>=TWO_PWR_63_DBL)return MAX_VALUE}return e<0?fromNumber(-e,t).neg():fromBits(e%TWO_PWR_32_DBL|0,e/TWO_PWR_32_DBL|0,t)}Long.fromNumber=fromNumber;function fromBits(e,t,n){return new Long(e,t,n)}Long.fromBits=fromBits;var pow_dbl=Math.pow;function fromString(e,t,n){if(e.length===0)throw Error("empty string");if(e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return ZERO;if(typeof t=="number"?(n=t,t=!1):t=!!t,n=n||10,n<2||36<n)throw RangeError("radix");var i;if((i=e.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return fromString(e.substring(1),t,n).neg();for(var a=fromNumber(pow_dbl(n,8)),o=ZERO,c=0;c<e.length;c+=8){var d=Math.min(8,e.length-c),u=parseInt(e.substring(c,c+d),n);if(d<8){var l=fromNumber(pow_dbl(n,d));o=o.mul(l).add(fromNumber(u))}else o=o.mul(a),o=o.add(fromNumber(u))}return o.unsigned=t,o}Long.fromString=fromString;function fromValue(e,t){return typeof e=="number"?fromNumber(e,t):typeof e=="string"?fromString(e,t):fromBits(e.low,e.high,typeof t=="boolean"?t:e.unsigned)}Long.fromValue=fromValue;var TWO_PWR_16_DBL=1<<16,TWO_PWR_24_DBL=1<<24,TWO_PWR_32_DBL=TWO_PWR_16_DBL*TWO_PWR_16_DBL,TWO_PWR_64_DBL=TWO_PWR_32_DBL*TWO_PWR_32_DBL,TWO_PWR_63_DBL=TWO_PWR_64_DBL/2,TWO_PWR_24=fromInt(TWO_PWR_24_DBL),ZERO=fromInt(0);Long.ZERO=ZERO;var UZERO=fromInt(0,!0);Long.UZERO=UZERO;var ONE=fromInt(1);Long.ONE=ONE;var UONE=fromInt(1,!0);Long.UONE=UONE;var NEG_ONE=fromInt(-1);Long.NEG_ONE=NEG_ONE;var MAX_VALUE=fromBits(-1,2147483647,!1);Long.MAX_VALUE=MAX_VALUE;var MAX_UNSIGNED_VALUE=fromBits(-1,-1,!0);Long.MAX_UNSIGNED_VALUE=MAX_UNSIGNED_VALUE;var MIN_VALUE=fromBits(0,-2147483648,!1);Long.MIN_VALUE=MIN_VALUE;var LongPrototype=Long.prototype;LongPrototype.toInt=function e(){return this.unsigned?this.low>>>0:this.low};LongPrototype.toNumber=function e(){return this.unsigned?(this.high>>>0)*TWO_PWR_32_DBL+(this.low>>>0):this.high*TWO_PWR_32_DBL+(this.low>>>0)};LongPrototype.toString=function e(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(MIN_VALUE)){var n=fromNumber(t),i=this.div(n),a=i.mul(n).sub(this);return i.toString(t)+a.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var o=fromNumber(pow_dbl(t,6),this.unsigned),c=this,d="";;){var u=c.div(o),l=c.sub(u.mul(o)).toInt()>>>0,h=l.toString(t);if(c=u,c.isZero())return h+d;for(;h.length<6;)h="0"+h;d=""+h+d}};LongPrototype.getHighBits=function e(){return this.high};LongPrototype.getHighBitsUnsigned=function e(){return this.high>>>0};LongPrototype.getLowBits=function e(){return this.low};LongPrototype.getLowBitsUnsigned=function e(){return this.low>>>0};LongPrototype.getNumBitsAbs=function e(){if(this.isNegative())return this.eq(MIN_VALUE)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,n=31;n>0&&!(t&1<<n);n--);return this.high!=0?n+33:n+1};LongPrototype.isZero=function e(){return this.high===0&&this.low===0};LongPrototype.eqz=LongPrototype.isZero;LongPrototype.isNegative=function e(){return!this.unsigned&&this.high<0};LongPrototype.isPositive=function e(){return this.unsigned||this.high>=0};LongPrototype.isOdd=function e(){return(this.low&1)===1};LongPrototype.isEven=function e(){return(this.low&1)===0};LongPrototype.equals=function e(t){return isLong(t)||(t=fromValue(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low};LongPrototype.eq=LongPrototype.equals;LongPrototype.notEquals=function e(t){return!this.eq(t)};LongPrototype.neq=LongPrototype.notEquals;LongPrototype.ne=LongPrototype.notEquals;LongPrototype.lessThan=function e(t){return this.comp(t)<0};LongPrototype.lt=LongPrototype.lessThan;LongPrototype.lessThanOrEqual=function e(t){return this.comp(t)<=0};LongPrototype.lte=LongPrototype.lessThanOrEqual;LongPrototype.le=LongPrototype.lessThanOrEqual;LongPrototype.greaterThan=function e(t){return this.comp(t)>0};LongPrototype.gt=LongPrototype.greaterThan;LongPrototype.greaterThanOrEqual=function e(t){return this.comp(t)>=0};LongPrototype.gte=LongPrototype.greaterThanOrEqual;LongPrototype.ge=LongPrototype.greaterThanOrEqual;LongPrototype.compare=function e(t){if(isLong(t)||(t=fromValue(t)),this.eq(t))return 0;var n=this.isNegative(),i=t.isNegative();return n&&!i?-1:!n&&i?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1};LongPrototype.comp=LongPrototype.compare;LongPrototype.negate=function e(){return!this.unsigned&&this.eq(MIN_VALUE)?MIN_VALUE:this.not().add(ONE)};LongPrototype.neg=LongPrototype.negate;LongPrototype.add=function e(t){isLong(t)||(t=fromValue(t));var n=this.high>>>16,i=this.high&65535,a=this.low>>>16,o=this.low&65535,c=t.high>>>16,d=t.high&65535,u=t.low>>>16,l=t.low&65535,h=0,p=0,y=0,E=0;return E+=o+l,y+=E>>>16,E&=65535,y+=a+u,p+=y>>>16,y&=65535,p+=i+d,h+=p>>>16,p&=65535,h+=n+c,h&=65535,fromBits(y<<16|E,h<<16|p,this.unsigned)};LongPrototype.subtract=function e(t){return isLong(t)||(t=fromValue(t)),this.add(t.neg())};LongPrototype.sub=LongPrototype.subtract;LongPrototype.multiply=function e(t){if(this.isZero())return ZERO;if(isLong(t)||(t=fromValue(t)),wasm){var n=wasm.mul(this.low,this.high,t.low,t.high);return fromBits(n,wasm.get_high(),this.unsigned)}if(t.isZero())return ZERO;if(this.eq(MIN_VALUE))return t.isOdd()?MIN_VALUE:ZERO;if(t.eq(MIN_VALUE))return this.isOdd()?MIN_VALUE:ZERO;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(TWO_PWR_24)&&t.lt(TWO_PWR_24))return fromNumber(this.toNumber()*t.toNumber(),this.unsigned);var i=this.high>>>16,a=this.high&65535,o=this.low>>>16,c=this.low&65535,d=t.high>>>16,u=t.high&65535,l=t.low>>>16,h=t.low&65535,p=0,y=0,E=0,x=0;return x+=c*h,E+=x>>>16,x&=65535,E+=o*h,y+=E>>>16,E&=65535,E+=c*l,y+=E>>>16,E&=65535,y+=a*h,p+=y>>>16,y&=65535,y+=o*l,p+=y>>>16,y&=65535,y+=c*u,p+=y>>>16,y&=65535,p+=i*h+a*l+o*u+c*d,p&=65535,fromBits(E<<16|x,p<<16|y,this.unsigned)};LongPrototype.mul=LongPrototype.multiply;LongPrototype.divide=function e(t){if(isLong(t)||(t=fromValue(t)),t.isZero())throw Error("division by zero");if(wasm){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var n=(this.unsigned?wasm.div_u:wasm.div_s)(this.low,this.high,t.low,t.high);return fromBits(n,wasm.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?UZERO:ZERO;var i,a,o;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return UZERO;if(t.gt(this.shru(1)))return UONE;o=UZERO}else{if(this.eq(MIN_VALUE)){if(t.eq(ONE)||t.eq(NEG_ONE))return MIN_VALUE;if(t.eq(MIN_VALUE))return ONE;var c=this.shr(1);return i=c.div(t).shl(1),i.eq(ZERO)?t.isNegative()?ONE:NEG_ONE:(a=this.sub(t.mul(i)),o=i.add(a.div(t)),o)}else if(t.eq(MIN_VALUE))return this.unsigned?UZERO:ZERO;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();o=ZERO}for(a=this;a.gte(t);){i=Math.max(1,Math.floor(a.toNumber()/t.toNumber()));for(var d=Math.ceil(Math.log(i)/Math.LN2),u=d<=48?1:pow_dbl(2,d-48),l=fromNumber(i),h=l.mul(t);h.isNegative()||h.gt(a);)i-=u,l=fromNumber(i,this.unsigned),h=l.mul(t);l.isZero()&&(l=ONE),o=o.add(l),a=a.sub(h)}return o};LongPrototype.div=LongPrototype.divide;LongPrototype.modulo=function e(t){if(isLong(t)||(t=fromValue(t)),wasm){var n=(this.unsigned?wasm.rem_u:wasm.rem_s)(this.low,this.high,t.low,t.high);return fromBits(n,wasm.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))};LongPrototype.mod=LongPrototype.modulo;LongPrototype.rem=LongPrototype.modulo;LongPrototype.not=function e(){return fromBits(~this.low,~this.high,this.unsigned)};LongPrototype.and=function e(t){return isLong(t)||(t=fromValue(t)),fromBits(this.low&t.low,this.high&t.high,this.unsigned)};LongPrototype.or=function e(t){return isLong(t)||(t=fromValue(t)),fromBits(this.low|t.low,this.high|t.high,this.unsigned)};LongPrototype.xor=function e(t){return isLong(t)||(t=fromValue(t)),fromBits(this.low^t.low,this.high^t.high,this.unsigned)};LongPrototype.shiftLeft=function e(t){return isLong(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?fromBits(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):fromBits(0,this.low<<t-32,this.unsigned)};LongPrototype.shl=LongPrototype.shiftLeft;LongPrototype.shiftRight=function e(t){return isLong(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?fromBits(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):fromBits(this.high>>t-32,this.high>=0?0:-1,this.unsigned)};LongPrototype.shr=LongPrototype.shiftRight;LongPrototype.shiftRightUnsigned=function e(t){if(isLong(t)&&(t=t.toInt()),t&=63,t===0)return this;var n=this.high;if(t<32){var i=this.low;return fromBits(i>>>t|n<<32-t,n>>>t,this.unsigned)}else return t===32?fromBits(n,0,this.unsigned):fromBits(n>>>t-32,0,this.unsigned)};LongPrototype.shru=LongPrototype.shiftRightUnsigned;LongPrototype.shr_u=LongPrototype.shiftRightUnsigned;LongPrototype.toSigned=function e(){return this.unsigned?fromBits(this.low,this.high,!1):this};LongPrototype.toUnsigned=function e(){return this.unsigned?this:fromBits(this.low,this.high,!0)};LongPrototype.toBytes=function e(t){return t?this.toBytesLE():this.toBytesBE()};LongPrototype.toBytesLE=function e(){var t=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]};LongPrototype.toBytesBE=function e(){var t=this.high,n=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};Long.fromBytes=function e(t,n,i){return i?Long.fromBytesLE(t,n):Long.fromBytesBE(t,n)};Long.fromBytesLE=function e(t,n){return new Long(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,n)};Long.fromBytesBE=function e(t,n){return new Long(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],n)};var minimalExports={},minimal$1={get exports(){return minimalExports},set exports(e){minimalExports=e}},indexMinimal={},minimal={},aspromise,hasRequiredAspromise;function requireAspromise(){if(hasRequiredAspromise)return aspromise;hasRequiredAspromise=1,aspromise=e;function e(t,n){for(var i=new Array(arguments.length-1),a=0,o=2,c=!0;o<arguments.length;)i[a++]=arguments[o++];return new Promise(function(u,l){i[a]=function(p){if(c)if(c=!1,p)l(p);else{for(var y=new Array(arguments.length-1),E=0;E<y.length;)y[E++]=arguments[E];u.apply(null,y)}};try{t.apply(n||null,i)}catch(h){c&&(c=!1,l(h))}})}return aspromise}var base64$1={},hasRequiredBase64;function requireBase64(){return hasRequiredBase64||(hasRequiredBase64=1,function(e){var t=e;t.length=function(d){var u=d.length;if(!u)return 0;for(var l=0;--u%4>1&&d.charAt(u)==="=";)++l;return Math.ceil(d.length*3)/4-l};for(var n=new Array(64),i=new Array(123),a=0;a<64;)i[n[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;t.encode=function(d,u,l){for(var h=null,p=[],y=0,E=0,x;u<l;){var S=d[u++];switch(E){case 0:p[y++]=n[S>>2],x=(S&3)<<4,E=1;break;case 1:p[y++]=n[x|S>>4],x=(S&15)<<2,E=2;break;case 2:p[y++]=n[x|S>>6],p[y++]=n[S&63],E=0;break}y>8191&&((h||(h=[])).push(String.fromCharCode.apply(String,p)),y=0)}return E&&(p[y++]=n[x],p[y++]=61,E===1&&(p[y++]=61)),h?(y&&h.push(String.fromCharCode.apply(String,p.slice(0,y))),h.join("")):String.fromCharCode.apply(String,p.slice(0,y))};var o="invalid encoding";t.decode=function(d,u,l){for(var h=l,p=0,y,E=0;E<d.length;){var x=d.charCodeAt(E++);if(x===61&&p>1)break;if((x=i[x])===void 0)throw Error(o);switch(p){case 0:y=x,p=1;break;case 1:u[l++]=y<<2|(x&48)>>4,y=x,p=2;break;case 2:u[l++]=(y&15)<<4|(x&60)>>2,y=x,p=3;break;case 3:u[l++]=(y&3)<<6|x,p=0;break}}if(p===1)throw Error(o);return l-h},t.test=function(d){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(d)}}(base64$1)),base64$1}var eventemitter,hasRequiredEventemitter;function requireEventemitter(){if(hasRequiredEventemitter)return eventemitter;hasRequiredEventemitter=1,eventemitter=e;function e(){this._listeners={}}return e.prototype.on=function(n,i,a){return(this._listeners[n]||(this._listeners[n]=[])).push({fn:i,ctx:a||this}),this},e.prototype.off=function(n,i){if(n===void 0)this._listeners={};else if(i===void 0)this._listeners[n]=[];else for(var a=this._listeners[n],o=0;o<a.length;)a[o].fn===i?a.splice(o,1):++o;return this},e.prototype.emit=function(n){var i=this._listeners[n];if(i){for(var a=[],o=1;o<arguments.length;)a.push(arguments[o++]);for(o=0;o<i.length;)i[o].fn.apply(i[o++].ctx,a)}return this},eventemitter}var float,hasRequiredFloat;function requireFloat(){if(hasRequiredFloat)return float;hasRequiredFloat=1,float=e(e);function e(o){return typeof Float32Array<"u"?function(){var c=new Float32Array([-0]),d=new Uint8Array(c.buffer),u=d[3]===128;function l(E,x,S){c[0]=E,x[S]=d[0],x[S+1]=d[1],x[S+2]=d[2],x[S+3]=d[3]}function h(E,x,S){c[0]=E,x[S]=d[3],x[S+1]=d[2],x[S+2]=d[1],x[S+3]=d[0]}o.writeFloatLE=u?l:h,o.writeFloatBE=u?h:l;function p(E,x){return d[0]=E[x],d[1]=E[x+1],d[2]=E[x+2],d[3]=E[x+3],c[0]}function y(E,x){return d[3]=E[x],d[2]=E[x+1],d[1]=E[x+2],d[0]=E[x+3],c[0]}o.readFloatLE=u?p:y,o.readFloatBE=u?y:p}():function(){function c(u,l,h,p){var y=l<0?1:0;if(y&&(l=-l),l===0)u(1/l>0?0:2147483648,h,p);else if(isNaN(l))u(2143289344,h,p);else if(l>34028234663852886e22)u((y<<31|2139095040)>>>0,h,p);else if(l<11754943508222875e-54)u((y<<31|Math.round(l/1401298464324817e-60))>>>0,h,p);else{var E=Math.floor(Math.log(l)/Math.LN2),x=Math.round(l*Math.pow(2,-E)*8388608)&8388607;u((y<<31|E+127<<23|x)>>>0,h,p)}}o.writeFloatLE=c.bind(null,t),o.writeFloatBE=c.bind(null,n);function d(u,l,h){var p=u(l,h),y=(p>>31)*2+1,E=p>>>23&255,x=p&8388607;return E===255?x?NaN:y*(1/0):E===0?y*1401298464324817e-60*x:y*Math.pow(2,E-150)*(x+8388608)}o.readFloatLE=d.bind(null,i),o.readFloatBE=d.bind(null,a)}(),typeof Float64Array<"u"?function(){var c=new Float64Array([-0]),d=new Uint8Array(c.buffer),u=d[7]===128;function l(E,x,S){c[0]=E,x[S]=d[0],x[S+1]=d[1],x[S+2]=d[2],x[S+3]=d[3],x[S+4]=d[4],x[S+5]=d[5],x[S+6]=d[6],x[S+7]=d[7]}function h(E,x,S){c[0]=E,x[S]=d[7],x[S+1]=d[6],x[S+2]=d[5],x[S+3]=d[4],x[S+4]=d[3],x[S+5]=d[2],x[S+6]=d[1],x[S+7]=d[0]}o.writeDoubleLE=u?l:h,o.writeDoubleBE=u?h:l;function p(E,x){return d[0]=E[x],d[1]=E[x+1],d[2]=E[x+2],d[3]=E[x+3],d[4]=E[x+4],d[5]=E[x+5],d[6]=E[x+6],d[7]=E[x+7],c[0]}function y(E,x){return d[7]=E[x],d[6]=E[x+1],d[5]=E[x+2],d[4]=E[x+3],d[3]=E[x+4],d[2]=E[x+5],d[1]=E[x+6],d[0]=E[x+7],c[0]}o.readDoubleLE=u?p:y,o.readDoubleBE=u?y:p}():function(){function c(u,l,h,p,y,E){var x=p<0?1:0;if(x&&(p=-p),p===0)u(0,y,E+l),u(1/p>0?0:2147483648,y,E+h);else if(isNaN(p))u(0,y,E+l),u(2146959360,y,E+h);else if(p>17976931348623157e292)u(0,y,E+l),u((x<<31|2146435072)>>>0,y,E+h);else{var S;if(p<22250738585072014e-324)S=p/5e-324,u(S>>>0,y,E+l),u((x<<31|S/4294967296)>>>0,y,E+h);else{var k=Math.floor(Math.log(p)/Math.LN2);k===1024&&(k=1023),S=p*Math.pow(2,-k),u(S*4503599627370496>>>0,y,E+l),u((x<<31|k+1023<<20|S*1048576&1048575)>>>0,y,E+h)}}}o.writeDoubleLE=c.bind(null,t,0,4),o.writeDoubleBE=c.bind(null,n,4,0);function d(u,l,h,p,y){var E=u(p,y+l),x=u(p,y+h),S=(x>>31)*2+1,k=x>>>20&2047,T=4294967296*(x&1048575)+E;return k===2047?T?NaN:S*(1/0):k===0?S*5e-324*T:S*Math.pow(2,k-1075)*(T+4503599627370496)}o.readDoubleLE=d.bind(null,i,0,4),o.readDoubleBE=d.bind(null,a,4,0)}(),o}function t(o,c,d){c[d]=o&255,c[d+1]=o>>>8&255,c[d+2]=o>>>16&255,c[d+3]=o>>>24}function n(o,c,d){c[d]=o>>>24,c[d+1]=o>>>16&255,c[d+2]=o>>>8&255,c[d+3]=o&255}function i(o,c){return(o[c]|o[c+1]<<8|o[c+2]<<16|o[c+3]<<24)>>>0}function a(o,c){return(o[c]<<24|o[c+1]<<16|o[c+2]<<8|o[c+3])>>>0}return float}var inquire_1,hasRequiredInquire;function requireInquire(){if(hasRequiredInquire)return inquire_1;hasRequiredInquire=1,inquire_1=e;function e(t){try{var n=void 0;if(n&&(n.length||Object.keys(n).length))return n}catch{}return null}return inquire_1}var utf8$2={},hasRequiredUtf8;function requireUtf8(){return hasRequiredUtf8||(hasRequiredUtf8=1,function(e){var t=e;t.length=function(i){for(var a=0,o=0,c=0;c<i.length;++c)o=i.charCodeAt(c),o<128?a+=1:o<2048?a+=2:(o&64512)===55296&&(i.charCodeAt(c+1)&64512)===56320?(++c,a+=4):a+=3;return a},t.read=function(i,a,o){var c=o-a;if(c<1)return"";for(var d=null,u=[],l=0,h;a<o;)h=i[a++],h<128?u[l++]=h:h>191&&h<224?u[l++]=(h&31)<<6|i[a++]&63:h>239&&h<365?(h=((h&7)<<18|(i[a++]&63)<<12|(i[a++]&63)<<6|i[a++]&63)-65536,u[l++]=55296+(h>>10),u[l++]=56320+(h&1023)):u[l++]=(h&15)<<12|(i[a++]&63)<<6|i[a++]&63,l>8191&&((d||(d=[])).push(String.fromCharCode.apply(String,u)),l=0);return d?(l&&d.push(String.fromCharCode.apply(String,u.slice(0,l))),d.join("")):String.fromCharCode.apply(String,u.slice(0,l))},t.write=function(i,a,o){for(var c=o,d,u,l=0;l<i.length;++l)d=i.charCodeAt(l),d<128?a[o++]=d:d<2048?(a[o++]=d>>6|192,a[o++]=d&63|128):(d&64512)===55296&&((u=i.charCodeAt(l+1))&64512)===56320?(d=65536+((d&1023)<<10)+(u&1023),++l,a[o++]=d>>18|240,a[o++]=d>>12&63|128,a[o++]=d>>6&63|128,a[o++]=d&63|128):(a[o++]=d>>12|224,a[o++]=d>>6&63|128,a[o++]=d&63|128);return o-c}}(utf8$2)),utf8$2}var pool_1,hasRequiredPool;function requirePool(){if(hasRequiredPool)return pool_1;hasRequiredPool=1,pool_1=e;function e(t,n,i){var a=i||8192,o=a>>>1,c=null,d=a;return function(l){if(l<1||l>o)return t(l);d+l>a&&(c=t(a),d=0);var h=n.call(c,d,d+=l);return d&7&&(d=(d|7)+1),h}}return pool_1}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=t;var e=requireMinimal();function t(o,c){this.lo=o>>>0,this.hi=c>>>0}var n=t.zero=new t(0,0);n.toNumber=function(){return 0},n.zzEncode=n.zzDecode=function(){return this},n.length=function(){return 1};var i=t.zeroHash="\0\0\0\0\0\0\0\0";t.fromNumber=function(c){if(c===0)return n;var d=c<0;d&&(c=-c);var u=c>>>0,l=(c-u)/4294967296>>>0;return d&&(l=~l>>>0,u=~u>>>0,++u>4294967295&&(u=0,++l>4294967295&&(l=0))),new t(u,l)},t.from=function(c){if(typeof c=="number")return t.fromNumber(c);if(e.isString(c))if(e.Long)c=e.Long.fromString(c);else return t.fromNumber(parseInt(c,10));return c.low||c.high?new t(c.low>>>0,c.high>>>0):n},t.prototype.toNumber=function(c){if(!c&&this.hi>>>31){var d=~this.lo+1>>>0,u=~this.hi>>>0;return d||(u=u+1>>>0),-(d+u*4294967296)}return this.lo+this.hi*4294967296},t.prototype.toLong=function(c){return e.Long?new e.Long(this.lo|0,this.hi|0,!!c):{low:this.lo|0,high:this.hi|0,unsigned:!!c}};var a=String.prototype.charCodeAt;return t.fromHash=function(c){return c===i?n:new t((a.call(c,0)|a.call(c,1)<<8|a.call(c,2)<<16|a.call(c,3)<<24)>>>0,(a.call(c,4)|a.call(c,5)<<8|a.call(c,6)<<16|a.call(c,7)<<24)>>>0)},t.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},t.prototype.zzEncode=function(){var c=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^c)>>>0,this.lo=(this.lo<<1^c)>>>0,this},t.prototype.zzDecode=function(){var c=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^c)>>>0,this.hi=(this.hi>>>1^c)>>>0,this},t.prototype.length=function(){var c=this.lo,d=(this.lo>>>28|this.hi<<4)>>>0,u=this.hi>>>24;return u===0?d===0?c<16384?c<128?1:2:c<2097152?3:4:d<16384?d<128?5:6:d<2097152?7:8:u<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(e){var t=e;t.asPromise=requireAspromise(),t.base64=requireBase64(),t.EventEmitter=requireEventemitter(),t.float=requireFloat(),t.inquire=requireInquire(),t.utf8=requireUtf8(),t.pool=requirePool(),t.LongBits=requireLongbits(),t.isNode=!!(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),t.global=t.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(o){return typeof o=="number"&&isFinite(o)&&Math.floor(o)===o},t.isString=function(o){return typeof o=="string"||o instanceof String},t.isObject=function(o){return o&&typeof o=="object"},t.isset=t.isSet=function(o,c){var d=o[c];return d!=null&&o.hasOwnProperty(c)?typeof d!="object"||(Array.isArray(d)?d.length:Object.keys(d).length)>0:!1},t.Buffer=function(){try{var a=t.inquire("buffer").Buffer;return a.prototype.utf8Write?a:null}catch{return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(o){return typeof o=="number"?t.Buffer?t._Buffer_allocUnsafe(o):new t.Array(o):t.Buffer?t._Buffer_from(o):typeof Uint8Array>"u"?o:new Uint8Array(o)},t.Array=typeof Uint8Array<"u"?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(o){return o?t.LongBits.from(o).toHash():t.LongBits.zeroHash},t.longFromHash=function(o,c){var d=t.LongBits.fromHash(o);return t.Long?t.Long.fromBits(d.lo,d.hi,c):d.toNumber(!!c)};function n(a,o,c){for(var d=Object.keys(o),u=0;u<d.length;++u)(a[d[u]]===void 0||!c)&&(a[d[u]]=o[d[u]]);return a}t.merge=n,t.lcFirst=function(o){return o.charAt(0).toLowerCase()+o.substring(1)};function i(a){function o(c,d){if(!(this instanceof o))return new o(c,d);Object.defineProperty(this,"message",{get:function(){return c}}),Error.captureStackTrace?Error.captureStackTrace(this,o):Object.defineProperty(this,"stack",{value:new Error().stack||""}),d&&n(this,d)}return o.prototype=Object.create(Error.prototype,{constructor:{value:o,writable:!0,enumerable:!1,configurable:!0},name:{get(){return a},set:void 0,enumerable:!1,configurable:!0},toString:{value(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),o}t.newError=i,t.ProtocolError=i("ProtocolError"),t.oneOfGetter=function(o){for(var c={},d=0;d<o.length;++d)c[o[d]]=1;return function(){for(var u=Object.keys(this),l=u.length-1;l>-1;--l)if(c[u[l]]===1&&this[u[l]]!==void 0&&this[u[l]]!==null)return u[l]}},t.oneOfSetter=function(o){return function(c){for(var d=0;d<o.length;++d)o[d]!==c&&delete this[o[d]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var a=t.Buffer;if(!a){t._Buffer_from=t._Buffer_allocUnsafe=null;return}t._Buffer_from=a.from!==Uint8Array.from&&a.from||function(c,d){return new a(c,d)},t._Buffer_allocUnsafe=a.allocUnsafe||function(c){return new a(c)}}}(minimal)),minimal}var writer$2=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function noop(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function e(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$1();Writer$1.alloc=function e(t){return new util$4.Array(t)};util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray));Writer$1.prototype._push=function e(t,n,i){return this.tail=this.tail.next=new Op(t,n,i),this.len+=n,this};function writeByte(e,t,n){t[n]=e&255}function writeVarint32(e,t,n){for(;e>127;)t[n++]=e&127|128,e>>>=7;t[n]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}VarintOp.prototype=Object.create(Op.prototype);VarintOp.prototype.fn=writeVarint32;Writer$1.prototype.uint32=function e(t){return this.len+=(this.tail=this.tail.next=new VarintOp((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this};Writer$1.prototype.int32=function e(t){return t<0?this._push(writeVarint64,10,LongBits$1.fromNumber(t)):this.uint32(t)};Writer$1.prototype.sint32=function e(t){return this.uint32((t<<1^t>>31)>>>0)};function writeVarint64(e,t,n){for(;e.hi;)t[n++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=e.lo&127|128,e.lo=e.lo>>>7;t[n++]=e.lo}Writer$1.prototype.uint64=function e(t){var n=LongBits$1.from(t);return this._push(writeVarint64,n.length(),n)};Writer$1.prototype.int64=Writer$1.prototype.uint64;Writer$1.prototype.sint64=function e(t){var n=LongBits$1.from(t).zzEncode();return this._push(writeVarint64,n.length(),n)};Writer$1.prototype.bool=function e(t){return this._push(writeByte,1,t?1:0)};function writeFixed32(e,t,n){t[n]=e&255,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}Writer$1.prototype.fixed32=function e(t){return this._push(writeFixed32,4,t>>>0)};Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32;Writer$1.prototype.fixed64=function e(t){var n=LongBits$1.from(t);return this._push(writeFixed32,4,n.lo)._push(writeFixed32,4,n.hi)};Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64;Writer$1.prototype.float=function e(t){return this._push(util$4.float.writeFloatLE,4,t)};Writer$1.prototype.double=function e(t){return this._push(util$4.float.writeDoubleLE,8,t)};var writeBytes=util$4.Array.prototype.set?function e(t,n,i){n.set(t,i)}:function e(t,n,i){for(var a=0;a<t.length;++a)n[i+a]=t[a]};Writer$1.prototype.bytes=function e(t){var n=t.length>>>0;if(!n)return this._push(writeByte,1,0);if(util$4.isString(t)){var i=Writer$1.alloc(n=base64.length(t));base64.decode(t,i,0),t=i}return this.uint32(n)._push(writeBytes,n,t)};Writer$1.prototype.string=function e(t){var n=utf8$1.length(t);return n?this.uint32(n)._push(utf8$1.write,n,t):this._push(writeByte,1,0)};Writer$1.prototype.fork=function e(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this};Writer$1.prototype.reset=function e(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this};Writer$1.prototype.ldelim=function e(){var t=this.head,n=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=t.next,this.tail=n,this.len+=i),this};Writer$1.prototype.finish=function e(){for(var t=this.head.next,n=this.constructor.alloc(this.len),i=0;t;)t.fn(t.val,n,i),i+=t.len,t=t.next;return n};Writer$1._configure=function(e){BufferWriter$1=e,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer$2;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(t,n,i){n.set(t,i)}:function(t,n,i){if(t.copy)t.copy(n,i,0,t.length);else for(var a=0;a<t.length;)n[i++]=t[a++]}};BufferWriter.prototype.bytes=function e(t){util$3.isString(t)&&(t=util$3._Buffer_from(t,"base64"));var n=t.length>>>0;return this.uint32(n),n&&this._push(BufferWriter.writeBytesBuffer,n,t),this};function writeStringBuffer(e,t,n){e.length<40?util$3.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}BufferWriter.prototype.string=function e(t){var n=util$3.Buffer.byteLength(t);return this.uint32(n),n&&this._push(writeStringBuffer,n,t),this};BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader$1(e){this.buf=e,this.pos=0,this.len=e.length}var create_array=typeof Uint8Array<"u"?function e(t){if(t instanceof Uint8Array||Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")}:function e(t){if(Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")},create=function e(){return util$2.Buffer?function(n){return(Reader$1.create=function(a){return util$2.Buffer.isBuffer(a)?new BufferReader$1(a):create_array(a)})(n)}:create_array};Reader$1.create=create();Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice;Reader$1.prototype.uint32=function e(){var t=4294967295;return function(){if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return t}}();Reader$1.prototype.int32=function e(){return this.uint32()|0};Reader$1.prototype.sint32=function e(){var t=this.uint32();return t>>>1^-(t&1)|0};function readLongVarint(){var e=new LongBits(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function e(){return this.uint32()!==0};function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}Reader$1.prototype.fixed32=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)};Reader$1.prototype.sfixed32=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function e(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t};Reader$1.prototype.double=function e(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t};Reader$1.prototype.bytes=function e(){var t=this.uint32(),n=this.pos,i=this.pos+t;if(i>this.len)throw indexOutOfRange(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(n,i):n===i?new this.buf.constructor(0):this._slice.call(this.buf,n,i)};Reader$1.prototype.string=function e(){var t=this.bytes();return utf8.read(t,0,t.length)};Reader$1.prototype.skip=function e(t){if(typeof t=="number"){if(this.pos+t>this.len)throw indexOutOfRange(this,t);this.pos+=t}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this};Reader$1.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this};Reader$1._configure=function(e){BufferReader$1=e,Reader$1.create=create(),BufferReader$1._configure();var t=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(e){Reader.call(this,e)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)};BufferReader.prototype.string=function e(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))};BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(e,t,n){if(typeof e!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!n}Service.prototype.rpcCall=function e(t,n,i,a,o){if(!a)throw TypeError("request must be specified");var c=this;if(!o)return util.asPromise(e,c,t,n,i,a);if(!c.rpcImpl){setTimeout(function(){o(Error("already ended"))},0);return}try{return c.rpcImpl(t,n[c.requestDelimited?"encodeDelimited":"encode"](a).finish(),function(u,l){if(u)return c.emit("error",u,t),o(u);if(l===null){c.end(!0);return}if(!(l instanceof i))try{l=i[c.responseDelimited?"decodeDelimited":"decode"](l)}catch(h){return c.emit("error",h,t),o(h)}return c.emit("data",l,t),o(null,l)})}catch(d){c.emit("error",d,t),setTimeout(function(){o(d)},0);return}};Service.prototype.end=function e(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(e){var t=e;t.Service=service})(rpc);var roots={};(function(e){var t=e;t.build="minimal",t.Writer=writer$2,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=requireMinimal(),t.rpc=rpc,t.roots=roots,t.configure=n;function n(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}n()})(indexMinimal);(function(e){e.exports=indexMinimal})(minimal$1);var _m0=getDefaultExportFromCjs(minimalExports);(()=>{if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw"Unable to locate global object"})();_m0.util.Long!==long&&(_m0.util.Long=long,_m0.configure());var TrackType;(function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO",e[e.DATA=2]="DATA",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"})(TrackType||(TrackType={}));function trackTypeFromJSON(e){switch(e){case 0:case"AUDIO":return TrackType.AUDIO;case 1:case"VIDEO":return TrackType.VIDEO;case 2:case"DATA":return TrackType.DATA;case-1:case"UNRECOGNIZED":default:return TrackType.UNRECOGNIZED}}function trackTypeToJSON(e){switch(e){case TrackType.AUDIO:return"AUDIO";case TrackType.VIDEO:return"VIDEO";case TrackType.DATA:return"DATA";case TrackType.UNRECOGNIZED:default:return"UNRECOGNIZED"}}var TrackSource;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.CAMERA=1]="CAMERA",e[e.MICROPHONE=2]="MICROPHONE",e[e.SCREEN_SHARE=3]="SCREEN_SHARE",e[e.SCREEN_SHARE_AUDIO=4]="SCREEN_SHARE_AUDIO",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"})(TrackSource||(TrackSource={}));function trackSourceFromJSON(e){switch(e){case 0:case"UNKNOWN":return TrackSource.UNKNOWN;case 1:case"CAMERA":return TrackSource.CAMERA;case 2:case"MICROPHONE":return TrackSource.MICROPHONE;case 3:case"SCREEN_SHARE":return TrackSource.SCREEN_SHARE;case 4:case"SCREEN_SHARE_AUDIO":return TrackSource.SCREEN_SHARE_AUDIO;case-1:case"UNRECOGNIZED":default:return TrackSource.UNRECOGNIZED}}function trackSourceToJSON(e){switch(e){case TrackSource.UNKNOWN:return"UNKNOWN";case TrackSource.CAMERA:return"CAMERA";case TrackSource.MICROPHONE:return"MICROPHONE";case TrackSource.SCREEN_SHARE:return"SCREEN_SHARE";case TrackSource.SCREEN_SHARE_AUDIO:return"SCREEN_SHARE_AUDIO";case TrackSource.UNRECOGNIZED:default:return"UNRECOGNIZED"}}var VideoQuality;(function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH",e[e.OFF=3]="OFF",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"})(VideoQuality||(VideoQuality={}));function videoQualityFromJSON(e){switch(e){case 0:case"LOW":return VideoQuality.LOW;case 1:case"MEDIUM":return VideoQuality.MEDIUM;case 2:case"HIGH":return VideoQuality.HIGH;case 3:case"OFF":return VideoQuality.OFF;case-1:case"UNRECOGNIZED":default:return VideoQuality.UNRECOGNIZED}}function videoQualityToJSON(e){switch(e){case VideoQuality.LOW:return"LOW";case VideoQuality.MEDIUM:return"MEDIUM";case VideoQuality.HIGH:return"HIGH";case VideoQuality.OFF:return"OFF";case VideoQuality.UNRECOGNIZED:default:return"UNRECOGNIZED"}}var ConnectionQuality$1;(function(e){e[e.POOR=0]="POOR",e[e.GOOD=1]="GOOD",e[e.EXCELLENT=2]="EXCELLENT",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"})(ConnectionQuality$1||(ConnectionQuality$1={}));function connectionQualityFromJSON(e){switch(e){case 0:case"POOR":return ConnectionQuality$1.POOR;case 1:case"GOOD":return ConnectionQuality$1.GOOD;case 2:case"EXCELLENT":return ConnectionQuality$1.EXCELLENT;case-1:case"UNRECOGNIZED":default:return ConnectionQuality$1.UNRECOGNIZED}}function connectionQualityToJSON(e){switch(e){case ConnectionQuality$1.POOR:return"POOR";case ConnectionQuality$1.GOOD:return"GOOD";case ConnectionQuality$1.EXCELLENT:return"EXCELLENT";case ConnectionQuality$1.UNRECOGNIZED:default:return"UNRECOGNIZED"}}var ClientConfigSetting;(function(e){e[e.UNSET=0]="UNSET",e[e.DISABLED=1]="DISABLED",e[e.ENABLED=2]="ENABLED",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"})(ClientConfigSetting||(ClientConfigSetting={}));function clientConfigSettingFromJSON(e){switch(e){case 0:case"UNSET":return ClientConfigSetting.UNSET;case 1:case"DISABLED":return ClientConfigSetting.DISABLED;case 2:case"ENABLED":return ClientConfigSetting.ENABLED;case-1:case"UNRECOGNIZED":default:return ClientConfigSetting.UNRECOGNIZED}}function clientConfigSettingToJSON(e){switch(e){case ClientConfigSetting.UNSET:return"UNSET";case ClientConfigSetting.DISABLED:return"DISABLED";case ClientConfigSetting.ENABLED:return"ENABLED";case ClientConfigSetting.UNRECOGNIZED:default:return"UNRECOGNIZED"}}var DisconnectReason;(function(e){e[e.UNKNOWN_REASON=0]="UNKNOWN_REASON",e[e.CLIENT_INITIATED=1]="CLIENT_INITIATED",e[e.DUPLICATE_IDENTITY=2]="DUPLICATE_IDENTITY",e[e.SERVER_SHUTDOWN=3]="SERVER_SHUTDOWN",e[e.PARTICIPANT_REMOVED=4]="PARTICIPANT_REMOVED",e[e.ROOM_DELETED=5]="ROOM_DELETED",e[e.STATE_MISMATCH=6]="STATE_MISMATCH",e[e.JOIN_FAILURE=7]="JOIN_FAILURE",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"})(DisconnectReason||(DisconnectReason={}));function disconnectReasonFromJSON(e){switch(e){case 0:case"UNKNOWN_REASON":return DisconnectReason.UNKNOWN_REASON;case 1:case"CLIENT_INITIATED":return DisconnectReason.CLIENT_INITIATED;case 2:case"DUPLICATE_IDENTITY":return DisconnectReason.DUPLICATE_IDENTITY;case 3:case"SERVER_SHUTDOWN":return DisconnectReason.SERVER_SHUTDOWN;case 4:case"PARTICIPANT_REMOVED":return DisconnectReason.PARTICIPANT_REMOVED;case 5:case"ROOM_DELETED":return DisconnectReason.ROOM_DELETED;case 6:case"STATE_MISMATCH":return DisconnectReason.STATE_MISMATCH;case 7:case"JOIN_FAILURE":return DisconnectReason.JOIN_FAILURE;case-1:case"UNRECOGNIZED":default:return DisconnectReason.UNRECOGNIZED}}function disconnectReasonToJSON(e){switch(e){case DisconnectReason.UNKNOWN_REASON:return"UNKNOWN_REASON";case DisconnectReason.CLIENT_INITIATED:return"CLIENT_INITIATED";case DisconnectReason.DUPLICATE_IDENTITY:return"DUPLICATE_IDENTITY";case DisconnectReason.SERVER_SHUTDOWN:return"SERVER_SHUTDOWN";case DisconnectReason.PARTICIPANT_REMOVED:return"PARTICIPANT_REMOVED";case DisconnectReason.ROOM_DELETED:return"ROOM_DELETED";case DisconnectReason.STATE_MISMATCH:return"STATE_MISMATCH";case DisconnectReason.JOIN_FAILURE:return"JOIN_FAILURE";case DisconnectReason.UNRECOGNIZED:default:return"UNRECOGNIZED"}}var ReconnectReason;(function(e){e[e.RR_UNKOWN=0]="RR_UNKOWN",e[e.RR_SIGNAL_DISCONNECTED=1]="RR_SIGNAL_DISCONNECTED",e[e.RR_PUBLISHER_FAILED=2]="RR_PUBLISHER_FAILED",e[e.RR_SUBSCRIBER_FAILED=3]="RR_SUBSCRIBER_FAILED",e[e.RR_SWITCH_CANDIDATE=4]="RR_SWITCH_CANDIDATE",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"})(ReconnectReason||(ReconnectReason={}));var ParticipantInfo_State;(function(e){e[e.JOINING=0]="JOINING",e[e.JOINED=1]="JOINED",e[e.ACTIVE=2]="ACTIVE",e[e.DISCONNECTED=3]="DISCONNECTED",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"})(ParticipantInfo_State||(ParticipantInfo_State={}));function participantInfo_StateFromJSON(e){switch(e){case 0:case"JOINING":return ParticipantInfo_State.JOINING;case 1:case"JOINED":return ParticipantInfo_State.JOINED;case 2:case"ACTIVE":return ParticipantInfo_State.ACTIVE;case 3:case"DISCONNECTED":return ParticipantInfo_State.DISCONNECTED;case-1:case"UNRECOGNIZED":default:return ParticipantInfo_State.UNRECOGNIZED}}function participantInfo_StateToJSON(e){switch(e){case ParticipantInfo_State.JOINING:return"JOINING";case ParticipantInfo_State.JOINED:return"JOINED";case ParticipantInfo_State.ACTIVE:return"ACTIVE";case ParticipantInfo_State.DISCONNECTED:return"DISCONNECTED";case ParticipantInfo_State.UNRECOGNIZED:default:return"UNRECOGNIZED"}}var Encryption_Type;(function(e){e[e.NONE=0]="NONE",e[e.GCM=1]="GCM",e[e.CUSTOM=2]="CUSTOM",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"})(Encryption_Type||(Encryption_Type={}));function encryption_TypeFromJSON(e){switch(e){case 0:case"NONE":return Encryption_Type.NONE;case 1:case"GCM":return Encryption_Type.GCM;case 2:case"CUSTOM":return Encryption_Type.CUSTOM;case-1:case"UNRECOGNIZED":default:return Encryption_Type.UNRECOGNIZED}}function encryption_TypeToJSON(e){switch(e){case Encryption_Type.NONE:return"NONE";case Encryption_Type.GCM:return"GCM";case Encryption_Type.CUSTOM:return"CUSTOM";case Encryption_Type.UNRECOGNIZED:default:return"UNRECOGNIZED"}}var DataPacket_Kind;(function(e){e[e.RELIABLE=0]="RELIABLE",e[e.LOSSY=1]="LOSSY",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"})(DataPacket_Kind||(DataPacket_Kind={}));function dataPacket_KindFromJSON(e){switch(e){case 0:case"RELIABLE":return DataPacket_Kind.RELIABLE;case 1:case"LOSSY":return DataPacket_Kind.LOSSY;case-1:case"UNRECOGNIZED":default:return DataPacket_Kind.UNRECOGNIZED}}function dataPacket_KindToJSON(e){switch(e){case DataPacket_Kind.RELIABLE:return"RELIABLE";case DataPacket_Kind.LOSSY:return"LOSSY";case DataPacket_Kind.UNRECOGNIZED:default:return"UNRECOGNIZED"}}var ServerInfo_Edition;(function(e){e[e.Standard=0]="Standard",e[e.Cloud=1]="Cloud",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"})(ServerInfo_Edition||(ServerInfo_Edition={}));function serverInfo_EditionFromJSON(e){switch(e){case 0:case"Standard":return ServerInfo_Edition.Standard;case 1:case"Cloud":return ServerInfo_Edition.Cloud;case-1:case"UNRECOGNIZED":default:return ServerInfo_Edition.UNRECOGNIZED}}function serverInfo_EditionToJSON(e){switch(e){case ServerInfo_Edition.Standard:return"Standard";case ServerInfo_Edition.Cloud:return"Cloud";case ServerInfo_Edition.UNRECOGNIZED:default:return"UNRECOGNIZED"}}var ClientInfo_SDK;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.JS=1]="JS",e[e.SWIFT=2]="SWIFT",e[e.ANDROID=3]="ANDROID",e[e.FLUTTER=4]="FLUTTER",e[e.GO=5]="GO",e[e.UNITY=6]="UNITY",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"})(ClientInfo_SDK||(ClientInfo_SDK={}));function clientInfo_SDKFromJSON(e){switch(e){case 0:case"UNKNOWN":return ClientInfo_SDK.UNKNOWN;case 1:case"JS":return ClientInfo_SDK.JS;case 2:case"SWIFT":return ClientInfo_SDK.SWIFT;case 3:case"ANDROID":return ClientInfo_SDK.ANDROID;case 4:case"FLUTTER":return ClientInfo_SDK.FLUTTER;case 5:case"GO":return ClientInfo_SDK.GO;case 6:case"UNITY":return ClientInfo_SDK.UNITY;case-1:case"UNRECOGNIZED":default:return ClientInfo_SDK.UNRECOGNIZED}}function clientInfo_SDKToJSON(e){switch(e){case ClientInfo_SDK.UNKNOWN:return"UNKNOWN";case ClientInfo_SDK.JS:return"JS";case ClientInfo_SDK.SWIFT:return"SWIFT";case ClientInfo_SDK.ANDROID:return"ANDROID";case ClientInfo_SDK.FLUTTER:return"FLUTTER";case ClientInfo_SDK.GO:return"GO";case ClientInfo_SDK.UNITY:return"UNITY";case ClientInfo_SDK.UNRECOGNIZED:default:return"UNRECOGNIZED"}}function createBaseRoom(){return{sid:"",name:"",emptyTimeout:0,maxParticipants:0,creationTime:0,turnPassword:"",enabledCodecs:[],metadata:"",numParticipants:0,activeRecording:!1}}const Room$1={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();e.sid!==""&&t.uint32(10).string(e.sid),e.name!==""&&t.uint32(18).string(e.name),e.emptyTimeout!==0&&t.uint32(24).uint32(e.emptyTimeout),e.maxParticipants!==0&&t.uint32(32).uint32(e.maxParticipants),e.creationTime!==0&&t.uint32(40).int64(e.creationTime),e.turnPassword!==""&&t.uint32(50).string(e.turnPassword);for(const n of e.enabledCodecs)Codec.encode(n,t.uint32(58).fork()).ldelim();return e.metadata!==""&&t.uint32(66).string(e.metadata),e.numParticipants!==0&&t.uint32(72).uint32(e.numParticipants),e.activeRecording===!0&&t.uint32(80).bool(e.activeRecording),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseRoom();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.sid=n.string();break;case 2:a.name=n.string();break;case 3:a.emptyTimeout=n.uint32();break;case 4:a.maxParticipants=n.uint32();break;case 5:a.creationTime=longToNumber$1(n.int64());break;case 6:a.turnPassword=n.string();break;case 7:a.enabledCodecs.push(Codec.decode(n,n.uint32()));break;case 8:a.metadata=n.string();break;case 9:a.numParticipants=n.uint32();break;case 10:a.activeRecording=n.bool();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{sid:isSet$1(e.sid)?String(e.sid):"",name:isSet$1(e.name)?String(e.name):"",emptyTimeout:isSet$1(e.emptyTimeout)?Number(e.emptyTimeout):0,maxParticipants:isSet$1(e.maxParticipants)?Number(e.maxParticipants):0,creationTime:isSet$1(e.creationTime)?Number(e.creationTime):0,turnPassword:isSet$1(e.turnPassword)?String(e.turnPassword):"",enabledCodecs:Array.isArray(e==null?void 0:e.enabledCodecs)?e.enabledCodecs.map(t=>Codec.fromJSON(t)):[],metadata:isSet$1(e.metadata)?String(e.metadata):"",numParticipants:isSet$1(e.numParticipants)?Number(e.numParticipants):0,activeRecording:isSet$1(e.activeRecording)?!!e.activeRecording:!1}},toJSON(e){const t={};return e.sid!==void 0&&(t.sid=e.sid),e.name!==void 0&&(t.name=e.name),e.emptyTimeout!==void 0&&(t.emptyTimeout=Math.round(e.emptyTimeout)),e.maxParticipants!==void 0&&(t.maxParticipants=Math.round(e.maxParticipants)),e.creationTime!==void 0&&(t.creationTime=Math.round(e.creationTime)),e.turnPassword!==void 0&&(t.turnPassword=e.turnPassword),e.enabledCodecs?t.enabledCodecs=e.enabledCodecs.map(n=>n?Codec.toJSON(n):void 0):t.enabledCodecs=[],e.metadata!==void 0&&(t.metadata=e.metadata),e.numParticipants!==void 0&&(t.numParticipants=Math.round(e.numParticipants)),e.activeRecording!==void 0&&(t.activeRecording=e.activeRecording),t},create(e){return Room$1.fromPartial(e??{})},fromPartial(e){var t,n,i,a,o,c,d,u,l,h;const p=createBaseRoom();return p.sid=(t=e.sid)!==null&&t!==void 0?t:"",p.name=(n=e.name)!==null&&n!==void 0?n:"",p.emptyTimeout=(i=e.emptyTimeout)!==null&&i!==void 0?i:0,p.maxParticipants=(a=e.maxParticipants)!==null&&a!==void 0?a:0,p.creationTime=(o=e.creationTime)!==null&&o!==void 0?o:0,p.turnPassword=(c=e.turnPassword)!==null&&c!==void 0?c:"",p.enabledCodecs=((d=e.enabledCodecs)===null||d===void 0?void 0:d.map(y=>Codec.fromPartial(y)))||[],p.metadata=(u=e.metadata)!==null&&u!==void 0?u:"",p.numParticipants=(l=e.numParticipants)!==null&&l!==void 0?l:0,p.activeRecording=(h=e.activeRecording)!==null&&h!==void 0?h:!1,p}};function createBaseCodec(){return{mime:"",fmtpLine:""}}const Codec={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.mime!==""&&t.uint32(10).string(e.mime),e.fmtpLine!==""&&t.uint32(18).string(e.fmtpLine),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseCodec();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.mime=n.string();break;case 2:a.fmtpLine=n.string();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{mime:isSet$1(e.mime)?String(e.mime):"",fmtpLine:isSet$1(e.fmtpLine)?String(e.fmtpLine):""}},toJSON(e){const t={};return e.mime!==void 0&&(t.mime=e.mime),e.fmtpLine!==void 0&&(t.fmtpLine=e.fmtpLine),t},create(e){return Codec.fromPartial(e??{})},fromPartial(e){var t,n;const i=createBaseCodec();return i.mime=(t=e.mime)!==null&&t!==void 0?t:"",i.fmtpLine=(n=e.fmtpLine)!==null&&n!==void 0?n:"",i}};function createBaseParticipantPermission(){return{canSubscribe:!1,canPublish:!1,canPublishData:!1,canPublishSources:[],hidden:!1,recorder:!1}}const ParticipantPermission={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();e.canSubscribe===!0&&t.uint32(8).bool(e.canSubscribe),e.canPublish===!0&&t.uint32(16).bool(e.canPublish),e.canPublishData===!0&&t.uint32(24).bool(e.canPublishData),t.uint32(74).fork();for(const n of e.canPublishSources)t.int32(n);return t.ldelim(),e.hidden===!0&&t.uint32(56).bool(e.hidden),e.recorder===!0&&t.uint32(64).bool(e.recorder),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseParticipantPermission();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.canSubscribe=n.bool();break;case 2:a.canPublish=n.bool();break;case 3:a.canPublishData=n.bool();break;case 9:if((o&7)===2){const c=n.uint32()+n.pos;for(;n.pos<c;)a.canPublishSources.push(n.int32())}else a.canPublishSources.push(n.int32());break;case 7:a.hidden=n.bool();break;case 8:a.recorder=n.bool();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{canSubscribe:isSet$1(e.canSubscribe)?!!e.canSubscribe:!1,canPublish:isSet$1(e.canPublish)?!!e.canPublish:!1,canPublishData:isSet$1(e.canPublishData)?!!e.canPublishData:!1,canPublishSources:Array.isArray(e==null?void 0:e.canPublishSources)?e.canPublishSources.map(t=>trackSourceFromJSON(t)):[],hidden:isSet$1(e.hidden)?!!e.hidden:!1,recorder:isSet$1(e.recorder)?!!e.recorder:!1}},toJSON(e){const t={};return e.canSubscribe!==void 0&&(t.canSubscribe=e.canSubscribe),e.canPublish!==void 0&&(t.canPublish=e.canPublish),e.canPublishData!==void 0&&(t.canPublishData=e.canPublishData),e.canPublishSources?t.canPublishSources=e.canPublishSources.map(n=>trackSourceToJSON(n)):t.canPublishSources=[],e.hidden!==void 0&&(t.hidden=e.hidden),e.recorder!==void 0&&(t.recorder=e.recorder),t},create(e){return ParticipantPermission.fromPartial(e??{})},fromPartial(e){var t,n,i,a,o,c;const d=createBaseParticipantPermission();return d.canSubscribe=(t=e.canSubscribe)!==null&&t!==void 0?t:!1,d.canPublish=(n=e.canPublish)!==null&&n!==void 0?n:!1,d.canPublishData=(i=e.canPublishData)!==null&&i!==void 0?i:!1,d.canPublishSources=((a=e.canPublishSources)===null||a===void 0?void 0:a.map(u=>u))||[],d.hidden=(o=e.hidden)!==null&&o!==void 0?o:!1,d.recorder=(c=e.recorder)!==null&&c!==void 0?c:!1,d}};function createBaseParticipantInfo(){return{sid:"",identity:"",state:0,tracks:[],metadata:"",joinedAt:0,name:"",version:0,permission:void 0,region:"",isPublisher:!1}}const ParticipantInfo={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();e.sid!==""&&t.uint32(10).string(e.sid),e.identity!==""&&t.uint32(18).string(e.identity),e.state!==0&&t.uint32(24).int32(e.state);for(const n of e.tracks)TrackInfo.encode(n,t.uint32(34).fork()).ldelim();return e.metadata!==""&&t.uint32(42).string(e.metadata),e.joinedAt!==0&&t.uint32(48).int64(e.joinedAt),e.name!==""&&t.uint32(74).string(e.name),e.version!==0&&t.uint32(80).uint32(e.version),e.permission!==void 0&&ParticipantPermission.encode(e.permission,t.uint32(90).fork()).ldelim(),e.region!==""&&t.uint32(98).string(e.region),e.isPublisher===!0&&t.uint32(104).bool(e.isPublisher),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseParticipantInfo();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.sid=n.string();break;case 2:a.identity=n.string();break;case 3:a.state=n.int32();break;case 4:a.tracks.push(TrackInfo.decode(n,n.uint32()));break;case 5:a.metadata=n.string();break;case 6:a.joinedAt=longToNumber$1(n.int64());break;case 9:a.name=n.string();break;case 10:a.version=n.uint32();break;case 11:a.permission=ParticipantPermission.decode(n,n.uint32());break;case 12:a.region=n.string();break;case 13:a.isPublisher=n.bool();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{sid:isSet$1(e.sid)?String(e.sid):"",identity:isSet$1(e.identity)?String(e.identity):"",state:isSet$1(e.state)?participantInfo_StateFromJSON(e.state):0,tracks:Array.isArray(e==null?void 0:e.tracks)?e.tracks.map(t=>TrackInfo.fromJSON(t)):[],metadata:isSet$1(e.metadata)?String(e.metadata):"",joinedAt:isSet$1(e.joinedAt)?Number(e.joinedAt):0,name:isSet$1(e.name)?String(e.name):"",version:isSet$1(e.version)?Number(e.version):0,permission:isSet$1(e.permission)?ParticipantPermission.fromJSON(e.permission):void 0,region:isSet$1(e.region)?String(e.region):"",isPublisher:isSet$1(e.isPublisher)?!!e.isPublisher:!1}},toJSON(e){const t={};return e.sid!==void 0&&(t.sid=e.sid),e.identity!==void 0&&(t.identity=e.identity),e.state!==void 0&&(t.state=participantInfo_StateToJSON(e.state)),e.tracks?t.tracks=e.tracks.map(n=>n?TrackInfo.toJSON(n):void 0):t.tracks=[],e.metadata!==void 0&&(t.metadata=e.metadata),e.joinedAt!==void 0&&(t.joinedAt=Math.round(e.joinedAt)),e.name!==void 0&&(t.name=e.name),e.version!==void 0&&(t.version=Math.round(e.version)),e.permission!==void 0&&(t.permission=e.permission?ParticipantPermission.toJSON(e.permission):void 0),e.region!==void 0&&(t.region=e.region),e.isPublisher!==void 0&&(t.isPublisher=e.isPublisher),t},create(e){return ParticipantInfo.fromPartial(e??{})},fromPartial(e){var t,n,i,a,o,c,d,u,l,h;const p=createBaseParticipantInfo();return p.sid=(t=e.sid)!==null&&t!==void 0?t:"",p.identity=(n=e.identity)!==null&&n!==void 0?n:"",p.state=(i=e.state)!==null&&i!==void 0?i:0,p.tracks=((a=e.tracks)===null||a===void 0?void 0:a.map(y=>TrackInfo.fromPartial(y)))||[],p.metadata=(o=e.metadata)!==null&&o!==void 0?o:"",p.joinedAt=(c=e.joinedAt)!==null&&c!==void 0?c:0,p.name=(d=e.name)!==null&&d!==void 0?d:"",p.version=(u=e.version)!==null&&u!==void 0?u:0,p.permission=e.permission!==void 0&&e.permission!==null?ParticipantPermission.fromPartial(e.permission):void 0,p.region=(l=e.region)!==null&&l!==void 0?l:"",p.isPublisher=(h=e.isPublisher)!==null&&h!==void 0?h:!1,p}};function createBaseSimulcastCodecInfo(){return{mimeType:"",mid:"",cid:"",layers:[]}}const SimulcastCodecInfo={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();e.mimeType!==""&&t.uint32(10).string(e.mimeType),e.mid!==""&&t.uint32(18).string(e.mid),e.cid!==""&&t.uint32(26).string(e.cid);for(const n of e.layers)VideoLayer.encode(n,t.uint32(34).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseSimulcastCodecInfo();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.mimeType=n.string();break;case 2:a.mid=n.string();break;case 3:a.cid=n.string();break;case 4:a.layers.push(VideoLayer.decode(n,n.uint32()));break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{mimeType:isSet$1(e.mimeType)?String(e.mimeType):"",mid:isSet$1(e.mid)?String(e.mid):"",cid:isSet$1(e.cid)?String(e.cid):"",layers:Array.isArray(e==null?void 0:e.layers)?e.layers.map(t=>VideoLayer.fromJSON(t)):[]}},toJSON(e){const t={};return e.mimeType!==void 0&&(t.mimeType=e.mimeType),e.mid!==void 0&&(t.mid=e.mid),e.cid!==void 0&&(t.cid=e.cid),e.layers?t.layers=e.layers.map(n=>n?VideoLayer.toJSON(n):void 0):t.layers=[],t},create(e){return SimulcastCodecInfo.fromPartial(e??{})},fromPartial(e){var t,n,i,a;const o=createBaseSimulcastCodecInfo();return o.mimeType=(t=e.mimeType)!==null&&t!==void 0?t:"",o.mid=(n=e.mid)!==null&&n!==void 0?n:"",o.cid=(i=e.cid)!==null&&i!==void 0?i:"",o.layers=((a=e.layers)===null||a===void 0?void 0:a.map(c=>VideoLayer.fromPartial(c)))||[],o}};function createBaseTrackInfo(){return{sid:"",type:0,name:"",muted:!1,width:0,height:0,simulcast:!1,disableDtx:!1,source:0,layers:[],mimeType:"",mid:"",codecs:[],stereo:!1,disableRed:!1,encryption:0}}const TrackInfo={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();e.sid!==""&&t.uint32(10).string(e.sid),e.type!==0&&t.uint32(16).int32(e.type),e.name!==""&&t.uint32(26).string(e.name),e.muted===!0&&t.uint32(32).bool(e.muted),e.width!==0&&t.uint32(40).uint32(e.width),e.height!==0&&t.uint32(48).uint32(e.height),e.simulcast===!0&&t.uint32(56).bool(e.simulcast),e.disableDtx===!0&&t.uint32(64).bool(e.disableDtx),e.source!==0&&t.uint32(72).int32(e.source);for(const n of e.layers)VideoLayer.encode(n,t.uint32(82).fork()).ldelim();e.mimeType!==""&&t.uint32(90).string(e.mimeType),e.mid!==""&&t.uint32(98).string(e.mid);for(const n of e.codecs)SimulcastCodecInfo.encode(n,t.uint32(106).fork()).ldelim();return e.stereo===!0&&t.uint32(112).bool(e.stereo),e.disableRed===!0&&t.uint32(120).bool(e.disableRed),e.encryption!==0&&t.uint32(128).int32(e.encryption),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseTrackInfo();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.sid=n.string();break;case 2:a.type=n.int32();break;case 3:a.name=n.string();break;case 4:a.muted=n.bool();break;case 5:a.width=n.uint32();break;case 6:a.height=n.uint32();break;case 7:a.simulcast=n.bool();break;case 8:a.disableDtx=n.bool();break;case 9:a.source=n.int32();break;case 10:a.layers.push(VideoLayer.decode(n,n.uint32()));break;case 11:a.mimeType=n.string();break;case 12:a.mid=n.string();break;case 13:a.codecs.push(SimulcastCodecInfo.decode(n,n.uint32()));break;case 14:a.stereo=n.bool();break;case 15:a.disableRed=n.bool();break;case 16:a.encryption=n.int32();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{sid:isSet$1(e.sid)?String(e.sid):"",type:isSet$1(e.type)?trackTypeFromJSON(e.type):0,name:isSet$1(e.name)?String(e.name):"",muted:isSet$1(e.muted)?!!e.muted:!1,width:isSet$1(e.width)?Number(e.width):0,height:isSet$1(e.height)?Number(e.height):0,simulcast:isSet$1(e.simulcast)?!!e.simulcast:!1,disableDtx:isSet$1(e.disableDtx)?!!e.disableDtx:!1,source:isSet$1(e.source)?trackSourceFromJSON(e.source):0,layers:Array.isArray(e==null?void 0:e.layers)?e.layers.map(t=>VideoLayer.fromJSON(t)):[],mimeType:isSet$1(e.mimeType)?String(e.mimeType):"",mid:isSet$1(e.mid)?String(e.mid):"",codecs:Array.isArray(e==null?void 0:e.codecs)?e.codecs.map(t=>SimulcastCodecInfo.fromJSON(t)):[],stereo:isSet$1(e.stereo)?!!e.stereo:!1,disableRed:isSet$1(e.disableRed)?!!e.disableRed:!1,encryption:isSet$1(e.encryption)?encryption_TypeFromJSON(e.encryption):0}},toJSON(e){const t={};return e.sid!==void 0&&(t.sid=e.sid),e.type!==void 0&&(t.type=trackTypeToJSON(e.type)),e.name!==void 0&&(t.name=e.name),e.muted!==void 0&&(t.muted=e.muted),e.width!==void 0&&(t.width=Math.round(e.width)),e.height!==void 0&&(t.height=Math.round(e.height)),e.simulcast!==void 0&&(t.simulcast=e.simulcast),e.disableDtx!==void 0&&(t.disableDtx=e.disableDtx),e.source!==void 0&&(t.source=trackSourceToJSON(e.source)),e.layers?t.layers=e.layers.map(n=>n?VideoLayer.toJSON(n):void 0):t.layers=[],e.mimeType!==void 0&&(t.mimeType=e.mimeType),e.mid!==void 0&&(t.mid=e.mid),e.codecs?t.codecs=e.codecs.map(n=>n?SimulcastCodecInfo.toJSON(n):void 0):t.codecs=[],e.stereo!==void 0&&(t.stereo=e.stereo),e.disableRed!==void 0&&(t.disableRed=e.disableRed),e.encryption!==void 0&&(t.encryption=encryption_TypeToJSON(e.encryption)),t},create(e){return TrackInfo.fromPartial(e??{})},fromPartial(e){var t,n,i,a,o,c,d,u,l,h,p,y,E,x,S,k;const T=createBaseTrackInfo();return T.sid=(t=e.sid)!==null&&t!==void 0?t:"",T.type=(n=e.type)!==null&&n!==void 0?n:0,T.name=(i=e.name)!==null&&i!==void 0?i:"",T.muted=(a=e.muted)!==null&&a!==void 0?a:!1,T.width=(o=e.width)!==null&&o!==void 0?o:0,T.height=(c=e.height)!==null&&c!==void 0?c:0,T.simulcast=(d=e.simulcast)!==null&&d!==void 0?d:!1,T.disableDtx=(u=e.disableDtx)!==null&&u!==void 0?u:!1,T.source=(l=e.source)!==null&&l!==void 0?l:0,T.layers=((h=e.layers)===null||h===void 0?void 0:h.map(L=>VideoLayer.fromPartial(L)))||[],T.mimeType=(p=e.mimeType)!==null&&p!==void 0?p:"",T.mid=(y=e.mid)!==null&&y!==void 0?y:"",T.codecs=((E=e.codecs)===null||E===void 0?void 0:E.map(L=>SimulcastCodecInfo.fromPartial(L)))||[],T.stereo=(x=e.stereo)!==null&&x!==void 0?x:!1,T.disableRed=(S=e.disableRed)!==null&&S!==void 0?S:!1,T.encryption=(k=e.encryption)!==null&&k!==void 0?k:0,T}};function createBaseVideoLayer(){return{quality:0,width:0,height:0,bitrate:0,ssrc:0}}const VideoLayer={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.quality!==0&&t.uint32(8).int32(e.quality),e.width!==0&&t.uint32(16).uint32(e.width),e.height!==0&&t.uint32(24).uint32(e.height),e.bitrate!==0&&t.uint32(32).uint32(e.bitrate),e.ssrc!==0&&t.uint32(40).uint32(e.ssrc),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseVideoLayer();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.quality=n.int32();break;case 2:a.width=n.uint32();break;case 3:a.height=n.uint32();break;case 4:a.bitrate=n.uint32();break;case 5:a.ssrc=n.uint32();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{quality:isSet$1(e.quality)?videoQualityFromJSON(e.quality):0,width:isSet$1(e.width)?Number(e.width):0,height:isSet$1(e.height)?Number(e.height):0,bitrate:isSet$1(e.bitrate)?Number(e.bitrate):0,ssrc:isSet$1(e.ssrc)?Number(e.ssrc):0}},toJSON(e){const t={};return e.quality!==void 0&&(t.quality=videoQualityToJSON(e.quality)),e.width!==void 0&&(t.width=Math.round(e.width)),e.height!==void 0&&(t.height=Math.round(e.height)),e.bitrate!==void 0&&(t.bitrate=Math.round(e.bitrate)),e.ssrc!==void 0&&(t.ssrc=Math.round(e.ssrc)),t},create(e){return VideoLayer.fromPartial(e??{})},fromPartial(e){var t,n,i,a,o;const c=createBaseVideoLayer();return c.quality=(t=e.quality)!==null&&t!==void 0?t:0,c.width=(n=e.width)!==null&&n!==void 0?n:0,c.height=(i=e.height)!==null&&i!==void 0?i:0,c.bitrate=(a=e.bitrate)!==null&&a!==void 0?a:0,c.ssrc=(o=e.ssrc)!==null&&o!==void 0?o:0,c}};function createBaseDataPacket(){return{kind:0,value:void 0}}const DataPacket={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();var n;switch(e.kind!==0&&t.uint32(8).int32(e.kind),(n=e.value)===null||n===void 0?void 0:n.$case){case"user":UserPacket.encode(e.value.user,t.uint32(18).fork()).ldelim();break;case"speaker":ActiveSpeakerUpdate.encode(e.value.speaker,t.uint32(26).fork()).ldelim();break}return t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseDataPacket();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.kind=n.int32();break;case 2:a.value={$case:"user",user:UserPacket.decode(n,n.uint32())};break;case 3:a.value={$case:"speaker",speaker:ActiveSpeakerUpdate.decode(n,n.uint32())};break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{kind:isSet$1(e.kind)?dataPacket_KindFromJSON(e.kind):0,value:isSet$1(e.user)?{$case:"user",user:UserPacket.fromJSON(e.user)}:isSet$1(e.speaker)?{$case:"speaker",speaker:ActiveSpeakerUpdate.fromJSON(e.speaker)}:void 0}},toJSON(e){var t,n,i,a,o,c;const d={};return e.kind!==void 0&&(d.kind=dataPacket_KindToJSON(e.kind)),((t=e.value)===null||t===void 0?void 0:t.$case)==="user"&&(d.user=!((n=e.value)===null||n===void 0)&&n.user?UserPacket.toJSON((i=e.value)===null||i===void 0?void 0:i.user):void 0),((a=e.value)===null||a===void 0?void 0:a.$case)==="speaker"&&(d.speaker=!((o=e.value)===null||o===void 0)&&o.speaker?ActiveSpeakerUpdate.toJSON((c=e.value)===null||c===void 0?void 0:c.speaker):void 0),d},create(e){return DataPacket.fromPartial(e??{})},fromPartial(e){var t,n,i,a,o,c,d;const u=createBaseDataPacket();return u.kind=(t=e.kind)!==null&&t!==void 0?t:0,((n=e.value)===null||n===void 0?void 0:n.$case)==="user"&&((i=e.value)===null||i===void 0?void 0:i.user)!==void 0&&((a=e.value)===null||a===void 0?void 0:a.user)!==null&&(u.value={$case:"user",user:UserPacket.fromPartial(e.value.user)}),((o=e.value)===null||o===void 0?void 0:o.$case)==="speaker"&&((c=e.value)===null||c===void 0?void 0:c.speaker)!==void 0&&((d=e.value)===null||d===void 0?void 0:d.speaker)!==null&&(u.value={$case:"speaker",speaker:ActiveSpeakerUpdate.fromPartial(e.value.speaker)}),u}};function createBaseActiveSpeakerUpdate(){return{speakers:[]}}const ActiveSpeakerUpdate={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();for(const n of e.speakers)SpeakerInfo.encode(n,t.uint32(10).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseActiveSpeakerUpdate();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.speakers.push(SpeakerInfo.decode(n,n.uint32()));break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{speakers:Array.isArray(e==null?void 0:e.speakers)?e.speakers.map(t=>SpeakerInfo.fromJSON(t)):[]}},toJSON(e){const t={};return e.speakers?t.speakers=e.speakers.map(n=>n?SpeakerInfo.toJSON(n):void 0):t.speakers=[],t},create(e){return ActiveSpeakerUpdate.fromPartial(e??{})},fromPartial(e){var t;const n=createBaseActiveSpeakerUpdate();return n.speakers=((t=e.speakers)===null||t===void 0?void 0:t.map(i=>SpeakerInfo.fromPartial(i)))||[],n}};function createBaseSpeakerInfo(){return{sid:"",level:0,active:!1}}const SpeakerInfo={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.sid!==""&&t.uint32(10).string(e.sid),e.level!==0&&t.uint32(21).float(e.level),e.active===!0&&t.uint32(24).bool(e.active),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseSpeakerInfo();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.sid=n.string();break;case 2:a.level=n.float();break;case 3:a.active=n.bool();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{sid:isSet$1(e.sid)?String(e.sid):"",level:isSet$1(e.level)?Number(e.level):0,active:isSet$1(e.active)?!!e.active:!1}},toJSON(e){const t={};return e.sid!==void 0&&(t.sid=e.sid),e.level!==void 0&&(t.level=e.level),e.active!==void 0&&(t.active=e.active),t},create(e){return SpeakerInfo.fromPartial(e??{})},fromPartial(e){var t,n,i;const a=createBaseSpeakerInfo();return a.sid=(t=e.sid)!==null&&t!==void 0?t:"",a.level=(n=e.level)!==null&&n!==void 0?n:0,a.active=(i=e.active)!==null&&i!==void 0?i:!1,a}};function createBaseUserPacket(){return{participantSid:"",payload:new Uint8Array,destinationSids:[],topic:void 0}}const UserPacket={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();e.participantSid!==""&&t.uint32(10).string(e.participantSid),e.payload.length!==0&&t.uint32(18).bytes(e.payload);for(const n of e.destinationSids)t.uint32(26).string(n);return e.topic!==void 0&&t.uint32(34).string(e.topic),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseUserPacket();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.participantSid=n.string();break;case 2:a.payload=n.bytes();break;case 3:a.destinationSids.push(n.string());break;case 4:a.topic=n.string();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{participantSid:isSet$1(e.participantSid)?String(e.participantSid):"",payload:isSet$1(e.payload)?bytesFromBase64$1(e.payload):new Uint8Array,destinationSids:Array.isArray(e==null?void 0:e.destinationSids)?e.destinationSids.map(t=>String(t)):[],topic:isSet$1(e.topic)?String(e.topic):void 0}},toJSON(e){const t={};return e.participantSid!==void 0&&(t.participantSid=e.participantSid),e.payload!==void 0&&(t.payload=base64FromBytes$1(e.payload!==void 0?e.payload:new Uint8Array)),e.destinationSids?t.destinationSids=e.destinationSids.map(n=>n):t.destinationSids=[],e.topic!==void 0&&(t.topic=e.topic),t},create(e){return UserPacket.fromPartial(e??{})},fromPartial(e){var t,n,i,a;const o=createBaseUserPacket();return o.participantSid=(t=e.participantSid)!==null&&t!==void 0?t:"",o.payload=(n=e.payload)!==null&&n!==void 0?n:new Uint8Array,o.destinationSids=((i=e.destinationSids)===null||i===void 0?void 0:i.map(c=>c))||[],o.topic=(a=e.topic)!==null&&a!==void 0?a:void 0,o}};function createBaseParticipantTracks(){return{participantSid:"",trackSids:[]}}const ParticipantTracks={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();e.participantSid!==""&&t.uint32(10).string(e.participantSid);for(const n of e.trackSids)t.uint32(18).string(n);return t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseParticipantTracks();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.participantSid=n.string();break;case 2:a.trackSids.push(n.string());break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{participantSid:isSet$1(e.participantSid)?String(e.participantSid):"",trackSids:Array.isArray(e==null?void 0:e.trackSids)?e.trackSids.map(t=>String(t)):[]}},toJSON(e){const t={};return e.participantSid!==void 0&&(t.participantSid=e.participantSid),e.trackSids?t.trackSids=e.trackSids.map(n=>n):t.trackSids=[],t},create(e){return ParticipantTracks.fromPartial(e??{})},fromPartial(e){var t,n;const i=createBaseParticipantTracks();return i.participantSid=(t=e.participantSid)!==null&&t!==void 0?t:"",i.trackSids=((n=e.trackSids)===null||n===void 0?void 0:n.map(a=>a))||[],i}};function createBaseServerInfo(){return{edition:0,version:"",protocol:0,region:"",nodeId:"",debugInfo:""}}const ServerInfo={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.edition!==0&&t.uint32(8).int32(e.edition),e.version!==""&&t.uint32(18).string(e.version),e.protocol!==0&&t.uint32(24).int32(e.protocol),e.region!==""&&t.uint32(34).string(e.region),e.nodeId!==""&&t.uint32(42).string(e.nodeId),e.debugInfo!==""&&t.uint32(50).string(e.debugInfo),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseServerInfo();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.edition=n.int32();break;case 2:a.version=n.string();break;case 3:a.protocol=n.int32();break;case 4:a.region=n.string();break;case 5:a.nodeId=n.string();break;case 6:a.debugInfo=n.string();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{edition:isSet$1(e.edition)?serverInfo_EditionFromJSON(e.edition):0,version:isSet$1(e.version)?String(e.version):"",protocol:isSet$1(e.protocol)?Number(e.protocol):0,region:isSet$1(e.region)?String(e.region):"",nodeId:isSet$1(e.nodeId)?String(e.nodeId):"",debugInfo:isSet$1(e.debugInfo)?String(e.debugInfo):""}},toJSON(e){const t={};return e.edition!==void 0&&(t.edition=serverInfo_EditionToJSON(e.edition)),e.version!==void 0&&(t.version=e.version),e.protocol!==void 0&&(t.protocol=Math.round(e.protocol)),e.region!==void 0&&(t.region=e.region),e.nodeId!==void 0&&(t.nodeId=e.nodeId),e.debugInfo!==void 0&&(t.debugInfo=e.debugInfo),t},create(e){return ServerInfo.fromPartial(e??{})},fromPartial(e){var t,n,i,a,o,c;const d=createBaseServerInfo();return d.edition=(t=e.edition)!==null&&t!==void 0?t:0,d.version=(n=e.version)!==null&&n!==void 0?n:"",d.protocol=(i=e.protocol)!==null&&i!==void 0?i:0,d.region=(a=e.region)!==null&&a!==void 0?a:"",d.nodeId=(o=e.nodeId)!==null&&o!==void 0?o:"",d.debugInfo=(c=e.debugInfo)!==null&&c!==void 0?c:"",d}};function createBaseClientInfo(){return{sdk:0,version:"",protocol:0,os:"",osVersion:"",deviceModel:"",browser:"",browserVersion:"",address:"",network:""}}const ClientInfo={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.sdk!==0&&t.uint32(8).int32(e.sdk),e.version!==""&&t.uint32(18).string(e.version),e.protocol!==0&&t.uint32(24).int32(e.protocol),e.os!==""&&t.uint32(34).string(e.os),e.osVersion!==""&&t.uint32(42).string(e.osVersion),e.deviceModel!==""&&t.uint32(50).string(e.deviceModel),e.browser!==""&&t.uint32(58).string(e.browser),e.browserVersion!==""&&t.uint32(66).string(e.browserVersion),e.address!==""&&t.uint32(74).string(e.address),e.network!==""&&t.uint32(82).string(e.network),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseClientInfo();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.sdk=n.int32();break;case 2:a.version=n.string();break;case 3:a.protocol=n.int32();break;case 4:a.os=n.string();break;case 5:a.osVersion=n.string();break;case 6:a.deviceModel=n.string();break;case 7:a.browser=n.string();break;case 8:a.browserVersion=n.string();break;case 9:a.address=n.string();break;case 10:a.network=n.string();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{sdk:isSet$1(e.sdk)?clientInfo_SDKFromJSON(e.sdk):0,version:isSet$1(e.version)?String(e.version):"",protocol:isSet$1(e.protocol)?Number(e.protocol):0,os:isSet$1(e.os)?String(e.os):"",osVersion:isSet$1(e.osVersion)?String(e.osVersion):"",deviceModel:isSet$1(e.deviceModel)?String(e.deviceModel):"",browser:isSet$1(e.browser)?String(e.browser):"",browserVersion:isSet$1(e.browserVersion)?String(e.browserVersion):"",address:isSet$1(e.address)?String(e.address):"",network:isSet$1(e.network)?String(e.network):""}},toJSON(e){const t={};return e.sdk!==void 0&&(t.sdk=clientInfo_SDKToJSON(e.sdk)),e.version!==void 0&&(t.version=e.version),e.protocol!==void 0&&(t.protocol=Math.round(e.protocol)),e.os!==void 0&&(t.os=e.os),e.osVersion!==void 0&&(t.osVersion=e.osVersion),e.deviceModel!==void 0&&(t.deviceModel=e.deviceModel),e.browser!==void 0&&(t.browser=e.browser),e.browserVersion!==void 0&&(t.browserVersion=e.browserVersion),e.address!==void 0&&(t.address=e.address),e.network!==void 0&&(t.network=e.network),t},create(e){return ClientInfo.fromPartial(e??{})},fromPartial(e){var t,n,i,a,o,c,d,u,l,h;const p=createBaseClientInfo();return p.sdk=(t=e.sdk)!==null&&t!==void 0?t:0,p.version=(n=e.version)!==null&&n!==void 0?n:"",p.protocol=(i=e.protocol)!==null&&i!==void 0?i:0,p.os=(a=e.os)!==null&&a!==void 0?a:"",p.osVersion=(o=e.osVersion)!==null&&o!==void 0?o:"",p.deviceModel=(c=e.deviceModel)!==null&&c!==void 0?c:"",p.browser=(d=e.browser)!==null&&d!==void 0?d:"",p.browserVersion=(u=e.browserVersion)!==null&&u!==void 0?u:"",p.address=(l=e.address)!==null&&l!==void 0?l:"",p.network=(h=e.network)!==null&&h!==void 0?h:"",p}};function createBaseClientConfiguration(){return{video:void 0,screen:void 0,resumeConnection:0,disabledCodecs:void 0,forceRelay:0}}const ClientConfiguration={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.video!==void 0&&VideoConfiguration.encode(e.video,t.uint32(10).fork()).ldelim(),e.screen!==void 0&&VideoConfiguration.encode(e.screen,t.uint32(18).fork()).ldelim(),e.resumeConnection!==0&&t.uint32(24).int32(e.resumeConnection),e.disabledCodecs!==void 0&&DisabledCodecs.encode(e.disabledCodecs,t.uint32(34).fork()).ldelim(),e.forceRelay!==0&&t.uint32(40).int32(e.forceRelay),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseClientConfiguration();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.video=VideoConfiguration.decode(n,n.uint32());break;case 2:a.screen=VideoConfiguration.decode(n,n.uint32());break;case 3:a.resumeConnection=n.int32();break;case 4:a.disabledCodecs=DisabledCodecs.decode(n,n.uint32());break;case 5:a.forceRelay=n.int32();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{video:isSet$1(e.video)?VideoConfiguration.fromJSON(e.video):void 0,screen:isSet$1(e.screen)?VideoConfiguration.fromJSON(e.screen):void 0,resumeConnection:isSet$1(e.resumeConnection)?clientConfigSettingFromJSON(e.resumeConnection):0,disabledCodecs:isSet$1(e.disabledCodecs)?DisabledCodecs.fromJSON(e.disabledCodecs):void 0,forceRelay:isSet$1(e.forceRelay)?clientConfigSettingFromJSON(e.forceRelay):0}},toJSON(e){const t={};return e.video!==void 0&&(t.video=e.video?VideoConfiguration.toJSON(e.video):void 0),e.screen!==void 0&&(t.screen=e.screen?VideoConfiguration.toJSON(e.screen):void 0),e.resumeConnection!==void 0&&(t.resumeConnection=clientConfigSettingToJSON(e.resumeConnection)),e.disabledCodecs!==void 0&&(t.disabledCodecs=e.disabledCodecs?DisabledCodecs.toJSON(e.disabledCodecs):void 0),e.forceRelay!==void 0&&(t.forceRelay=clientConfigSettingToJSON(e.forceRelay)),t},create(e){return ClientConfiguration.fromPartial(e??{})},fromPartial(e){var t,n;const i=createBaseClientConfiguration();return i.video=e.video!==void 0&&e.video!==null?VideoConfiguration.fromPartial(e.video):void 0,i.screen=e.screen!==void 0&&e.screen!==null?VideoConfiguration.fromPartial(e.screen):void 0,i.resumeConnection=(t=e.resumeConnection)!==null&&t!==void 0?t:0,i.disabledCodecs=e.disabledCodecs!==void 0&&e.disabledCodecs!==null?DisabledCodecs.fromPartial(e.disabledCodecs):void 0,i.forceRelay=(n=e.forceRelay)!==null&&n!==void 0?n:0,i}};function createBaseVideoConfiguration(){return{hardwareEncoder:0}}const VideoConfiguration={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.hardwareEncoder!==0&&t.uint32(8).int32(e.hardwareEncoder),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseVideoConfiguration();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.hardwareEncoder=n.int32();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{hardwareEncoder:isSet$1(e.hardwareEncoder)?clientConfigSettingFromJSON(e.hardwareEncoder):0}},toJSON(e){const t={};return e.hardwareEncoder!==void 0&&(t.hardwareEncoder=clientConfigSettingToJSON(e.hardwareEncoder)),t},create(e){return VideoConfiguration.fromPartial(e??{})},fromPartial(e){var t;const n=createBaseVideoConfiguration();return n.hardwareEncoder=(t=e.hardwareEncoder)!==null&&t!==void 0?t:0,n}};function createBaseDisabledCodecs(){return{codecs:[]}}const DisabledCodecs={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();for(const n of e.codecs)Codec.encode(n,t.uint32(10).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseDisabledCodecs();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.codecs.push(Codec.decode(n,n.uint32()));break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{codecs:Array.isArray(e==null?void 0:e.codecs)?e.codecs.map(t=>Codec.fromJSON(t)):[]}},toJSON(e){const t={};return e.codecs?t.codecs=e.codecs.map(n=>n?Codec.toJSON(n):void 0):t.codecs=[],t},create(e){return DisabledCodecs.fromPartial(e??{})},fromPartial(e){var t;const n=createBaseDisabledCodecs();return n.codecs=((t=e.codecs)===null||t===void 0?void 0:t.map(i=>Codec.fromPartial(i)))||[],n}};var tsProtoGlobalThis$1=(()=>{if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw"Unable to locate global object"})();function bytesFromBase64$1(e){if(tsProtoGlobalThis$1.Buffer)return Uint8Array.from(tsProtoGlobalThis$1.Buffer.from(e,"base64"));{const t=tsProtoGlobalThis$1.atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;++i)n[i]=t.charCodeAt(i);return n}}function base64FromBytes$1(e){if(tsProtoGlobalThis$1.Buffer)return tsProtoGlobalThis$1.Buffer.from(e).toString("base64");{const t=[];return e.forEach(n=>{t.push(String.fromCharCode(n))}),tsProtoGlobalThis$1.btoa(t.join(""))}}function longToNumber$1(e){if(e.gt(Number.MAX_SAFE_INTEGER))throw new tsProtoGlobalThis$1.Error("Value is larger than Number.MAX_SAFE_INTEGER");return e.toNumber()}_m0.util.Long!==long&&(_m0.util.Long=long,_m0.configure());function isSet$1(e){return e!=null}const maxRetryDelay=7e3,DEFAULT_RETRY_DELAYS_IN_MS=[0,300,2*2*300,3*3*300,4*4*300,maxRetryDelay,maxRetryDelay,maxRetryDelay,maxRetryDelay,maxRetryDelay];class DefaultReconnectPolicy{constructor(t){this._retryDelays=t!==void 0?[...t]:DEFAULT_RETRY_DELAYS_IN_MS}nextRetryDelayInMs(t){if(t.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[t.retryCount];return t.retryCount<=1?n:n+Math.random()*1e3}}function _asyncIterator(e){var t,n,i,a=2;for(typeof Symbol<"u"&&(n=Symbol.asyncIterator,i=Symbol.iterator);a--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new AsyncFromSyncIterator(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function AsyncFromSyncIterator(e){function t(n){if(Object(n)!==n)return Promise.reject(new TypeError(n+" is not an object."));var i=n.done;return Promise.resolve(n.value).then(function(a){return{value:a,done:i}})}return AsyncFromSyncIterator=function(n){this.s=n,this.n=n.next},AsyncFromSyncIterator.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?Promise.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?Promise.reject(n):t(i.apply(this.s,arguments))}},new AsyncFromSyncIterator(e)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,i)}return n}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(i){_defineProperty(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function _defineProperty(e,t,n){return t=_toPropertyKey(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPrimitive(e,t){if(typeof e!="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return typeof t=="symbol"?t:String(t)}let logDisabled_=!0,deprecationWarnings_=!0;function extractVersion(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function wrapPeerConnectionEvent(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,a=i.addEventListener;i.addEventListener=function(c,d){if(c!==t)return a.apply(this,arguments);const u=l=>{const h=n(l);h&&(d.handleEvent?d.handleEvent(h):d(h))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(d,u),a.apply(this,[c,u])};const o=i.removeEventListener;i.removeEventListener=function(c,d){if(c!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(d))return o.apply(this,arguments);const u=this._eventMap[t].get(d);return this._eventMap[t].delete(d),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[c,u])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(c){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),c&&this.addEventListener(t,this["_on"+t]=c)},enumerable:!0,configurable:!0})}function disableLog(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(logDisabled_=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function disableWarnings(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(deprecationWarnings_=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function log(){if(typeof window=="object"){if(logDisabled_)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function deprecated(e,t){deprecationWarnings_&&console.warn(e+" is deprecated, please use "+t+" instead.")}function detectBrowser(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=extractVersion(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=extractVersion(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=extractVersion(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function isObject(e){return Object.prototype.toString.call(e)==="[object Object]"}function compactObject(e){return isObject(e)?Object.keys(e).reduce(function(t,n){const i=isObject(e[n]),a=i?compactObject(e[n]):e[n],o=i&&!Object.keys(a).length;return a===void 0||o?t:Object.assign(t,{[n]:a})},{}):e}function walkStats(e,t,n){!t||n.has(t.id)||(n.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?walkStats(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach(a=>{walkStats(e,e.get(a),n)})}))}function filterStats(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",a=new Map;if(t===null)return a;const o=[];return e.forEach(c=>{c.type==="track"&&c.trackIdentifier===t.id&&o.push(c)}),o.forEach(c=>{e.forEach(d=>{d.type===i&&d.trackId===c.id&&walkStats(e,d,a)})}),a}const logging=log;function shimGetUserMedia$2(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;const u={};return Object.keys(d).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const h=typeof d[l]=="object"?d[l]:{ideal:d[l]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);const p=function(y,E){return y?y+E.charAt(0).toUpperCase()+E.slice(1):E==="deviceId"?"sourceId":E};if(h.ideal!==void 0){u.optional=u.optional||[];let y={};typeof h.ideal=="number"?(y[p("min",l)]=h.ideal,u.optional.push(y),y={},y[p("max",l)]=h.ideal,u.optional.push(y)):(y[p("",l)]=h.ideal,u.optional.push(y))}h.exact!==void 0&&typeof h.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[p("",l)]=h.exact):["min","max"].forEach(y=>{h[y]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[p(y,l)]=h[y])})}),d.advanced&&(u.optional=(u.optional||[]).concat(d.advanced)),u},a=function(d,u){if(t.version>=61)return u(d);if(d=JSON.parse(JSON.stringify(d)),d&&typeof d.audio=="object"){const l=function(h,p,y){p in h&&!(y in h)&&(h[y]=h[p],delete h[p])};d=JSON.parse(JSON.stringify(d)),l(d.audio,"autoGainControl","googAutoGainControl"),l(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=i(d.audio)}if(d&&typeof d.video=="object"){let l=d.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const h=t.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!h)){delete d.video.facingMode;let p;if(l.exact==="environment"||l.ideal==="environment"?p=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(p=["front"]),p)return n.mediaDevices.enumerateDevices().then(y=>{y=y.filter(x=>x.kind==="videoinput");let E=y.find(x=>p.some(S=>x.label.toLowerCase().includes(S)));return!E&&y.length&&p.includes("back")&&(E=y[y.length-1]),E&&(d.video.deviceId=l.exact?{exact:E.deviceId}:{ideal:E.deviceId}),d.video=i(d.video),logging("chrome: "+JSON.stringify(d)),u(d)})}d.video=i(d.video)}return logging("chrome: "+JSON.stringify(d)),u(d)},o=function(d){return t.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},c=function(d,u,l){a(d,h=>{n.webkitGetUserMedia(h,u,p=>{l&&l(o(p))})})};if(n.getUserMedia=c.bind(n),n.mediaDevices.getUserMedia){const d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(u){return a(u,l=>d(l).then(h=>{if(l.audio&&!h.getAudioTracks().length||l.video&&!h.getVideoTracks().length)throw h.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return h},h=>Promise.reject(o(h))))}}}function shimGetDisplayMedia$1(e,t){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&e.navigator.mediaDevices){if(typeof t!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then(a=>{const o=i.video&&i.video.width,c=i.video&&i.video.height,d=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:d||3}},o&&(i.video.mandatory.maxWidth=o),c&&(i.video.mandatory.maxHeight=c),e.navigator.mediaDevices.getUserMedia(i)})}}}function shimMediaStream(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function shimOnTrack$1(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",a=>{let o;e.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(d=>d.track&&d.track.id===a.track.id):o={track:a.track};const c=new Event("track");c.track=a.track,c.receiver=o,c.transceiver={receiver:o},c.streams=[i.stream],this.dispatchEvent(c)}),i.stream.getTracks().forEach(a=>{let o;e.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(d=>d.track&&d.track.id===a.id):o={track:a};const c=new Event("track");c.track=a,c.receiver=o,c.transceiver={receiver:o},c.streams=[i.stream],this.dispatchEvent(c)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else wrapPeerConnectionEvent(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function shimGetSendersWithDtmf(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(a,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=a.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:a}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const a=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(d,u){let l=a.apply(this,arguments);return l||(l=t(this,d),this._senders.push(l)),l};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(d){o.apply(this,arguments);const u=this._senders.indexOf(d);u!==-1&&this._senders.splice(u,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(c=>{this._senders.push(t(this,c))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach(c=>{const d=this._senders.find(u=>u.track===c);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(a=>a._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function shimGetStats(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,a,o]=arguments;if(arguments.length>0&&typeof i=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof i!="function"))return t.apply(this,[]);const c=function(u){const l={};return u.result().forEach(p=>{const y={id:p.id,timestamp:p.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[p.type]||p.type};p.names().forEach(E=>{y[E]=p.stat(E)}),l[y.id]=y}),l},d=function(u){return new Map(Object.keys(u).map(l=>[l,u[l]]))};if(arguments.length>=2){const u=function(l){a(d(c(l)))};return t.apply(this,[u,i])}return new Promise((u,l)=>{t.apply(this,[function(h){u(d(c(h)))},l])}).then(a,o)}}function shimSenderReceiverGetStats(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(c=>c._pc=this),o});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>filterStats(c,o.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const a=n.apply(this,[]);return a.forEach(o=>o._pc=this),a}),wrapPeerConnectionEvent(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(o=>filterStats(o,a.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const i=arguments[0];let a,o,c;return this.getSenders().forEach(d=>{d.track===i&&(a?c=!0:a=d)}),this.getReceivers().forEach(d=>(d.track===i&&(o?c=!0:o=d),d.track===i)),c||a&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function shimAddTrackRemoveTrackWithNative(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(c=>this._shimmedLocalStreams[c][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,d){if(!d)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const u=t.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(u)===-1&&this._shimmedLocalStreams[d.id].push(u):this._shimmedLocalStreams[d.id]=[d,u],u};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._shimmedLocalStreams=this._shimmedLocalStreams||{},c.getTracks().forEach(l=>{if(this.getSenders().find(p=>p.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const d=this.getSenders();n.apply(this,arguments);const u=this.getSenders().filter(l=>d.indexOf(l)===-1);this._shimmedLocalStreams[c.id]=[c].concat(u)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[c.id],i.apply(this,arguments)};const a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},c&&Object.keys(this._shimmedLocalStreams).forEach(d=>{const u=this._shimmedLocalStreams[d].indexOf(c);u!==-1&&this._shimmedLocalStreams[d].splice(u,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),a.apply(this,arguments)}}function shimAddTrackRemoveTrack(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return shimAddTrackRemoveTrackWithNative(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const h=n.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(p=>this._reverseStreams[p.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(p=>{if(this.getSenders().find(E=>E.track===p))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){const p=new e.MediaStream(h.getTracks());this._streams[h.id]=p,this._reverseStreams[p.id]=h,h=p}i.apply(this,[h])};const a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},e.RTCPeerConnection.prototype.addTrack=function(h,p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const y=[].slice.call(arguments,1);if(y.length!==1||!y[0].getTracks().find(S=>S===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(S=>S.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const x=this._streams[p.id];if(x)x.addTrack(h),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const S=new e.MediaStream([h]);this._streams[p.id]=S,this._reverseStreams[S.id]=p,this.addStream(S)}return this.getSenders().find(S=>S.track===h)};function o(l,h){let p=h.sdp;return Object.keys(l._reverseStreams||[]).forEach(y=>{const E=l._reverseStreams[y],x=l._streams[E.id];p=p.replace(new RegExp(x.id,"g"),E.id)}),new RTCSessionDescription({type:h.type,sdp:p})}function c(l,h){let p=h.sdp;return Object.keys(l._reverseStreams||[]).forEach(y=>{const E=l._reverseStreams[y],x=l._streams[E.id];p=p.replace(new RegExp(E.id,"g"),x.id)}),new RTCSessionDescription({type:h.type,sdp:p})}["createOffer","createAnswer"].forEach(function(l){const h=e.RTCPeerConnection.prototype[l],p={[l](){const y=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[x=>{const S=o(this,x);y[0].apply(null,[S])},x=>{y[1]&&y[1].apply(null,x)},arguments[2]]):h.apply(this,arguments).then(x=>o(this,x))}};e.RTCPeerConnection.prototype[l]=p[l]});const d=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?d.apply(this,arguments):(arguments[0]=c(this,arguments[0]),d.apply(this,arguments))};const u=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const l=u.get.apply(this);return l.type===""?l:o(this,l)}}),e.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(h._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let y;Object.keys(this._streams).forEach(E=>{this._streams[E].getTracks().find(S=>h.track===S)&&(y=this._streams[E])}),y&&(y.getTracks().length===1?this.removeStream(this._reverseStreams[y.id]):y.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function shimPeerConnection$1(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=e.RTCPeerConnection.prototype[n],a={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=a[n]})}function fixNegotiationNeeded(e,t){wrapPeerConnectionEvent(e,"negotiationneeded",n=>{const i=n.target;if(!((t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var chromeShim=Object.freeze({__proto__:null,fixNegotiationNeeded,shimAddTrackRemoveTrack,shimAddTrackRemoveTrackWithNative,shimGetDisplayMedia:shimGetDisplayMedia$1,shimGetSendersWithDtmf,shimGetStats,shimGetUserMedia:shimGetUserMedia$2,shimMediaStream,shimOnTrack:shimOnTrack$1,shimPeerConnection:shimPeerConnection$1,shimSenderReceiverGetStats});function shimGetUserMedia$1(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(a,o,c){deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(a).then(o,c)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const a=function(c,d,u){d in c&&!(u in c)&&(c[u]=c[d],delete c[d])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),a(c.audio,"autoGainControl","mozAutoGainControl"),a(c.audio,"noiseSuppression","mozNoiseSuppression")),o(c)},i&&i.prototype.getSettings){const c=i.prototype.getSettings;i.prototype.getSettings=function(){const d=c.apply(this,arguments);return a(d,"mozAutoGainControl","autoGainControl"),a(d,"mozNoiseSuppression","noiseSuppression"),d}}if(i&&i.prototype.applyConstraints){const c=i.prototype.applyConstraints;i.prototype.applyConstraints=function(d){return this.kind==="audio"&&typeof d=="object"&&(d=JSON.parse(JSON.stringify(d)),a(d,"autoGainControl","mozAutoGainControl"),a(d,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[d])}}}}function shimGetDisplayMedia(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Promise.reject(a)}return i.video===!0?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})}function shimOnTrack(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function shimPeerConnection(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){const o=e.RTCPeerConnection.prototype[a],c={[a](){return arguments[0]=new(a==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[a]=c[a]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[o,c,d]=arguments;return i.apply(this,[o||null]).then(u=>{if(t.version<53&&!c)try{u.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;u.forEach((h,p)=>{u.set(p,Object.assign({},h,{type:n[h.type]||h.type}))})}return u}).then(c,d)}}function shimSenderGetStats(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const a=t.apply(this,[]);return a.forEach(o=>o._pc=this),a});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const a=n.apply(this,arguments);return a._pc=this,a}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function shimReceiverGetStats(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=t.apply(this,[]);return i.forEach(a=>a._pc=this),i}),wrapPeerConnectionEvent(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function shimRemoveStream(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){deprecated("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function shimRTCDataChannel(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function shimAddTransceiver(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const i=arguments[1],a=i&&"sendEncodings"in i;a&&i.sendEncodings.forEach(c=>{if("rid"in c&&!/^[a-z0-9]{0,16}$/i.test(c.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in c&&!(parseFloat(c.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in c&&!(parseFloat(c.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=t.apply(this,arguments);if(a){const{sender:c}=o,d=c.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=i.sendEncodings,c.sendEncodings=i.sendEncodings,this.setParametersPromises.push(c.setParameters(d).then(()=>{delete c.sendEncodings}).catch(()=>{delete c.sendEncodings})))}return o})}function shimGetParameters(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const i=t.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function shimCreateOffer(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function shimCreateAnswer(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var firefoxShim=Object.freeze({__proto__:null,shimAddTransceiver,shimCreateAnswer,shimCreateOffer,shimGetDisplayMedia,shimGetParameters,shimGetUserMedia:shimGetUserMedia$1,shimOnTrack,shimPeerConnection,shimRTCDataChannel,shimReceiverGetStats,shimRemoveStream,shimSenderGetStats});function shimLocalStreamsAPI(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(a=>t.call(this,a,i)),i.getVideoTracks().forEach(a=>t.call(this,a,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var a=arguments.length,o=new Array(a>1?a-1:0),c=1;c<a;c++)o[c-1]=arguments[c];return o&&o.forEach(d=>{this._localStreams?this._localStreams.includes(d)||this._localStreams.push(d):this._localStreams=[d]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const a=n.getTracks();this.getSenders().forEach(o=>{a.includes(o.track)&&this.removeTrack(o)})})}}function shimRemoteStreamsAPI(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(a=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(a))return;this._remoteStreams.push(a);const o=new Event("addstream");o.stream=a,this.dispatchEvent(o)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(o=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(o)>=0)return;i._remoteStreams.push(o);const c=new Event("addstream");c.stream=o,i.dispatchEvent(c)})}),t.apply(i,arguments)}}}function shimCallbacksAPI(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,a=t.setLocalDescription,o=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(l,h){const p=arguments.length>=2?arguments[2]:arguments[0],y=n.apply(this,[p]);return h?(y.then(l,h),Promise.resolve()):y},t.createAnswer=function(l,h){const p=arguments.length>=2?arguments[2]:arguments[0],y=i.apply(this,[p]);return h?(y.then(l,h),Promise.resolve()):y};let d=function(u,l,h){const p=a.apply(this,[u]);return h?(p.then(l,h),Promise.resolve()):p};t.setLocalDescription=d,d=function(u,l,h){const p=o.apply(this,[u]);return h?(p.then(l,h),Promise.resolve()):p},t.setRemoteDescription=d,d=function(u,l,h){const p=c.apply(this,[u]);return h?(p.then(l,h),Promise.resolve()):p},t.addIceCandidate=d}function shimGetUserMedia(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,i=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=a=>i(shimConstraints(a))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(i,a,o){t.mediaDevices.getUserMedia(i).then(a,o)}.bind(t))}function shimConstraints(e){return e&&e.video!==void 0?Object.assign({},e,{video:compactObject(e.video)}):e}function shimRTCIceServerUrls(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(i,a){if(i&&i.iceServers){const o=[];for(let c=0;c<i.iceServers.length;c++){let d=i.iceServers[c];!d.hasOwnProperty("urls")&&d.hasOwnProperty("url")?(deprecated("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,o.push(d)):o.push(i.iceServers[c])}i.iceServers=o}return new t(i,a)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function shimTrackEventTransceiver(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function shimCreateOfferLegacy(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const a=this.getTransceivers().find(c=>c.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):i.offerToReceiveAudio===!0&&!a&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const o=this.getTransceivers().find(c=>c.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function shimAudioContext(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var safariShim=Object.freeze({__proto__:null,shimAudioContext,shimCallbacksAPI,shimConstraints,shimCreateOfferLegacy,shimGetUserMedia,shimLocalStreamsAPI,shimRTCIceServerUrls,shimRemoteStreamsAPI,shimTrackEventTransceiver}),sdpExports={},sdp$1={get exports(){return sdpExports},set exports(e){sdpExports=e}};(function(e){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},t.splitSections=function(n){return n.split(`
m=`).map((a,o)=>(o>0?"m="+a:a).trim()+`\r
`)},t.getDescription=function(n){const i=t.splitSections(n);return i&&i[0]},t.getMediaSections=function(n){const i=t.splitSections(n);return i.shift(),i},t.matchPrefix=function(n,i){return t.splitLines(n).filter(a=>a.indexOf(i)===0)},t.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const a={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let o=8;o<i.length;o+=2)switch(i[o]){case"raddr":a.relatedAddress=i[o+1];break;case"rport":a.relatedPort=parseInt(i[o+1],10);break;case"tcptype":a.tcpType=i[o+1];break;case"ufrag":a.ufrag=i[o+1],a.usernameFragment=i[o+1];break;default:a[i[o]]===void 0&&(a[i[o]]=i[o+1]);break}return a},t.writeCandidate=function(n){const i=[];i.push(n.foundation);const a=n.component;a==="rtp"?i.push(1):a==="rtcp"?i.push(2):i.push(a),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const o=n.type;return i.push("typ"),i.push(o),o!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(n){return n.substr(14).split(" ")},t.parseRtpMap=function(n){let i=n.substr(9).split(" ");const a={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),a.name=i[0],a.clockRate=parseInt(i[1],10),a.channels=i.length===3?parseInt(i[2],10):1,a.numChannels=a.channels,a},t.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const a=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(a!==1?"/"+a:"")+`\r
`},t.parseExtmap=function(n){const i=n.substr(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1]}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+`\r
`},t.parseFmtp=function(n){const i={};let a;const o=n.substr(n.indexOf(" ")+1).split(";");for(let c=0;c<o.length;c++)a=o[c].trim().split("="),i[a[0].trim()]=a[1];return i},t.writeFmtp=function(n){let i="",a=n.payloadType;if(n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const o=[];Object.keys(n.parameters).forEach(c=>{n.parameters[c]!==void 0?o.push(c+"="+n.parameters[c]):o.push(c)}),i+="a=fmtp:"+a+" "+o.join(";")+`\r
`}return i},t.parseRtcpFb=function(n){const i=n.substr(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(n){let i="",a=n.payloadType;return n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(o=>{i+="a=rtcp-fb:"+a+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(n){const i=n.indexOf(" "),a={ssrc:parseInt(n.substr(7,i-7),10)},o=n.indexOf(":",i);return o>-1?(a.attribute=n.substr(i+1,o-i-1),a.value=n.substr(o+1)):a.attribute=n.substr(i+1),a},t.parseSsrcGroup=function(n){const i=n.substr(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(a=>parseInt(a,10))}},t.getMid=function(n){const i=t.matchPrefix(n,"a=mid:")[0];if(i)return i.substr(6)},t.parseFingerprint=function(n){const i=n.substr(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:t.matchPrefix(n+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,i){let a="a=setup:"+i+`\r
`;return n.fingerprints.forEach(o=>{a+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),a},t.parseCryptoLine=function(n){const i=n.substr(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substr(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,i){return t.matchPrefix(n+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,i){const a=t.matchPrefix(n+i,"a=ice-ufrag:")[0],o=t.matchPrefix(n+i,"a=ice-pwd:")[0];return a&&o?{usernameFragment:a.substr(12),password:o.substr(10)}:null},t.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=t.splitLines(n)[0].split(" ");for(let c=3;c<o.length;c++){const d=o[c],u=t.matchPrefix(n,"a=rtpmap:"+d+" ")[0];if(u){const l=t.parseRtpMap(u),h=t.matchPrefix(n,"a=fmtp:"+d+" ");switch(l.parameters=h.length?t.parseFmtp(h[0]):{},l.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+d+" ").map(t.parseRtcpFb),i.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(l.name.toUpperCase());break}}}return t.matchPrefix(n,"a=extmap:").forEach(c=>{i.headerExtensions.push(t.parseExtmap(c))}),i},t.writeRtpDescription=function(n,i){let a="";a+="m="+n+" ",a+=i.codecs.length>0?"9":"0",a+=" UDP/TLS/RTP/SAVPF ",a+=i.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,a+=`c=IN IP4 0.0.0.0\r
`,a+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(c=>{a+=t.writeRtpMap(c),a+=t.writeFmtp(c),a+=t.writeRtcpFb(c)});let o=0;return i.codecs.forEach(c=>{c.maxptime>o&&(o=c.maxptime)}),o>0&&(a+="a=maxptime:"+o+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(c=>{a+=t.writeExtmap(c)}),a},t.parseRtpEncodingParameters=function(n){const i=[],a=t.parseRtpParameters(n),o=a.fecMechanisms.indexOf("RED")!==-1,c=a.fecMechanisms.indexOf("ULPFEC")!==-1,d=t.matchPrefix(n,"a=ssrc:").map(y=>t.parseSsrcMedia(y)).filter(y=>y.attribute==="cname"),u=d.length>0&&d[0].ssrc;let l;const h=t.matchPrefix(n,"a=ssrc-group:FID").map(y=>y.substr(17).split(" ").map(x=>parseInt(x,10)));h.length>0&&h[0].length>1&&h[0][0]===u&&(l=h[0][1]),a.codecs.forEach(y=>{if(y.name.toUpperCase()==="RTX"&&y.parameters.apt){let E={ssrc:u,codecPayloadType:parseInt(y.parameters.apt,10)};u&&l&&(E.rtx={ssrc:l}),i.push(E),o&&(E=JSON.parse(JSON.stringify(E)),E.fec={ssrc:u,mechanism:c?"red+ulpfec":"red"},i.push(E))}}),i.length===0&&u&&i.push({ssrc:u});let p=t.matchPrefix(n,"b=");return p.length&&(p[0].indexOf("b=TIAS:")===0?p=parseInt(p[0].substr(7),10):p[0].indexOf("b=AS:")===0?p=parseInt(p[0].substr(5),10)*1e3*.95-50*40*8:p=void 0,i.forEach(y=>{y.maxBitrate=p})),i},t.parseRtcpParameters=function(n){const i={},a=t.matchPrefix(n,"a=ssrc:").map(d=>t.parseSsrcMedia(d)).filter(d=>d.attribute==="cname")[0];a&&(i.cname=a.value,i.ssrc=a.ssrc);const o=t.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=o.length>0,i.compound=o.length===0;const c=t.matchPrefix(n,"a=rtcp-mux");return i.mux=c.length>0,i},t.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},t.parseMsid=function(n){let i;const a=t.matchPrefix(n,"a=msid:");if(a.length===1)return i=a[0].substr(7).split(" "),{stream:i[0],track:i[1]};const o=t.matchPrefix(n,"a=ssrc:").map(c=>t.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");if(o.length>0)return i=o[0].value.split(" "),{stream:i[0],track:i[1]}},t.parseSctpDescription=function(n){const i=t.parseMLine(n),a=t.matchPrefix(n,"a=max-message-size:");let o;a.length>0&&(o=parseInt(a[0].substr(19),10)),isNaN(o)&&(o=65536);const c=t.matchPrefix(n,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substr(12),10),protocol:i.fmt,maxMessageSize:o};const d=t.matchPrefix(n,"a=sctpmap:");if(d.length>0){const u=d[0].substr(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:o}}},t.writeSctpDescription=function(n,i){let a=[];return n.protocol!=="DTLS/SCTP"?a=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:a=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&a.push("a=max-message-size:"+i.maxMessageSize+`\r
`),a.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(n,i,a){let o;const c=i!==void 0?i:2;return n?o=n:o=t.generateSessionId(),`v=0\r
o=`+(a||"thisisadapterortc")+" "+o+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,i){const a=t.splitLines(n);for(let o=0;o<a.length;o++)switch(a[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[o].substr(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substr(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const a=t.splitLines(n)[0].substr(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},t.parseOLine=function(n){const a=t.matchPrefix(n,"o=")[0].substr(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=t.splitLines(n);for(let a=0;a<i.length;a++)if(i[a].length<2||i[a].charAt(1)!=="=")return!1;return!0},e.exports=t})(sdp$1);var SDPUtils=sdpExports,sdp=_mergeNamespaces({__proto__:null,default:SDPUtils},[sdpExports]);function shimRTCIceCandidate(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const a=new t(i),o=SDPUtils.parseCandidate(i.candidate),c=Object.assign(a,o);return c.toJSON=function(){return{candidate:c.candidate,sdpMid:c.sdpMid,sdpMLineIndex:c.sdpMLineIndex,usernameFragment:c.usernameFragment}},c}return new t(i)},e.RTCIceCandidate.prototype=t.prototype,wrapPeerConnectionEvent(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function shimMaxMessageSize(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(d){if(!d||!d.sdp)return!1;const u=SDPUtils.splitSections(d.sdp);return u.shift(),u.some(l=>{const h=SDPUtils.parseMLine(l);return h&&h.kind==="application"&&h.protocol.indexOf("SCTP")!==-1})},i=function(d){const u=d.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;const l=parseInt(u[1],10);return l!==l?-1:l},a=function(d){let u=65536;return t.browser==="firefox"&&(t.version<57?d===-1?u=16384:u=2147483637:t.version<60?u=t.version===57?65535:65536:u=2147483637),u},o=function(d,u){let l=65536;t.browser==="firefox"&&t.version===57&&(l=65535);const h=SDPUtils.matchPrefix(d.sdp,"a=max-message-size:");return h.length>0?l=parseInt(h[0].substr(19),10):t.browser==="firefox"&&u!==-1&&(l=2147483637),l},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const u=i(arguments[0]),l=a(u),h=o(arguments[0],u);let p;l===0&&h===0?p=Number.POSITIVE_INFINITY:l===0||h===0?p=Math.max(l,h):p=Math.min(l,h);const y={};Object.defineProperty(y,"maxMessageSize",{get(){return p}}),this._sctp=y}return c.apply(this,arguments)}}function shimSendThrowTypeError(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,a){const o=i.send;i.send=function(){const d=arguments[0],u=d.length||d.size||d.byteLength;if(i.readyState==="open"&&a.sctp&&u>a.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)");return o.apply(i,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const a=n.apply(this,arguments);return t(a,this),a},wrapPeerConnectionEvent(e,"datachannel",i=>(t(i.channel,i.target),i))}function shimConnectionState(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=a=>{const o=a.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const c=new Event("connectionstatechange",a);o.dispatchEvent(c)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function removeExtmapAllowMixed(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=a.sdp.split(`
`).filter(c=>c.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&a instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:a.type,sdp:o}):a.sdp=o}return n.apply(this,arguments)}}function shimAddIceCandidateNullOrEmpty(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const n=e.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function shimParameterlessSetLocalDescription(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const n=e.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return n.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer";break}return a.sdp||a.type!=="offer"&&a.type!=="answer"?n.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>n.apply(this,[c]))})}var commonShim=Object.freeze({__proto__:null,removeExtmapAllowMixed,shimAddIceCandidateNullOrEmpty,shimConnectionState,shimMaxMessageSize,shimParameterlessSetLocalDescription,shimRTCIceCandidate,shimSendThrowTypeError});function adapterFactory(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=log,i=detectBrowser(e),a={browserDetails:i,commonShim,extractVersion,disableLog,disableWarnings,sdp};switch(i.browser){case"chrome":if(!chromeShim||!shimPeerConnection$1||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),a;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),a;n("adapter.js shimming chrome."),a.browserShim=chromeShim,shimAddIceCandidateNullOrEmpty(e,i),shimParameterlessSetLocalDescription(e),shimGetUserMedia$2(e,i),shimMediaStream(e),shimPeerConnection$1(e,i),shimOnTrack$1(e),shimAddTrackRemoveTrack(e,i),shimGetSendersWithDtmf(e),shimGetStats(e),shimSenderReceiverGetStats(e),fixNegotiationNeeded(e,i),shimRTCIceCandidate(e),shimConnectionState(e),shimMaxMessageSize(e,i),shimSendThrowTypeError(e),removeExtmapAllowMixed(e,i);break;case"firefox":if(!firefoxShim||!shimPeerConnection||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),a;n("adapter.js shimming firefox."),a.browserShim=firefoxShim,shimAddIceCandidateNullOrEmpty(e,i),shimParameterlessSetLocalDescription(e),shimGetUserMedia$1(e,i),shimPeerConnection(e,i),shimOnTrack(e),shimRemoveStream(e),shimSenderGetStats(e),shimReceiverGetStats(e),shimRTCDataChannel(e),shimAddTransceiver(e),shimGetParameters(e),shimCreateOffer(e),shimCreateAnswer(e),shimRTCIceCandidate(e),shimConnectionState(e),shimMaxMessageSize(e,i),shimSendThrowTypeError(e);break;case"safari":if(!safariShim||!t.shimSafari)return n("Safari shim is not included in this adapter release."),a;n("adapter.js shimming safari."),a.browserShim=safariShim,shimAddIceCandidateNullOrEmpty(e,i),shimParameterlessSetLocalDescription(e),shimRTCIceServerUrls(e),shimCreateOfferLegacy(e),shimCallbacksAPI(e),shimLocalStreamsAPI(e),shimRemoteStreamsAPI(e),shimTrackEventTransceiver(e),shimGetUserMedia(e),shimAudioContext(e),shimRTCIceCandidate(e),shimMaxMessageSize(e,i),shimSendThrowTypeError(e),removeExtmapAllowMixed(e,i);break;default:n("Unsupported browser!");break}return a}adapterFactory({window:typeof window>"u"?void 0:window});var SignalTarget;(function(e){e[e.PUBLISHER=0]="PUBLISHER",e[e.SUBSCRIBER=1]="SUBSCRIBER",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"})(SignalTarget||(SignalTarget={}));function signalTargetFromJSON(e){switch(e){case 0:case"PUBLISHER":return SignalTarget.PUBLISHER;case 1:case"SUBSCRIBER":return SignalTarget.SUBSCRIBER;case-1:case"UNRECOGNIZED":default:return SignalTarget.UNRECOGNIZED}}function signalTargetToJSON(e){switch(e){case SignalTarget.PUBLISHER:return"PUBLISHER";case SignalTarget.SUBSCRIBER:return"SUBSCRIBER";case SignalTarget.UNRECOGNIZED:default:return"UNRECOGNIZED"}}var StreamState;(function(e){e[e.ACTIVE=0]="ACTIVE",e[e.PAUSED=1]="PAUSED",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"})(StreamState||(StreamState={}));function streamStateFromJSON(e){switch(e){case 0:case"ACTIVE":return StreamState.ACTIVE;case 1:case"PAUSED":return StreamState.PAUSED;case-1:case"UNRECOGNIZED":default:return StreamState.UNRECOGNIZED}}function streamStateToJSON(e){switch(e){case StreamState.ACTIVE:return"ACTIVE";case StreamState.PAUSED:return"PAUSED";case StreamState.UNRECOGNIZED:default:return"UNRECOGNIZED"}}var CandidateProtocol;(function(e){e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.TLS=2]="TLS",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED"})(CandidateProtocol||(CandidateProtocol={}));function candidateProtocolFromJSON(e){switch(e){case 0:case"UDP":return CandidateProtocol.UDP;case 1:case"TCP":return CandidateProtocol.TCP;case 2:case"TLS":return CandidateProtocol.TLS;case-1:case"UNRECOGNIZED":default:return CandidateProtocol.UNRECOGNIZED}}function candidateProtocolToJSON(e){switch(e){case CandidateProtocol.UDP:return"UDP";case CandidateProtocol.TCP:return"TCP";case CandidateProtocol.TLS:return"TLS";case CandidateProtocol.UNRECOGNIZED:default:return"UNRECOGNIZED"}}function createBaseSignalRequest(){return{message:void 0}}const SignalRequest={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();var n;switch((n=e.message)===null||n===void 0?void 0:n.$case){case"offer":SessionDescription.encode(e.message.offer,t.uint32(10).fork()).ldelim();break;case"answer":SessionDescription.encode(e.message.answer,t.uint32(18).fork()).ldelim();break;case"trickle":TrickleRequest.encode(e.message.trickle,t.uint32(26).fork()).ldelim();break;case"addTrack":AddTrackRequest.encode(e.message.addTrack,t.uint32(34).fork()).ldelim();break;case"mute":MuteTrackRequest.encode(e.message.mute,t.uint32(42).fork()).ldelim();break;case"subscription":UpdateSubscription.encode(e.message.subscription,t.uint32(50).fork()).ldelim();break;case"trackSetting":UpdateTrackSettings.encode(e.message.trackSetting,t.uint32(58).fork()).ldelim();break;case"leave":LeaveRequest.encode(e.message.leave,t.uint32(66).fork()).ldelim();break;case"updateLayers":UpdateVideoLayers.encode(e.message.updateLayers,t.uint32(82).fork()).ldelim();break;case"subscriptionPermission":SubscriptionPermission.encode(e.message.subscriptionPermission,t.uint32(90).fork()).ldelim();break;case"syncState":SyncState.encode(e.message.syncState,t.uint32(98).fork()).ldelim();break;case"simulate":SimulateScenario.encode(e.message.simulate,t.uint32(106).fork()).ldelim();break;case"ping":t.uint32(112).int64(e.message.ping);break;case"updateMetadata":UpdateParticipantMetadata.encode(e.message.updateMetadata,t.uint32(122).fork()).ldelim();break;case"pingReq":Ping.encode(e.message.pingReq,t.uint32(130).fork()).ldelim();break}return t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseSignalRequest();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.message={$case:"offer",offer:SessionDescription.decode(n,n.uint32())};break;case 2:a.message={$case:"answer",answer:SessionDescription.decode(n,n.uint32())};break;case 3:a.message={$case:"trickle",trickle:TrickleRequest.decode(n,n.uint32())};break;case 4:a.message={$case:"addTrack",addTrack:AddTrackRequest.decode(n,n.uint32())};break;case 5:a.message={$case:"mute",mute:MuteTrackRequest.decode(n,n.uint32())};break;case 6:a.message={$case:"subscription",subscription:UpdateSubscription.decode(n,n.uint32())};break;case 7:a.message={$case:"trackSetting",trackSetting:UpdateTrackSettings.decode(n,n.uint32())};break;case 8:a.message={$case:"leave",leave:LeaveRequest.decode(n,n.uint32())};break;case 10:a.message={$case:"updateLayers",updateLayers:UpdateVideoLayers.decode(n,n.uint32())};break;case 11:a.message={$case:"subscriptionPermission",subscriptionPermission:SubscriptionPermission.decode(n,n.uint32())};break;case 12:a.message={$case:"syncState",syncState:SyncState.decode(n,n.uint32())};break;case 13:a.message={$case:"simulate",simulate:SimulateScenario.decode(n,n.uint32())};break;case 14:a.message={$case:"ping",ping:longToNumber(n.int64())};break;case 15:a.message={$case:"updateMetadata",updateMetadata:UpdateParticipantMetadata.decode(n,n.uint32())};break;case 16:a.message={$case:"pingReq",pingReq:Ping.decode(n,n.uint32())};break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{message:isSet$2(e.offer)?{$case:"offer",offer:SessionDescription.fromJSON(e.offer)}:isSet$2(e.answer)?{$case:"answer",answer:SessionDescription.fromJSON(e.answer)}:isSet$2(e.trickle)?{$case:"trickle",trickle:TrickleRequest.fromJSON(e.trickle)}:isSet$2(e.addTrack)?{$case:"addTrack",addTrack:AddTrackRequest.fromJSON(e.addTrack)}:isSet$2(e.mute)?{$case:"mute",mute:MuteTrackRequest.fromJSON(e.mute)}:isSet$2(e.subscription)?{$case:"subscription",subscription:UpdateSubscription.fromJSON(e.subscription)}:isSet$2(e.trackSetting)?{$case:"trackSetting",trackSetting:UpdateTrackSettings.fromJSON(e.trackSetting)}:isSet$2(e.leave)?{$case:"leave",leave:LeaveRequest.fromJSON(e.leave)}:isSet$2(e.updateLayers)?{$case:"updateLayers",updateLayers:UpdateVideoLayers.fromJSON(e.updateLayers)}:isSet$2(e.subscriptionPermission)?{$case:"subscriptionPermission",subscriptionPermission:SubscriptionPermission.fromJSON(e.subscriptionPermission)}:isSet$2(e.syncState)?{$case:"syncState",syncState:SyncState.fromJSON(e.syncState)}:isSet$2(e.simulate)?{$case:"simulate",simulate:SimulateScenario.fromJSON(e.simulate)}:isSet$2(e.ping)?{$case:"ping",ping:Number(e.ping)}:isSet$2(e.updateMetadata)?{$case:"updateMetadata",updateMetadata:UpdateParticipantMetadata.fromJSON(e.updateMetadata)}:isSet$2(e.pingReq)?{$case:"pingReq",pingReq:Ping.fromJSON(e.pingReq)}:void 0}},toJSON(e){var t,n,i,a,o,c,d,u,l,h,p,y,E,x,S,k,T,L,q,U,ee,W,ie,fe,ce,ye,xe,Oe,F,v,C,I,B,J,Y,H,_,m,b,$,g,O,te,Z;const ae={};return((t=e.message)===null||t===void 0?void 0:t.$case)==="offer"&&(ae.offer=!((n=e.message)===null||n===void 0)&&n.offer?SessionDescription.toJSON((i=e.message)===null||i===void 0?void 0:i.offer):void 0),((a=e.message)===null||a===void 0?void 0:a.$case)==="answer"&&(ae.answer=!((o=e.message)===null||o===void 0)&&o.answer?SessionDescription.toJSON((c=e.message)===null||c===void 0?void 0:c.answer):void 0),((d=e.message)===null||d===void 0?void 0:d.$case)==="trickle"&&(ae.trickle=!((u=e.message)===null||u===void 0)&&u.trickle?TrickleRequest.toJSON((l=e.message)===null||l===void 0?void 0:l.trickle):void 0),((h=e.message)===null||h===void 0?void 0:h.$case)==="addTrack"&&(ae.addTrack=!((p=e.message)===null||p===void 0)&&p.addTrack?AddTrackRequest.toJSON((y=e.message)===null||y===void 0?void 0:y.addTrack):void 0),((E=e.message)===null||E===void 0?void 0:E.$case)==="mute"&&(ae.mute=!((x=e.message)===null||x===void 0)&&x.mute?MuteTrackRequest.toJSON((S=e.message)===null||S===void 0?void 0:S.mute):void 0),((k=e.message)===null||k===void 0?void 0:k.$case)==="subscription"&&(ae.subscription=!((T=e.message)===null||T===void 0)&&T.subscription?UpdateSubscription.toJSON((L=e.message)===null||L===void 0?void 0:L.subscription):void 0),((q=e.message)===null||q===void 0?void 0:q.$case)==="trackSetting"&&(ae.trackSetting=!((U=e.message)===null||U===void 0)&&U.trackSetting?UpdateTrackSettings.toJSON((ee=e.message)===null||ee===void 0?void 0:ee.trackSetting):void 0),((W=e.message)===null||W===void 0?void 0:W.$case)==="leave"&&(ae.leave=!((ie=e.message)===null||ie===void 0)&&ie.leave?LeaveRequest.toJSON((fe=e.message)===null||fe===void 0?void 0:fe.leave):void 0),((ce=e.message)===null||ce===void 0?void 0:ce.$case)==="updateLayers"&&(ae.updateLayers=!((ye=e.message)===null||ye===void 0)&&ye.updateLayers?UpdateVideoLayers.toJSON((xe=e.message)===null||xe===void 0?void 0:xe.updateLayers):void 0),((Oe=e.message)===null||Oe===void 0?void 0:Oe.$case)==="subscriptionPermission"&&(ae.subscriptionPermission=!((F=e.message)===null||F===void 0)&&F.subscriptionPermission?SubscriptionPermission.toJSON((v=e.message)===null||v===void 0?void 0:v.subscriptionPermission):void 0),((C=e.message)===null||C===void 0?void 0:C.$case)==="syncState"&&(ae.syncState=!((I=e.message)===null||I===void 0)&&I.syncState?SyncState.toJSON((B=e.message)===null||B===void 0?void 0:B.syncState):void 0),((J=e.message)===null||J===void 0?void 0:J.$case)==="simulate"&&(ae.simulate=!((Y=e.message)===null||Y===void 0)&&Y.simulate?SimulateScenario.toJSON((H=e.message)===null||H===void 0?void 0:H.simulate):void 0),((_=e.message)===null||_===void 0?void 0:_.$case)==="ping"&&(ae.ping=Math.round((m=e.message)===null||m===void 0?void 0:m.ping)),((b=e.message)===null||b===void 0?void 0:b.$case)==="updateMetadata"&&(ae.updateMetadata=!(($=e.message)===null||$===void 0)&&$.updateMetadata?UpdateParticipantMetadata.toJSON((g=e.message)===null||g===void 0?void 0:g.updateMetadata):void 0),((O=e.message)===null||O===void 0?void 0:O.$case)==="pingReq"&&(ae.pingReq=!((te=e.message)===null||te===void 0)&&te.pingReq?Ping.toJSON((Z=e.message)===null||Z===void 0?void 0:Z.pingReq):void 0),ae},create(e){return SignalRequest.fromPartial(e??{})},fromPartial(e){var t,n,i,a,o,c,d,u,l,h,p,y,E,x,S,k,T,L,q,U,ee,W,ie,fe,ce,ye,xe,Oe,F,v,C,I,B,J,Y,H,_,m,b,$,g,O,te,Z,ae;const be=createBaseSignalRequest();return((t=e.message)===null||t===void 0?void 0:t.$case)==="offer"&&((n=e.message)===null||n===void 0?void 0:n.offer)!==void 0&&((i=e.message)===null||i===void 0?void 0:i.offer)!==null&&(be.message={$case:"offer",offer:SessionDescription.fromPartial(e.message.offer)}),((a=e.message)===null||a===void 0?void 0:a.$case)==="answer"&&((o=e.message)===null||o===void 0?void 0:o.answer)!==void 0&&((c=e.message)===null||c===void 0?void 0:c.answer)!==null&&(be.message={$case:"answer",answer:SessionDescription.fromPartial(e.message.answer)}),((d=e.message)===null||d===void 0?void 0:d.$case)==="trickle"&&((u=e.message)===null||u===void 0?void 0:u.trickle)!==void 0&&((l=e.message)===null||l===void 0?void 0:l.trickle)!==null&&(be.message={$case:"trickle",trickle:TrickleRequest.fromPartial(e.message.trickle)}),((h=e.message)===null||h===void 0?void 0:h.$case)==="addTrack"&&((p=e.message)===null||p===void 0?void 0:p.addTrack)!==void 0&&((y=e.message)===null||y===void 0?void 0:y.addTrack)!==null&&(be.message={$case:"addTrack",addTrack:AddTrackRequest.fromPartial(e.message.addTrack)}),((E=e.message)===null||E===void 0?void 0:E.$case)==="mute"&&((x=e.message)===null||x===void 0?void 0:x.mute)!==void 0&&((S=e.message)===null||S===void 0?void 0:S.mute)!==null&&(be.message={$case:"mute",mute:MuteTrackRequest.fromPartial(e.message.mute)}),((k=e.message)===null||k===void 0?void 0:k.$case)==="subscription"&&((T=e.message)===null||T===void 0?void 0:T.subscription)!==void 0&&((L=e.message)===null||L===void 0?void 0:L.subscription)!==null&&(be.message={$case:"subscription",subscription:UpdateSubscription.fromPartial(e.message.subscription)}),((q=e.message)===null||q===void 0?void 0:q.$case)==="trackSetting"&&((U=e.message)===null||U===void 0?void 0:U.trackSetting)!==void 0&&((ee=e.message)===null||ee===void 0?void 0:ee.trackSetting)!==null&&(be.message={$case:"trackSetting",trackSetting:UpdateTrackSettings.fromPartial(e.message.trackSetting)}),((W=e.message)===null||W===void 0?void 0:W.$case)==="leave"&&((ie=e.message)===null||ie===void 0?void 0:ie.leave)!==void 0&&((fe=e.message)===null||fe===void 0?void 0:fe.leave)!==null&&(be.message={$case:"leave",leave:LeaveRequest.fromPartial(e.message.leave)}),((ce=e.message)===null||ce===void 0?void 0:ce.$case)==="updateLayers"&&((ye=e.message)===null||ye===void 0?void 0:ye.updateLayers)!==void 0&&((xe=e.message)===null||xe===void 0?void 0:xe.updateLayers)!==null&&(be.message={$case:"updateLayers",updateLayers:UpdateVideoLayers.fromPartial(e.message.updateLayers)}),((Oe=e.message)===null||Oe===void 0?void 0:Oe.$case)==="subscriptionPermission"&&((F=e.message)===null||F===void 0?void 0:F.subscriptionPermission)!==void 0&&((v=e.message)===null||v===void 0?void 0:v.subscriptionPermission)!==null&&(be.message={$case:"subscriptionPermission",subscriptionPermission:SubscriptionPermission.fromPartial(e.message.subscriptionPermission)}),((C=e.message)===null||C===void 0?void 0:C.$case)==="syncState"&&((I=e.message)===null||I===void 0?void 0:I.syncState)!==void 0&&((B=e.message)===null||B===void 0?void 0:B.syncState)!==null&&(be.message={$case:"syncState",syncState:SyncState.fromPartial(e.message.syncState)}),((J=e.message)===null||J===void 0?void 0:J.$case)==="simulate"&&((Y=e.message)===null||Y===void 0?void 0:Y.simulate)!==void 0&&((H=e.message)===null||H===void 0?void 0:H.simulate)!==null&&(be.message={$case:"simulate",simulate:SimulateScenario.fromPartial(e.message.simulate)}),((_=e.message)===null||_===void 0?void 0:_.$case)==="ping"&&((m=e.message)===null||m===void 0?void 0:m.ping)!==void 0&&((b=e.message)===null||b===void 0?void 0:b.ping)!==null&&(be.message={$case:"ping",ping:e.message.ping}),(($=e.message)===null||$===void 0?void 0:$.$case)==="updateMetadata"&&((g=e.message)===null||g===void 0?void 0:g.updateMetadata)!==void 0&&((O=e.message)===null||O===void 0?void 0:O.updateMetadata)!==null&&(be.message={$case:"updateMetadata",updateMetadata:UpdateParticipantMetadata.fromPartial(e.message.updateMetadata)}),((te=e.message)===null||te===void 0?void 0:te.$case)==="pingReq"&&((Z=e.message)===null||Z===void 0?void 0:Z.pingReq)!==void 0&&((ae=e.message)===null||ae===void 0?void 0:ae.pingReq)!==null&&(be.message={$case:"pingReq",pingReq:Ping.fromPartial(e.message.pingReq)}),be}};function createBaseSignalResponse(){return{message:void 0}}const SignalResponse={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();var n;switch((n=e.message)===null||n===void 0?void 0:n.$case){case"join":JoinResponse.encode(e.message.join,t.uint32(10).fork()).ldelim();break;case"answer":SessionDescription.encode(e.message.answer,t.uint32(18).fork()).ldelim();break;case"offer":SessionDescription.encode(e.message.offer,t.uint32(26).fork()).ldelim();break;case"trickle":TrickleRequest.encode(e.message.trickle,t.uint32(34).fork()).ldelim();break;case"update":ParticipantUpdate.encode(e.message.update,t.uint32(42).fork()).ldelim();break;case"trackPublished":TrackPublishedResponse.encode(e.message.trackPublished,t.uint32(50).fork()).ldelim();break;case"leave":LeaveRequest.encode(e.message.leave,t.uint32(66).fork()).ldelim();break;case"mute":MuteTrackRequest.encode(e.message.mute,t.uint32(74).fork()).ldelim();break;case"speakersChanged":SpeakersChanged.encode(e.message.speakersChanged,t.uint32(82).fork()).ldelim();break;case"roomUpdate":RoomUpdate.encode(e.message.roomUpdate,t.uint32(90).fork()).ldelim();break;case"connectionQuality":ConnectionQualityUpdate.encode(e.message.connectionQuality,t.uint32(98).fork()).ldelim();break;case"streamStateUpdate":StreamStateUpdate.encode(e.message.streamStateUpdate,t.uint32(106).fork()).ldelim();break;case"subscribedQualityUpdate":SubscribedQualityUpdate.encode(e.message.subscribedQualityUpdate,t.uint32(114).fork()).ldelim();break;case"subscriptionPermissionUpdate":SubscriptionPermissionUpdate.encode(e.message.subscriptionPermissionUpdate,t.uint32(122).fork()).ldelim();break;case"refreshToken":t.uint32(130).string(e.message.refreshToken);break;case"trackUnpublished":TrackUnpublishedResponse.encode(e.message.trackUnpublished,t.uint32(138).fork()).ldelim();break;case"pong":t.uint32(144).int64(e.message.pong);break;case"reconnect":ReconnectResponse.encode(e.message.reconnect,t.uint32(154).fork()).ldelim();break;case"pongResp":Pong.encode(e.message.pongResp,t.uint32(162).fork()).ldelim();break}return t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseSignalResponse();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.message={$case:"join",join:JoinResponse.decode(n,n.uint32())};break;case 2:a.message={$case:"answer",answer:SessionDescription.decode(n,n.uint32())};break;case 3:a.message={$case:"offer",offer:SessionDescription.decode(n,n.uint32())};break;case 4:a.message={$case:"trickle",trickle:TrickleRequest.decode(n,n.uint32())};break;case 5:a.message={$case:"update",update:ParticipantUpdate.decode(n,n.uint32())};break;case 6:a.message={$case:"trackPublished",trackPublished:TrackPublishedResponse.decode(n,n.uint32())};break;case 8:a.message={$case:"leave",leave:LeaveRequest.decode(n,n.uint32())};break;case 9:a.message={$case:"mute",mute:MuteTrackRequest.decode(n,n.uint32())};break;case 10:a.message={$case:"speakersChanged",speakersChanged:SpeakersChanged.decode(n,n.uint32())};break;case 11:a.message={$case:"roomUpdate",roomUpdate:RoomUpdate.decode(n,n.uint32())};break;case 12:a.message={$case:"connectionQuality",connectionQuality:ConnectionQualityUpdate.decode(n,n.uint32())};break;case 13:a.message={$case:"streamStateUpdate",streamStateUpdate:StreamStateUpdate.decode(n,n.uint32())};break;case 14:a.message={$case:"subscribedQualityUpdate",subscribedQualityUpdate:SubscribedQualityUpdate.decode(n,n.uint32())};break;case 15:a.message={$case:"subscriptionPermissionUpdate",subscriptionPermissionUpdate:SubscriptionPermissionUpdate.decode(n,n.uint32())};break;case 16:a.message={$case:"refreshToken",refreshToken:n.string()};break;case 17:a.message={$case:"trackUnpublished",trackUnpublished:TrackUnpublishedResponse.decode(n,n.uint32())};break;case 18:a.message={$case:"pong",pong:longToNumber(n.int64())};break;case 19:a.message={$case:"reconnect",reconnect:ReconnectResponse.decode(n,n.uint32())};break;case 20:a.message={$case:"pongResp",pongResp:Pong.decode(n,n.uint32())};break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{message:isSet$2(e.join)?{$case:"join",join:JoinResponse.fromJSON(e.join)}:isSet$2(e.answer)?{$case:"answer",answer:SessionDescription.fromJSON(e.answer)}:isSet$2(e.offer)?{$case:"offer",offer:SessionDescription.fromJSON(e.offer)}:isSet$2(e.trickle)?{$case:"trickle",trickle:TrickleRequest.fromJSON(e.trickle)}:isSet$2(e.update)?{$case:"update",update:ParticipantUpdate.fromJSON(e.update)}:isSet$2(e.trackPublished)?{$case:"trackPublished",trackPublished:TrackPublishedResponse.fromJSON(e.trackPublished)}:isSet$2(e.leave)?{$case:"leave",leave:LeaveRequest.fromJSON(e.leave)}:isSet$2(e.mute)?{$case:"mute",mute:MuteTrackRequest.fromJSON(e.mute)}:isSet$2(e.speakersChanged)?{$case:"speakersChanged",speakersChanged:SpeakersChanged.fromJSON(e.speakersChanged)}:isSet$2(e.roomUpdate)?{$case:"roomUpdate",roomUpdate:RoomUpdate.fromJSON(e.roomUpdate)}:isSet$2(e.connectionQuality)?{$case:"connectionQuality",connectionQuality:ConnectionQualityUpdate.fromJSON(e.connectionQuality)}:isSet$2(e.streamStateUpdate)?{$case:"streamStateUpdate",streamStateUpdate:StreamStateUpdate.fromJSON(e.streamStateUpdate)}:isSet$2(e.subscribedQualityUpdate)?{$case:"subscribedQualityUpdate",subscribedQualityUpdate:SubscribedQualityUpdate.fromJSON(e.subscribedQualityUpdate)}:isSet$2(e.subscriptionPermissionUpdate)?{$case:"subscriptionPermissionUpdate",subscriptionPermissionUpdate:SubscriptionPermissionUpdate.fromJSON(e.subscriptionPermissionUpdate)}:isSet$2(e.refreshToken)?{$case:"refreshToken",refreshToken:String(e.refreshToken)}:isSet$2(e.trackUnpublished)?{$case:"trackUnpublished",trackUnpublished:TrackUnpublishedResponse.fromJSON(e.trackUnpublished)}:isSet$2(e.pong)?{$case:"pong",pong:Number(e.pong)}:isSet$2(e.reconnect)?{$case:"reconnect",reconnect:ReconnectResponse.fromJSON(e.reconnect)}:isSet$2(e.pongResp)?{$case:"pongResp",pongResp:Pong.fromJSON(e.pongResp)}:void 0}},toJSON(e){var t,n,i,a,o,c,d,u,l,h,p,y,E,x,S,k,T,L,q,U,ee,W,ie,fe,ce,ye,xe,Oe,F,v,C,I,B,J,Y,H,_,m,b,$,g,O,te,Z,ae,be,ke,Ae,dt,qe,et,Ke,gt,at,Lt;const Ge={};return((t=e.message)===null||t===void 0?void 0:t.$case)==="join"&&(Ge.join=!((n=e.message)===null||n===void 0)&&n.join?JoinResponse.toJSON((i=e.message)===null||i===void 0?void 0:i.join):void 0),((a=e.message)===null||a===void 0?void 0:a.$case)==="answer"&&(Ge.answer=!((o=e.message)===null||o===void 0)&&o.answer?SessionDescription.toJSON((c=e.message)===null||c===void 0?void 0:c.answer):void 0),((d=e.message)===null||d===void 0?void 0:d.$case)==="offer"&&(Ge.offer=!((u=e.message)===null||u===void 0)&&u.offer?SessionDescription.toJSON((l=e.message)===null||l===void 0?void 0:l.offer):void 0),((h=e.message)===null||h===void 0?void 0:h.$case)==="trickle"&&(Ge.trickle=!((p=e.message)===null||p===void 0)&&p.trickle?TrickleRequest.toJSON((y=e.message)===null||y===void 0?void 0:y.trickle):void 0),((E=e.message)===null||E===void 0?void 0:E.$case)==="update"&&(Ge.update=!((x=e.message)===null||x===void 0)&&x.update?ParticipantUpdate.toJSON((S=e.message)===null||S===void 0?void 0:S.update):void 0),((k=e.message)===null||k===void 0?void 0:k.$case)==="trackPublished"&&(Ge.trackPublished=!((T=e.message)===null||T===void 0)&&T.trackPublished?TrackPublishedResponse.toJSON((L=e.message)===null||L===void 0?void 0:L.trackPublished):void 0),((q=e.message)===null||q===void 0?void 0:q.$case)==="leave"&&(Ge.leave=!((U=e.message)===null||U===void 0)&&U.leave?LeaveRequest.toJSON((ee=e.message)===null||ee===void 0?void 0:ee.leave):void 0),((W=e.message)===null||W===void 0?void 0:W.$case)==="mute"&&(Ge.mute=!((ie=e.message)===null||ie===void 0)&&ie.mute?MuteTrackRequest.toJSON((fe=e.message)===null||fe===void 0?void 0:fe.mute):void 0),((ce=e.message)===null||ce===void 0?void 0:ce.$case)==="speakersChanged"&&(Ge.speakersChanged=!((ye=e.message)===null||ye===void 0)&&ye.speakersChanged?SpeakersChanged.toJSON((xe=e.message)===null||xe===void 0?void 0:xe.speakersChanged):void 0),((Oe=e.message)===null||Oe===void 0?void 0:Oe.$case)==="roomUpdate"&&(Ge.roomUpdate=!((F=e.message)===null||F===void 0)&&F.roomUpdate?RoomUpdate.toJSON((v=e.message)===null||v===void 0?void 0:v.roomUpdate):void 0),((C=e.message)===null||C===void 0?void 0:C.$case)==="connectionQuality"&&(Ge.connectionQuality=!((I=e.message)===null||I===void 0)&&I.connectionQuality?ConnectionQualityUpdate.toJSON((B=e.message)===null||B===void 0?void 0:B.connectionQuality):void 0),((J=e.message)===null||J===void 0?void 0:J.$case)==="streamStateUpdate"&&(Ge.streamStateUpdate=!((Y=e.message)===null||Y===void 0)&&Y.streamStateUpdate?StreamStateUpdate.toJSON((H=e.message)===null||H===void 0?void 0:H.streamStateUpdate):void 0),((_=e.message)===null||_===void 0?void 0:_.$case)==="subscribedQualityUpdate"&&(Ge.subscribedQualityUpdate=!((m=e.message)===null||m===void 0)&&m.subscribedQualityUpdate?SubscribedQualityUpdate.toJSON((b=e.message)===null||b===void 0?void 0:b.subscribedQualityUpdate):void 0),(($=e.message)===null||$===void 0?void 0:$.$case)==="subscriptionPermissionUpdate"&&(Ge.subscriptionPermissionUpdate=!((g=e.message)===null||g===void 0)&&g.subscriptionPermissionUpdate?SubscriptionPermissionUpdate.toJSON((O=e.message)===null||O===void 0?void 0:O.subscriptionPermissionUpdate):void 0),((te=e.message)===null||te===void 0?void 0:te.$case)==="refreshToken"&&(Ge.refreshToken=(Z=e.message)===null||Z===void 0?void 0:Z.refreshToken),((ae=e.message)===null||ae===void 0?void 0:ae.$case)==="trackUnpublished"&&(Ge.trackUnpublished=!((be=e.message)===null||be===void 0)&&be.trackUnpublished?TrackUnpublishedResponse.toJSON((ke=e.message)===null||ke===void 0?void 0:ke.trackUnpublished):void 0),((Ae=e.message)===null||Ae===void 0?void 0:Ae.$case)==="pong"&&(Ge.pong=Math.round((dt=e.message)===null||dt===void 0?void 0:dt.pong)),((qe=e.message)===null||qe===void 0?void 0:qe.$case)==="reconnect"&&(Ge.reconnect=!((et=e.message)===null||et===void 0)&&et.reconnect?ReconnectResponse.toJSON((Ke=e.message)===null||Ke===void 0?void 0:Ke.reconnect):void 0),((gt=e.message)===null||gt===void 0?void 0:gt.$case)==="pongResp"&&(Ge.pongResp=!((at=e.message)===null||at===void 0)&&at.pongResp?Pong.toJSON((Lt=e.message)===null||Lt===void 0?void 0:Lt.pongResp):void 0),Ge},create(e){return SignalResponse.fromPartial(e??{})},fromPartial(e){var t,n,i,a,o,c,d,u,l,h,p,y,E,x,S,k,T,L,q,U,ee,W,ie,fe,ce,ye,xe,Oe,F,v,C,I,B,J,Y,H,_,m,b,$,g,O,te,Z,ae,be,ke,Ae,dt,qe,et,Ke,gt,at,Lt,Ge,st;const Qe=createBaseSignalResponse();return((t=e.message)===null||t===void 0?void 0:t.$case)==="join"&&((n=e.message)===null||n===void 0?void 0:n.join)!==void 0&&((i=e.message)===null||i===void 0?void 0:i.join)!==null&&(Qe.message={$case:"join",join:JoinResponse.fromPartial(e.message.join)}),((a=e.message)===null||a===void 0?void 0:a.$case)==="answer"&&((o=e.message)===null||o===void 0?void 0:o.answer)!==void 0&&((c=e.message)===null||c===void 0?void 0:c.answer)!==null&&(Qe.message={$case:"answer",answer:SessionDescription.fromPartial(e.message.answer)}),((d=e.message)===null||d===void 0?void 0:d.$case)==="offer"&&((u=e.message)===null||u===void 0?void 0:u.offer)!==void 0&&((l=e.message)===null||l===void 0?void 0:l.offer)!==null&&(Qe.message={$case:"offer",offer:SessionDescription.fromPartial(e.message.offer)}),((h=e.message)===null||h===void 0?void 0:h.$case)==="trickle"&&((p=e.message)===null||p===void 0?void 0:p.trickle)!==void 0&&((y=e.message)===null||y===void 0?void 0:y.trickle)!==null&&(Qe.message={$case:"trickle",trickle:TrickleRequest.fromPartial(e.message.trickle)}),((E=e.message)===null||E===void 0?void 0:E.$case)==="update"&&((x=e.message)===null||x===void 0?void 0:x.update)!==void 0&&((S=e.message)===null||S===void 0?void 0:S.update)!==null&&(Qe.message={$case:"update",update:ParticipantUpdate.fromPartial(e.message.update)}),((k=e.message)===null||k===void 0?void 0:k.$case)==="trackPublished"&&((T=e.message)===null||T===void 0?void 0:T.trackPublished)!==void 0&&((L=e.message)===null||L===void 0?void 0:L.trackPublished)!==null&&(Qe.message={$case:"trackPublished",trackPublished:TrackPublishedResponse.fromPartial(e.message.trackPublished)}),((q=e.message)===null||q===void 0?void 0:q.$case)==="leave"&&((U=e.message)===null||U===void 0?void 0:U.leave)!==void 0&&((ee=e.message)===null||ee===void 0?void 0:ee.leave)!==null&&(Qe.message={$case:"leave",leave:LeaveRequest.fromPartial(e.message.leave)}),((W=e.message)===null||W===void 0?void 0:W.$case)==="mute"&&((ie=e.message)===null||ie===void 0?void 0:ie.mute)!==void 0&&((fe=e.message)===null||fe===void 0?void 0:fe.mute)!==null&&(Qe.message={$case:"mute",mute:MuteTrackRequest.fromPartial(e.message.mute)}),((ce=e.message)===null||ce===void 0?void 0:ce.$case)==="speakersChanged"&&((ye=e.message)===null||ye===void 0?void 0:ye.speakersChanged)!==void 0&&((xe=e.message)===null||xe===void 0?void 0:xe.speakersChanged)!==null&&(Qe.message={$case:"speakersChanged",speakersChanged:SpeakersChanged.fromPartial(e.message.speakersChanged)}),((Oe=e.message)===null||Oe===void 0?void 0:Oe.$case)==="roomUpdate"&&((F=e.message)===null||F===void 0?void 0:F.roomUpdate)!==void 0&&((v=e.message)===null||v===void 0?void 0:v.roomUpdate)!==null&&(Qe.message={$case:"roomUpdate",roomUpdate:RoomUpdate.fromPartial(e.message.roomUpdate)}),((C=e.message)===null||C===void 0?void 0:C.$case)==="connectionQuality"&&((I=e.message)===null||I===void 0?void 0:I.connectionQuality)!==void 0&&((B=e.message)===null||B===void 0?void 0:B.connectionQuality)!==null&&(Qe.message={$case:"connectionQuality",connectionQuality:ConnectionQualityUpdate.fromPartial(e.message.connectionQuality)}),((J=e.message)===null||J===void 0?void 0:J.$case)==="streamStateUpdate"&&((Y=e.message)===null||Y===void 0?void 0:Y.streamStateUpdate)!==void 0&&((H=e.message)===null||H===void 0?void 0:H.streamStateUpdate)!==null&&(Qe.message={$case:"streamStateUpdate",streamStateUpdate:StreamStateUpdate.fromPartial(e.message.streamStateUpdate)}),((_=e.message)===null||_===void 0?void 0:_.$case)==="subscribedQualityUpdate"&&((m=e.message)===null||m===void 0?void 0:m.subscribedQualityUpdate)!==void 0&&((b=e.message)===null||b===void 0?void 0:b.subscribedQualityUpdate)!==null&&(Qe.message={$case:"subscribedQualityUpdate",subscribedQualityUpdate:SubscribedQualityUpdate.fromPartial(e.message.subscribedQualityUpdate)}),(($=e.message)===null||$===void 0?void 0:$.$case)==="subscriptionPermissionUpdate"&&((g=e.message)===null||g===void 0?void 0:g.subscriptionPermissionUpdate)!==void 0&&((O=e.message)===null||O===void 0?void 0:O.subscriptionPermissionUpdate)!==null&&(Qe.message={$case:"subscriptionPermissionUpdate",subscriptionPermissionUpdate:SubscriptionPermissionUpdate.fromPartial(e.message.subscriptionPermissionUpdate)}),((te=e.message)===null||te===void 0?void 0:te.$case)==="refreshToken"&&((Z=e.message)===null||Z===void 0?void 0:Z.refreshToken)!==void 0&&((ae=e.message)===null||ae===void 0?void 0:ae.refreshToken)!==null&&(Qe.message={$case:"refreshToken",refreshToken:e.message.refreshToken}),((be=e.message)===null||be===void 0?void 0:be.$case)==="trackUnpublished"&&((ke=e.message)===null||ke===void 0?void 0:ke.trackUnpublished)!==void 0&&((Ae=e.message)===null||Ae===void 0?void 0:Ae.trackUnpublished)!==null&&(Qe.message={$case:"trackUnpublished",trackUnpublished:TrackUnpublishedResponse.fromPartial(e.message.trackUnpublished)}),((dt=e.message)===null||dt===void 0?void 0:dt.$case)==="pong"&&((qe=e.message)===null||qe===void 0?void 0:qe.pong)!==void 0&&((et=e.message)===null||et===void 0?void 0:et.pong)!==null&&(Qe.message={$case:"pong",pong:e.message.pong}),((Ke=e.message)===null||Ke===void 0?void 0:Ke.$case)==="reconnect"&&((gt=e.message)===null||gt===void 0?void 0:gt.reconnect)!==void 0&&((at=e.message)===null||at===void 0?void 0:at.reconnect)!==null&&(Qe.message={$case:"reconnect",reconnect:ReconnectResponse.fromPartial(e.message.reconnect)}),((Lt=e.message)===null||Lt===void 0?void 0:Lt.$case)==="pongResp"&&((Ge=e.message)===null||Ge===void 0?void 0:Ge.pongResp)!==void 0&&((st=e.message)===null||st===void 0?void 0:st.pongResp)!==null&&(Qe.message={$case:"pongResp",pongResp:Pong.fromPartial(e.message.pongResp)}),Qe}};function createBaseSimulcastCodec(){return{codec:"",cid:"",enableSimulcastLayers:!1}}const SimulcastCodec={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.codec!==""&&t.uint32(10).string(e.codec),e.cid!==""&&t.uint32(18).string(e.cid),e.enableSimulcastLayers===!0&&t.uint32(24).bool(e.enableSimulcastLayers),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseSimulcastCodec();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.codec=n.string();break;case 2:a.cid=n.string();break;case 3:a.enableSimulcastLayers=n.bool();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{codec:isSet$2(e.codec)?String(e.codec):"",cid:isSet$2(e.cid)?String(e.cid):"",enableSimulcastLayers:isSet$2(e.enableSimulcastLayers)?!!e.enableSimulcastLayers:!1}},toJSON(e){const t={};return e.codec!==void 0&&(t.codec=e.codec),e.cid!==void 0&&(t.cid=e.cid),e.enableSimulcastLayers!==void 0&&(t.enableSimulcastLayers=e.enableSimulcastLayers),t},create(e){return SimulcastCodec.fromPartial(e??{})},fromPartial(e){var t,n,i;const a=createBaseSimulcastCodec();return a.codec=(t=e.codec)!==null&&t!==void 0?t:"",a.cid=(n=e.cid)!==null&&n!==void 0?n:"",a.enableSimulcastLayers=(i=e.enableSimulcastLayers)!==null&&i!==void 0?i:!1,a}};function createBaseAddTrackRequest(){return{cid:"",name:"",type:0,width:0,height:0,muted:!1,disableDtx:!1,source:0,layers:[],simulcastCodecs:[],sid:"",stereo:!1,disableRed:!1,encryption:0}}const AddTrackRequest={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();e.cid!==""&&t.uint32(10).string(e.cid),e.name!==""&&t.uint32(18).string(e.name),e.type!==0&&t.uint32(24).int32(e.type),e.width!==0&&t.uint32(32).uint32(e.width),e.height!==0&&t.uint32(40).uint32(e.height),e.muted===!0&&t.uint32(48).bool(e.muted),e.disableDtx===!0&&t.uint32(56).bool(e.disableDtx),e.source!==0&&t.uint32(64).int32(e.source);for(const n of e.layers)VideoLayer.encode(n,t.uint32(74).fork()).ldelim();for(const n of e.simulcastCodecs)SimulcastCodec.encode(n,t.uint32(82).fork()).ldelim();return e.sid!==""&&t.uint32(90).string(e.sid),e.stereo===!0&&t.uint32(96).bool(e.stereo),e.disableRed===!0&&t.uint32(104).bool(e.disableRed),e.encryption!==0&&t.uint32(112).int32(e.encryption),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseAddTrackRequest();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.cid=n.string();break;case 2:a.name=n.string();break;case 3:a.type=n.int32();break;case 4:a.width=n.uint32();break;case 5:a.height=n.uint32();break;case 6:a.muted=n.bool();break;case 7:a.disableDtx=n.bool();break;case 8:a.source=n.int32();break;case 9:a.layers.push(VideoLayer.decode(n,n.uint32()));break;case 10:a.simulcastCodecs.push(SimulcastCodec.decode(n,n.uint32()));break;case 11:a.sid=n.string();break;case 12:a.stereo=n.bool();break;case 13:a.disableRed=n.bool();break;case 14:a.encryption=n.int32();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{cid:isSet$2(e.cid)?String(e.cid):"",name:isSet$2(e.name)?String(e.name):"",type:isSet$2(e.type)?trackTypeFromJSON(e.type):0,width:isSet$2(e.width)?Number(e.width):0,height:isSet$2(e.height)?Number(e.height):0,muted:isSet$2(e.muted)?!!e.muted:!1,disableDtx:isSet$2(e.disableDtx)?!!e.disableDtx:!1,source:isSet$2(e.source)?trackSourceFromJSON(e.source):0,layers:Array.isArray(e==null?void 0:e.layers)?e.layers.map(t=>VideoLayer.fromJSON(t)):[],simulcastCodecs:Array.isArray(e==null?void 0:e.simulcastCodecs)?e.simulcastCodecs.map(t=>SimulcastCodec.fromJSON(t)):[],sid:isSet$2(e.sid)?String(e.sid):"",stereo:isSet$2(e.stereo)?!!e.stereo:!1,disableRed:isSet$2(e.disableRed)?!!e.disableRed:!1,encryption:isSet$2(e.encryption)?encryption_TypeFromJSON(e.encryption):0}},toJSON(e){const t={};return e.cid!==void 0&&(t.cid=e.cid),e.name!==void 0&&(t.name=e.name),e.type!==void 0&&(t.type=trackTypeToJSON(e.type)),e.width!==void 0&&(t.width=Math.round(e.width)),e.height!==void 0&&(t.height=Math.round(e.height)),e.muted!==void 0&&(t.muted=e.muted),e.disableDtx!==void 0&&(t.disableDtx=e.disableDtx),e.source!==void 0&&(t.source=trackSourceToJSON(e.source)),e.layers?t.layers=e.layers.map(n=>n?VideoLayer.toJSON(n):void 0):t.layers=[],e.simulcastCodecs?t.simulcastCodecs=e.simulcastCodecs.map(n=>n?SimulcastCodec.toJSON(n):void 0):t.simulcastCodecs=[],e.sid!==void 0&&(t.sid=e.sid),e.stereo!==void 0&&(t.stereo=e.stereo),e.disableRed!==void 0&&(t.disableRed=e.disableRed),e.encryption!==void 0&&(t.encryption=encryption_TypeToJSON(e.encryption)),t},create(e){return AddTrackRequest.fromPartial(e??{})},fromPartial(e){var t,n,i,a,o,c,d,u,l,h,p,y,E,x;const S=createBaseAddTrackRequest();return S.cid=(t=e.cid)!==null&&t!==void 0?t:"",S.name=(n=e.name)!==null&&n!==void 0?n:"",S.type=(i=e.type)!==null&&i!==void 0?i:0,S.width=(a=e.width)!==null&&a!==void 0?a:0,S.height=(o=e.height)!==null&&o!==void 0?o:0,S.muted=(c=e.muted)!==null&&c!==void 0?c:!1,S.disableDtx=(d=e.disableDtx)!==null&&d!==void 0?d:!1,S.source=(u=e.source)!==null&&u!==void 0?u:0,S.layers=((l=e.layers)===null||l===void 0?void 0:l.map(k=>VideoLayer.fromPartial(k)))||[],S.simulcastCodecs=((h=e.simulcastCodecs)===null||h===void 0?void 0:h.map(k=>SimulcastCodec.fromPartial(k)))||[],S.sid=(p=e.sid)!==null&&p!==void 0?p:"",S.stereo=(y=e.stereo)!==null&&y!==void 0?y:!1,S.disableRed=(E=e.disableRed)!==null&&E!==void 0?E:!1,S.encryption=(x=e.encryption)!==null&&x!==void 0?x:0,S}};function createBaseTrickleRequest(){return{candidateInit:"",target:0}}const TrickleRequest={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.candidateInit!==""&&t.uint32(10).string(e.candidateInit),e.target!==0&&t.uint32(16).int32(e.target),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseTrickleRequest();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.candidateInit=n.string();break;case 2:a.target=n.int32();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{candidateInit:isSet$2(e.candidateInit)?String(e.candidateInit):"",target:isSet$2(e.target)?signalTargetFromJSON(e.target):0}},toJSON(e){const t={};return e.candidateInit!==void 0&&(t.candidateInit=e.candidateInit),e.target!==void 0&&(t.target=signalTargetToJSON(e.target)),t},create(e){return TrickleRequest.fromPartial(e??{})},fromPartial(e){var t,n;const i=createBaseTrickleRequest();return i.candidateInit=(t=e.candidateInit)!==null&&t!==void 0?t:"",i.target=(n=e.target)!==null&&n!==void 0?n:0,i}};function createBaseMuteTrackRequest(){return{sid:"",muted:!1}}const MuteTrackRequest={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.sid!==""&&t.uint32(10).string(e.sid),e.muted===!0&&t.uint32(16).bool(e.muted),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseMuteTrackRequest();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.sid=n.string();break;case 2:a.muted=n.bool();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{sid:isSet$2(e.sid)?String(e.sid):"",muted:isSet$2(e.muted)?!!e.muted:!1}},toJSON(e){const t={};return e.sid!==void 0&&(t.sid=e.sid),e.muted!==void 0&&(t.muted=e.muted),t},create(e){return MuteTrackRequest.fromPartial(e??{})},fromPartial(e){var t,n;const i=createBaseMuteTrackRequest();return i.sid=(t=e.sid)!==null&&t!==void 0?t:"",i.muted=(n=e.muted)!==null&&n!==void 0?n:!1,i}};function createBaseJoinResponse(){return{room:void 0,participant:void 0,otherParticipants:[],serverVersion:"",iceServers:[],subscriberPrimary:!1,alternativeUrl:"",clientConfiguration:void 0,serverRegion:"",pingTimeout:0,pingInterval:0,serverInfo:void 0}}const JoinResponse={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();e.room!==void 0&&Room$1.encode(e.room,t.uint32(10).fork()).ldelim(),e.participant!==void 0&&ParticipantInfo.encode(e.participant,t.uint32(18).fork()).ldelim();for(const n of e.otherParticipants)ParticipantInfo.encode(n,t.uint32(26).fork()).ldelim();e.serverVersion!==""&&t.uint32(34).string(e.serverVersion);for(const n of e.iceServers)ICEServer.encode(n,t.uint32(42).fork()).ldelim();return e.subscriberPrimary===!0&&t.uint32(48).bool(e.subscriberPrimary),e.alternativeUrl!==""&&t.uint32(58).string(e.alternativeUrl),e.clientConfiguration!==void 0&&ClientConfiguration.encode(e.clientConfiguration,t.uint32(66).fork()).ldelim(),e.serverRegion!==""&&t.uint32(74).string(e.serverRegion),e.pingTimeout!==0&&t.uint32(80).int32(e.pingTimeout),e.pingInterval!==0&&t.uint32(88).int32(e.pingInterval),e.serverInfo!==void 0&&ServerInfo.encode(e.serverInfo,t.uint32(98).fork()).ldelim(),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseJoinResponse();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.room=Room$1.decode(n,n.uint32());break;case 2:a.participant=ParticipantInfo.decode(n,n.uint32());break;case 3:a.otherParticipants.push(ParticipantInfo.decode(n,n.uint32()));break;case 4:a.serverVersion=n.string();break;case 5:a.iceServers.push(ICEServer.decode(n,n.uint32()));break;case 6:a.subscriberPrimary=n.bool();break;case 7:a.alternativeUrl=n.string();break;case 8:a.clientConfiguration=ClientConfiguration.decode(n,n.uint32());break;case 9:a.serverRegion=n.string();break;case 10:a.pingTimeout=n.int32();break;case 11:a.pingInterval=n.int32();break;case 12:a.serverInfo=ServerInfo.decode(n,n.uint32());break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{room:isSet$2(e.room)?Room$1.fromJSON(e.room):void 0,participant:isSet$2(e.participant)?ParticipantInfo.fromJSON(e.participant):void 0,otherParticipants:Array.isArray(e==null?void 0:e.otherParticipants)?e.otherParticipants.map(t=>ParticipantInfo.fromJSON(t)):[],serverVersion:isSet$2(e.serverVersion)?String(e.serverVersion):"",iceServers:Array.isArray(e==null?void 0:e.iceServers)?e.iceServers.map(t=>ICEServer.fromJSON(t)):[],subscriberPrimary:isSet$2(e.subscriberPrimary)?!!e.subscriberPrimary:!1,alternativeUrl:isSet$2(e.alternativeUrl)?String(e.alternativeUrl):"",clientConfiguration:isSet$2(e.clientConfiguration)?ClientConfiguration.fromJSON(e.clientConfiguration):void 0,serverRegion:isSet$2(e.serverRegion)?String(e.serverRegion):"",pingTimeout:isSet$2(e.pingTimeout)?Number(e.pingTimeout):0,pingInterval:isSet$2(e.pingInterval)?Number(e.pingInterval):0,serverInfo:isSet$2(e.serverInfo)?ServerInfo.fromJSON(e.serverInfo):void 0}},toJSON(e){const t={};return e.room!==void 0&&(t.room=e.room?Room$1.toJSON(e.room):void 0),e.participant!==void 0&&(t.participant=e.participant?ParticipantInfo.toJSON(e.participant):void 0),e.otherParticipants?t.otherParticipants=e.otherParticipants.map(n=>n?ParticipantInfo.toJSON(n):void 0):t.otherParticipants=[],e.serverVersion!==void 0&&(t.serverVersion=e.serverVersion),e.iceServers?t.iceServers=e.iceServers.map(n=>n?ICEServer.toJSON(n):void 0):t.iceServers=[],e.subscriberPrimary!==void 0&&(t.subscriberPrimary=e.subscriberPrimary),e.alternativeUrl!==void 0&&(t.alternativeUrl=e.alternativeUrl),e.clientConfiguration!==void 0&&(t.clientConfiguration=e.clientConfiguration?ClientConfiguration.toJSON(e.clientConfiguration):void 0),e.serverRegion!==void 0&&(t.serverRegion=e.serverRegion),e.pingTimeout!==void 0&&(t.pingTimeout=Math.round(e.pingTimeout)),e.pingInterval!==void 0&&(t.pingInterval=Math.round(e.pingInterval)),e.serverInfo!==void 0&&(t.serverInfo=e.serverInfo?ServerInfo.toJSON(e.serverInfo):void 0),t},create(e){return JoinResponse.fromPartial(e??{})},fromPartial(e){var t,n,i,a,o,c,d,u;const l=createBaseJoinResponse();return l.room=e.room!==void 0&&e.room!==null?Room$1.fromPartial(e.room):void 0,l.participant=e.participant!==void 0&&e.participant!==null?ParticipantInfo.fromPartial(e.participant):void 0,l.otherParticipants=((t=e.otherParticipants)===null||t===void 0?void 0:t.map(h=>ParticipantInfo.fromPartial(h)))||[],l.serverVersion=(n=e.serverVersion)!==null&&n!==void 0?n:"",l.iceServers=((i=e.iceServers)===null||i===void 0?void 0:i.map(h=>ICEServer.fromPartial(h)))||[],l.subscriberPrimary=(a=e.subscriberPrimary)!==null&&a!==void 0?a:!1,l.alternativeUrl=(o=e.alternativeUrl)!==null&&o!==void 0?o:"",l.clientConfiguration=e.clientConfiguration!==void 0&&e.clientConfiguration!==null?ClientConfiguration.fromPartial(e.clientConfiguration):void 0,l.serverRegion=(c=e.serverRegion)!==null&&c!==void 0?c:"",l.pingTimeout=(d=e.pingTimeout)!==null&&d!==void 0?d:0,l.pingInterval=(u=e.pingInterval)!==null&&u!==void 0?u:0,l.serverInfo=e.serverInfo!==void 0&&e.serverInfo!==null?ServerInfo.fromPartial(e.serverInfo):void 0,l}};function createBaseReconnectResponse(){return{iceServers:[],clientConfiguration:void 0}}const ReconnectResponse={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();for(const n of e.iceServers)ICEServer.encode(n,t.uint32(10).fork()).ldelim();return e.clientConfiguration!==void 0&&ClientConfiguration.encode(e.clientConfiguration,t.uint32(18).fork()).ldelim(),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseReconnectResponse();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.iceServers.push(ICEServer.decode(n,n.uint32()));break;case 2:a.clientConfiguration=ClientConfiguration.decode(n,n.uint32());break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{iceServers:Array.isArray(e==null?void 0:e.iceServers)?e.iceServers.map(t=>ICEServer.fromJSON(t)):[],clientConfiguration:isSet$2(e.clientConfiguration)?ClientConfiguration.fromJSON(e.clientConfiguration):void 0}},toJSON(e){const t={};return e.iceServers?t.iceServers=e.iceServers.map(n=>n?ICEServer.toJSON(n):void 0):t.iceServers=[],e.clientConfiguration!==void 0&&(t.clientConfiguration=e.clientConfiguration?ClientConfiguration.toJSON(e.clientConfiguration):void 0),t},create(e){return ReconnectResponse.fromPartial(e??{})},fromPartial(e){var t;const n=createBaseReconnectResponse();return n.iceServers=((t=e.iceServers)===null||t===void 0?void 0:t.map(i=>ICEServer.fromPartial(i)))||[],n.clientConfiguration=e.clientConfiguration!==void 0&&e.clientConfiguration!==null?ClientConfiguration.fromPartial(e.clientConfiguration):void 0,n}};function createBaseTrackPublishedResponse(){return{cid:"",track:void 0}}const TrackPublishedResponse={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.cid!==""&&t.uint32(10).string(e.cid),e.track!==void 0&&TrackInfo.encode(e.track,t.uint32(18).fork()).ldelim(),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseTrackPublishedResponse();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.cid=n.string();break;case 2:a.track=TrackInfo.decode(n,n.uint32());break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{cid:isSet$2(e.cid)?String(e.cid):"",track:isSet$2(e.track)?TrackInfo.fromJSON(e.track):void 0}},toJSON(e){const t={};return e.cid!==void 0&&(t.cid=e.cid),e.track!==void 0&&(t.track=e.track?TrackInfo.toJSON(e.track):void 0),t},create(e){return TrackPublishedResponse.fromPartial(e??{})},fromPartial(e){var t;const n=createBaseTrackPublishedResponse();return n.cid=(t=e.cid)!==null&&t!==void 0?t:"",n.track=e.track!==void 0&&e.track!==null?TrackInfo.fromPartial(e.track):void 0,n}};function createBaseTrackUnpublishedResponse(){return{trackSid:""}}const TrackUnpublishedResponse={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.trackSid!==""&&t.uint32(10).string(e.trackSid),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseTrackUnpublishedResponse();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.trackSid=n.string();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{trackSid:isSet$2(e.trackSid)?String(e.trackSid):""}},toJSON(e){const t={};return e.trackSid!==void 0&&(t.trackSid=e.trackSid),t},create(e){return TrackUnpublishedResponse.fromPartial(e??{})},fromPartial(e){var t;const n=createBaseTrackUnpublishedResponse();return n.trackSid=(t=e.trackSid)!==null&&t!==void 0?t:"",n}};function createBaseSessionDescription(){return{type:"",sdp:""}}const SessionDescription={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.type!==""&&t.uint32(10).string(e.type),e.sdp!==""&&t.uint32(18).string(e.sdp),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseSessionDescription();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.type=n.string();break;case 2:a.sdp=n.string();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{type:isSet$2(e.type)?String(e.type):"",sdp:isSet$2(e.sdp)?String(e.sdp):""}},toJSON(e){const t={};return e.type!==void 0&&(t.type=e.type),e.sdp!==void 0&&(t.sdp=e.sdp),t},create(e){return SessionDescription.fromPartial(e??{})},fromPartial(e){var t,n;const i=createBaseSessionDescription();return i.type=(t=e.type)!==null&&t!==void 0?t:"",i.sdp=(n=e.sdp)!==null&&n!==void 0?n:"",i}};function createBaseParticipantUpdate(){return{participants:[]}}const ParticipantUpdate={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();for(const n of e.participants)ParticipantInfo.encode(n,t.uint32(10).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseParticipantUpdate();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.participants.push(ParticipantInfo.decode(n,n.uint32()));break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{participants:Array.isArray(e==null?void 0:e.participants)?e.participants.map(t=>ParticipantInfo.fromJSON(t)):[]}},toJSON(e){const t={};return e.participants?t.participants=e.participants.map(n=>n?ParticipantInfo.toJSON(n):void 0):t.participants=[],t},create(e){return ParticipantUpdate.fromPartial(e??{})},fromPartial(e){var t;const n=createBaseParticipantUpdate();return n.participants=((t=e.participants)===null||t===void 0?void 0:t.map(i=>ParticipantInfo.fromPartial(i)))||[],n}};function createBaseUpdateSubscription(){return{trackSids:[],subscribe:!1,participantTracks:[]}}const UpdateSubscription={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();for(const n of e.trackSids)t.uint32(10).string(n);e.subscribe===!0&&t.uint32(16).bool(e.subscribe);for(const n of e.participantTracks)ParticipantTracks.encode(n,t.uint32(26).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseUpdateSubscription();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.trackSids.push(n.string());break;case 2:a.subscribe=n.bool();break;case 3:a.participantTracks.push(ParticipantTracks.decode(n,n.uint32()));break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{trackSids:Array.isArray(e==null?void 0:e.trackSids)?e.trackSids.map(t=>String(t)):[],subscribe:isSet$2(e.subscribe)?!!e.subscribe:!1,participantTracks:Array.isArray(e==null?void 0:e.participantTracks)?e.participantTracks.map(t=>ParticipantTracks.fromJSON(t)):[]}},toJSON(e){const t={};return e.trackSids?t.trackSids=e.trackSids.map(n=>n):t.trackSids=[],e.subscribe!==void 0&&(t.subscribe=e.subscribe),e.participantTracks?t.participantTracks=e.participantTracks.map(n=>n?ParticipantTracks.toJSON(n):void 0):t.participantTracks=[],t},create(e){return UpdateSubscription.fromPartial(e??{})},fromPartial(e){var t,n,i;const a=createBaseUpdateSubscription();return a.trackSids=((t=e.trackSids)===null||t===void 0?void 0:t.map(o=>o))||[],a.subscribe=(n=e.subscribe)!==null&&n!==void 0?n:!1,a.participantTracks=((i=e.participantTracks)===null||i===void 0?void 0:i.map(o=>ParticipantTracks.fromPartial(o)))||[],a}};function createBaseUpdateTrackSettings(){return{trackSids:[],disabled:!1,quality:0,width:0,height:0,fps:0,priority:0}}const UpdateTrackSettings={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();for(const n of e.trackSids)t.uint32(10).string(n);return e.disabled===!0&&t.uint32(24).bool(e.disabled),e.quality!==0&&t.uint32(32).int32(e.quality),e.width!==0&&t.uint32(40).uint32(e.width),e.height!==0&&t.uint32(48).uint32(e.height),e.fps!==0&&t.uint32(56).uint32(e.fps),e.priority!==0&&t.uint32(64).uint32(e.priority),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseUpdateTrackSettings();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.trackSids.push(n.string());break;case 3:a.disabled=n.bool();break;case 4:a.quality=n.int32();break;case 5:a.width=n.uint32();break;case 6:a.height=n.uint32();break;case 7:a.fps=n.uint32();break;case 8:a.priority=n.uint32();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{trackSids:Array.isArray(e==null?void 0:e.trackSids)?e.trackSids.map(t=>String(t)):[],disabled:isSet$2(e.disabled)?!!e.disabled:!1,quality:isSet$2(e.quality)?videoQualityFromJSON(e.quality):0,width:isSet$2(e.width)?Number(e.width):0,height:isSet$2(e.height)?Number(e.height):0,fps:isSet$2(e.fps)?Number(e.fps):0,priority:isSet$2(e.priority)?Number(e.priority):0}},toJSON(e){const t={};return e.trackSids?t.trackSids=e.trackSids.map(n=>n):t.trackSids=[],e.disabled!==void 0&&(t.disabled=e.disabled),e.quality!==void 0&&(t.quality=videoQualityToJSON(e.quality)),e.width!==void 0&&(t.width=Math.round(e.width)),e.height!==void 0&&(t.height=Math.round(e.height)),e.fps!==void 0&&(t.fps=Math.round(e.fps)),e.priority!==void 0&&(t.priority=Math.round(e.priority)),t},create(e){return UpdateTrackSettings.fromPartial(e??{})},fromPartial(e){var t,n,i,a,o,c,d;const u=createBaseUpdateTrackSettings();return u.trackSids=((t=e.trackSids)===null||t===void 0?void 0:t.map(l=>l))||[],u.disabled=(n=e.disabled)!==null&&n!==void 0?n:!1,u.quality=(i=e.quality)!==null&&i!==void 0?i:0,u.width=(a=e.width)!==null&&a!==void 0?a:0,u.height=(o=e.height)!==null&&o!==void 0?o:0,u.fps=(c=e.fps)!==null&&c!==void 0?c:0,u.priority=(d=e.priority)!==null&&d!==void 0?d:0,u}};function createBaseLeaveRequest(){return{canReconnect:!1,reason:0}}const LeaveRequest={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.canReconnect===!0&&t.uint32(8).bool(e.canReconnect),e.reason!==0&&t.uint32(16).int32(e.reason),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseLeaveRequest();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.canReconnect=n.bool();break;case 2:a.reason=n.int32();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{canReconnect:isSet$2(e.canReconnect)?!!e.canReconnect:!1,reason:isSet$2(e.reason)?disconnectReasonFromJSON(e.reason):0}},toJSON(e){const t={};return e.canReconnect!==void 0&&(t.canReconnect=e.canReconnect),e.reason!==void 0&&(t.reason=disconnectReasonToJSON(e.reason)),t},create(e){return LeaveRequest.fromPartial(e??{})},fromPartial(e){var t,n;const i=createBaseLeaveRequest();return i.canReconnect=(t=e.canReconnect)!==null&&t!==void 0?t:!1,i.reason=(n=e.reason)!==null&&n!==void 0?n:0,i}};function createBaseUpdateVideoLayers(){return{trackSid:"",layers:[]}}const UpdateVideoLayers={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();e.trackSid!==""&&t.uint32(10).string(e.trackSid);for(const n of e.layers)VideoLayer.encode(n,t.uint32(18).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseUpdateVideoLayers();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.trackSid=n.string();break;case 2:a.layers.push(VideoLayer.decode(n,n.uint32()));break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{trackSid:isSet$2(e.trackSid)?String(e.trackSid):"",layers:Array.isArray(e==null?void 0:e.layers)?e.layers.map(t=>VideoLayer.fromJSON(t)):[]}},toJSON(e){const t={};return e.trackSid!==void 0&&(t.trackSid=e.trackSid),e.layers?t.layers=e.layers.map(n=>n?VideoLayer.toJSON(n):void 0):t.layers=[],t},create(e){return UpdateVideoLayers.fromPartial(e??{})},fromPartial(e){var t,n;const i=createBaseUpdateVideoLayers();return i.trackSid=(t=e.trackSid)!==null&&t!==void 0?t:"",i.layers=((n=e.layers)===null||n===void 0?void 0:n.map(a=>VideoLayer.fromPartial(a)))||[],i}};function createBaseUpdateParticipantMetadata(){return{metadata:""}}const UpdateParticipantMetadata={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.metadata!==""&&t.uint32(10).string(e.metadata),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseUpdateParticipantMetadata();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.metadata=n.string();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{metadata:isSet$2(e.metadata)?String(e.metadata):""}},toJSON(e){const t={};return e.metadata!==void 0&&(t.metadata=e.metadata),t},create(e){return UpdateParticipantMetadata.fromPartial(e??{})},fromPartial(e){var t;const n=createBaseUpdateParticipantMetadata();return n.metadata=(t=e.metadata)!==null&&t!==void 0?t:"",n}};function createBaseICEServer(){return{urls:[],username:"",credential:""}}const ICEServer={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();for(const n of e.urls)t.uint32(10).string(n);return e.username!==""&&t.uint32(18).string(e.username),e.credential!==""&&t.uint32(26).string(e.credential),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseICEServer();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.urls.push(n.string());break;case 2:a.username=n.string();break;case 3:a.credential=n.string();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{urls:Array.isArray(e==null?void 0:e.urls)?e.urls.map(t=>String(t)):[],username:isSet$2(e.username)?String(e.username):"",credential:isSet$2(e.credential)?String(e.credential):""}},toJSON(e){const t={};return e.urls?t.urls=e.urls.map(n=>n):t.urls=[],e.username!==void 0&&(t.username=e.username),e.credential!==void 0&&(t.credential=e.credential),t},create(e){return ICEServer.fromPartial(e??{})},fromPartial(e){var t,n,i;const a=createBaseICEServer();return a.urls=((t=e.urls)===null||t===void 0?void 0:t.map(o=>o))||[],a.username=(n=e.username)!==null&&n!==void 0?n:"",a.credential=(i=e.credential)!==null&&i!==void 0?i:"",a}};function createBaseSpeakersChanged(){return{speakers:[]}}const SpeakersChanged={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();for(const n of e.speakers)SpeakerInfo.encode(n,t.uint32(10).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseSpeakersChanged();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.speakers.push(SpeakerInfo.decode(n,n.uint32()));break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{speakers:Array.isArray(e==null?void 0:e.speakers)?e.speakers.map(t=>SpeakerInfo.fromJSON(t)):[]}},toJSON(e){const t={};return e.speakers?t.speakers=e.speakers.map(n=>n?SpeakerInfo.toJSON(n):void 0):t.speakers=[],t},create(e){return SpeakersChanged.fromPartial(e??{})},fromPartial(e){var t;const n=createBaseSpeakersChanged();return n.speakers=((t=e.speakers)===null||t===void 0?void 0:t.map(i=>SpeakerInfo.fromPartial(i)))||[],n}};function createBaseRoomUpdate(){return{room:void 0}}const RoomUpdate={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.room!==void 0&&Room$1.encode(e.room,t.uint32(10).fork()).ldelim(),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseRoomUpdate();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.room=Room$1.decode(n,n.uint32());break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{room:isSet$2(e.room)?Room$1.fromJSON(e.room):void 0}},toJSON(e){const t={};return e.room!==void 0&&(t.room=e.room?Room$1.toJSON(e.room):void 0),t},create(e){return RoomUpdate.fromPartial(e??{})},fromPartial(e){const t=createBaseRoomUpdate();return t.room=e.room!==void 0&&e.room!==null?Room$1.fromPartial(e.room):void 0,t}};function createBaseConnectionQualityInfo(){return{participantSid:"",quality:0,score:0}}const ConnectionQualityInfo={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.participantSid!==""&&t.uint32(10).string(e.participantSid),e.quality!==0&&t.uint32(16).int32(e.quality),e.score!==0&&t.uint32(29).float(e.score),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseConnectionQualityInfo();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.participantSid=n.string();break;case 2:a.quality=n.int32();break;case 3:a.score=n.float();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{participantSid:isSet$2(e.participantSid)?String(e.participantSid):"",quality:isSet$2(e.quality)?connectionQualityFromJSON(e.quality):0,score:isSet$2(e.score)?Number(e.score):0}},toJSON(e){const t={};return e.participantSid!==void 0&&(t.participantSid=e.participantSid),e.quality!==void 0&&(t.quality=connectionQualityToJSON(e.quality)),e.score!==void 0&&(t.score=e.score),t},create(e){return ConnectionQualityInfo.fromPartial(e??{})},fromPartial(e){var t,n,i;const a=createBaseConnectionQualityInfo();return a.participantSid=(t=e.participantSid)!==null&&t!==void 0?t:"",a.quality=(n=e.quality)!==null&&n!==void 0?n:0,a.score=(i=e.score)!==null&&i!==void 0?i:0,a}};function createBaseConnectionQualityUpdate(){return{updates:[]}}const ConnectionQualityUpdate={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();for(const n of e.updates)ConnectionQualityInfo.encode(n,t.uint32(10).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseConnectionQualityUpdate();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.updates.push(ConnectionQualityInfo.decode(n,n.uint32()));break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{updates:Array.isArray(e==null?void 0:e.updates)?e.updates.map(t=>ConnectionQualityInfo.fromJSON(t)):[]}},toJSON(e){const t={};return e.updates?t.updates=e.updates.map(n=>n?ConnectionQualityInfo.toJSON(n):void 0):t.updates=[],t},create(e){return ConnectionQualityUpdate.fromPartial(e??{})},fromPartial(e){var t;const n=createBaseConnectionQualityUpdate();return n.updates=((t=e.updates)===null||t===void 0?void 0:t.map(i=>ConnectionQualityInfo.fromPartial(i)))||[],n}};function createBaseStreamStateInfo(){return{participantSid:"",trackSid:"",state:0}}const StreamStateInfo={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.participantSid!==""&&t.uint32(10).string(e.participantSid),e.trackSid!==""&&t.uint32(18).string(e.trackSid),e.state!==0&&t.uint32(24).int32(e.state),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseStreamStateInfo();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.participantSid=n.string();break;case 2:a.trackSid=n.string();break;case 3:a.state=n.int32();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{participantSid:isSet$2(e.participantSid)?String(e.participantSid):"",trackSid:isSet$2(e.trackSid)?String(e.trackSid):"",state:isSet$2(e.state)?streamStateFromJSON(e.state):0}},toJSON(e){const t={};return e.participantSid!==void 0&&(t.participantSid=e.participantSid),e.trackSid!==void 0&&(t.trackSid=e.trackSid),e.state!==void 0&&(t.state=streamStateToJSON(e.state)),t},create(e){return StreamStateInfo.fromPartial(e??{})},fromPartial(e){var t,n,i;const a=createBaseStreamStateInfo();return a.participantSid=(t=e.participantSid)!==null&&t!==void 0?t:"",a.trackSid=(n=e.trackSid)!==null&&n!==void 0?n:"",a.state=(i=e.state)!==null&&i!==void 0?i:0,a}};function createBaseStreamStateUpdate(){return{streamStates:[]}}const StreamStateUpdate={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();for(const n of e.streamStates)StreamStateInfo.encode(n,t.uint32(10).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseStreamStateUpdate();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.streamStates.push(StreamStateInfo.decode(n,n.uint32()));break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{streamStates:Array.isArray(e==null?void 0:e.streamStates)?e.streamStates.map(t=>StreamStateInfo.fromJSON(t)):[]}},toJSON(e){const t={};return e.streamStates?t.streamStates=e.streamStates.map(n=>n?StreamStateInfo.toJSON(n):void 0):t.streamStates=[],t},create(e){return StreamStateUpdate.fromPartial(e??{})},fromPartial(e){var t;const n=createBaseStreamStateUpdate();return n.streamStates=((t=e.streamStates)===null||t===void 0?void 0:t.map(i=>StreamStateInfo.fromPartial(i)))||[],n}};function createBaseSubscribedQuality(){return{quality:0,enabled:!1}}const SubscribedQuality={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.quality!==0&&t.uint32(8).int32(e.quality),e.enabled===!0&&t.uint32(16).bool(e.enabled),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseSubscribedQuality();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.quality=n.int32();break;case 2:a.enabled=n.bool();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{quality:isSet$2(e.quality)?videoQualityFromJSON(e.quality):0,enabled:isSet$2(e.enabled)?!!e.enabled:!1}},toJSON(e){const t={};return e.quality!==void 0&&(t.quality=videoQualityToJSON(e.quality)),e.enabled!==void 0&&(t.enabled=e.enabled),t},create(e){return SubscribedQuality.fromPartial(e??{})},fromPartial(e){var t,n;const i=createBaseSubscribedQuality();return i.quality=(t=e.quality)!==null&&t!==void 0?t:0,i.enabled=(n=e.enabled)!==null&&n!==void 0?n:!1,i}};function createBaseSubscribedCodec(){return{codec:"",qualities:[]}}const SubscribedCodec={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();e.codec!==""&&t.uint32(10).string(e.codec);for(const n of e.qualities)SubscribedQuality.encode(n,t.uint32(18).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseSubscribedCodec();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.codec=n.string();break;case 2:a.qualities.push(SubscribedQuality.decode(n,n.uint32()));break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{codec:isSet$2(e.codec)?String(e.codec):"",qualities:Array.isArray(e==null?void 0:e.qualities)?e.qualities.map(t=>SubscribedQuality.fromJSON(t)):[]}},toJSON(e){const t={};return e.codec!==void 0&&(t.codec=e.codec),e.qualities?t.qualities=e.qualities.map(n=>n?SubscribedQuality.toJSON(n):void 0):t.qualities=[],t},create(e){return SubscribedCodec.fromPartial(e??{})},fromPartial(e){var t,n;const i=createBaseSubscribedCodec();return i.codec=(t=e.codec)!==null&&t!==void 0?t:"",i.qualities=((n=e.qualities)===null||n===void 0?void 0:n.map(a=>SubscribedQuality.fromPartial(a)))||[],i}};function createBaseSubscribedQualityUpdate(){return{trackSid:"",subscribedQualities:[],subscribedCodecs:[]}}const SubscribedQualityUpdate={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();e.trackSid!==""&&t.uint32(10).string(e.trackSid);for(const n of e.subscribedQualities)SubscribedQuality.encode(n,t.uint32(18).fork()).ldelim();for(const n of e.subscribedCodecs)SubscribedCodec.encode(n,t.uint32(26).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseSubscribedQualityUpdate();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.trackSid=n.string();break;case 2:a.subscribedQualities.push(SubscribedQuality.decode(n,n.uint32()));break;case 3:a.subscribedCodecs.push(SubscribedCodec.decode(n,n.uint32()));break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{trackSid:isSet$2(e.trackSid)?String(e.trackSid):"",subscribedQualities:Array.isArray(e==null?void 0:e.subscribedQualities)?e.subscribedQualities.map(t=>SubscribedQuality.fromJSON(t)):[],subscribedCodecs:Array.isArray(e==null?void 0:e.subscribedCodecs)?e.subscribedCodecs.map(t=>SubscribedCodec.fromJSON(t)):[]}},toJSON(e){const t={};return e.trackSid!==void 0&&(t.trackSid=e.trackSid),e.subscribedQualities?t.subscribedQualities=e.subscribedQualities.map(n=>n?SubscribedQuality.toJSON(n):void 0):t.subscribedQualities=[],e.subscribedCodecs?t.subscribedCodecs=e.subscribedCodecs.map(n=>n?SubscribedCodec.toJSON(n):void 0):t.subscribedCodecs=[],t},create(e){return SubscribedQualityUpdate.fromPartial(e??{})},fromPartial(e){var t,n,i;const a=createBaseSubscribedQualityUpdate();return a.trackSid=(t=e.trackSid)!==null&&t!==void 0?t:"",a.subscribedQualities=((n=e.subscribedQualities)===null||n===void 0?void 0:n.map(o=>SubscribedQuality.fromPartial(o)))||[],a.subscribedCodecs=((i=e.subscribedCodecs)===null||i===void 0?void 0:i.map(o=>SubscribedCodec.fromPartial(o)))||[],a}};function createBaseTrackPermission(){return{participantSid:"",allTracks:!1,trackSids:[],participantIdentity:""}}const TrackPermission={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();e.participantSid!==""&&t.uint32(10).string(e.participantSid),e.allTracks===!0&&t.uint32(16).bool(e.allTracks);for(const n of e.trackSids)t.uint32(26).string(n);return e.participantIdentity!==""&&t.uint32(34).string(e.participantIdentity),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseTrackPermission();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.participantSid=n.string();break;case 2:a.allTracks=n.bool();break;case 3:a.trackSids.push(n.string());break;case 4:a.participantIdentity=n.string();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{participantSid:isSet$2(e.participantSid)?String(e.participantSid):"",allTracks:isSet$2(e.allTracks)?!!e.allTracks:!1,trackSids:Array.isArray(e==null?void 0:e.trackSids)?e.trackSids.map(t=>String(t)):[],participantIdentity:isSet$2(e.participantIdentity)?String(e.participantIdentity):""}},toJSON(e){const t={};return e.participantSid!==void 0&&(t.participantSid=e.participantSid),e.allTracks!==void 0&&(t.allTracks=e.allTracks),e.trackSids?t.trackSids=e.trackSids.map(n=>n):t.trackSids=[],e.participantIdentity!==void 0&&(t.participantIdentity=e.participantIdentity),t},create(e){return TrackPermission.fromPartial(e??{})},fromPartial(e){var t,n,i,a;const o=createBaseTrackPermission();return o.participantSid=(t=e.participantSid)!==null&&t!==void 0?t:"",o.allTracks=(n=e.allTracks)!==null&&n!==void 0?n:!1,o.trackSids=((i=e.trackSids)===null||i===void 0?void 0:i.map(c=>c))||[],o.participantIdentity=(a=e.participantIdentity)!==null&&a!==void 0?a:"",o}};function createBaseSubscriptionPermission(){return{allParticipants:!1,trackPermissions:[]}}const SubscriptionPermission={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();e.allParticipants===!0&&t.uint32(8).bool(e.allParticipants);for(const n of e.trackPermissions)TrackPermission.encode(n,t.uint32(18).fork()).ldelim();return t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseSubscriptionPermission();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.allParticipants=n.bool();break;case 2:a.trackPermissions.push(TrackPermission.decode(n,n.uint32()));break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{allParticipants:isSet$2(e.allParticipants)?!!e.allParticipants:!1,trackPermissions:Array.isArray(e==null?void 0:e.trackPermissions)?e.trackPermissions.map(t=>TrackPermission.fromJSON(t)):[]}},toJSON(e){const t={};return e.allParticipants!==void 0&&(t.allParticipants=e.allParticipants),e.trackPermissions?t.trackPermissions=e.trackPermissions.map(n=>n?TrackPermission.toJSON(n):void 0):t.trackPermissions=[],t},create(e){return SubscriptionPermission.fromPartial(e??{})},fromPartial(e){var t,n;const i=createBaseSubscriptionPermission();return i.allParticipants=(t=e.allParticipants)!==null&&t!==void 0?t:!1,i.trackPermissions=((n=e.trackPermissions)===null||n===void 0?void 0:n.map(a=>TrackPermission.fromPartial(a)))||[],i}};function createBaseSubscriptionPermissionUpdate(){return{participantSid:"",trackSid:"",allowed:!1}}const SubscriptionPermissionUpdate={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.participantSid!==""&&t.uint32(10).string(e.participantSid),e.trackSid!==""&&t.uint32(18).string(e.trackSid),e.allowed===!0&&t.uint32(24).bool(e.allowed),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseSubscriptionPermissionUpdate();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.participantSid=n.string();break;case 2:a.trackSid=n.string();break;case 3:a.allowed=n.bool();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{participantSid:isSet$2(e.participantSid)?String(e.participantSid):"",trackSid:isSet$2(e.trackSid)?String(e.trackSid):"",allowed:isSet$2(e.allowed)?!!e.allowed:!1}},toJSON(e){const t={};return e.participantSid!==void 0&&(t.participantSid=e.participantSid),e.trackSid!==void 0&&(t.trackSid=e.trackSid),e.allowed!==void 0&&(t.allowed=e.allowed),t},create(e){return SubscriptionPermissionUpdate.fromPartial(e??{})},fromPartial(e){var t,n,i;const a=createBaseSubscriptionPermissionUpdate();return a.participantSid=(t=e.participantSid)!==null&&t!==void 0?t:"",a.trackSid=(n=e.trackSid)!==null&&n!==void 0?n:"",a.allowed=(i=e.allowed)!==null&&i!==void 0?i:!1,a}};function createBaseSyncState(){return{answer:void 0,subscription:void 0,publishTracks:[],dataChannels:[],offer:void 0}}const SyncState={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();e.answer!==void 0&&SessionDescription.encode(e.answer,t.uint32(10).fork()).ldelim(),e.subscription!==void 0&&UpdateSubscription.encode(e.subscription,t.uint32(18).fork()).ldelim();for(const n of e.publishTracks)TrackPublishedResponse.encode(n,t.uint32(26).fork()).ldelim();for(const n of e.dataChannels)DataChannelInfo.encode(n,t.uint32(34).fork()).ldelim();return e.offer!==void 0&&SessionDescription.encode(e.offer,t.uint32(42).fork()).ldelim(),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseSyncState();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.answer=SessionDescription.decode(n,n.uint32());break;case 2:a.subscription=UpdateSubscription.decode(n,n.uint32());break;case 3:a.publishTracks.push(TrackPublishedResponse.decode(n,n.uint32()));break;case 4:a.dataChannels.push(DataChannelInfo.decode(n,n.uint32()));break;case 5:a.offer=SessionDescription.decode(n,n.uint32());break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{answer:isSet$2(e.answer)?SessionDescription.fromJSON(e.answer):void 0,subscription:isSet$2(e.subscription)?UpdateSubscription.fromJSON(e.subscription):void 0,publishTracks:Array.isArray(e==null?void 0:e.publishTracks)?e.publishTracks.map(t=>TrackPublishedResponse.fromJSON(t)):[],dataChannels:Array.isArray(e==null?void 0:e.dataChannels)?e.dataChannels.map(t=>DataChannelInfo.fromJSON(t)):[],offer:isSet$2(e.offer)?SessionDescription.fromJSON(e.offer):void 0}},toJSON(e){const t={};return e.answer!==void 0&&(t.answer=e.answer?SessionDescription.toJSON(e.answer):void 0),e.subscription!==void 0&&(t.subscription=e.subscription?UpdateSubscription.toJSON(e.subscription):void 0),e.publishTracks?t.publishTracks=e.publishTracks.map(n=>n?TrackPublishedResponse.toJSON(n):void 0):t.publishTracks=[],e.dataChannels?t.dataChannels=e.dataChannels.map(n=>n?DataChannelInfo.toJSON(n):void 0):t.dataChannels=[],e.offer!==void 0&&(t.offer=e.offer?SessionDescription.toJSON(e.offer):void 0),t},create(e){return SyncState.fromPartial(e??{})},fromPartial(e){var t,n;const i=createBaseSyncState();return i.answer=e.answer!==void 0&&e.answer!==null?SessionDescription.fromPartial(e.answer):void 0,i.subscription=e.subscription!==void 0&&e.subscription!==null?UpdateSubscription.fromPartial(e.subscription):void 0,i.publishTracks=((t=e.publishTracks)===null||t===void 0?void 0:t.map(a=>TrackPublishedResponse.fromPartial(a)))||[],i.dataChannels=((n=e.dataChannels)===null||n===void 0?void 0:n.map(a=>DataChannelInfo.fromPartial(a)))||[],i.offer=e.offer!==void 0&&e.offer!==null?SessionDescription.fromPartial(e.offer):void 0,i}};function createBaseDataChannelInfo(){return{label:"",id:0,target:0}}const DataChannelInfo={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.label!==""&&t.uint32(10).string(e.label),e.id!==0&&t.uint32(16).uint32(e.id),e.target!==0&&t.uint32(24).int32(e.target),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseDataChannelInfo();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.label=n.string();break;case 2:a.id=n.uint32();break;case 3:a.target=n.int32();break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{label:isSet$2(e.label)?String(e.label):"",id:isSet$2(e.id)?Number(e.id):0,target:isSet$2(e.target)?signalTargetFromJSON(e.target):0}},toJSON(e){const t={};return e.label!==void 0&&(t.label=e.label),e.id!==void 0&&(t.id=Math.round(e.id)),e.target!==void 0&&(t.target=signalTargetToJSON(e.target)),t},create(e){return DataChannelInfo.fromPartial(e??{})},fromPartial(e){var t,n,i;const a=createBaseDataChannelInfo();return a.label=(t=e.label)!==null&&t!==void 0?t:"",a.id=(n=e.id)!==null&&n!==void 0?n:0,a.target=(i=e.target)!==null&&i!==void 0?i:0,a}};function createBaseSimulateScenario(){return{scenario:void 0}}const SimulateScenario={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();var n;switch((n=e.scenario)===null||n===void 0?void 0:n.$case){case"speakerUpdate":t.uint32(8).int32(e.scenario.speakerUpdate);break;case"nodeFailure":t.uint32(16).bool(e.scenario.nodeFailure);break;case"migration":t.uint32(24).bool(e.scenario.migration);break;case"serverLeave":t.uint32(32).bool(e.scenario.serverLeave);break;case"switchCandidateProtocol":t.uint32(40).int32(e.scenario.switchCandidateProtocol);break}return t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseSimulateScenario();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.scenario={$case:"speakerUpdate",speakerUpdate:n.int32()};break;case 2:a.scenario={$case:"nodeFailure",nodeFailure:n.bool()};break;case 3:a.scenario={$case:"migration",migration:n.bool()};break;case 4:a.scenario={$case:"serverLeave",serverLeave:n.bool()};break;case 5:a.scenario={$case:"switchCandidateProtocol",switchCandidateProtocol:n.int32()};break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{scenario:isSet$2(e.speakerUpdate)?{$case:"speakerUpdate",speakerUpdate:Number(e.speakerUpdate)}:isSet$2(e.nodeFailure)?{$case:"nodeFailure",nodeFailure:!!e.nodeFailure}:isSet$2(e.migration)?{$case:"migration",migration:!!e.migration}:isSet$2(e.serverLeave)?{$case:"serverLeave",serverLeave:!!e.serverLeave}:isSet$2(e.switchCandidateProtocol)?{$case:"switchCandidateProtocol",switchCandidateProtocol:candidateProtocolFromJSON(e.switchCandidateProtocol)}:void 0}},toJSON(e){var t,n,i,a,o,c,d,u,l,h,p;const y={};return((t=e.scenario)===null||t===void 0?void 0:t.$case)==="speakerUpdate"&&(y.speakerUpdate=Math.round((n=e.scenario)===null||n===void 0?void 0:n.speakerUpdate)),((i=e.scenario)===null||i===void 0?void 0:i.$case)==="nodeFailure"&&(y.nodeFailure=(a=e.scenario)===null||a===void 0?void 0:a.nodeFailure),((o=e.scenario)===null||o===void 0?void 0:o.$case)==="migration"&&(y.migration=(c=e.scenario)===null||c===void 0?void 0:c.migration),((d=e.scenario)===null||d===void 0?void 0:d.$case)==="serverLeave"&&(y.serverLeave=(u=e.scenario)===null||u===void 0?void 0:u.serverLeave),((l=e.scenario)===null||l===void 0?void 0:l.$case)==="switchCandidateProtocol"&&(y.switchCandidateProtocol=((h=e.scenario)===null||h===void 0?void 0:h.switchCandidateProtocol)!==void 0?candidateProtocolToJSON((p=e.scenario)===null||p===void 0?void 0:p.switchCandidateProtocol):void 0),y},create(e){return SimulateScenario.fromPartial(e??{})},fromPartial(e){var t,n,i,a,o,c,d,u,l,h,p,y,E,x,S;const k=createBaseSimulateScenario();return((t=e.scenario)===null||t===void 0?void 0:t.$case)==="speakerUpdate"&&((n=e.scenario)===null||n===void 0?void 0:n.speakerUpdate)!==void 0&&((i=e.scenario)===null||i===void 0?void 0:i.speakerUpdate)!==null&&(k.scenario={$case:"speakerUpdate",speakerUpdate:e.scenario.speakerUpdate}),((a=e.scenario)===null||a===void 0?void 0:a.$case)==="nodeFailure"&&((o=e.scenario)===null||o===void 0?void 0:o.nodeFailure)!==void 0&&((c=e.scenario)===null||c===void 0?void 0:c.nodeFailure)!==null&&(k.scenario={$case:"nodeFailure",nodeFailure:e.scenario.nodeFailure}),((d=e.scenario)===null||d===void 0?void 0:d.$case)==="migration"&&((u=e.scenario)===null||u===void 0?void 0:u.migration)!==void 0&&((l=e.scenario)===null||l===void 0?void 0:l.migration)!==null&&(k.scenario={$case:"migration",migration:e.scenario.migration}),((h=e.scenario)===null||h===void 0?void 0:h.$case)==="serverLeave"&&((p=e.scenario)===null||p===void 0?void 0:p.serverLeave)!==void 0&&((y=e.scenario)===null||y===void 0?void 0:y.serverLeave)!==null&&(k.scenario={$case:"serverLeave",serverLeave:e.scenario.serverLeave}),((E=e.scenario)===null||E===void 0?void 0:E.$case)==="switchCandidateProtocol"&&((x=e.scenario)===null||x===void 0?void 0:x.switchCandidateProtocol)!==void 0&&((S=e.scenario)===null||S===void 0?void 0:S.switchCandidateProtocol)!==null&&(k.scenario={$case:"switchCandidateProtocol",switchCandidateProtocol:e.scenario.switchCandidateProtocol}),k}};function createBasePing(){return{timestamp:0,rtt:0}}const Ping={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.timestamp!==0&&t.uint32(8).int64(e.timestamp),e.rtt!==0&&t.uint32(16).int64(e.rtt),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBasePing();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.timestamp=longToNumber(n.int64());break;case 2:a.rtt=longToNumber(n.int64());break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{timestamp:isSet$2(e.timestamp)?Number(e.timestamp):0,rtt:isSet$2(e.rtt)?Number(e.rtt):0}},toJSON(e){const t={};return e.timestamp!==void 0&&(t.timestamp=Math.round(e.timestamp)),e.rtt!==void 0&&(t.rtt=Math.round(e.rtt)),t},create(e){return Ping.fromPartial(e??{})},fromPartial(e){var t,n;const i=createBasePing();return i.timestamp=(t=e.timestamp)!==null&&t!==void 0?t:0,i.rtt=(n=e.rtt)!==null&&n!==void 0?n:0,i}};function createBasePong(){return{lastPingTimestamp:0,timestamp:0}}const Pong={encode(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_m0.Writer.create();return e.lastPingTimestamp!==0&&t.uint32(8).int64(e.lastPingTimestamp),e.timestamp!==0&&t.uint32(16).int64(e.timestamp),t},decode(e,t){const n=e instanceof _m0.Reader?e:new _m0.Reader(e);let i=t===void 0?n.len:n.pos+t;const a=createBasePong();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:a.lastPingTimestamp=longToNumber(n.int64());break;case 2:a.timestamp=longToNumber(n.int64());break;default:n.skipType(o&7);break}}return a},fromJSON(e){return{lastPingTimestamp:isSet$2(e.lastPingTimestamp)?Number(e.lastPingTimestamp):0,timestamp:isSet$2(e.timestamp)?Number(e.timestamp):0}},toJSON(e){const t={};return e.lastPingTimestamp!==void 0&&(t.lastPingTimestamp=Math.round(e.lastPingTimestamp)),e.timestamp!==void 0&&(t.timestamp=Math.round(e.timestamp)),t},create(e){return Pong.fromPartial(e??{})},fromPartial(e){var t,n;const i=createBasePong();return i.lastPingTimestamp=(t=e.lastPingTimestamp)!==null&&t!==void 0?t:0,i.timestamp=(n=e.timestamp)!==null&&n!==void 0?n:0,i}};var tsProtoGlobalThis$2=(()=>{if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw"Unable to locate global object"})();function longToNumber(e){if(e.gt(Number.MAX_SAFE_INTEGER))throw new tsProtoGlobalThis$2.Error("Value is larger than Number.MAX_SAFE_INTEGER");return e.toNumber()}_m0.util.Long!==long&&(_m0.util.Long=long,_m0.configure());function isSet$2(e){return e!=null}class LivekitError extends Error{constructor(t,n){super(n||"an error has occured"),this.code=t}}class ConnectionError extends LivekitError{constructor(t,n,i){super(1,t),this.status=i,this.reason=n}}class DeviceUnsupportedError extends LivekitError{constructor(t){super(21,t??"device is unsupported")}}class TrackInvalidError extends LivekitError{constructor(t){super(20,t??"track is invalid")}}class UnsupportedServer extends LivekitError{constructor(t){super(10,t??"unsupported server")}}class UnexpectedConnectionState extends LivekitError{constructor(t){super(12,t??"unexpected connection state")}}class NegotiationError extends LivekitError{constructor(t){super(13,t??"unable to negotiate")}}var MediaDeviceFailure;(function(e){e.PermissionDenied="PermissionDenied",e.NotFound="NotFound",e.DeviceInUse="DeviceInUse",e.Other="Other"})(MediaDeviceFailure||(MediaDeviceFailure={}));(function(e){function t(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?e.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?e.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?e.DeviceInUse:e.Other}e.getFailure=t})(MediaDeviceFailure||(MediaDeviceFailure={}));var RoomEvent;(function(e){e.Connected="connected",e.Reconnecting="reconnecting",e.Reconnected="reconnected",e.Disconnected="disconnected",e.ConnectionStateChanged="connectionStateChanged",e.StateChanged="connectionStateChanged",e.MediaDevicesChanged="mediaDevicesChanged",e.ParticipantConnected="participantConnected",e.ParticipantDisconnected="participantDisconnected",e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.LocalAudioSilenceDetected="localAudioSilenceDetected",e.ActiveSpeakersChanged="activeSpeakersChanged",e.ParticipantMetadataChanged="participantMetadataChanged",e.RoomMetadataChanged="roomMetadataChanged",e.DataReceived="dataReceived",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.AudioPlaybackStatusChanged="audioPlaybackChanged",e.MediaDevicesError="mediaDevicesError",e.ParticipantPermissionsChanged="participantPermissionsChanged",e.SignalConnected="signalConnected",e.RecordingStatusChanged="recordingStatusChanged"})(RoomEvent||(RoomEvent={}));var ParticipantEvent;(function(e){e.TrackPublished="trackPublished",e.TrackSubscribed="trackSubscribed",e.TrackSubscriptionFailed="trackSubscriptionFailed",e.TrackUnpublished="trackUnpublished",e.TrackUnsubscribed="trackUnsubscribed",e.TrackMuted="trackMuted",e.TrackUnmuted="trackUnmuted",e.LocalTrackPublished="localTrackPublished",e.LocalTrackUnpublished="localTrackUnpublished",e.ParticipantMetadataChanged="participantMetadataChanged",e.DataReceived="dataReceived",e.IsSpeakingChanged="isSpeakingChanged",e.ConnectionQualityChanged="connectionQualityChanged",e.TrackStreamStateChanged="trackStreamStateChanged",e.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",e.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",e.MediaDevicesError="mediaDevicesError",e.ParticipantPermissionsChanged="participantPermissionsChanged"})(ParticipantEvent||(ParticipantEvent={}));var EngineEvent;(function(e){e.TransportsCreated="transportsCreated",e.Connected="connected",e.Disconnected="disconnected",e.Resuming="resuming",e.Resumed="resumed",e.Restarting="restarting",e.Restarted="restarted",e.SignalResumed="signalResumed",e.Closing="closing",e.MediaTrackAdded="mediaTrackAdded",e.ActiveSpeakersUpdate="activeSpeakersUpdate",e.DataPacketReceived="dataPacketReceived"})(EngineEvent||(EngineEvent={}));var TrackEvent;(function(e){e.Message="message",e.Muted="muted",e.Unmuted="unmuted",e.Restarted="restarted",e.Ended="ended",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed",e.UpdateSettings="updateSettings",e.UpdateSubscription="updateSubscription",e.AudioPlaybackStarted="audioPlaybackStarted",e.AudioPlaybackFailed="audioPlaybackFailed",e.AudioSilenceDetected="audioSilenceDetected",e.VisibilityChanged="visibilityChanged",e.VideoDimensionsChanged="videoDimensionsChanged",e.ElementAttached="elementAttached",e.ElementDetached="elementDetached",e.UpstreamPaused="upstreamPaused",e.UpstreamResumed="upstreamResumed",e.SubscriptionPermissionChanged="subscriptionPermissionChanged",e.SubscriptionStatusChanged="subscriptionStatusChanged"})(TrackEvent||(TrackEvent={}));const monitorFrequency=2e3;function computeBitrate(e,t){if(!t)return 0;let n,i;return"bytesReceived"in e?(n=e.bytesReceived,i=t.bytesReceived):"bytesSent"in e&&(n=e.bytesSent,i=t.bytesSent),n===void 0||i===void 0||e.timestamp===void 0||t.timestamp===void 0?0:(n-i)*8*1e3/(e.timestamp-t.timestamp)}var uaParserExports={},uaParser={get exports(){return uaParserExports},set exports(e){uaParserExports=e}};(function(e,t){(function(n,i){var a="1.0.33",o="",c="?",d="function",u="undefined",l="object",h="string",p="major",y="model",E="name",x="type",S="vendor",k="version",T="architecture",L="console",q="mobile",U="tablet",ee="smarttv",W="wearable",ie="embedded",fe=350,ce="Amazon",ye="Apple",xe="ASUS",Oe="BlackBerry",F="Browser",v="Chrome",C="Edge",I="Firefox",B="Google",J="Huawei",Y="LG",H="Microsoft",_="Motorola",m="Opera",b="Samsung",$="Sharp",g="Sony",O="Xiaomi",te="Zebra",Z="Facebook",ae=function(We,ze){var ut={};for(var rt in We)ze[rt]&&ze[rt].length%2===0?ut[rt]=ze[rt].concat(We[rt]):ut[rt]=We[rt];return ut},be=function(We){for(var ze={},ut=0;ut<We.length;ut++)ze[We[ut].toUpperCase()]=We[ut];return ze},ke=function(We,ze){return typeof We===h?Ae(ze).indexOf(Ae(We))!==-1:!1},Ae=function(We){return We.toLowerCase()},dt=function(We){return typeof We===h?We.replace(/[^\d\.]/g,o).split(".")[0]:i},qe=function(We,ze){if(typeof We===h)return We=We.replace(/^\s\s*/,o),typeof ze===u?We:We.substring(0,fe)},et=function(We,ze){for(var ut=0,rt,Ze,er,Ye,yt,Vt;ut<ze.length&&!yt;){var $t=ze[ut],bt=ze[ut+1];for(rt=Ze=0;rt<$t.length&&!yt;)if(yt=$t[rt++].exec(We),yt)for(er=0;er<bt.length;er++)Vt=yt[++Ze],Ye=bt[er],typeof Ye===l&&Ye.length>0?Ye.length===2?typeof Ye[1]==d?this[Ye[0]]=Ye[1].call(this,Vt):this[Ye[0]]=Ye[1]:Ye.length===3?typeof Ye[1]===d&&!(Ye[1].exec&&Ye[1].test)?this[Ye[0]]=Vt?Ye[1].call(this,Vt,Ye[2]):i:this[Ye[0]]=Vt?Vt.replace(Ye[1],Ye[2]):i:Ye.length===4&&(this[Ye[0]]=Vt?Ye[3].call(this,Vt.replace(Ye[1],Ye[2])):i):this[Ye]=Vt||i;ut+=2}},Ke=function(We,ze){for(var ut in ze)if(typeof ze[ut]===l&&ze[ut].length>0){for(var rt=0;rt<ze[ut].length;rt++)if(ke(ze[ut][rt],We))return ut===c?i:ut}else if(ke(ze[ut],We))return ut===c?i:ut;return We},gt={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},at={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Lt={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[k,[E,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[k,[E,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[E,k],[/opios[\/ ]+([\w\.]+)/i],[k,[E,m+" Mini"]],[/\bopr\/([\w\.]+)/i],[k,[E,m]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[E,k],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[k,[E,"UC"+F]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[k,[E,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[k,[E,"WeChat"]],[/konqueror\/([\w\.]+)/i],[k,[E,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[k,[E,"IE"]],[/yabrowser\/([\w\.]+)/i],[k,[E,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[E,/(.+)/,"$1 Secure "+F],k],[/\bfocus\/([\w\.]+)/i],[k,[E,I+" Focus"]],[/\bopt\/([\w\.]+)/i],[k,[E,m+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[k,[E,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[k,[E,"Dolphin"]],[/coast\/([\w\.]+)/i],[k,[E,m+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[k,[E,"MIUI "+F]],[/fxios\/([-\w\.]+)/i],[k,[E,I]],[/\bqihu|(qi?ho?o?|360)browser/i],[[E,"360 "+F]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[E,/(.+)/,"$1 "+F],k],[/(comodo_dragon)\/([\w\.]+)/i],[[E,/_/g," "],k],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[E,k],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[E],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[E,Z],k],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[E,k],[/\bgsa\/([\w\.]+) .*safari\//i],[k,[E,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[k,[E,v+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[E,v+" WebView"],k],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[k,[E,"Android "+F]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[E,k],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[k,[E,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[k,E],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[E,[k,Ke,gt]],[/(webkit|khtml)\/([\w\.]+)/i],[E,k],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[E,"Netscape"],k],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[k,[E,I+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[E,k],[/(cobalt)\/([\w\.]+)/i],[E,[k,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[T,"amd64"]],[/(ia32(?=;))/i],[[T,Ae]],[/((?:i[346]|x)86)[;\)]/i],[[T,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[T,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[T,"armhf"]],[/windows (ce|mobile); ppc;/i],[[T,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[T,/ower/,o,Ae]],[/(sun4\w)[;\)]/i],[[T,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[T,Ae]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[y,[S,b],[x,U]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[y,[S,b],[x,q]],[/\((ip(?:hone|od)[\w ]*);/i],[y,[S,ye],[x,q]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[y,[S,ye],[x,U]],[/(macintosh);/i],[y,[S,ye]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[y,[S,J],[x,U]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[y,[S,J],[x,q]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[y,/_/g," "],[S,O],[x,q]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[y,/_/g," "],[S,O],[x,U]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[y,[S,"OPPO"],[x,q]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[y,[S,"Vivo"],[x,q]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[y,[S,"Realme"],[x,q]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[y,[S,_],[x,q]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[y,[S,_],[x,U]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[y,[S,Y],[x,U]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[y,[S,Y],[x,q]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[y,[S,"Lenovo"],[x,U]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[y,/_/g," "],[S,"Nokia"],[x,q]],[/(pixel c)\b/i],[y,[S,B],[x,U]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[y,[S,B],[x,q]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[y,[S,g],[x,q]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[y,"Xperia Tablet"],[S,g],[x,U]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[y,[S,"OnePlus"],[x,q]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[y,[S,ce],[x,U]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[y,/(.+)/g,"Fire Phone $1"],[S,ce],[x,q]],[/(playbook);[-\w\),; ]+(rim)/i],[y,S,[x,U]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[y,[S,Oe],[x,q]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[y,[S,xe],[x,U]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[y,[S,xe],[x,q]],[/(nexus 9)/i],[y,[S,"HTC"],[x,U]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony(?!-bra))[-_ ]?([-\w]*)/i],[S,[y,/_/g," "],[x,q]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[y,[S,"Acer"],[x,U]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[y,[S,"Meizu"],[x,q]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[y,[S,$],[x,q]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[S,y,[x,q]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[S,y,[x,U]],[/(surface duo)/i],[y,[S,H],[x,U]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[y,[S,"Fairphone"],[x,q]],[/(u304aa)/i],[y,[S,"AT&T"],[x,q]],[/\bsie-(\w*)/i],[y,[S,"Siemens"],[x,q]],[/\b(rct\w+) b/i],[y,[S,"RCA"],[x,U]],[/\b(venue[\d ]{2,7}) b/i],[y,[S,"Dell"],[x,U]],[/\b(q(?:mv|ta)\w+) b/i],[y,[S,"Verizon"],[x,U]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[y,[S,"Barnes & Noble"],[x,U]],[/\b(tm\d{3}\w+) b/i],[y,[S,"NuVision"],[x,U]],[/\b(k88) b/i],[y,[S,"ZTE"],[x,U]],[/\b(nx\d{3}j) b/i],[y,[S,"ZTE"],[x,q]],[/\b(gen\d{3}) b.+49h/i],[y,[S,"Swiss"],[x,q]],[/\b(zur\d{3}) b/i],[y,[S,"Swiss"],[x,U]],[/\b((zeki)?tb.*\b) b/i],[y,[S,"Zeki"],[x,U]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[S,"Dragon Touch"],y,[x,U]],[/\b(ns-?\w{0,9}) b/i],[y,[S,"Insignia"],[x,U]],[/\b((nxa|next)-?\w{0,9}) b/i],[y,[S,"NextBook"],[x,U]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[S,"Voice"],y,[x,q]],[/\b(lvtel\-)?(v1[12]) b/i],[[S,"LvTel"],y,[x,q]],[/\b(ph-1) /i],[y,[S,"Essential"],[x,q]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[y,[S,"Envizen"],[x,U]],[/\b(trio[-\w\. ]+) b/i],[y,[S,"MachSpeed"],[x,U]],[/\btu_(1491) b/i],[y,[S,"Rotor"],[x,U]],[/(shield[\w ]+) b/i],[y,[S,"Nvidia"],[x,U]],[/(sprint) (\w+)/i],[S,y,[x,q]],[/(kin\.[onetw]{3})/i],[[y,/\./g," "],[S,H],[x,q]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[y,[S,te],[x,U]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[y,[S,te],[x,q]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[S,y,[x,L]],[/droid.+; (shield) bui/i],[y,[S,"Nvidia"],[x,L]],[/(playstation [345portablevi]+)/i],[y,[S,g],[x,L]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[y,[S,H],[x,L]],[/smart-tv.+(samsung)/i],[S,[x,ee]],[/hbbtv.+maple;(\d+)/i],[[y,/^/,"SmartTV"],[S,b],[x,ee]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[S,Y],[x,ee]],[/(apple) ?tv/i],[S,[y,ye+" TV"],[x,ee]],[/crkey/i],[[y,v+"cast"],[S,B],[x,ee]],[/droid.+aft(\w)( bui|\))/i],[y,[S,ce],[x,ee]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[y,[S,$],[x,ee]],[/(bravia[\w ]+)( bui|\))/i],[y,[S,g],[x,ee]],[/(mitv-\w{5}) bui/i],[y,[S,O],[x,ee]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[S,qe],[y,qe],[x,ee]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[x,ee]],[/((pebble))app/i],[S,y,[x,W]],[/droid.+; (glass) \d/i],[y,[S,B],[x,W]],[/droid.+; (wt63?0{2,3})\)/i],[y,[S,te],[x,W]],[/(quest( 2)?)/i],[y,[S,Z],[x,W]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[S,[x,ie]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[y,[x,q]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[y,[x,U]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[x,U]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[x,q]],[/(android[-\w\. ]{0,9});.+buil/i],[y,[S,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[k,[E,C+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[k,[E,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[E,k],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[k,E]],os:[[/microsoft (windows) (vista|xp)/i],[E,k],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[E,[k,Ke,at]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[E,"Windows"],[k,Ke,at]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[k,/_/g,"."],[E,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[E,"Mac OS"],[k,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[k,E],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[E,k],[/\(bb(10);/i],[k,[E,Oe]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[k,[E,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[k,[E,I+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[k,[E,"webOS"]],[/crkey\/([\d\.]+)/i],[k,[E,v+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[E,"Chromium OS"],k],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[E,k],[/(sunos) ?([\w\.\d]*)/i],[[E,"Solaris"],k],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[E,k]]},Ge=function(We,ze){if(typeof We===l&&(ze=We,We=i),!(this instanceof Ge))return new Ge(We,ze).getResult();var ut=We||(typeof n!==u&&n.navigator&&n.navigator.userAgent?n.navigator.userAgent:o),rt=ze?ae(Lt,ze):Lt;return this.getBrowser=function(){var Ze={};return Ze[E]=i,Ze[k]=i,et.call(Ze,ut,rt.browser),Ze.major=dt(Ze.version),Ze},this.getCPU=function(){var Ze={};return Ze[T]=i,et.call(Ze,ut,rt.cpu),Ze},this.getDevice=function(){var Ze={};return Ze[S]=i,Ze[y]=i,Ze[x]=i,et.call(Ze,ut,rt.device),Ze},this.getEngine=function(){var Ze={};return Ze[E]=i,Ze[k]=i,et.call(Ze,ut,rt.engine),Ze},this.getOS=function(){var Ze={};return Ze[E]=i,Ze[k]=i,et.call(Ze,ut,rt.os),Ze},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ut},this.setUA=function(Ze){return ut=typeof Ze===h&&Ze.length>fe?qe(Ze,fe):Ze,this},this.setUA(ut),this};Ge.VERSION=a,Ge.BROWSER=be([E,k,p]),Ge.CPU=be([T]),Ge.DEVICE=be([y,S,x,L,q,ee,U,W,ie]),Ge.ENGINE=Ge.OS=be([E,k]),e.exports&&(t=e.exports=Ge),t.UAParser=Ge;var st=typeof n!==u&&(n.jQuery||n.Zepto);if(st&&!st.ua){var Qe=new Ge;st.ua=Qe.getResult(),st.ua.get=function(){return Qe.getUA()},st.ua.set=function(We){Qe.setUA(We);var ze=Qe.getResult();for(var ut in ze)st.ua[ut]=ze[ut]}}})(typeof window=="object"?window:commonjsGlobal)})(uaParser,uaParserExports);var UAParser=uaParserExports,version$1="1.7.1";const version=version$1,protocolVersion=9;function mergeDefaultOptions(e,t,n){const i=_objectSpread2({},e);return i.audio===!0&&(i.audio={}),i.video===!0&&(i.video={}),i.audio&&mergeObjectWithoutOverwriting(i.audio,t),i.video&&mergeObjectWithoutOverwriting(i.video,n),i}function mergeObjectWithoutOverwriting(e,t){return Object.keys(t).forEach(n=>{e[n]===void 0&&(e[n]=t[n])}),e}function constraintsForOptions(e){const t={};if(e.video)if(typeof e.video=="object"){const n={},i=n,a=e.video;Object.keys(a).forEach(o=>{switch(o){case"resolution":mergeObjectWithoutOverwriting(i,a.resolution);break;default:i[o]=a[o]}}),t.video=n}else t.video=e.video;else t.video=!1;return e.audio?typeof e.audio=="object"?t.audio=e.audio:t.audio=!0:t.audio=!1,t}async function detectSilence(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;const n=getNewAudioContext();if(n){const i=n.createAnalyser();i.fftSize=2048;const a=i.frequencyBinCount,o=new Uint8Array(a);n.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(i),await sleep(t),i.getByteTimeDomainData(o);const d=o.some(u=>u!==128&&u!==0);return n.close(),!d}return!1}function getNewAudioContext(){const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e)return new e({latencyHint:"interactive"})}const separator="|";function unpackStreamId(e){const t=e.split(separator);return t.length>1?[t[0],e.substr(t[0].length+1)]:[e,""]}async function sleep(e){return new Promise(t=>setTimeout(t,e))}function supportsTransceiver(){return"addTransceiver"in RTCPeerConnection.prototype}function supportsAddTrack(){return"addTrack"in RTCPeerConnection.prototype}function supportsAV1(){const e=RTCRtpReceiver.getCapabilities("video");let t=!1,n=!1;if(e){for(const i of e.codecs)if(i.mimeType==="video/AV1"){t=!0;break}for(const i of e.headerExtensions)if(i.uri==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"){n=!0;break}}return t&&n}function supportsSetSinkId(e){return document?(e||(e=document.createElement("audio")),"setSinkId"in e):!1}const setCodecPreferencesVersions={Chrome:"100",Chromium:"100",Safari:"15",Firefox:"100",Edge:"100",Brave:"1.40"};function supportsSetCodecPreferences(e){if(!isWeb()||!("setCodecPreferences"in e))return!1;const t=UAParser();if(!t.browser.name||!t.browser.version)return!1;const n=setCodecPreferencesVersions[t.browser.name];return n?compareVersions(t.browser.version,n)>=0:!1}function isFireFox(){return isWeb()?navigator.userAgent.indexOf("Firefox")!==-1:!1}function isSafari(){return isWeb()?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}function isMobile(){return isWeb()?/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function isWeb(){return typeof document<"u"}function compareVersions(e,t){const n=e.split("."),i=t.split("."),a=Math.min(e.length,t.length);for(let o=0;o<a;++o){const c=parseInt(n[o],10),d=parseInt(i[o],10);if(c>d)return 1;if(c<d)return-1}return n.length==i.length?0:n.length<i.length?-1:1}function roDispatchCallback(e){for(const t of e)t.target.handleResize(t)}function ioDispatchCallback(e){for(const t of e)t.target.handleVisibilityChanged(t)}let resizeObserver=null;const getResizeObserver=()=>(resizeObserver||(resizeObserver=new ResizeObserver(roDispatchCallback)),resizeObserver);let intersectionObserver=null;const getIntersectionObserver=()=>(intersectionObserver||(intersectionObserver=new IntersectionObserver(ioDispatchCallback,{root:document,rootMargin:"0px"})),intersectionObserver);function getClientInfo(){return ClientInfo.fromPartial({sdk:ClientInfo_SDK.JS,protocol:protocolVersion,version})}let emptyVideoStreamTrack;function getEmptyVideoStreamTrack(){return emptyVideoStreamTrack||(emptyVideoStreamTrack=createDummyVideoStreamTrack()),emptyVideoStreamTrack}function createDummyVideoStreamTrack(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const a=document.createElement("canvas");a.width=e,a.height=t;const o=a.getContext("2d");o==null||o.fillRect(0,0,a.width,a.height),i&&o&&(o.beginPath(),o.arc(e/2,t/2,50,0,Math.PI*2,!0),o.closePath(),o.fillStyle="grey",o.fill());const c=a.captureStream(),[d]=c.getTracks();if(!d)throw Error("Could not get empty media stream video track");return d.enabled=n,d}let emptyAudioStreamTrack;function getEmptyAudioStreamTrack(){if(!emptyAudioStreamTrack){const e=new AudioContext,t=e.createOscillator(),n=e.createMediaStreamDestination();if(t.connect(n),t.start(),[emptyAudioStreamTrack]=n.stream.getAudioTracks(),!emptyAudioStreamTrack)throw Error("Could not get empty media stream audio track");emptyAudioStreamTrack.enabled=!1}return emptyAudioStreamTrack}class Future{constructor(t,n){this.onFinally=n,this.promise=new Promise(async(i,a)=>{this.resolve=i,this.reject=a,t&&await t(i,a)}).finally(()=>{var i;return(i=this.onFinally)===null||i===void 0?void 0:i.call(this)})}}class Mutex{constructor(){this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let t;const n=new Promise(a=>t=()=>{this._locks-=1,a()}),i=this._locking.then(()=>t);return this._locking=this._locking.then(()=>n),i}}class Queue{constructor(t,n){this.maxConcurrent=t||1,this.minCycle=n||0,this.queueRunning=[],this.queueWaiting={},this.lastRun=0}dequeue(t){const n=this.queueRunning,i=n.findIndex(o=>o.hash===t);if(i==-1)throw"queue desync";const a=n[i];return n.splice(i,1),a}getFirstWaiting(){for(let t of Object.keys(this.queueWaiting).sort((n,i)=>n-i))if(this.queueWaiting[t]!==void 0&&this.queueWaiting[t].length>0)return this.queueWaiting[t]}end(t){this.dequeue(t).resolve();const i=this.getFirstWaiting();i!==void 0&&i.shift().resolve()}async wait(t,n){const i=n===void 0?0:n;let a={hash:t,priority:i};for(this.queueWaiting[i]==null&&(this.queueWaiting[i]=[]),this.queueRunning.length>=this.maxConcurrent&&(a.promise=new Promise(o=>{a.resolve=o}),this.queueWaiting[i].push(a),await a.promise),this.queueRunning.push(a),a.promise=new Promise(o=>{a.resolve=o});Date.now()-this.lastRun<this.minCycle;)await new Promise(o=>setTimeout(o,this.minCycle-Date.now()+this.lastRun));this.lastRun=Date.now()}run(t,n){const i=n===void 0?0:n,a=Symbol();return this.wait(a,i).then(()=>t()).finally(()=>{this.end(a)})}stat(){return{running:this.queueRunning.length,waiting:Object.keys(this.queueWaiting).reduce((t,n)=>t+=this.queueWaiting[n].length,0),last:this.lastRun}}async flush(){for(;this.stat().waiting>0;)for(let t of Object.keys(this.queueWaiting).sort((n,i)=>i-n)){const n=this.queueWaiting[t];n!==void 0&&n.length>0&&await n[n.length-1].promise}for(;this.queueRunning.length>0;)await Promise.allSettled(this.queueRunning.map(t=>t.promise))}}const defaultId="default";class DeviceManager{static getInstance(){return this.instance===void 0&&(this.instance=new DeviceManager),this.instance}async getDevices(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;var i;if(((i=DeviceManager.userMediaPromiseMap)===null||i===void 0?void 0:i.size)>0){livekitLogger.debug("awaiting getUserMedia promise");try{t?await DeviceManager.userMediaPromiseMap.get(t):await Promise.all(DeviceManager.userMediaPromiseMap.values())}catch{livekitLogger.warn("error waiting for media permissons")}}let a=await navigator.mediaDevices.enumerateDevices();if(n&&t&&(!DeviceManager.userMediaPromiseMap.get(t)||!isSafari())&&(a.length===0||a.some(c=>{const d=c.label==="",u=t?c.kind===t:!0;return d&&u}))){const c={video:t!=="audioinput"&&t!=="audiooutput",audio:t!=="videoinput"},d=await navigator.mediaDevices.getUserMedia(c);a=await navigator.mediaDevices.enumerateDevices(),d.getTracks().forEach(u=>{u.stop()})}return t&&(a=a.filter(o=>o.kind===t)),a}async normalizeDeviceId(t,n,i){if(n!==defaultId)return n;const o=(await this.getDevices(t)).find(c=>c.groupId===i&&c.deviceId!==defaultId);return o==null?void 0:o.deviceId}}DeviceManager.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];DeviceManager.userMediaPromiseMap=new Map;var eventsExports={},events={get exports(){return eventsExports},set exports(e){eventsExports=e}},R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function e(t,n,i){return Function.prototype.apply.call(t,n,i)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:ReflectOwnKeys=function(t){return Object.getOwnPropertyNames(t)};function ProcessEmitWarning(e){console&&console.warn&&console.warn(e)}var NumberIsNaN=Number.isNaN||function e(t){return t!==t};function EventEmitter(){EventEmitter.init.call(this)}events.exports=EventEmitter;eventsExports.once=once;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=void 0;EventEmitter.prototype._eventsCount=0;EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(e){if(typeof e!="number"||e<0||NumberIsNaN(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");defaultMaxListeners=e}});EventEmitter.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter.prototype.setMaxListeners=function e(t){if(typeof t!="number"||t<0||NumberIsNaN(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function _getMaxListeners(e){return e._maxListeners===void 0?EventEmitter.defaultMaxListeners:e._maxListeners}EventEmitter.prototype.getMaxListeners=function e(){return _getMaxListeners(this)};EventEmitter.prototype.emit=function e(t){for(var n=[],i=1;i<arguments.length;i++)n.push(arguments[i]);var a=t==="error",o=this._events;if(o!==void 0)a=a&&o.error===void 0;else if(!a)return!1;if(a){var c;if(n.length>0&&(c=n[0]),c instanceof Error)throw c;var d=new Error("Unhandled error."+(c?" ("+c.message+")":""));throw d.context=c,d}var u=o[t];if(u===void 0)return!1;if(typeof u=="function")ReflectApply(u,this,n);else for(var l=u.length,h=arrayClone(u,l),i=0;i<l;++i)ReflectApply(h[i],this,n);return!0};function _addListener(e,t,n,i){var a,o,c;if(checkListener(n),o=e._events,o===void 0?(o=e._events=Object.create(null),e._eventsCount=0):(o.newListener!==void 0&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),c=o[t]),c===void 0)c=o[t]=n,++e._eventsCount;else if(typeof c=="function"?c=o[t]=i?[n,c]:[c,n]:i?c.unshift(n):c.push(n),a=_getMaxListeners(e),a>0&&c.length>a&&!c.warned){c.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=c.length,ProcessEmitWarning(d)}return e}EventEmitter.prototype.addListener=function e(t,n){return _addListener(this,t,n,!1)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function e(t,n){return _addListener(this,t,n,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},a=onceWrapper.bind(i);return a.listener=n,i.wrapFn=a,a}EventEmitter.prototype.once=function e(t,n){return checkListener(n),this.on(t,_onceWrap(this,t,n)),this};EventEmitter.prototype.prependOnceListener=function e(t,n){return checkListener(n),this.prependListener(t,_onceWrap(this,t,n)),this};EventEmitter.prototype.removeListener=function e(t,n){var i,a,o,c,d;if(checkListener(n),a=this._events,a===void 0)return this;if(i=a[t],i===void 0)return this;if(i===n||i.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete a[t],a.removeListener&&this.emit("removeListener",t,i.listener||n));else if(typeof i!="function"){for(o=-1,c=i.length-1;c>=0;c--)if(i[c]===n||i[c].listener===n){d=i[c].listener,o=c;break}if(o<0)return this;o===0?i.shift():spliceOne(i,o),i.length===1&&(a[t]=i[0]),a.removeListener!==void 0&&this.emit("removeListener",t,d||n)}return this};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.removeAllListeners=function e(t){var n,i,a;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[t]),this;if(arguments.length===0){var o=Object.keys(i),c;for(a=0;a<o.length;++a)c=o[a],c!=="removeListener"&&this.removeAllListeners(c);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=i[t],typeof n=="function")this.removeListener(t,n);else if(n!==void 0)for(a=n.length-1;a>=0;a--)this.removeListener(t,n[a]);return this};function _listeners(e,t,n){var i=e._events;if(i===void 0)return[];var a=i[t];return a===void 0?[]:typeof a=="function"?n?[a.listener||a]:[a]:n?unwrapListeners(a):arrayClone(a,a.length)}EventEmitter.prototype.listeners=function e(t){return _listeners(this,t,!0)};EventEmitter.prototype.rawListeners=function e(t){return _listeners(this,t,!1)};EventEmitter.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):listenerCount.call(e,t)};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(e){var t=this._events;if(t!==void 0){var n=t[e];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}EventEmitter.prototype.eventNames=function e(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function spliceOne(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function unwrapListeners(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function once(e,t){return new Promise(function(n,i){function a(c){e.removeListener(t,o),i(c)}function o(){typeof e.removeListener=="function"&&e.removeListener("error",a),n([].slice.call(arguments))}eventTargetAgnosticAddListener(e,t,o,{once:!0}),t!=="error"&&addErrorHandlerIfEventEmitter(e,a,{once:!0})})}function addErrorHandlerIfEventEmitter(e,t,n){typeof e.on=="function"&&eventTargetAgnosticAddListener(e,"error",t,n)}function eventTargetAgnosticAddListener(e,t,n,i){if(typeof e.on=="function")i.once?e.once(t,n):e.on(t,n);else if(typeof e.addEventListener=="function")e.addEventListener(t,function a(o){i.once&&e.removeEventListener(t,a),n(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}const BACKGROUND_REACTION_DELAY=5e3,recycledElements=[];class Track extends eventsExports.EventEmitter{constructor(t,n){super(),this.attachedElements=[],this.isMuted=!1,this.streamState=Track.StreamState.Active,this._currentBitrate=0,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),BACKGROUND_REACTION_DELAY):this.handleAppVisibilityChanged()},this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=t,this._mediaStreamID=t.id,this.source=Track.Source.Unknown,isWeb()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(t){let n="audio";this.kind===Track.Kind.Video&&(n="video"),t||(n==="audio"&&(recycledElements.forEach(a=>{a.parentElement===null&&!t&&(t=a)}),t&&recycledElements.splice(recycledElements.indexOf(t),1)),t||(t=document.createElement(n))),this.attachedElements.includes(t)||this.attachedElements.push(t),attachToElement(this._mediaStreamTrack,t);const i=t.srcObject.getTracks();return i.some(a=>a.kind==="audio")&&t.play().then(()=>{this.emit(TrackEvent.AudioPlaybackStarted)}).catch(a=>{a.name==="NotAllowedError"?this.emit(TrackEvent.AudioPlaybackFailed,a):livekitLogger.warn("could not playback audio",a),t&&i.some(o=>o.kind==="video")&&a.name==="NotAllowedError"&&(t.muted=!0,t.play().catch(()=>{}))}),this.emit(TrackEvent.ElementAttached,t),t}detach(t){if(t){detachTrack(this._mediaStreamTrack,t);const i=this.attachedElements.indexOf(t);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(t),this.emit(TrackEvent.ElementDetached,t)),t}const n=[];return this.attachedElements.forEach(i=>{detachTrack(this._mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(TrackEvent.ElementDetached,i)}),this.attachedElements=[],n}stop(){this.stopMonitor(),this._mediaStreamTrack.stop(),isWeb()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval)}recycleElement(t){if(t instanceof HTMLAudioElement){let n=!0;t.pause(),recycledElements.forEach(i=>{i.parentElement||(n=!1)}),n&&recycledElements.push(t)}}async handleAppVisibilityChanged(){this.isInBackground=document.visibilityState==="hidden"}}function attachToElement(e,t){let n;t.srcObject instanceof MediaStream?n=t.srcObject:n=new MediaStream;let i;e.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(e)||(i.forEach(a=>{n.removeTrack(a)}),n.addTrack(e)),t.autoplay=!0,t.muted=n.getAudioTracks().length===0,t instanceof HTMLVideoElement&&(t.playsInline=!0),t.srcObject!==n&&(t.srcObject=n,(isSafari()||isFireFox())&&t instanceof HTMLVideoElement&&setTimeout(()=>{t.srcObject=n,t.play().catch(()=>{})},0))}function detachTrack(e,t){if(t.srcObject instanceof MediaStream){const n=t.srcObject;n.removeTrack(e),n.getTracks().length>0?t.srcObject=n:t.srcObject=null}}(function(e){let t;(function(l){l.Audio="audio",l.Video="video",l.Unknown="unknown"})(t=e.Kind||(e.Kind={}));let n;(function(l){l.Camera="camera",l.Microphone="microphone",l.ScreenShare="screen_share",l.ScreenShareAudio="screen_share_audio",l.Unknown="unknown"})(n=e.Source||(e.Source={}));let i;(function(l){l.Active="active",l.Paused="paused",l.Unknown="unknown"})(i=e.StreamState||(e.StreamState={}));function a(l){switch(l){case t.Audio:return TrackType.AUDIO;case t.Video:return TrackType.VIDEO;default:return TrackType.UNRECOGNIZED}}e.kindToProto=a;function o(l){switch(l){case TrackType.AUDIO:return t.Audio;case TrackType.VIDEO:return t.Video;default:return t.Unknown}}e.kindFromProto=o;function c(l){switch(l){case n.Camera:return TrackSource.CAMERA;case n.Microphone:return TrackSource.MICROPHONE;case n.ScreenShare:return TrackSource.SCREEN_SHARE;case n.ScreenShareAudio:return TrackSource.SCREEN_SHARE_AUDIO;default:return TrackSource.UNRECOGNIZED}}e.sourceToProto=c;function d(l){switch(l){case TrackSource.CAMERA:return n.Camera;case TrackSource.MICROPHONE:return n.Microphone;case TrackSource.SCREEN_SHARE:return n.ScreenShare;case TrackSource.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}e.sourceFromProto=d;function u(l){switch(l){case StreamState.ACTIVE:return i.Active;case StreamState.PAUSED:return i.Paused;default:return i.Unknown}}e.streamStateFromProto=u})(Track||(Track={}));const defaultDimensionsTimeout=2*1e3;class LocalTrack extends Track{constructor(t,n,i){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;super(t,n),this._isUpstreamPaused=!1,this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this.emit(TrackEvent.Ended,this)},this._mediaStreamTrack.addEventListener("ended",this.handleEnded),this.constraints=i??t.getConstraints(),this.reacquireTrack=!1,this.providedByUser=a,this.muteQueue=new Queue}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==Track.Kind.Video)return;const{width:t,height:n}=this._mediaStreamTrack.getSettings();if(t&&n)return{width:t,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}async waitForDimensions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:defaultDimensionsTimeout;if(this.kind===Track.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");const n=Date.now();for(;Date.now()-n<t;){const i=this.dimensions;if(i)return i;await sleep(50)}throw new TrackInvalidError("unable to get track dimensions after timeout")}async getDeviceId(){if(this.source===Track.Source.ScreenShare)return;const{deviceId:t,groupId:n}=this._mediaStreamTrack.getSettings(),i=this.kind===Track.Kind.Audio?"audioinput":"videoinput";return DeviceManager.getInstance().normalizeDeviceId(i,t,n)}async mute(){return this.setTrackMuted(!0),this}async unmute(){return this.setTrackMuted(!1),this}async replaceTrack(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!this.sender)throw new TrackInvalidError("unable to replace an unpublished track");return this.attachedElements.forEach(i=>{detachTrack(this._mediaStreamTrack,i)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this.providedByUser||this._mediaStreamTrack.stop(),t.addEventListener("ended",this.handleEnded),livekitLogger.debug("replace MediaStreamTrack"),this.sender&&await this.sender.replaceTrack(t),this._mediaStreamTrack=t,this._mediaStreamTrack.enabled=!this.isMuted,await this.resumeUpstream(),this.attachedElements.forEach(i=>{attachToElement(t,i)}),this.mediaStream=new MediaStream([t]),this.providedByUser=n,this}async restart(t){t||(t=this.constraints),livekitLogger.debug("restarting track with constraints",t);const n={audio:!1,video:!1};this.kind===Track.Kind.Video?n.video=t:n.audio=t,this.attachedElements.forEach(o=>{detachTrack(this._mediaStreamTrack,o)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const i=await navigator.mediaDevices.getUserMedia(n),a=i.getTracks()[0];return a.addEventListener("ended",this.handleEnded),livekitLogger.debug("re-acquired MediaStreamTrack"),this.sender&&await this.sender.replaceTrack(a),this._mediaStreamTrack=a,await this.resumeUpstream(),this.attachedElements.forEach(o=>{attachToElement(a,o)}),this.mediaStream=i,this.constraints=t,this.emit(TrackEvent.Restarted,this),this}setTrackMuted(t){livekitLogger.debug("setting ".concat(this.kind," track ").concat(t?"muted":"unmuted")),!(this.isMuted===t&&this._mediaStreamTrack.enabled!==t)&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?TrackEvent.Muted:TrackEvent.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}async handleAppVisibilityChanged(){await super.handleAppVisibilityChanged(),isMobile()&&(livekitLogger.debug("visibility changed, is in Background: ".concat(this.isInBackground)),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(livekitLogger.debug("track needs to be reaquired, restarting ".concat(this.source)),await this.restart(),this.reacquireTrack=!1))}async pauseUpstream(){this.muteQueue.run(async()=>{if(this._isUpstreamPaused===!0)return;if(!this.sender){livekitLogger.warn("unable to pause upstream for an unpublished track");return}this._isUpstreamPaused=!0,this.emit(TrackEvent.UpstreamPaused,this);const t=this.kind===Track.Kind.Audio?getEmptyAudioStreamTrack():getEmptyVideoStreamTrack();await this.sender.replaceTrack(t)})}async resumeUpstream(){this.muteQueue.run(async()=>{if(this._isUpstreamPaused!==!1){if(!this.sender){livekitLogger.warn("unable to resume upstream for an unpublished track");return}this._isUpstreamPaused=!1,this.emit(TrackEvent.UpstreamResumed,this),await this.sender.replaceTrack(this._mediaStreamTrack)}})}}class LocalAudioTrack extends LocalTrack{constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;super(t,Track.Kind.Audio,n,i),this.stopOnMute=!1,this.monitorSender=async()=>{if(!this.sender){this._currentBitrate=0;return}let a;try{a=await this.getSenderStats()}catch(o){livekitLogger.error("could not get audio sender stats",{error:o});return}a&&this.prevStats&&(this._currentBitrate=computeBitrate(a,this.prevStats)),this.prevStats=a},this.checkForSilence()}async setDeviceId(t){this.constraints.deviceId!==t&&(this.constraints.deviceId=t,this.isMuted||await this.restartTrack())}async mute(){return await this.muteQueue.run(async()=>{this.source===Track.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(livekitLogger.debug("stopping mic track"),this._mediaStreamTrack.stop()),await super.mute()}),this}async unmute(){return await this.muteQueue.run(async()=>{this.source===Track.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended")&&!this.isUserProvided&&(livekitLogger.debug("reacquiring mic track"),await this.restartTrack()),await super.unmute()}),this}async restartTrack(t){let n;if(t){const i=constraintsForOptions({audio:t});typeof i.audio!="boolean"&&(n=i.audio)}await this.restart(n)}async restart(t){const n=await super.restart(t);return this.checkForSilence(),n}startMonitor(){isWeb()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},monitorFrequency)))}async getSenderStats(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return;const n=await this.sender.getStats();let i;return n.forEach(a=>{a.type==="outbound-rtp"&&(i={type:"audio",streamId:a.id,packetsSent:a.packetsSent,packetsLost:a.packetsLost,bytesSent:a.bytesSent,timestamp:a.timestamp,roundTripTime:a.roundTripTime,jitter:a.jitter})}),i}async checkForSilence(){const t=await detectSilence(this);return t&&(this.isMuted||livekitLogger.warn("silence detected on local audio track"),this.emit(TrackEvent.AudioSilenceDetected)),t}}const refreshSubscribedCodecAfterNewCodec=5e3;class LocalVideoTrack extends LocalTrack{constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;super(t,Track.Kind.Video,n,i),this.simulcastCodecs=new Map,this.monitorSender=async()=>{if(!this.sender){this._currentBitrate=0;return}let a;try{a=await this.getSenderStats()}catch(c){livekitLogger.error("could not get audio sender stats",{error:c});return}const o=new Map(a.map(c=>[c.rid,c]));if(this.prevStats){let c=0;o.forEach((d,u)=>{var l;const h=(l=this.prevStats)===null||l===void 0?void 0:l.get(u);c+=computeBitrate(d,h)}),this._currentBitrate=c}this.prevStats=o},this.senderLock=new Mutex}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(t){var n;if(this.signalClient=t,!isWeb())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},monitorFrequency))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(t=>{t.mediaStreamTrack.stop()}),super.stop()}async mute(){return await this.muteQueue.run(async()=>{this.source===Track.Source.Camera&&!this.isUserProvided&&(livekitLogger.debug("stopping camera track"),this._mediaStreamTrack.stop()),await super.mute()}),this}async unmute(){return await this.muteQueue.run(async()=>{this.source===Track.Source.Camera&&!this.isUserProvided&&(livekitLogger.debug("reacquiring camera track"),await this.restartTrack()),await super.unmute()}),this}async getSenderStats(){var t;if(!(!((t=this.sender)===null||t===void 0)&&t.getStats))return[];const n=[],i=await this.sender.getStats();return i.forEach(a=>{var o;if(a.type==="outbound-rtp"){const c={type:"video",streamId:a.id,frameHeight:a.frameHeight,frameWidth:a.frameWidth,firCount:a.firCount,pliCount:a.pliCount,nackCount:a.nackCount,packetsSent:a.packetsSent,bytesSent:a.bytesSent,framesSent:a.framesSent,timestamp:a.timestamp,rid:(o=a.rid)!==null&&o!==void 0?o:a.id,retransmittedPacketsSent:a.retransmittedPacketsSent,qualityLimitationReason:a.qualityLimitationReason,qualityLimitationResolutionChanges:a.qualityLimitationResolutionChanges},d=i.get(a.remoteId);d&&(c.jitter=d.jitter,c.packetsLost=d.packetsLost,c.roundTripTime=d.roundTripTime),n.push(c)}}),n}setPublishingQuality(t){const n=[];for(let i=VideoQuality.LOW;i<=VideoQuality.HIGH;i+=1)n.push({quality:i,enabled:i<=t});livekitLogger.debug("setting publishing quality. max quality ".concat(t)),this.setPublishingLayers(n)}async setDeviceId(t){this.constraints.deviceId!==t&&(this.constraints.deviceId=t,this.isMuted||await this.restartTrack())}async restartTrack(t){let n;if(t){const i=constraintsForOptions({video:t});typeof i.video!="boolean"&&(n=i.video)}await this.restart(n)}addSimulcastTrack(t,n){if(this.simulcastCodecs.has(t))throw new Error("".concat(t," already added"));const i={codec:t,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(t,i),i}setSimulcastTrackSender(t,n){const i=this.simulcastCodecs.get(t);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},refreshSubscribedCodecAfterNewCodec))}async setPublishingCodecs(t){if(livekitLogger.debug("setting publishing codecs",{codecs:t,currentCodec:this.codec}),!this.codec&&t.length>0)return await this.setPublishingLayers(t[0].qualities),[];this.subscribedCodecs=t;const n=[];var i=!1,a=!1,o;try{for(var c=_asyncIterator(t),d;i=!(d=await c.next()).done;i=!1){const u=d.value;if(!this.codec||this.codec===u.codec)await this.setPublishingLayers(u.qualities);else{const l=this.simulcastCodecs.get(u.codec);if(livekitLogger.debug("try setPublishingCodec for ".concat(u.codec),l),!l||!l.sender){for(const h of u.qualities)if(h.enabled){n.push(u.codec);break}}else l.encodings&&(livekitLogger.debug("try setPublishingLayersForSender ".concat(u.codec)),await setPublishingLayersForSender(l.sender,l.encodings,u.qualities,this.senderLock))}}}catch(u){a=!0,o=u}finally{try{i&&c.return!=null&&await c.return()}finally{if(a)throw o}}return n}async setPublishingLayers(t){livekitLogger.debug("setting publishing layers",t),!(!this.sender||!this.encodings)&&await setPublishingLayersForSender(this.sender,this.encodings,t,this.senderLock)}async handleAppVisibilityChanged(){await super.handleAppVisibilityChanged(),isMobile()&&this.isInBackground&&this.source===Track.Source.Camera&&(this._mediaStreamTrack.enabled=!1)}}async function setPublishingLayersForSender(e,t,n,i){const a=await i.lock();livekitLogger.debug("setPublishingLayersForSender",{sender:e,qualities:n,senderEncodings:t});try{const o=e.getParameters(),{encodings:c}=o;if(!c)return;if(c.length!==t.length){livekitLogger.warn("cannot set publishing layers, encodings mismatch");return}let d=!1;c.forEach((u,l)=>{var h;let p=(h=u.rid)!==null&&h!==void 0?h:"";p===""&&(p="q");const y=videoQualityForRid(p),E=n.find(x=>x.quality===y);E&&u.active!==E.enabled&&(d=!0,u.active=E.enabled,livekitLogger.debug("setting layer ".concat(E.quality," to ").concat(u.active?"enabled":"disabled")),isFireFox()&&(E.enabled?(u.scaleResolutionDownBy=t[l].scaleResolutionDownBy,u.maxBitrate=t[l].maxBitrate,u.maxFrameRate=t[l].maxFrameRate):(u.scaleResolutionDownBy=4,u.maxBitrate=10,u.maxFrameRate=2)))}),d&&(o.encodings=c,await e.setParameters(o))}finally{a()}}function videoQualityForRid(e){switch(e){case"f":return VideoQuality.HIGH;case"h":return VideoQuality.MEDIUM;case"q":return VideoQuality.LOW;default:return VideoQuality.UNRECOGNIZED}}function videoLayersFromEncodings(e,t,n){return n?n.map(i=>{var a,o,c;const d=(a=i.scaleResolutionDownBy)!==null&&a!==void 0?a:1;let u=videoQualityForRid((o=i.rid)!==null&&o!==void 0?o:"");return u===VideoQuality.UNRECOGNIZED&&n.length===1&&(u=VideoQuality.HIGH),{quality:u,width:e/d,height:t/d,bitrate:(c=i.maxBitrate)!==null&&c!==void 0?c:0,ssrc:0}}):[{quality:VideoQuality.HIGH,width:e,height:t,bitrate:0,ssrc:0}]}class RemoteTrack extends Track{constructor(t,n,i,a){super(t,i),this.sid=n,this.receiver=a}setMuted(t){this.isMuted!==t&&(this.isMuted=t,this._mediaStreamTrack.enabled=!t,this.emit(t?TrackEvent.Muted:TrackEvent.Unmuted,this))}setMediaStream(t){this.mediaStream=t,t.onremovetrack=()=>{this.receiver=void 0,this._currentBitrate=0,this.emit(TrackEvent.Ended,this)}}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),monitorFrequency))}}class RemoteAudioTrack extends RemoteTrack{constructor(t,n,i,a,o){super(t,n,Track.Kind.Audio,i),this.monitorReceiver=async()=>{if(!this.receiver){this._currentBitrate=0;return}const c=await this.getReceiverStats();c&&this.prevStats&&this.receiver&&(this._currentBitrate=computeBitrate(c,this.prevStats)),this.prevStats=c},this.audioContext=a,this.webAudioPluginNodes=[],o&&(this.sinkId=o.deviceId)}setVolume(t){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(t,0,.1):i.volume=t;this.elementVolume=t}getVolume(){if(this.elementVolume)return this.elementVolume;let t=0;return this.attachedElements.forEach(n=>{n.volume>t&&(t=n.volume)}),t}async setSinkId(t){this.sinkId=t,await Promise.all(this.attachedElements.map(n=>{if(supportsSetSinkId(n))return n.setSinkId(t)}))}attach(t){const n=this.attachedElements.length===0;return t?super.attach(t):t=super.attach(),this.elementVolume&&(t.volume=this.elementVolume),this.sinkId&&supportsSetSinkId(t)&&t.setSinkId(this.sinkId),this.audioContext&&n&&(livekitLogger.debug("using audio context mapping"),this.connectWebAudio(this.audioContext,t),t.volume=0,t.muted=!0),t}detach(t){let n;return t?(n=super.detach(t),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(t){this.audioContext=t,t&&this.attachedElements.length>0?this.connectWebAudio(t,this.attachedElements[0]):t||this.disconnectWebAudio()}setWebAudioPlugins(t){this.webAudioPluginNodes=t,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(t,n){this.disconnectWebAudio(),this.sourceNode=t.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(a=>{i.connect(a),i=a}),this.gainNode=t.createGain(),i.connect(this.gainNode),this.gainNode.connect(t.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),t.state!=="running"&&t.resume().then(()=>{t.state!=="running"&&this.emit(TrackEvent.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(a=>{this.emit(TrackEvent.AudioPlaybackFailed,a)})}disconnectWebAudio(){var t,n;(t=this.gainNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}async getReceiverStats(){if(!this.receiver||!this.receiver.getStats)return;const t=await this.receiver.getStats();let n;return t.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n}}function r(e,t,n){var i,a,o;t===void 0&&(t=50),n===void 0&&(n={});var c=(i=n.isImmediate)!=null&&i,d=(a=n.callback)!=null&&a,u=n.maxWait,l=Date.now(),h=[];function p(){if(u!==void 0){var E=Date.now()-l;if(E+t>=u)return u-E}return t}var y=function(){var E=[].slice.call(arguments),x=this;return new Promise(function(S,k){var T=c&&o===void 0;if(o!==void 0&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,l=Date.now(),!c){var q=e.apply(x,E);d&&d(q),h.forEach(function(U){return(0,U.resolve)(q)}),h=[]}},p()),T){var L=e.apply(x,E);return d&&d(L),S(L)}h.push({resolve:S,reject:k})})};return y.cancel=function(E){o!==void 0&&clearTimeout(o),h.forEach(function(x){return(0,x.reject)(E)}),h=[]},y}class CriticalTimers{}CriticalTimers.setTimeout=function(){return setTimeout(...arguments)};CriticalTimers.setInterval=function(){return setInterval(...arguments)};CriticalTimers.clearTimeout=function(){return clearTimeout(...arguments)};CriticalTimers.clearInterval=function(){return clearInterval(...arguments)};const REACTION_DELAY=100;class RemoteVideoTrack extends RemoteTrack{constructor(t,n,i,a){super(t,n,Track.Kind.Video,i),this.elementInfos=[],this.hasUsedAttach=!1,this.monitorReceiver=async()=>{if(!this.receiver){this._currentBitrate=0;return}const o=await this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=computeBitrate(o,this.prevStats)),this.prevStats=o},this.debouncedHandleResize=r(()=>{this.updateDimensions()},REACTION_DELAY),this.adaptiveStreamSettings=a}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this.isAdaptiveStream&&!this.hasUsedAttach&&livekitLogger.warn("When using adaptiveStream, you need to use remoteVideoTrack.attach() to add the track to a HTMLVideoElement, otherwise your video tracks might never start"),this._mediaStreamTrack}setMuted(t){super.setMuted(t),this.attachedElements.forEach(n=>{t?detachTrack(this._mediaStreamTrack,n):attachToElement(this._mediaStreamTrack,n)})}attach(t){if(t?super.attach(t):t=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===t)===void 0){const n=new HTMLElementInfo(t);this.observeElementInfo(n)}return this.hasUsedAttach=!0,t}observeElementInfo(t){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===t)===void 0?(t.handleResize=()=>{this.debouncedHandleResize()},t.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(t),t.observe(),this.debouncedHandleResize(),this.updateVisibility()):livekitLogger.warn("visibility resize observer not triggered")}stopObservingElementInfo(t){if(!this.isAdaptiveStream){livekitLogger.warn("stopObservingElementInfo ignored");return}const n=this.elementInfos.filter(i=>i===t);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==t),this.updateVisibility()}detach(t){let n=[];if(t)return this.stopObservingElement(t),super.detach(t);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var t;return(t=this.prevStats)===null||t===void 0?void 0:t.decoderImplementation}async getReceiverStats(){if(!this.receiver||!this.receiver.getStats)return;const t=await this.receiver.getStats();let n;return t.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"video",framesDecoded:i.framesDecoded,framesDropped:i.framesDropped,framesReceived:i.framesReceived,packetsReceived:i.packetsReceived,packetsLost:i.packetsLost,frameWidth:i.frameWidth,frameHeight:i.frameHeight,pliCount:i.pliCount,firCount:i.firCount,nackCount:i.nackCount,jitter:i.jitter,timestamp:i.timestamp,bytesReceived:i.bytesReceived,decoderImplementation:i.decoderImplementation})}),n}stopObservingElement(t){const n=this.elementInfos.filter(i=>i.element===t);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i.element!==t)}async handleAppVisibilityChanged(){await super.handleAppVisibilityChanged(),this.isAdaptiveStream&&this.updateVisibility()}updateVisibility(){var t,n;const i=this.elementInfos.reduce((d,u)=>Math.max(d,u.visibilityChangedAt||0),0),a=!((n=(t=this.adaptiveStreamSettings)===null||t===void 0?void 0:t.pauseVideoInBackground)!==null&&n!==void 0)||n?this.isInBackground:!1,o=this.elementInfos.some(d=>d.pictureInPicture),c=this.elementInfos.some(d=>d.visible)&&!a||o;if(this.lastVisible!==c){if(!c&&Date.now()-i<REACTION_DELAY){CriticalTimers.setTimeout(()=>{this.updateVisibility()},REACTION_DELAY);return}this.lastVisible=c,this.emit(TrackEvent.VisibilityChanged,c,this)}}updateDimensions(){var t,n,i,a;let o=0,c=0;for(const d of this.elementInfos){const u=(n=(t=this.adaptiveStreamSettings)===null||t===void 0?void 0:t.pixelDensity)!==null&&n!==void 0?n:1,l=u==="screen"?window.devicePixelRatio:u,h=d.width()*l,p=d.height()*l;h+p>o+c&&(o=h,c=p)}((i=this.lastDimensions)===null||i===void 0?void 0:i.width)===o&&((a=this.lastDimensions)===null||a===void 0?void 0:a.height)===c||(this.lastDimensions={width:o,height:c},this.emit(TrackEvent.VideoDimensionsChanged,this.lastDimensions,this))}}class HTMLElementInfo{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(t,n){this.onVisibilityChanged=i=>{var a;const{target:o,isIntersecting:c}=i;o===this.element&&(this.isIntersecting=c,this.visibilityChangedAt=Date.now(),(a=this.handleVisibilityChanged)===null||a===void 0||a.call(this))},this.onEnterPiP=()=>{var i;this.isPiP=!0,(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=!1,(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=t,this.isIntersecting=n??isElementInViewport(t),this.isPiP=isWeb()&&document.pictureInPictureElement===t,this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){this.isIntersecting=isElementInViewport(this.element),this.isPiP=document.pictureInPictureElement===this.element,this.element.handleResize=()=>{var t;(t=this.handleResize)===null||t===void 0||t.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,getIntersectionObserver().observe(this.element),getResizeObserver().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP)}stopObserving(){var t,n;(t=getIntersectionObserver())===null||t===void 0||t.unobserve(this.element),(n=getResizeObserver())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP)}}function isElementInViewport(e){let t=e.offsetTop,n=e.offsetLeft;const i=e.offsetWidth,a=e.offsetHeight,{hidden:o}=e,{opacity:c,display:d}=getComputedStyle(e);for(;e.offsetParent;)e=e.offsetParent,t+=e.offsetTop,n+=e.offsetLeft;return t<window.pageYOffset+window.innerHeight&&n<window.pageXOffset+window.innerWidth&&t+a>window.pageYOffset&&n+i>window.pageXOffset&&!o&&(c!==""?parseFloat(c)>0:!0)&&d!=="none"}class TrackPublication extends eventsExports.EventEmitter{constructor(t,n,i){super(),this.metadataMuted=!1,this.handleMuted=()=>{this.emit(TrackEvent.Muted)},this.handleUnmuted=()=>{this.emit(TrackEvent.Unmuted)},this.setMaxListeners(100),this.kind=t,this.trackSid=n,this.trackName=i,this.source=Track.Source.Unknown}setTrack(t){this.track&&(this.track.off(TrackEvent.Muted,this.handleMuted),this.track.off(TrackEvent.Unmuted,this.handleUnmuted)),this.track=t,t&&(t.on(TrackEvent.Muted,this.handleMuted),t.on(TrackEvent.Unmuted,this.handleUnmuted))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get audioTrack(){if(this.track instanceof LocalAudioTrack||this.track instanceof RemoteAudioTrack)return this.track}get videoTrack(){if(this.track instanceof LocalVideoTrack||this.track instanceof RemoteVideoTrack)return this.track}updateInfo(t){this.trackSid=t.sid,this.trackName=t.name,this.source=Track.sourceFromProto(t.source),this.mimeType=t.mimeType,this.kind===Track.Kind.Video&&t.width>0&&(this.dimensions={width:t.width,height:t.height},this.simulcasted=t.simulcast),this.trackInfo=t,livekitLogger.trace("update publication info",{info:t})}}(function(e){(function(t){t.Desired="desired",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed"})(e.SubscriptionStatus||(e.SubscriptionStatus={})),function(t){t.Allowed="allowed",t.NotAllowed="not_allowed"}(e.PermissionStatus||(e.PermissionStatus={}))})(TrackPublication||(TrackPublication={}));class LocalTrackPublication extends TrackPublication{get isUpstreamPaused(){var t;return(t=this.track)===null||t===void 0?void 0:t.isUpstreamPaused}constructor(t,n,i){super(t,n.sid,n.name),this.track=void 0,this.handleTrackEnded=()=>{this.emit(TrackEvent.Ended)},this.updateInfo(n),this.setTrack(i)}setTrack(t){this.track&&this.track.off(TrackEvent.Ended,this.handleTrackEnded),super.setTrack(t),t&&t.on(TrackEvent.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}async mute(){var t;return(t=this.track)===null||t===void 0?void 0:t.mute()}async unmute(){var t;return(t=this.track)===null||t===void 0?void 0:t.unmute()}async pauseUpstream(){var t;await((t=this.track)===null||t===void 0?void 0:t.pauseUpstream())}async resumeUpstream(){var t;await((t=this.track)===null||t===void 0?void 0:t.resumeUpstream())}}class VideoPreset{constructor(t,n,i,a){this.width=t,this.height=n,this.encoding={maxBitrate:i,maxFramerate:a}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.width/this.height}}}const backupCodecs=["vp8","h264"];function isBackupCodec(e){return!!backupCodecs.find(t=>t===e)}var AudioPresets;(function(e){e.telephone={maxBitrate:12e3},e.speech={maxBitrate:2e4},e.music={maxBitrate:32e3},e.musicStereo={maxBitrate:48e3},e.musicHighQuality={maxBitrate:64e3},e.musicHighQualityStereo={maxBitrate:96e3}})(AudioPresets||(AudioPresets={}));const VideoPresets={h90:new VideoPreset(160,90,6e4,15),h180:new VideoPreset(320,180,12e4,15),h216:new VideoPreset(384,216,18e4,15),h360:new VideoPreset(640,360,3e5,20),h540:new VideoPreset(960,540,6e5,25),h720:new VideoPreset(1280,720,17e5,30),h1080:new VideoPreset(1920,1080,3e6,30),h1440:new VideoPreset(2560,1440,5e6,30),h2160:new VideoPreset(3840,2160,8e6,30)},VideoPresets43={h120:new VideoPreset(160,120,8e4,15),h180:new VideoPreset(240,180,1e5,15),h240:new VideoPreset(320,240,15e4,15),h360:new VideoPreset(480,360,225e3,20),h480:new VideoPreset(640,480,3e5,20),h540:new VideoPreset(720,540,45e4,25),h720:new VideoPreset(960,720,15e5,30),h1080:new VideoPreset(1440,1080,25e5,30),h1440:new VideoPreset(1920,1440,35e5,30)},ScreenSharePresets={h360fps3:new VideoPreset(640,360,2e5,3),h720fps5:new VideoPreset(1280,720,4e5,5),h720fps15:new VideoPreset(1280,720,1e6,15),h1080fps15:new VideoPreset(1920,1080,15e5,15),h1080fps30:new VideoPreset(1920,1080,3e6,30)};var ConnectionQuality;(function(e){e.Excellent="excellent",e.Good="good",e.Poor="poor",e.Unknown="unknown"})(ConnectionQuality||(ConnectionQuality={}));function qualityFromProto(e){switch(e){case ConnectionQuality$1.EXCELLENT:return ConnectionQuality.Excellent;case ConnectionQuality$1.GOOD:return ConnectionQuality.Good;case ConnectionQuality$1.POOR:return ConnectionQuality.Poor;default:return ConnectionQuality.Unknown}}class Participant extends eventsExports.EventEmitter{constructor(t,n,i,a){super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=ConnectionQuality.Unknown,this.setMaxListeners(100),this.sid=t,this.identity=n,this.name=i,this.metadata=a,this.audioTracks=new Map,this.videoTracks=new Map,this.tracks=new Map}getTracks(){return Array.from(this.tracks.values())}getTrack(t){for(const[,n]of this.tracks)if(n.source===t)return n}getTrackByName(t){for(const[,n]of this.tracks)if(n.trackName===t)return n}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var t;const n=this.getTrack(Track.Source.Camera);return!(!((t=n==null?void 0:n.isMuted)!==null&&t!==void 0)||t)}get isMicrophoneEnabled(){var t;const n=this.getTrack(Track.Source.Microphone);return!(!((t=n==null?void 0:n.isMuted)!==null&&t!==void 0)||t)}get isScreenShareEnabled(){return!!this.getTrack(Track.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(this.participantInfo.joinedAt*1e3):new Date}updateInfo(t){this.identity=t.identity,this.sid=t.sid,this.name=t.name,this.setMetadata(t.metadata),t.permission&&this.setPermissions(t.permission),this.participantInfo=t,livekitLogger.trace("update participant info",{info:t})}setMetadata(t){const n=this.metadata!==t,i=this.metadata;this.metadata=t,n&&this.emit(ParticipantEvent.ParticipantMetadataChanged,i)}setPermissions(t){var n,i,a,o,c;const d=this.permissions,u=t.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||t.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||t.canPublishData!==((a=this.permissions)===null||a===void 0?void 0:a.canPublishData)||t.hidden!==((o=this.permissions)===null||o===void 0?void 0:o.hidden)||t.recorder!==((c=this.permissions)===null||c===void 0?void 0:c.recorder)||t.canPublishSources.length!==this.permissions.canPublishSources.length||t.canPublishSources.some((l,h)=>{var p;return l!==((p=this.permissions)===null||p===void 0?void 0:p.canPublishSources[h])});return this.permissions=t,u&&this.emit(ParticipantEvent.ParticipantPermissionsChanged,d),u}setIsSpeaking(t){t!==this.isSpeaking&&(this.isSpeaking=t,t&&(this.lastSpokeAt=new Date),this.emit(ParticipantEvent.IsSpeakingChanged,t))}setConnectionQuality(t){const n=this._connectionQuality;this._connectionQuality=qualityFromProto(t),n!==this._connectionQuality&&this.emit(ParticipantEvent.ConnectionQualityChanged,this._connectionQuality)}addTrackPublication(t){t.on(TrackEvent.Muted,()=>{this.emit(ParticipantEvent.TrackMuted,t)}),t.on(TrackEvent.Unmuted,()=>{this.emit(ParticipantEvent.TrackUnmuted,t)});const n=t;switch(n.track&&(n.track.sid=t.trackSid),this.tracks.set(t.trackSid,t),t.kind){case Track.Kind.Audio:this.audioTracks.set(t.trackSid,t);break;case Track.Kind.Video:this.videoTracks.set(t.trackSid,t);break}}}function trackPermissionToProto(e){var t,n,i;if(!e.participantSid&&!e.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return{participantIdentity:(t=e.participantIdentity)!==null&&t!==void 0?t:"",participantSid:(n=e.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=e.allowAll)!==null&&i!==void 0?i:!1,trackSids:e.allowedTrackSids||[]}}function mediaTrackToLocalTrack(e,t){switch(e.kind){case"audio":return new LocalAudioTrack(e,t,!1);case"video":return new LocalVideoTrack(e,t,!1);default:throw new TrackInvalidError("unsupported track type: ".concat(e.kind))}}const presets169=Object.values(VideoPresets),presets43=Object.values(VideoPresets43),presetsScreenShare=Object.values(ScreenSharePresets),defaultSimulcastPresets169=[VideoPresets.h180,VideoPresets.h360],defaultSimulcastPresets43=[VideoPresets43.h180,VideoPresets43.h360],computeDefaultScreenShareSimulcastPresets=e=>[{scaleResolutionDownBy:2,fps:3}].map(n=>{var i;return new VideoPreset(Math.floor(e.width/n.scaleResolutionDownBy),Math.floor(e.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(e.encoding.maxBitrate/(n.scaleResolutionDownBy**2*(((i=e.encoding.maxFramerate)!==null&&i!==void 0?i:30)/n.fps)))),n.fps)}),videoRids=["q","h","f"];function computeVideoEncodings(e,t,n,i){var a,o;let c=i==null?void 0:i.videoEncoding;e&&(c=i==null?void 0:i.screenShareEncoding);const d=i==null?void 0:i.simulcast,u=i==null?void 0:i.scalabilityMode,l=i==null?void 0:i.videoCodec;if(!c&&!d&&!u||!t||!n)return[{}];c||(c=determineAppropriateEncoding(e,t,n,l),livekitLogger.debug("using video encoding",c));const h=new VideoPreset(t,n,c.maxBitrate,c.maxFramerate);if(u&&l==="av1"){livekitLogger.debug("using svc with scalabilityMode ".concat(u));const E=[];switch(u){case"L3T3":for(let x=0;x<3;x+=1)E.push({rid:videoRids[2-x],scaleResolutionDownBy:2**x,maxBitrate:c.maxBitrate/3**x,maxFramerate:h.encoding.maxFramerate,scalabilityMode:"L3T3"});return livekitLogger.debug("encodings",E),E;default:throw new Error("unsupported scalabilityMode: ".concat(u))}}if(!d)return[c];let p=[];e?p=(a=sortPresets(i==null?void 0:i.screenShareSimulcastLayers))!==null&&a!==void 0?a:defaultSimulcastLayers(e,h):p=(o=sortPresets(i==null?void 0:i.videoSimulcastLayers))!==null&&o!==void 0?o:defaultSimulcastLayers(e,h);let y;if(p.length>0){const E=p[0];p.length>1&&([,y]=p);const x=Math.max(t,n);if(x>=960&&y)return encodingsFromPresets(t,n,[E,y,h]);if(x>=480)return encodingsFromPresets(t,n,[E,h])}return encodingsFromPresets(t,n,[h])}function computeTrackBackupEncodings(e,t,n){var i,a,o,c;if(!n.backupCodec||n.backupCodec.codec===n.videoCodec)return;t!==n.backupCodec.codec&&livekitLogger.warn("requested a different codec than specified as backup",{serverRequested:t,backup:n.backupCodec.codec}),n.videoCodec=t,n.videoEncoding=n.backupCodec.encoding;const d=e.mediaStreamTrack.getSettings(),u=(i=d.width)!==null&&i!==void 0?i:(a=e.dimensions)===null||a===void 0?void 0:a.width,l=(o=d.height)!==null&&o!==void 0?o:(c=e.dimensions)===null||c===void 0?void 0:c.height;return computeVideoEncodings(e.source===Track.Source.ScreenShare,u,l,n)}function determineAppropriateEncoding(e,t,n,i){const a=presetsForResolution(e,t,n);let{encoding:o}=a[0];const c=Math.max(t,n);for(let d=0;d<a.length;d+=1){const u=a[d];if(o=u.encoding,u.width>=c)break}if(i)switch(i){case"av1":o.maxBitrate=o.maxBitrate*.7;break}return o}function presetsForResolution(e,t,n){if(e)return presetsScreenShare;const i=t>n?t/n:n/t;return Math.abs(i-16/9)<Math.abs(i-4/3)?presets169:presets43}function defaultSimulcastLayers(e,t){if(e)return computeDefaultScreenShareSimulcastPresets(t);const{width:n,height:i}=t,a=n>i?n/i:i/n;return Math.abs(a-16/9)<Math.abs(a-4/3)?defaultSimulcastPresets169:defaultSimulcastPresets43}function encodingsFromPresets(e,t,n){const i=[];return n.forEach((a,o)=>{if(o>=videoRids.length)return;const c=Math.min(e,t),d=videoRids[o];i.push({rid:d,scaleResolutionDownBy:Math.max(1,c/Math.min(a.width,a.height)),maxBitrate:a.encoding.maxBitrate,maxFramerate:a.encoding.maxFramerate})}),i}function sortPresets(e){if(e)return e.sort((t,n)=>{const{encoding:i}=t,{encoding:a}=n;return i.maxBitrate>a.maxBitrate?1:i.maxBitrate<a.maxBitrate?-1:i.maxBitrate===a.maxBitrate&&i.maxFramerate&&a.maxFramerate?i.maxFramerate>a.maxFramerate?1:-1:0})}class RemoteTrackPublication extends TrackPublication{constructor(t,n,i){super(t,n.sid,n.name),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=VideoQuality.HIGH,this.handleEnded=a=>{this.setTrack(void 0),this.emit(TrackEvent.Ended,a)},this.handleVisibilityChange=a=>{livekitLogger.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(a),{trackSid:this.trackSid}),this.disabled=!a,this.emitTrackUpdate()},this.handleVideoDimensionsChange=a=>{livekitLogger.debug("adaptivestream video dimensions ".concat(a.width,"x").concat(a.height),{trackSid:this.trackSid}),this.videoDimensions=a,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(t){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=t,t&&(this.allowed=!0);const a={trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[{participantSid:"",trackSids:[this.trackSid]}]};this.emit(TrackEvent.UpdateSubscription,a),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?TrackPublication.SubscriptionStatus.Unsubscribed:super.isSubscribed?TrackPublication.SubscriptionStatus.Subscribed:TrackPublication.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?TrackPublication.PermissionStatus.Allowed:TrackPublication.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return!this.disabled}setEnabled(t){!this.isManualOperationAllowed()||this.disabled===!t||(this.disabled=!t,this.emitTrackUpdate())}setVideoQuality(t){!this.isManualOperationAllowed()||this.currentVideoQuality===t||(this.currentVideoQuality=t,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(t){var n,i;this.isManualOperationAllowed()&&(((n=this.videoDimensions)===null||n===void 0?void 0:n.width)===t.width&&((i=this.videoDimensions)===null||i===void 0?void 0:i.height)===t.height||(this.track instanceof RemoteVideoTrack&&(this.videoDimensions=t),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(t){this.isManualOperationAllowed()&&this.track instanceof RemoteVideoTrack&&this.fps!==t&&(this.fps=t,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(t){const n=this.subscriptionStatus,i=this.permissionStatus,a=this.track;a!==t&&(a&&(a.off(TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),a.off(TrackEvent.VisibilityChanged,this.handleVisibilityChange),a.off(TrackEvent.Ended,this.handleEnded),a.detach(),this.emit(TrackEvent.Unsubscribed,a)),super.setTrack(t),t&&(t.sid=this.trackSid,t.on(TrackEvent.VideoDimensionsChanged,this.handleVideoDimensionsChange),t.on(TrackEvent.VisibilityChanged,this.handleVisibilityChange),t.on(TrackEvent.Ended,this.handleEnded),this.emit(TrackEvent.Subscribed,t)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(t){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=t,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}updateInfo(t){super.updateInfo(t);const n=this.metadataMuted;this.metadataMuted=t.muted,this.track?this.track.setMuted(t.muted):n!==t.muted&&this.emit(t.muted?TrackEvent.Muted:TrackEvent.Unmuted)}emitSubscriptionUpdateIfChanged(t){const n=this.subscriptionStatus;t!==n&&this.emit(TrackEvent.SubscriptionStatusChanged,n,t)}emitPermissionUpdateIfChanged(t){this.permissionStatus!==t&&this.emit(TrackEvent.SubscriptionPermissionChanged,this.permissionStatus,t)}isManualOperationAllowed(){return this.isAdaptiveStream?(livekitLogger.warn("adaptive stream is enabled, cannot change track settings",{trackSid:this.trackSid}),!1):this.isDesired?!0:(livekitLogger.warn("cannot update track settings when not subscribed",{trackSid:this.trackSid}),!1)}get isAdaptiveStream(){return this.track instanceof RemoteVideoTrack&&this.track.isAdaptiveStream}emitTrackUpdate(){const t=UpdateTrackSettings.fromPartial({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(t.width=this.videoDimensions.width,t.height=this.videoDimensions.height):this.currentVideoQuality!==void 0?t.quality=this.currentVideoQuality:t.quality=VideoQuality.HIGH,this.emit(TrackEvent.UpdateSettings,t)}}class RemoteParticipant extends Participant{static fromParticipantInfo(t,n){return new RemoteParticipant(t,n.sid,n.identity,n.name,n.metadata)}constructor(t,n,i,a,o){super(n,i||"",a,o),this.signalClient=t,this.tracks=new Map,this.audioTracks=new Map,this.videoTracks=new Map}addTrackPublication(t){super.addTrackPublication(t),t.on(TrackEvent.UpdateSettings,n=>{livekitLogger.debug("send update settings",n),this.signalClient.sendUpdateTrackSettings(n)}),t.on(TrackEvent.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),t.on(TrackEvent.SubscriptionPermissionChanged,n=>{this.emit(ParticipantEvent.TrackSubscriptionPermissionChanged,t,n)}),t.on(TrackEvent.SubscriptionStatusChanged,n=>{this.emit(ParticipantEvent.TrackSubscriptionStatusChanged,t,n)}),t.on(TrackEvent.Subscribed,n=>{this.emit(ParticipantEvent.TrackSubscribed,n,t)}),t.on(TrackEvent.Unsubscribed,n=>{this.emit(ParticipantEvent.TrackUnsubscribed,n,t)})}getTrack(t){const n=super.getTrack(t);if(n)return n}getTrackByName(t){const n=super.getTrackByName(t);if(n)return n}setVolume(t){this.volume=t;const n=this.getTrack(Track.Source.Microphone);n&&n.track&&n.track.setVolume(t)}getVolume(){const t=this.getTrack(Track.Source.Microphone);return t&&t.track?t.track.getVolume():this.volume}addSubscribedMediaTrack(t,n,i,a,o,c){let d=this.getTrackPublication(n);if(d||n.startsWith("TR")||this.tracks.forEach(h=>{!d&&t.kind===h.kind.toString()&&(d=h)}),!d){if(c===0){livekitLogger.error("could not find published track",{participant:this.sid,trackSid:n}),this.emit(ParticipantEvent.TrackSubscriptionFailed,n);return}c===void 0&&(c=20),setTimeout(()=>{this.addSubscribedMediaTrack(t,n,i,a,o,c-1)},150);return}if(t.readyState==="ended"){livekitLogger.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",{participant:this.sid,trackSid:n}),this.emit(ParticipantEvent.TrackSubscriptionFailed,n);return}const u=t.kind==="video";let l;return u?l=new RemoteVideoTrack(t,n,a,o):l=new RemoteAudioTrack(t,n,a,this.audioContext,this.audioOutput),l.source=d.source,l.isMuted=d.isMuted,l.setMediaStream(i),l.start(),d.setTrack(l),this.volume!==void 0&&l instanceof RemoteAudioTrack&&l.source===Track.Source.Microphone&&l.setVolume(this.volume),d}get hasMetadata(){return!!this.participantInfo}getTrackPublication(t){return this.tracks.get(t)}updateInfo(t){super.updateInfo(t);const n=new Map,i=new Map;t.tracks.forEach(a=>{var o;let c=this.getTrackPublication(a.sid);if(c)c.updateInfo(a);else{const d=Track.kindFromProto(a.type);if(!d)return;c=new RemoteTrackPublication(d,a,(o=this.signalClient.connectOptions)===null||o===void 0?void 0:o.autoSubscribe),c.updateInfo(a),i.set(a.sid,c);const u=Array.from(this.tracks.values()).find(l=>l.source===(c==null?void 0:c.source));u&&c.source!==Track.Source.Unknown&&livekitLogger.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(c.source),{oldTrack:u,newTrack:c,participant:this,participantInfo:t}),this.addTrackPublication(c)}n.set(a.sid,c)}),this.tracks.forEach(a=>{n.has(a.trackSid)||(livekitLogger.trace("detected removed track on remote participant, unpublishing",{publication:a,participantSid:this.sid}),this.unpublishTrack(a.trackSid,!0))}),i.forEach(a=>{this.emit(ParticipantEvent.TrackPublished,a)})}unpublishTrack(t,n){const i=this.tracks.get(t);if(!i)return;switch(this.tracks.delete(t),i.kind){case Track.Kind.Audio:this.audioTracks.delete(t);break;case Track.Kind.Video:this.videoTracks.delete(t);break}const{track:a}=i;a&&(a.stop(),i.setTrack(void 0)),n&&this.emit(ParticipantEvent.TrackUnpublished,i)}setAudioContext(t){this.audioContext=t,this.audioTracks.forEach(n=>n.track instanceof RemoteAudioTrack&&n.track.setAudioContext(t))}async setAudioOutput(t){this.audioOutput=t;const n=[];this.audioTracks.forEach(i=>{var a;i.track instanceof RemoteAudioTrack&&n.push(i.track.setSinkId((a=t.deviceId)!==null&&a!==void 0?a:"default"))}),await Promise.all(n)}emit(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return livekitLogger.trace("participant event",{participant:this.sid,event:t,args:i}),super.emit(t,...i)}}class LocalParticipant extends Participant{constructor(t,n,i,a){super(t,n),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Future)},this.handleReconnected=()=>{var o,c;(c=(o=this.reconnectFuture)===null||o===void 0?void 0:o.resolve)===null||c===void 0||c.call(o),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var o,c;(c=(o=this.reconnectFuture)===null||o===void 0?void 0:o.reject)===null||c===void 0||c.call(o,"Got disconnected during publishing attempt"),this.reconnectFuture=void 0},this.updateTrackSubscriptionPermissions=()=>{livekitLogger.debug("updating track subscription permissions",{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions}),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(o=>trackPermissionToProto(o)))},this.onTrackUnmuted=o=>{this.onTrackMuted(o,o.isUpstreamPaused)},this.onTrackMuted=(o,c)=>{if(c===void 0&&(c=!0),!o.sid){livekitLogger.error("could not update mute status for unpublished track",o);return}this.engine.updateMuteStatus(o.sid,c)},this.onTrackUpstreamPaused=o=>{livekitLogger.debug("upstream paused"),this.onTrackMuted(o,!0)},this.onTrackUpstreamResumed=o=>{livekitLogger.debug("upstream resumed"),this.onTrackMuted(o,o.isMuted)},this.handleSubscribedQualityUpdate=async o=>{var c,d;if(!(!((c=this.roomOptions)===null||c===void 0)&&c.dynacast))return;const u=this.videoTracks.get(o.trackSid);if(!u){livekitLogger.warn("received subscribed quality update for unknown track",{method:"handleSubscribedQualityUpdate",sid:o.trackSid});return}if(o.subscribedCodecs.length>0){if(!u.videoTrack)return;const x=await u.videoTrack.setPublishingCodecs(o.subscribedCodecs);var l=!1,h=!1,p;try{for(var y=_asyncIterator(x),E;l=!(E=await y.next()).done;l=!1){const S=E.value;isBackupCodec(S)&&(livekitLogger.debug("publish ".concat(S," for ").concat(u.videoTrack.sid)),await this.publishAdditionalCodecForTrack(u.videoTrack,S,u.options))}}catch(S){h=!0,p=S}finally{try{l&&y.return!=null&&await y.return()}finally{if(h)throw p}}}else o.subscribedQualities.length>0&&await((d=u.videoTrack)===null||d===void 0?void 0:d.setPublishingLayers(o.subscribedQualities))},this.handleLocalTrackUnpublished=o=>{const c=this.tracks.get(o.trackSid);if(!c){livekitLogger.warn("received unpublished event for unknown track",{method:"handleLocalTrackUnpublished",trackSid:o.trackSid});return}this.unpublishTrack(c.track)},this.handleTrackEnded=async o=>{if(o.source===Track.Source.ScreenShare||o.source===Track.Source.ScreenShareAudio)livekitLogger.debug("unpublishing local track due to TrackEnded",{track:o.sid}),this.unpublishTrack(o);else if(o.isUserProvided)await o.mute();else if(o instanceof LocalAudioTrack||o instanceof LocalVideoTrack)try{if(isWeb())try{const c=await(navigator==null?void 0:navigator.permissions.query({name:o.source===Track.Source.Camera?"camera":"microphone"}));if(c&&c.state==="denied")throw livekitLogger.warn("user has revoked access to ".concat(o.source)),c.onchange=()=>{c.state!=="denied"&&(o.isMuted||o.restartTrack(),c.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}o.isMuted||(livekitLogger.debug("track ended, attempting to use a different device"),await o.restartTrack())}catch{livekitLogger.warn("could not restart track, muting instead"),await o.mute()}},this.audioTracks=new Map,this.videoTracks=new Map,this.tracks=new Map,this.engine=i,this.roomOptions=a,this.setupEngine(i)}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}getTrack(t){const n=super.getTrack(t);if(n)return n}getTrackByName(t){const n=super.getTrackByName(t);if(n)return n}setupEngine(t){this.engine=t,this.engine.client.onRemoteMuteChanged=(n,i)=>{const a=this.tracks.get(n);!a||!a.track||(i?a.mute():a.unmute())},this.engine.client.onSubscribedQualityUpdate=this.handleSubscribedQualityUpdate,this.engine.client.onLocalTrackUnpublished=this.handleLocalTrackUnpublished,this.engine.on(EngineEvent.Connected,this.handleReconnected).on(EngineEvent.Restarted,this.handleReconnected).on(EngineEvent.Resumed,this.handleReconnected).on(EngineEvent.Restarting,this.handleReconnecting).on(EngineEvent.Resuming,this.handleReconnecting).on(EngineEvent.Disconnected,this.handleDisconnected)}setCameraEnabled(t,n,i){return this.setTrackEnabled(Track.Source.Camera,t,n,i)}setMicrophoneEnabled(t,n,i){return this.setTrackEnabled(Track.Source.Microphone,t,n,i)}setScreenShareEnabled(t,n,i){return this.setTrackEnabled(Track.Source.ScreenShare,t,n,i)}async setTrackEnabled(t,n,i,a){var o,c;livekitLogger.debug("setTrackEnabled",{source:t,enabled:n});let d=this.getTrack(t);if(n)if(d)await d.unmute();else{let u;if(this.pendingPublishing.has(t)){livekitLogger.info("skipping duplicate published source",{source:t});return}this.pendingPublishing.add(t);try{switch(t){case Track.Source.Camera:u=await this.createTracks({video:(o=i)!==null&&o!==void 0?o:!0});break;case Track.Source.Microphone:u=await this.createTracks({audio:(c=i)!==null&&c!==void 0?c:!0});break;case Track.Source.ScreenShare:u=await this.createScreenTracks(_objectSpread2({},i));break;default:throw new TrackInvalidError(t)}const l=[];for(const p of u)livekitLogger.info("publishing track",{localTrack:p}),l.push(this.publishTrack(p,a));[d]=await Promise.all(l)}catch(l){throw l instanceof Error&&!(l instanceof TrackInvalidError)&&this.emit(ParticipantEvent.MediaDevicesError,l),l}finally{this.pendingPublishing.delete(t)}}else if(d&&d.track)if(t===Track.Source.ScreenShare){d=await this.unpublishTrack(d.track);const u=this.getTrack(Track.Source.ScreenShareAudio);u&&u.track&&this.unpublishTrack(u.track)}else await d.mute();return d}async enableCameraAndMicrophone(){if(!(this.pendingPublishing.has(Track.Source.Camera)||this.pendingPublishing.has(Track.Source.Microphone))){this.pendingPublishing.add(Track.Source.Camera),this.pendingPublishing.add(Track.Source.Microphone);try{const t=await this.createTracks({audio:!0,video:!0});await Promise.all(t.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(Track.Source.Camera),this.pendingPublishing.delete(Track.Source.Microphone)}}}async createTracks(t){var n,i;const a=mergeDefaultOptions(t,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults),o=constraintsForOptions(a);let c;try{c=await navigator.mediaDevices.getUserMedia(o)}catch(d){throw d instanceof Error&&(o.audio&&(this.microphoneError=d),o.video&&(this.cameraError=d)),d}return o.audio&&(this.microphoneError=void 0),o.video&&(this.cameraError=void 0),c.getTracks().map(d=>{const u=d.kind==="audio";u?t.audio:t.video;let l;const h=u?o.audio:o.video;typeof h!="boolean"&&(l=h);const p=mediaTrackToLocalTrack(d,l);return p.kind===Track.Kind.Video?p.source=Track.Source.Camera:p.kind===Track.Kind.Audio&&(p.source=Track.Source.Microphone),p.mediaStream=c,p})}async createScreenTracks(t){var n;t===void 0&&(t={}),t.resolution===void 0&&(t.resolution=ScreenSharePresets.h1080fps15.resolution);let i=!0;if(t.resolution&&(isSafari()?i={width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}:i={width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate}),navigator.mediaDevices.getDisplayMedia===void 0)throw new DeviceUnsupportedError("getDisplayMedia not supported");const a=await navigator.mediaDevices.getDisplayMedia({audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio}),o=a.getVideoTracks();if(o.length===0)throw new TrackInvalidError("no video track found");const c=new LocalVideoTrack(o[0],void 0,!1);c.source=Track.Source.ScreenShare;const d=[c];if(a.getAudioTracks().length>0){const u=new LocalAudioTrack(a.getAudioTracks()[0],void 0,!1);u.source=Track.Source.ScreenShareAudio,d.push(u)}return d}async publishTrack(t,n){var i,a,o;if(await((i=this.reconnectFuture)===null||i===void 0?void 0:i.promise),t instanceof LocalTrack&&this.pendingPublishPromises.has(t)&&await this.pendingPublishPromises.get(t),t instanceof MediaStreamTrack)switch(t.kind){case"audio":t=new LocalAudioTrack(t,void 0,!0);break;case"video":t=new LocalVideoTrack(t,void 0,!0);break;default:throw new TrackInvalidError("unsupported MediaStreamTrack kind ".concat(t.kind))}let c;if(this.tracks.forEach(h=>{h.track&&h.track===t&&(c=h)}),c)return livekitLogger.warn("track has already been published, skipping"),c;const d=(n==null?void 0:n.forceStereo)||"channelCount"in t.mediaStreamTrack.getSettings()&&t.mediaStreamTrack.getSettings().channelCount===2||t.mediaStreamTrack.getConstraints().channelCount===2;d&&(n||(n={}),n.dtx===void 0&&livekitLogger.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work."),n.red===void 0&&livekitLogger.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(a=n.dtx)!==null&&a!==void 0||(n.dtx=!1),(o=n.red)!==null&&o!==void 0||(n.red=!1));const u=_objectSpread2(_objectSpread2({},this.roomOptions.publishDefaults),n);u.source&&(t.source=u.source);const l=this.publish(t,u,n,d);this.pendingPublishPromises.set(t,l);try{return await l}catch(h){throw h}finally{this.pendingPublishPromises.delete(t)}}async publish(t,n,i,a){var o,c,d,u;const l=Array.from(this.tracks.values()).find(S=>t instanceof LocalTrack&&S.source===t.source);if(l&&t.source!==Track.Source.Unknown)try{throw Error("publishing a second track with the same source: ".concat(t.source))}catch(S){S instanceof Error&&livekitLogger.warn(S.message,{oldTrack:l,newTrack:t,trace:S.stack})}n.stopMicTrackOnMute&&t instanceof LocalAudioTrack&&(t.stopOnMute=!0),t.source===Track.Source.ScreenShare&&isFireFox()&&(n.simulcast=!1),n.videoCodec==="av1"&&!supportsAV1()&&(n.videoCodec=void 0),t.on(TrackEvent.Muted,this.onTrackMuted),t.on(TrackEvent.Unmuted,this.onTrackUnmuted),t.on(TrackEvent.Ended,this.handleTrackEnded),t.on(TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.on(TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed);const h=AddTrackRequest.fromPartial({cid:t.mediaStreamTrack.id,name:i==null?void 0:i.name,type:Track.kindToProto(t.kind),muted:t.isMuted,source:Track.sourceToProto(t.source),disableDtx:!(!((o=n.dtx)!==null&&o!==void 0)||o),stereo:a,disableRed:!(!((c=n.red)!==null&&c!==void 0)||c)});let p,y;if(t.kind===Track.Kind.Video){let S={width:0,height:0};try{S=await t.waitForDimensions()}catch{livekitLogger.error("could not determine track dimensions")}if(h.width=S.width,h.height=S.height,t instanceof LocalVideoTrack&&((n==null?void 0:n.videoCodec)==="av1"&&(n.scalabilityMode=(d=n.scalabilityMode)!==null&&d!==void 0?d:"L3T3"),n.videoCodec&&n.backupCodec&&n.videoCodec!==n.backupCodec.codec)){const k=_objectSpread2({},n);k.simulcast=!0,y=computeTrackBackupEncodings(t,n.backupCodec.codec,k),h.simulcastCodecs=[{codec:n.videoCodec,cid:t.mediaStreamTrack.id,enableSimulcastLayers:!0},{codec:n.backupCodec.codec,cid:"",enableSimulcastLayers:!0}]}p=computeVideoEncodings(t.source===Track.Source.ScreenShare,S.width,S.height,n),h.layers=videoLayersFromEncodings(h.width,h.height,y??p)}else t.kind===Track.Kind.Audio&&n.audioBitrate&&(p=[{maxBitrate:n.audioBitrate}]);if(!this.engine||this.engine.isClosed)throw new UnexpectedConnectionState("cannot publish track when not connected");const E=await this.engine.addTrack(h),x=new LocalTrackPublication(t.kind,E,t);if(x.options=n,t.sid=E.sid,!this.engine.publisher)throw new UnexpectedConnectionState("publisher is closed");return livekitLogger.debug("publishing ".concat(t.kind," with encodings"),{encodings:p,trackInfo:E}),t.sender=await this.engine.createSender(t,n,p),t.codec==="av1"&&p&&(!((u=p[0])===null||u===void 0)&&u.maxBitrate)&&this.engine.publisher.setTrackCodecBitrate(h.cid,t.codec,p[0].maxBitrate/1e3),this.engine.negotiate(),t instanceof LocalVideoTrack?t.startMonitor(this.engine.client):t instanceof LocalAudioTrack&&t.startMonitor(),this.addTrackPublication(x),this.emit(ParticipantEvent.LocalTrackPublished,x),x}get isLocal(){return!0}async publishAdditionalCodecForTrack(t,n,i){var a;let o;if(this.tracks.forEach(p=>{p.track&&p.track===t&&(o=p)}),!o)throw new TrackInvalidError("track is not published");if(!(t instanceof LocalVideoTrack))throw new TrackInvalidError("track is not a video track");const c=_objectSpread2(_objectSpread2({},(a=this.roomOptions)===null||a===void 0?void 0:a.publishDefaults),i),d=computeTrackBackupEncodings(t,n,c);if(!d){livekitLogger.info("backup codec has been disabled, ignoring request to add additional codec for track");return}const u=t.addSimulcastTrack(n,d),l=AddTrackRequest.fromPartial({cid:u.mediaStreamTrack.id,type:Track.kindToProto(t.kind),muted:t.isMuted,source:Track.sourceToProto(t.source),sid:t.sid,simulcastCodecs:[{codec:c.videoCodec,cid:u.mediaStreamTrack.id,enableSimulcastLayers:c.simulcast}]});if(l.layers=videoLayersFromEncodings(l.width,l.height,d),!this.engine||this.engine.isClosed)throw new UnexpectedConnectionState("cannot publish track when not connected");const h=await this.engine.addTrack(l);await this.engine.createSimulcastSender(t,u,c,d),this.engine.negotiate(),livekitLogger.debug("published ".concat(n," for track ").concat(t.sid),{encodings:d,trackInfo:h})}async unpublishTrack(t,n){var i,a;const o=this.getPublicationForTrack(t);if(livekitLogger.debug("unpublishing track",{track:t,method:"unpublishTrack"}),!o||!o.track){livekitLogger.warn("track was not unpublished because no publication was found",{track:t,method:"unpublishTrack"});return}t=o.track,t.off(TrackEvent.Muted,this.onTrackMuted),t.off(TrackEvent.Unmuted,this.onTrackUnmuted),t.off(TrackEvent.Ended,this.handleTrackEnded),t.off(TrackEvent.UpstreamPaused,this.onTrackUpstreamPaused),t.off(TrackEvent.UpstreamResumed,this.onTrackUpstreamResumed),n===void 0&&(n=(a=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&a!==void 0?a:!0),n&&t.stop();let c=!1;const d=t.sender;if(t.sender=void 0,this.engine.publisher&&this.engine.publisher.pc.connectionState!=="closed"&&d)try{if(this.engine.removeTrack(d)&&(c=!0),t instanceof LocalVideoTrack){for(const[,u]of t.simulcastCodecs)u.sender&&(this.engine.removeTrack(u.sender)&&(c=!0),u.sender=void 0);t.simulcastCodecs.clear()}}catch(u){livekitLogger.warn("failed to unpublish track",{error:u,method:"unpublishTrack"})}switch(this.tracks.delete(o.trackSid),o.kind){case Track.Kind.Audio:this.audioTracks.delete(o.trackSid);break;case Track.Kind.Video:this.videoTracks.delete(o.trackSid);break}return this.emit(ParticipantEvent.LocalTrackUnpublished,o),o.setTrack(void 0),c&&await this.engine.negotiate(),o}async unpublishTracks(t){return(await Promise.all(t.map(i=>this.unpublishTrack(i)))).filter(i=>i instanceof LocalTrackPublication)}async republishAllTracks(t){const n=[];this.tracks.forEach(i=>{i.track&&(t&&(i.options=_objectSpread2(_objectSpread2({},i.options),t)),n.push(i))}),await Promise.all(n.map(async i=>{const a=i.track;await this.unpublishTrack(a,!1),await this.publishTrack(a,i.options)}))}async publishData(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const a=Array.isArray(i)?i:i==null?void 0:i.destination,o=[],c=Array.isArray(i)?void 0:i.topic;a!==void 0&&a.forEach(u=>{u instanceof RemoteParticipant?o.push(u.sid):o.push(u)});const d={kind:n,value:{$case:"user",user:{participantSid:this.sid,payload:t,destinationSids:o,topic:c}}};await this.engine.sendDataPacket(d,n)}setTrackSubscriptionPermissions(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=t,this.engine.client.isConnected&&this.updateTrackSubscriptionPermissions()}updateInfo(t){t.sid===this.sid&&(super.updateInfo(t),t.tracks.forEach(n=>{var i,a;const o=this.tracks.get(n.sid);if(o){const c=o.isMuted||((a=(i=o.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&a!==void 0?a:!1);c!==n.muted&&(livekitLogger.debug("updating server mute state after reconcile",{sid:n.sid,muted:c}),this.engine.client.sendMuteTrack(n.sid,c))}}))}getPublicationForTrack(t){let n;return this.tracks.forEach(i=>{const a=i.track;a&&(t instanceof MediaStreamTrack?(a instanceof LocalAudioTrack||a instanceof LocalVideoTrack)&&a.mediaStreamTrack===t&&(n=i):t===a&&(n=i))}),n}publishedTracksInfo(){const t=[];return this.tracks.forEach(n=>{n.track!==void 0&&t.push({cid:n.track.mediaStreamID,track:n.trackInfo})}),t}dataChannelsInfo(){const t=[],n=(i,a)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&t.push({label:i.label,id:i.id,target:a})};return n(this.engine.dataChannelForKind(DataPacket_Kind.LOSSY),SignalTarget.PUBLISHER),n(this.engine.dataChannelForKind(DataPacket_Kind.RELIABLE),SignalTarget.PUBLISHER),n(this.engine.dataChannelForKind(DataPacket_Kind.LOSSY,!0),SignalTarget.SUBSCRIBER),n(this.engine.dataChannelForKind(DataPacket_Kind.RELIABLE,!0),SignalTarget.SUBSCRIBER),t}}const passThroughQueueSignals=["syncState","trickle","offer","answer","simulate","leave"];function canPassThroughQueue(e){const t=passThroughQueueSignals.includes(e.$case);return livekitLogger.trace("request allowed to bypass queue:",{canPass:t,req:e}),t}class SignalClient{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.rtt=0,this.isConnected=!1,this.isReconnecting=!1,this.useJSON=t,this.requestQueue=new Queue,this.queuedRequests=[],this.closingLock=new Mutex}async join(t,n,i,a){return this.isConnected=!1,this.options=i,await this.connect(t,n,i,a)}async reconnect(t,n,i,a){if(!this.options){livekitLogger.warn("attempted to reconnect without signal options being set, ignoring");return}return this.isReconnecting=!0,this.clearPingInterval(),await this.connect(t,n,_objectSpread2(_objectSpread2({},this.options),{},{reconnect:!0,sid:i,reconnectReason:a}))}connect(t,n,i,a){this.connectOptions=i,t.startsWith("http")&&(t=t.replace("http","ws")),t=t.replace(/\/$/,""),t+="/rtc";const o=getClientInfo(),c=createConnectionParams(n,o,i);return new Promise(async(d,u)=>{const l=async()=>{await this.close(),u(new ConnectionError("room connection has been cancelled"))};a!=null&&a.aborted&&l(),a==null||a.addEventListener("abort",l),livekitLogger.debug("connecting to ".concat(t+c)),this.ws&&await this.close(),this.ws=new WebSocket(t+c),this.ws.binaryType="arraybuffer",this.ws.onerror=async h=>{if(!this.isConnected){try{const p=await fetch("http".concat(t.substring(2),"/validate").concat(c));if(p.ok)u(new ConnectionError("Internal error",2,p.status));else{const y=await p.text();u(new ConnectionError(y,0,p.status))}}catch{u(new ConnectionError("server was not reachable",1))}return}this.handleWSError(h)},this.ws.onmessage=async h=>{var p,y,E,x;let S;if(typeof h.data=="string"){const k=JSON.parse(h.data);S=SignalResponse.fromJSON(k)}else if(h.data instanceof ArrayBuffer)S=SignalResponse.decode(new Uint8Array(h.data));else{livekitLogger.error("could not decode websocket message: ".concat(typeof h.data));return}if(!this.isConnected){let k=!1;if(((p=S.message)===null||p===void 0?void 0:p.$case)==="join"?(this.isConnected=!0,a==null||a.removeEventListener("abort",l),this.pingTimeoutDuration=S.message.join.pingTimeout,this.pingIntervalDuration=S.message.join.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(livekitLogger.debug("ping config",{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration}),this.startPingInterval()),d(S.message.join)):i.reconnect?(this.isConnected=!0,a==null||a.removeEventListener("abort",l),this.startPingInterval(),((y=S.message)===null||y===void 0?void 0:y.$case)==="reconnect"?d((E=S.message)===null||E===void 0?void 0:E.reconnect):(d(),k=!0)):i.reconnect||u(new ConnectionError("did not receive join response, got ".concat((x=S.message)===null||x===void 0?void 0:x.$case," instead"))),!k)return}this.signalLatency&&await sleep(this.signalLatency),this.handleSignalResponse(S)},this.ws.onclose=h=>{this.isConnected&&(livekitLogger.debug("websocket connection closed: ".concat(h.reason)),this.isConnected=!1,this.onClose&&this.onClose(h.reason),this.ws=void 0)}})}async close(){const t=await this.closingLock.lock();try{if(this.isConnected=!1,this.ws){this.ws.onclose=null,this.ws.onmessage=null,this.ws.onopen=null;const n=new Promise(i=>{this.ws?this.ws.onclose=i:i(!0)});this.ws.close(),await Promise.race([n,sleep(250)])}this.ws=void 0,this.clearPingInterval()}finally{t()}}sendOffer(t){livekitLogger.debug("sending offer",t),this.sendRequest({$case:"offer",offer:toProtoSessionDescription(t)})}sendAnswer(t){livekitLogger.debug("sending answer"),this.sendRequest({$case:"answer",answer:toProtoSessionDescription(t)})}sendIceCandidate(t,n){livekitLogger.trace("sending ice candidate",t),this.sendRequest({$case:"trickle",trickle:{candidateInit:JSON.stringify(t),target:n}})}sendMuteTrack(t,n){this.sendRequest({$case:"mute",mute:{sid:t,muted:n}})}sendAddTrack(t){this.sendRequest({$case:"addTrack",addTrack:AddTrackRequest.fromPartial(t)})}sendUpdateTrackSettings(t){this.sendRequest({$case:"trackSetting",trackSetting:t})}sendUpdateSubscription(t){this.sendRequest({$case:"subscription",subscription:t})}sendSyncState(t){this.sendRequest({$case:"syncState",syncState:t})}sendUpdateVideoLayers(t,n){this.sendRequest({$case:"updateLayers",updateLayers:{trackSid:t,layers:n}})}sendUpdateSubscriptionPermissions(t,n){this.sendRequest({$case:"subscriptionPermission",subscriptionPermission:{allParticipants:t,trackPermissions:n}})}sendSimulateScenario(t){this.sendRequest({$case:"simulate",simulate:t})}sendPing(){this.sendRequest({$case:"ping",ping:Date.now()}),this.sendRequest({$case:"pingReq",pingReq:{timestamp:Date.now(),rtt:this.rtt}})}async sendLeave(){await this.sendRequest({$case:"leave",leave:{canReconnect:!1,reason:DisconnectReason.CLIENT_INITIATED}})}async sendRequest(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!n&&!canPassThroughQueue(t)&&this.isReconnecting){this.queuedRequests.push(async()=>{await this.sendRequest(t,!0)});return}if(n||await this.requestQueue.flush(),this.signalLatency&&await sleep(this.signalLatency),!this.ws||this.ws.readyState!==this.ws.OPEN){livekitLogger.error("cannot send signal request before connected, type: ".concat(t==null?void 0:t.$case));return}const a={message:t};try{this.useJSON?this.ws.send(JSON.stringify(SignalRequest.toJSON(a))):this.ws.send(SignalRequest.encode(a).finish())}catch(o){livekitLogger.error("error sending signal message",{error:o})}}handleSignalResponse(t){var n,i;const a=t.message;if(a==null){livekitLogger.debug("received unsupported message");return}if(a.$case==="answer"){const o=fromProtoSessionDescription(a.answer);this.onAnswer&&this.onAnswer(o)}else if(a.$case==="offer"){const o=fromProtoSessionDescription(a.offer);this.onOffer&&this.onOffer(o)}else if(a.$case==="trickle"){const o=JSON.parse(a.trickle.candidateInit);this.onTrickle&&this.onTrickle(o,a.trickle.target)}else a.$case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=a.update.participants)!==null&&n!==void 0?n:[]):a.$case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(a.trackPublished):a.$case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=a.speakersChanged.speakers)!==null&&i!==void 0?i:[]):a.$case==="leave"?this.onLeave&&this.onLeave(a.leave):a.$case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(a.mute.sid,a.mute.muted):a.$case==="roomUpdate"?this.onRoomUpdate&&a.roomUpdate.room&&this.onRoomUpdate(a.roomUpdate.room):a.$case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(a.connectionQuality):a.$case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(a.streamStateUpdate):a.$case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(a.subscribedQualityUpdate):a.$case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(a.subscriptionPermissionUpdate):a.$case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(a.refreshToken):a.$case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(a.trackUnpublished):a.$case==="pong"?this.resetPingTimeout():a.$case==="pongResp"?(this.rtt=Date.now()-a.pongResp.lastPingTimestamp,this.resetPingTimeout()):livekitLogger.debug("unsupported message",a)}setReconnected(){for(;this.queuedRequests.length>0;){const t=this.queuedRequests.shift();t&&this.requestQueue.run(t)}this.isReconnecting=!1}handleWSError(t){livekitLogger.error("websocket error",t)}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){livekitLogger.warn("ping timeout duration not set");return}this.pingTimeout=CriticalTimers.setTimeout(()=>{livekitLogger.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString())),this.onClose&&this.onClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&CriticalTimers.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){livekitLogger.warn("ping interval duration not set");return}livekitLogger.debug("start ping interval"),this.pingInterval=CriticalTimers.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){livekitLogger.debug("clearing ping interval"),this.clearPingTimeout(),this.pingInterval&&CriticalTimers.clearInterval(this.pingInterval)}}function fromProtoSessionDescription(e){const t={type:"offer",sdp:e.sdp};switch(e.type){case"answer":case"offer":case"pranswer":case"rollback":t.type=e.type;break}return t}function toProtoSessionDescription(e){return{sdp:e.sdp,type:e.type}}function createConnectionParams(e,t,n){var i;const a=new URLSearchParams;return a.set("access_token",e),n.reconnect&&(a.set("reconnect","1"),n.sid&&a.set("sid",n.sid)),a.set("auto_subscribe",n.autoSubscribe?"1":"0"),a.set("sdk","js"),a.set("version",t.version),a.set("protocol",t.protocol.toString()),t.deviceModel&&a.set("device_model",t.deviceModel),t.os&&a.set("os",t.os),t.osVersion&&a.set("os_version",t.osVersion),t.browser&&a.set("browser",t.browser),t.browserVersion&&a.set("browser_version",t.browserVersion),n.publishOnly!==void 0&&a.set("publish",n.publishOnly),n.adaptiveStream&&a.set("adaptive_stream","1"),n.reconnectReason&&a.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&a.set("network",navigator.connection.type),"?".concat(a.toString())}const publishDefaults={audioBitrate:AudioPresets.music.maxBitrate,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:ScreenSharePresets.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:"vp8",backupCodec:{codec:"vp8",encoding:VideoPresets.h540.encoding}},audioDefaults={autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0},videoDefaults={resolution:VideoPresets.h720.resolution},roomOptionDefaults={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new DefaultReconnectPolicy,disconnectOnPageLeave:!0,expWebAudioMix:!1},roomConnectOptionDefaults={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3};var parser$1={},grammarExports={},grammar$2={get exports(){return grammarExports},set exports(e){grammarExports=e}},grammar$1=grammar$2.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=e.raddr!=null?" raddr %s rport %d":"%v%v",t+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(t+=" generation %d"),t+=e["network-id"]!=null?" network-id %d":"%v",t+=e["network-cost"]!=null?" network-cost %d":"%v",t}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return e.attribute!=null&&(t+=" %s",e.value!=null&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=e.id!=null?"id=%s %s":"%v%s",t+=e.mediaClockValue!=null?"=%s":"",t+=e.rateNumerator!=null?" rate=%s":"",t+=e.rateDenominator!=null?"/%s":"",t}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(grammar$1).forEach(function(e){var t=grammar$1[e];t.forEach(function(n){n.reg||(n.reg=/(.*)/),n.format||(n.format="%s")})});(function(e){var t=function(d){return String(Number(d))===d?Number(d):d},n=function(d,u,l,h){if(h&&!l)u[h]=t(d[1]);else for(var p=0;p<l.length;p+=1)d[p+1]!=null&&(u[l[p]]=t(d[p+1]))},i=function(d,u,l){var h=d.name&&d.names;d.push&&!u[d.push]?u[d.push]=[]:h&&!u[d.name]&&(u[d.name]={});var p=d.push?{}:h?u[d.name]:u;n(l.match(d.reg),p,d.names,d.name),d.push&&u[d.push].push(p)},a=grammarExports,o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(d){var u={},l=[],h=u;return d.split(/(\r\n|\r|\n)/).filter(o).forEach(function(p){var y=p[0],E=p.slice(2);y==="m"&&(l.push({rtp:[],fmtp:[]}),h=l[l.length-1]);for(var x=0;x<(a[y]||[]).length;x+=1){var S=a[y][x];if(S.reg.test(E))return i(S,h,E)}}),u.media=l,u};var c=function(d,u){var l=u.split(/=(.+)/,2);return l.length===2?d[l[0]]=t(l[1]):l.length===1&&u.length>1&&(d[l[0]]=void 0),d};e.parseParams=function(d){return d.split(/;\s?/).reduce(c,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(d){return d.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(d){for(var u=[],l=d.split(" ").map(t),h=0;h<l.length;h+=3)u.push({component:l[h],ip:l[h+1],port:l[h+2]});return u},e.parseImageAttributes=function(d){return d.split(" ").map(function(u){return u.substring(1,u.length-1).split(",").reduce(c,{})})},e.parseSimulcastStreamList=function(d){return d.split(";").map(function(u){return u.split(",").map(function(l){var h,p=!1;return l[0]!=="~"?h=t(l):(h=t(l.substring(1,l.length)),p=!0),{scid:h,paused:p}})})}})(parser$1);var grammar=grammarExports,formatRegExp=/%[sdv%]/g,format=function(e){var t=1,n=arguments,i=n.length;return e.replace(formatRegExp,function(a){if(t>=i)return a;var o=n[t];switch(t+=1,a){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return""}})},makeLine=function(e,t,n){var i=t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format,a=[e+"="+i];if(t.names)for(var o=0;o<t.names.length;o+=1){var c=t.names[o];t.name?a.push(n[t.name][c]):a.push(n[t.names[o]])}else a.push(n[t.name]);return format.apply(null,a)},defaultOuterOrder=["v","o","s","i","u","e","p","c","b","t","r","z","a"],defaultInnerOrder=["i","c","b","a"],writer$1=function(e,t){t=t||{},e.version==null&&(e.version=0),e.name==null&&(e.name=" "),e.media.forEach(function(o){o.payloads==null&&(o.payloads="")});var n=t.outerOrder||defaultOuterOrder,i=t.innerOrder||defaultInnerOrder,a=[];return n.forEach(function(o){grammar[o].forEach(function(c){c.name in e&&e[c.name]!=null?a.push(makeLine(o,c,e)):c.push in e&&e[c.push]!=null&&e[c.push].forEach(function(d){a.push(makeLine(o,c,d))})})}),e.media.forEach(function(o){a.push(makeLine("m",grammar.m[0],o)),i.forEach(function(c){grammar[c].forEach(function(d){d.name in o&&o[d.name]!=null?a.push(makeLine(c,d,o)):d.push in o&&o[d.push]!=null&&o[d.push].forEach(function(u){a.push(makeLine(c,d,u))})})})}),a.join(`\r
`)+`\r
`},parser=parser$1,writer=writer$1,write=writer,parse=parser.parse;const PCEvents={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete"};class PCTransport extends eventsExports{constructor(t){super(),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=r(n=>{this.emit(PCEvents.NegotiationStarted);try{this.createAndSendOffer()}catch(i){if(n)n(i);else throw i}},100),this.pc=new RTCPeerConnection(t)}get isICEConnected(){return this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed"}async addIceCandidate(t){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(t);this.pendingCandidates.push(t)}async setRemoteDescription(t){if(t.type==="offer"){let{stereoMids:n,nackMids:i}=extractStereoAndNackAudioFromOffer(t);this.remoteStereoMids=n,this.remoteNackMids=i}await this.pc.setRemoteDescription(t),this.pendingCandidates.forEach(n=>{this.pc.addIceCandidate(n)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,this.createAndSendOffer()):t.type==="answer"&&this.emit(PCEvents.NegotiationComplete)}async createAndSendOffer(t){var n;if(this.onOffer===void 0)return;if(t!=null&&t.iceRestart&&(livekitLogger.debug("restarting ICE"),this.restartingIce=!0),this.pc.signalingState==="have-local-offer"){const o=this.pc.remoteDescription;if(t!=null&&t.iceRestart&&o)await this.pc.setRemoteDescription(o);else{this.renegotiate=!0;return}}else if(this.pc.signalingState==="closed"){livekitLogger.warn("could not createOffer with closed peer connection");return}livekitLogger.debug("starting to negotiate");const i=await this.pc.createOffer(t),a=parse((n=i.sdp)!==null&&n!==void 0?n:"");a.media.forEach(o=>{o.type==="audio"?ensureAudioNackAndStereo(o,[],[]):o.type==="video"&&this.trackBitrates.some(c=>{if(!o.msid||!o.msid.includes(c.sid))return!1;let d=0;return o.rtp.some(u=>u.codec.toUpperCase()===c.codec.toUpperCase()?(d=u.payload,!0):!1),d>0&&(o.fmtp.some(u=>u.payload===d?(u.config.includes("x-google-max-bitrate")||(u.config+=";x-google-max-bitrate=".concat(c.maxbr)),!0):!1)||o.fmtp.push({payload:d,config:"x-google-max-bitrate=".concat(c.maxbr)})),!0})}),this.trackBitrates=[],await this.setMungedLocalDescription(i,write(a)),this.onOffer(i)}async createAndSetAnswer(){var t;const n=await this.pc.createAnswer(),i=parse((t=n.sdp)!==null&&t!==void 0?t:"");return i.media.forEach(a=>{a.type==="audio"&&ensureAudioNackAndStereo(a,this.remoteStereoMids,this.remoteNackMids)}),await this.setMungedLocalDescription(n,write(i)),n}setTrackCodecBitrate(t,n,i){this.trackBitrates.push({sid:t,codec:n,maxbr:i})}close(){this.pc.onconnectionstatechange=null,this.pc.oniceconnectionstatechange=null,this.pc.close()}async setMungedLocalDescription(t,n){const i=t.sdp;t.sdp=n;try{livekitLogger.debug("setting munged local description"),await this.pc.setLocalDescription(t);return}catch(a){livekitLogger.warn("not able to set ".concat(t.type,", falling back to unmodified sdp"),{error:a}),t.sdp=i}try{await this.pc.setLocalDescription(t)}catch(a){let o="unknown error";throw a instanceof Error?o=a.message:typeof a=="string"&&(o=a),new NegotiationError(o)}}}function ensureAudioNackAndStereo(e,t,n){let i=0;e.rtp.some(a=>a.codec==="opus"?(i=a.payload,!0):!1),i>0&&(e.rtcpFb||(e.rtcpFb=[]),n.includes(e.mid)&&!e.rtcpFb.some(a=>a.payload===i&&a.type==="nack")&&e.rtcpFb.push({payload:i,type:"nack"}),t.includes(e.mid)&&e.fmtp.some(a=>a.payload===i?(a.config.includes("stereo=1")||(a.config+=";stereo=1"),!0):!1))}function extractStereoAndNackAudioFromOffer(e){var t;const n=[],i=[],a=parse((t=e.sdp)!==null&&t!==void 0?t:"");let o=0;return a.media.forEach(c=>{var d;c.type==="audio"&&(c.rtp.some(u=>u.codec==="opus"?(o=u.payload,!0):!1),!((d=c.rtcpFb)===null||d===void 0)&&d.some(u=>u.payload===o&&u.type==="nack")&&i.push(c.mid),c.fmtp.some(u=>u.payload===o?(u.config.includes("sprop-stereo=1")&&n.push(c.mid),!0):!1))}),{stereoMids:n,nackMids:i}}const lossyDataChannel="_lossy",reliableDataChannel="_reliable",minReconnectWait=2*1e3,leaveReconnect="leave-reconnect";var PCState;(function(e){e[e.New=0]="New",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected",e[e.Reconnecting=3]="Reconnecting",e[e.Closed=4]="Closed"})(PCState||(PCState={}));class RTCEngine extends eventsExports.EventEmitter{get isClosed(){return this._isClosed}constructor(t){super(),this.options=t,this.rtcConfig={},this.peerConnectionTimeout=roomConnectOptionDefaults.peerConnectionTimeout,this.subscriberPrimary=!1,this.pcState=PCState.New,this._isClosed=!0,this.pendingTrackResolvers={},this.hasPublished=!1,this.reconnectAttempts=0,this.reconnectStart=0,this.fullReconnectOnNext=!1,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.handleDataChannel=async n=>{let{channel:i}=n;if(i){if(i.label===reliableDataChannel)this.reliableDCSub=i;else if(i.label===lossyDataChannel)this.lossyDCSub=i;else return;livekitLogger.debug("on data channel ".concat(i.id,", ").concat(i.label)),i.onmessage=this.handleDataMessage}},this.handleDataMessage=async n=>{var i,a;const o=await this.dataProcessLock.lock();try{let c;if(n.data instanceof ArrayBuffer)c=n.data;else if(n.data instanceof Blob)c=await n.data.arrayBuffer();else{livekitLogger.error("unsupported data type",n.data);return}const d=DataPacket.decode(new Uint8Array(c));((i=d.value)===null||i===void 0?void 0:i.$case)==="speaker"?this.emit(EngineEvent.ActiveSpeakersUpdate,d.value.speaker.speakers):((a=d.value)===null||a===void 0?void 0:a.$case)==="user"&&this.emit(EngineEvent.DataPacketReceived,d.value.user,d.kind)}finally{o()}},this.handleDataError=n=>{const a=n.currentTarget.maxRetransmits===0?"lossy":"reliable";if(n instanceof ErrorEvent){const{error:o}=n.error;livekitLogger.error("DataChannel error on ".concat(a,": ").concat(n.message),o)}else livekitLogger.error("Unknown DataChannel Error on ".concat(a),n)},this.handleDisconnect=(n,i)=>{if(this._isClosed)return;livekitLogger.warn("".concat(n," disconnected")),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const a=d=>{livekitLogger.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(d,"ms. giving up")),this.emit(EngineEvent.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let c=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(c===null){a(o);return}n===leaveReconnect&&(c=0),livekitLogger.debug("reconnecting in ".concat(c,"ms")),this.clearReconnectTimeout(),this.reconnectTimeout=CriticalTimers.setTimeout(()=>this.attemptReconnect(i),c)},this.handleBrowserOnLine=()=>{this.client.isReconnecting&&(this.clearReconnectTimeout(),this.attemptReconnect(ReconnectReason.RR_SIGNAL_DISCONNECTED))},this.client=new SignalClient,this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new Mutex,this.dataProcessLock=new Mutex}async join(t,n,i,a){this.url=t,this.token=n,this.signalOpts=i;try{this.joinAttempts+=1;const o=await this.client.join(t,n,i,a);return this._isClosed=!1,this.subscriberPrimary=o.subscriberPrimary,this.publisher||this.configure(o),this.subscriberPrimary||this.negotiate(),this.clientConfiguration=o.clientConfiguration,o}catch(o){if(o instanceof ConnectionError&&o.reason===1&&(livekitLogger.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts)),this.joinAttempts<this.maxJoinAttempts))return this.join(t,n,i,a);throw o}}async close(){const t=await this.closingLock.lock();if(this.isClosed){t();return}try{this._isClosed=!0,this.emit(EngineEvent.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.publisher&&this.publisher.pc.signalingState!=="closed"&&(this.publisher.pc.getSenders().forEach(n=>{var i,a;try{!((i=this.publisher)===null||i===void 0)&&i.pc.removeTrack&&((a=this.publisher)===null||a===void 0||a.pc.removeTrack(n))}catch(o){livekitLogger.warn("could not removeTrack",{error:o})}}),this.publisher.close(),this.publisher=void 0),this.subscriber&&(this.subscriber.close(),this.subscriber=void 0),await this.client.close()}finally{t()}}addTrack(t){if(this.pendingTrackResolvers[t.cid])throw new TrackInvalidError("a track with the same ID has already been published");return new Promise((n,i)=>{const a=setTimeout(()=>{delete this.pendingTrackResolvers[t.cid],i(new ConnectionError("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[t.cid]={resolve:o=>{clearTimeout(a),n(o)},reject:()=>{clearTimeout(a),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(t)})}removeTrack(t){var n;if(t.track&&this.pendingTrackResolvers[t.track.id]){const{reject:i}=this.pendingTrackResolvers[t.track.id];i&&i(),delete this.pendingTrackResolvers[t.track.id]}try{return(n=this.publisher)===null||n===void 0||n.pc.removeTrack(t),!0}catch(i){livekitLogger.warn("failed to remove track",{error:i,method:"removeTrack"})}return!1}updateMuteStatus(t,n){this.client.sendMuteTrack(t,n)}get dataSubscriberReadyState(){var t;return(t=this.reliableDCSub)===null||t===void 0?void 0:t.readyState}async getConnectedServerAddress(){if(this.primaryPC!==void 0)return getConnectedAddress(this.primaryPC)}configure(t){var n;if(this.publisher||this.subscriber)return;this.participantSid=(n=t.participant)===null||n===void 0?void 0:n.sid;const i=this.makeRTCConfiguration(t);this.publisher=new PCTransport(i),this.subscriber=new PCTransport(i),this.emit(EngineEvent.TransportsCreated,this.publisher,this.subscriber),this.publisher.pc.onicecandidate=d=>{d.candidate&&(livekitLogger.trace("adding ICE candidate for peer",d.candidate),this.client.sendIceCandidate(d.candidate,SignalTarget.PUBLISHER))},this.subscriber.pc.onicecandidate=d=>{d.candidate&&this.client.sendIceCandidate(d.candidate,SignalTarget.SUBSCRIBER)},this.publisher.onOffer=d=>{this.client.sendOffer(d)};let a=this.publisher.pc,o=this.subscriber.pc,c=t.subscriberPrimary;c&&(a=this.subscriber.pc,o=this.publisher.pc,this.subscriber.pc.ondatachannel=this.handleDataChannel),this.primaryPC=a,a.onconnectionstatechange=async()=>{if(livekitLogger.debug("primary PC state changed ".concat(a.connectionState)),a.connectionState==="connected"){const d=this.pcState===PCState.New;this.pcState=PCState.Connected,d&&this.emit(EngineEvent.Connected,t)}else a.connectionState==="failed"&&this.pcState===PCState.Connected&&(this.pcState=PCState.Disconnected,this.handleDisconnect("primary peerconnection",c?ReconnectReason.RR_SUBSCRIBER_FAILED:ReconnectReason.RR_PUBLISHER_FAILED))},o.onconnectionstatechange=async()=>{livekitLogger.debug("secondary PC state changed ".concat(o.connectionState)),o.connectionState==="failed"&&this.handleDisconnect("secondary peerconnection",c?ReconnectReason.RR_PUBLISHER_FAILED:ReconnectReason.RR_SUBSCRIBER_FAILED)},this.subscriber.pc.ontrack=d=>{this.emit(EngineEvent.MediaTrackAdded,d.track,d.streams[0],d.receiver)},this.createDataChannels(),this.client.onAnswer=async d=>{this.publisher&&(livekitLogger.debug("received server answer",{RTCSdpType:d.type,signalingState:this.publisher.pc.signalingState}),await this.publisher.setRemoteDescription(d))},this.client.onTrickle=(d,u)=>{!this.publisher||!this.subscriber||(livekitLogger.trace("got ICE candidate from peer",{candidate:d,target:u}),u===SignalTarget.PUBLISHER?this.publisher.addIceCandidate(d):this.subscriber.addIceCandidate(d))},this.client.onOffer=async d=>{if(!this.subscriber)return;livekitLogger.debug("received server offer",{RTCSdpType:d.type,signalingState:this.subscriber.pc.signalingState}),await this.subscriber.setRemoteDescription(d);const u=await this.subscriber.createAndSetAnswer();this.client.sendAnswer(u)},this.client.onLocalTrackPublished=d=>{livekitLogger.debug("received trackPublishedResponse",d);const{resolve:u}=this.pendingTrackResolvers[d.cid];if(!u){livekitLogger.error("missing track resolver for ".concat(d.cid));return}delete this.pendingTrackResolvers[d.cid],u(d.track)},this.client.onTokenRefresh=d=>{this.token=d},this.client.onClose=()=>{this.handleDisconnect("signal",ReconnectReason.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=d=>{d!=null&&d.canReconnect?(this.fullReconnectOnNext=!0,this.primaryPC=void 0,this.handleDisconnect(leaveReconnect)):(this.emit(EngineEvent.Disconnected,d==null?void 0:d.reason),this.close()),livekitLogger.trace("leave request",{leave:d})}}makeRTCConfiguration(t){const n=_objectSpread2({},this.rtcConfig);if(t.iceServers&&!n.iceServers){const i=[];t.iceServers.forEach(a=>{const o={urls:a.urls};a.username&&(o.username=a.username),a.credential&&(o.credential=a.credential),i.push(o)}),n.iceServers=i}return t.clientConfiguration&&t.clientConfiguration.forceRelay===ClientConfigSetting.ENABLED&&(n.iceTransportPolicy="relay"),n.sdpSemantics="unified-plan",n.continualGatheringPolicy="gather_continually",n}createDataChannels(){this.publisher&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.publisher.pc.createDataChannel(lossyDataChannel,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.publisher.pc.createDataChannel(reliableDataChannel,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError)}setPreferredCodec(t,n,i){if(!("getCapabilities"in RTCRtpSender))return;const a=RTCRtpSender.getCapabilities(n);if(!a)return;livekitLogger.debug("get capabilities",a);const o=[],c=[],d=[];a.codecs.forEach(u=>{const l=u.mimeType.toLowerCase();if(l==="audio/opus"){o.push(u);return}if(!(l==="video/".concat(i))){d.push(u);return}if(i==="h264"){u.sdpFmtpLine&&u.sdpFmtpLine.includes("profile-level-id=42e01f")?o.push(u):c.push(u);return}o.push(u)}),supportsSetCodecPreferences(t)&&t.setCodecPreferences(o.concat(c,d))}async createSender(t,n,i){if(supportsTransceiver())return this.createTransceiverRTCRtpSender(t,n,i);if(supportsAddTrack())return livekitLogger.debug("using add-track fallback"),this.createRTCRtpSender(t.mediaStreamTrack);throw new UnexpectedConnectionState("Required webRTC APIs not supported on this device")}async createSimulcastSender(t,n,i,a){if(supportsTransceiver())return this.createSimulcastTransceiverSender(t,n,i,a);if(supportsAddTrack())return livekitLogger.debug("using add-track fallback"),this.createRTCRtpSender(t.mediaStreamTrack);throw new UnexpectedConnectionState("Cannot stream on this device")}async createTransceiverRTCRtpSender(t,n,i){if(!this.publisher)throw new UnexpectedConnectionState("publisher is closed");const a={direction:"sendonly"};i&&(a.sendEncodings=i);const o=await this.publisher.pc.addTransceiver(t.mediaStreamTrack,a);return t.kind===Track.Kind.Video&&n.videoCodec&&(this.setPreferredCodec(o,t.kind,n.videoCodec),t.codec=n.videoCodec),o.sender}async createSimulcastTransceiverSender(t,n,i,a){if(!this.publisher)throw new UnexpectedConnectionState("publisher is closed");const o={direction:"sendonly"};a&&(o.sendEncodings=a);const c=await this.publisher.pc.addTransceiver(n.mediaStreamTrack,o);if(i.videoCodec)return this.setPreferredCodec(c,t.kind,i.videoCodec),t.setSimulcastTrackSender(i.videoCodec,c.sender),c.sender}async createRTCRtpSender(t){if(!this.publisher)throw new UnexpectedConnectionState("publisher is closed");return this.publisher.pc.addTrack(t)}async attemptReconnect(t){var n,i,a;if(!this._isClosed&&!this.attemptingReconnect){(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===ClientConfigSetting.DISABLED||((a=(i=this.primaryPC)===null||i===void 0?void 0:i.signalingState)!==null&&a!==void 0?a:"closed")==="closed")&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?await this.restartConnection():await this.resumeConnection(t),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(o){this.reconnectAttempts+=1;let c=!0;o instanceof UnexpectedConnectionState?(livekitLogger.debug("received unrecoverable error",{error:o}),c=!1):o instanceof SignalReconnectError||(this.fullReconnectOnNext=!0),c?this.handleDisconnect("reconnect",ReconnectReason.RR_UNKOWN):(livekitLogger.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up")),this.emit(EngineEvent.Disconnected),this.close())}finally{this.attemptingReconnect=!1}}}getNextRetryDelay(t){try{return this.reconnectPolicy.nextRetryDelayInMs(t)}catch(n){livekitLogger.warn("encountered error in reconnect policy",{error:n})}return null}async restartConnection(){var t,n;if(!this.url||!this.token)throw new UnexpectedConnectionState("could not reconnect, url or token not saved");livekitLogger.info("reconnecting, attempt: ".concat(this.reconnectAttempts)),this.emit(EngineEvent.Restarting),this.client.isConnected&&await this.client.sendLeave(),await this.client.close(),this.primaryPC=void 0,(t=this.publisher)===null||t===void 0||t.close(),this.publisher=void 0,(n=this.subscriber)===null||n===void 0||n.close(),this.subscriber=void 0;let i;try{if(!this.signalOpts)throw livekitLogger.warn("attempted connection restart, without signal options present"),new SignalReconnectError;i=await this.join(this.url,this.token,this.signalOpts)}catch{throw new SignalReconnectError}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");await this.waitForPCConnected(),this.client.setReconnected(),this.emit(EngineEvent.Restarted,i)}async resumeConnection(t){var n;if(!this.url||!this.token)throw new UnexpectedConnectionState("could not reconnect, url or token not saved");if(!this.publisher||!this.subscriber)throw new UnexpectedConnectionState("publisher and subscriber connections unset");livekitLogger.info("resuming signal connection, attempt ".concat(this.reconnectAttempts)),this.emit(EngineEvent.Resuming);try{const i=await this.client.reconnect(this.url,this.token,this.participantSid,t);if(i){const a=this.makeRTCConfiguration(i);this.publisher.pc.setConfiguration(a),this.subscriber.pc.setConfiguration(a)}}catch(i){let a="";throw i instanceof Error&&(a=i.message),new SignalReconnectError(a)}if(this.emit(EngineEvent.SignalResumed),this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");this.subscriber.restartingIce=!0,this.hasPublished&&await this.publisher.createAndSendOffer({iceRestart:!0}),await this.waitForPCConnected(),this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),this.emit(EngineEvent.Resumed)}async waitForPCConnected(){var t;const n=Date.now();let i=n;for(this.pcState=PCState.Reconnecting,livekitLogger.debug("waiting for peer connection to reconnect");i-n<this.peerConnectionTimeout&&this.primaryPC!==void 0;){if(i-n>minReconnectWait&&((t=this.primaryPC)===null||t===void 0?void 0:t.connectionState)==="connected"&&(this.pcState=PCState.Connected),this.pcState===PCState.Connected)return;await sleep(100),i=Date.now()}throw new ConnectionError("could not establish PC connection")}async sendDataPacket(t,n){const i=DataPacket.encode(t).finish();await this.ensurePublisherConnected(n),n===DataPacket_Kind.LOSSY&&this.lossyDC?this.lossyDC.send(i):n===DataPacket_Kind.RELIABLE&&this.reliableDC&&this.reliableDC.send(i)}async ensureDataTransportConnected(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;var i,a,o;const c=n?this.subscriber:this.publisher,d=n?"Subscriber":"Publisher";if(!c)throw new ConnectionError("".concat(d," connection not set"));!n&&!(!((i=this.publisher)===null||i===void 0)&&i.isICEConnected)&&((a=this.publisher)===null||a===void 0?void 0:a.pc.iceConnectionState)!=="checking"&&this.negotiate();const u=this.dataChannelForKind(t,n);if((u==null?void 0:u.readyState)==="open")return;const l=new Date().getTime()+this.peerConnectionTimeout;for(;new Date().getTime()<l;){if(c.isICEConnected&&((o=this.dataChannelForKind(t,n))===null||o===void 0?void 0:o.readyState)==="open")return;await sleep(50)}throw new ConnectionError("could not establish ".concat(d," connection, state: ").concat(c.pc.iceConnectionState))}async ensurePublisherConnected(t){await this.ensureDataTransportConnected(t,!1)}negotiate(){return new Promise((t,n)=>{if(!this.publisher){n(new NegotiationError("publisher is not defined"));return}this.hasPublished=!0;const i=()=>{livekitLogger.debug("engine disconnected while negotiation was ongoing"),o(),t()};this.on(EngineEvent.Closing,i);const a=setTimeout(()=>{n("negotiation timed out"),this.handleDisconnect("negotiation",ReconnectReason.RR_SIGNAL_DISCONNECTED)},this.peerConnectionTimeout),o=()=>{clearTimeout(a),this.off(EngineEvent.Closing,i)};this.publisher.once(PCEvents.NegotiationStarted,()=>{var c;(c=this.publisher)===null||c===void 0||c.once(PCEvents.NegotiationComplete,()=>{o(),t()})}),this.publisher.negotiate(c=>{o(),n(c),c instanceof NegotiationError&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",ReconnectReason.RR_UNKOWN)})})}dataChannelForKind(t,n){if(n){if(t===DataPacket_Kind.LOSSY)return this.lossyDCSub;if(t===DataPacket_Kind.RELIABLE)return this.reliableDCSub}else{if(t===DataPacket_Kind.LOSSY)return this.lossyDC;if(t===DataPacket_Kind.RELIABLE)return this.reliableDC}}failNext(){this.shouldFailNext=!0}clearReconnectTimeout(){this.reconnectTimeout&&CriticalTimers.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){isWeb()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){isWeb()&&window.removeEventListener("online",this.handleBrowserOnLine)}}async function getConnectedAddress(e){var t;let n="";const i=new Map,a=new Map;if((await e.getStats()).forEach(d=>{switch(d.type){case"transport":n=d.selectedCandidatePairId;break;case"candidate-pair":n===""&&d.selected&&(n=d.id),i.set(d.id,d);break;case"remote-candidate":a.set(d.id,"".concat(d.address,":").concat(d.port));break}}),n==="")return;const c=(t=i.get(n))===null||t===void 0?void 0:t.remoteCandidateId;if(c!==void 0)return a.get(c)}class SignalReconnectError extends Error{}var ConnectionState;(function(e){e.Disconnected="disconnected",e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting"})(ConnectionState||(ConnectionState={}));class Room extends eventsExports.EventEmitter{constructor(t){var n;super(),n=this,this.state=ConnectionState.Disconnected,this.activeSpeakers=[],this.sid="",this.name="",this.metadata=void 0,this._isRecording=!1,this.audioEnabled=!0,this.connect=async(i,a,o)=>{const c=await this.disconnectLock.lock();if(this.state===ConnectionState.Connected)return livekitLogger.info("already connected to room ".concat(this.name)),c(),Promise.resolve();if(this.connectFuture)return c(),this.connectFuture.promise;this.setAndEmitConnectionState(ConnectionState.Connecting);const d=async(u,l)=>{var h,p;(!this.abortController||this.abortController.signal.aborted)&&(this.abortController=new AbortController),c(),this.state===ConnectionState.Reconnecting?(livekitLogger.info("Reconnection attempt replaced by new connection attempt"),this.recreateEngine()):this.maybeCreateEngine(),this.acquireAudioContext(),this.connOptions=_objectSpread2(_objectSpread2({},roomConnectOptionDefaults),o),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const x=await this.engine.join(i,a,{autoSubscribe:this.connOptions.autoSubscribe,publishOnly:this.connOptions.publishOnly,adaptiveStream:typeof this.options.adaptiveStream=="object"?!0:this.options.adaptiveStream,maxRetries:this.connOptions.maxRetries},this.abortController.signal);let S=x.serverInfo;if(S||(S={version:x.serverVersion,region:x.serverRegion}),livekitLogger.debug("connected to Livekit Server ".concat(Object.entries(S).map(T=>{let[L,q]=T;return"".concat(L,": ").concat(q)}).join(", "))),!x.serverVersion)throw new UnsupportedServer("unknown server version");x.serverVersion==="0.15.1"&&this.options.dynacast&&(livekitLogger.debug("disabling dynacast due to server version"),this.options.dynacast=!1);const k=x.participant;this.localParticipant.sid=k.sid,this.localParticipant.identity=k.identity,this.localParticipant.updateInfo(k),this.setupLocalParticipantEvents(),x.otherParticipants.forEach(T=>{T.sid!==this.localParticipant.sid&&T.identity!==this.localParticipant.identity?this.getOrCreateParticipant(T.sid,T):livekitLogger.warn("received info to create local participant as remote participant",{info:T,localParticipant:this.localParticipant})}),this.name=x.room.name,this.sid=x.room.sid,this.metadata=x.room.metadata,this._isRecording!==x.room.activeRecording&&(this._isRecording=x.room.activeRecording,this.emit(RoomEvent.RecordingStatusChanged,x.room.activeRecording)),this.emit(RoomEvent.SignalConnected)}catch(x){this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish);const S=new ConnectionError("could not establish signal connection");x instanceof Error&&(S.message="".concat(S.message,": ").concat(x.message)),x instanceof ConnectionError&&(S.reason=x.reason,S.status=x.status),livekitLogger.debug("error trying to establish signal connection",{error:x}),l(S);return}const y=CriticalTimers.setTimeout(()=>{this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),l(new ConnectionError("could not connect PeerConnection after timeout"))},this.connOptions.peerConnectionTimeout),E=()=>{livekitLogger.warn("closing engine"),CriticalTimers.clearTimeout(y),this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),l(new ConnectionError("room connection has been cancelled"))};!((h=this.abortController)===null||h===void 0)&&h.signal.aborted&&E(),(p=this.abortController)===null||p===void 0||p.signal.addEventListener("abort",E),this.engine.once(EngineEvent.Connected,()=>{var x,S;CriticalTimers.clearTimeout(y),(x=this.abortController)===null||x===void 0||x.signal.removeEventListener("abort",E),isWeb()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave),(S=navigator.mediaDevices)===null||S===void 0||S.addEventListener("devicechange",this.handleDeviceChange)),this.setAndEmitConnectionState(ConnectionState.Connected),this.emit(RoomEvent.Connected),u()})};return this.connectFuture=new Future(d,()=>{this.clearConnectionFutures()}),this.connectFuture.promise},this.disconnect=async function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;var a,o,c,d;const u=await n.disconnectLock.lock();try{if(n.state===ConnectionState.Disconnected){livekitLogger.debug("already disconnected");return}livekitLogger.info("disconnect from room",{identity:n.localParticipant.identity}),(n.state===ConnectionState.Connecting||n.state===ConnectionState.Reconnecting)&&(livekitLogger.warn("abort connection attempt"),(a=n.abortController)===null||a===void 0||a.abort(),(c=(o=n.connectFuture)===null||o===void 0?void 0:o.reject)===null||c===void 0||c.call(o,new ConnectionError("Client initiated disconnect")),n.connectFuture=void 0),!((d=n.engine)===null||d===void 0)&&d.client.isConnected&&await n.engine.client.sendLeave(),n.engine&&await n.engine.close(),n.handleDisconnect(i,DisconnectReason.CLIENT_INITIATED),n.engine=void 0}finally{u()}},this.onPageLeave=async()=>{await this.disconnect()},this.handleRestarting=()=>{for(const i of this.participants.values())this.handleParticipantDisconnected(i.sid,i);this.setAndEmitConnectionState(ConnectionState.Reconnecting)&&this.emit(RoomEvent.Reconnecting)},this.handleRestarted=async i=>{livekitLogger.debug("reconnected to server",{region:i.serverRegion});try{i.participant&&(this.localParticipant.sid=i.participant.sid,this.handleParticipantUpdates([i.participant])),this.handleParticipantUpdates(i.otherParticipants);const a=[];this.localParticipant.tracks.forEach(o=>{o.track&&a.push(o)}),await Promise.all(a.map(async o=>{const c=o.track;this.localParticipant.unpublishTrack(c,!1),c.isMuted||((c instanceof LocalAudioTrack||c instanceof LocalVideoTrack)&&!c.isUserProvided&&(livekitLogger.debug("restarting existing track",{track:o.trackSid}),await c.restartTrack()),livekitLogger.debug("publishing new track",{track:o.trackSid}),await this.localParticipant.publishTrack(c,o.options))}))}catch(a){livekitLogger.error("error trying to re-publish tracks after reconnection",{error:a})}finally{this.setAndEmitConnectionState(ConnectionState.Connected),this.emit(RoomEvent.Reconnected)}},this.handleParticipantUpdates=i=>{i.forEach(a=>{if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}const o=this.identityToSid.get(a.identity);o&&o!==a.sid&&this.handleParticipantDisconnected(o,this.participants.get(o));let c=this.participants.get(a.sid);const d=!c;a.state===ParticipantInfo_State.DISCONNECTED?this.handleParticipantDisconnected(a.sid,c):(c=this.getOrCreateParticipant(a.sid,a),d||c.updateInfo(a))})},this.handleActiveSpeakersUpdate=i=>{const a=[],o={};i.forEach(c=>{if(o[c.sid]=!0,c.sid===this.localParticipant.sid)this.localParticipant.audioLevel=c.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const d=this.participants.get(c.sid);d&&(d.audioLevel=c.level,d.setIsSpeaking(!0),a.push(d))}}),o[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.participants.forEach(c=>{o[c.sid]||(c.audioLevel=0,c.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(RoomEvent.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=i=>{const a=new Map;this.activeSpeakers.forEach(c=>{a.set(c.sid,c)}),i.forEach(c=>{let d=this.participants.get(c.sid);c.sid===this.localParticipant.sid&&(d=this.localParticipant),d&&(d.audioLevel=c.level,d.setIsSpeaking(c.active),c.active?a.set(c.sid,d):a.delete(c.sid))});const o=Array.from(a.values());o.sort((c,d)=>d.audioLevel-c.audioLevel),this.activeSpeakers=o,this.emitWhenConnected(RoomEvent.ActiveSpeakersChanged,o)},this.handleStreamStateUpdate=i=>{i.streamStates.forEach(a=>{const o=this.participants.get(a.participantSid);if(!o)return;const c=o.getTrackPublication(a.trackSid);!c||!c.track||(c.track.streamState=Track.streamStateFromProto(a.state),o.emit(ParticipantEvent.TrackStreamStateChanged,c,c.track.streamState),this.emitWhenConnected(RoomEvent.TrackStreamStateChanged,c,c.track.streamState,o))})},this.handleSubscriptionPermissionUpdate=i=>{const a=this.participants.get(i.participantSid);if(!a)return;const o=a.getTrackPublication(i.trackSid);o&&o.setAllowed(i.allowed)},this.handleDataPacket=(i,a)=>{const o=this.participants.get(i.participantSid);this.emit(RoomEvent.DataReceived,i.payload,o,a,i.topic),o==null||o.emit(ParticipantEvent.DataReceived,i.payload,a)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(RoomEvent.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=i=>{livekitLogger.warn("could not playback audio",i),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(RoomEvent.AudioPlaybackStatusChanged,!1))},this.handleDeviceChange=async()=>{this.emit(RoomEvent.MediaDevicesChanged)},this.handleRoomUpdate=i=>{this._isRecording!==i.activeRecording&&(this._isRecording=i.activeRecording,this.emit(RoomEvent.RecordingStatusChanged,i.activeRecording)),this.metadata!==i.metadata&&(this.metadata=i.metadata,this.emitWhenConnected(RoomEvent.RoomMetadataChanged,i.metadata))},this.handleConnectionQualityUpdate=i=>{i.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const o=this.participants.get(a.participantSid);o&&o.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=i=>{this.emit(RoomEvent.ParticipantMetadataChanged,i,this.localParticipant)},this.onLocalTrackMuted=i=>{this.emit(RoomEvent.TrackMuted,i,this.localParticipant)},this.onLocalTrackUnmuted=i=>{this.emit(RoomEvent.TrackUnmuted,i,this.localParticipant)},this.onLocalTrackPublished=async i=>{this.emit(RoomEvent.LocalTrackPublished,i,this.localParticipant),i.track instanceof LocalAudioTrack&&await i.track.checkForSilence()&&this.emit(RoomEvent.LocalAudioSilenceDetected,i)},this.onLocalTrackUnpublished=i=>{this.emit(RoomEvent.LocalTrackUnpublished,i,this.localParticipant)},this.onLocalConnectionQualityChanged=i=>{this.emit(RoomEvent.ConnectionQualityChanged,i,this.localParticipant)},this.onMediaDevicesError=i=>{this.emit(RoomEvent.MediaDevicesError,i)},this.onLocalParticipantPermissionsChanged=i=>{this.emit(RoomEvent.ParticipantPermissionsChanged,i,this.localParticipant)},this.setMaxListeners(100),this.participants=new Map,this.identityToSid=new Map,this.options=_objectSpread2(_objectSpread2({},roomOptionDefaults),t),this.options.audioCaptureDefaults=_objectSpread2(_objectSpread2({},audioDefaults),t==null?void 0:t.audioCaptureDefaults),this.options.videoCaptureDefaults=_objectSpread2(_objectSpread2({},videoDefaults),t==null?void 0:t.videoCaptureDefaults),this.options.publishDefaults=_objectSpread2(_objectSpread2({},publishDefaults),t==null?void 0:t.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new Mutex,this.localParticipant=new LocalParticipant("","",this.engine,this.options)}maybeCreateEngine(){this.engine||(this.engine=new RTCEngine(this.options),this.engine.client.onParticipantUpdate=this.handleParticipantUpdates,this.engine.client.onRoomUpdate=this.handleRoomUpdate,this.engine.client.onSpeakersChanged=this.handleSpeakersChanged,this.engine.client.onStreamStateUpdate=this.handleStreamStateUpdate,this.engine.client.onSubscriptionPermissionUpdate=this.handleSubscriptionPermissionUpdate,this.engine.client.onConnectionQuality=this.handleConnectionQualityUpdate,this.engine.on(EngineEvent.MediaTrackAdded,(t,n,i)=>{this.onTrackAdded(t,n,i)}).on(EngineEvent.Disconnected,t=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,t)}).on(EngineEvent.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(EngineEvent.DataPacketReceived,this.handleDataPacket).on(EngineEvent.Resuming,()=>{this.setAndEmitConnectionState(ConnectionState.Reconnecting)&&this.emit(RoomEvent.Reconnecting)}).on(EngineEvent.Resumed,()=>{this.setAndEmitConnectionState(ConnectionState.Connected),this.emit(RoomEvent.Reconnected),this.updateSubscriptions()}).on(EngineEvent.SignalResumed,()=>{this.state===ConnectionState.Reconnecting&&this.sendSyncState()}).on(EngineEvent.Restarting,this.handleRestarting).on(EngineEvent.Restarted,this.handleRestarted),this.localParticipant&&this.localParticipant.setupEngine(this.engine))}static getLocalDevices(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return DeviceManager.getInstance().getDevices(t,n)}async prepareConnection(t){await fetch("http".concat(t.substring(2)),{method:"HEAD"})}getParticipantByIdentity(t){if(this.localParticipant.identity===t)return this.localParticipant;const n=this.identityToSid.get(t);if(n)return this.participants.get(n)}clearConnectionFutures(){this.connectFuture=void 0}get isRecording(){return this._isRecording}async simulateScenario(t){let n=()=>{},i;switch(t){case"signal-reconnect":await this.engine.client.close(),this.engine.client.onClose&&this.engine.client.onClose("simulate disconnect");break;case"speaker":i=SimulateScenario.fromPartial({scenario:{$case:"speakerUpdate",speakerUpdate:3}});break;case"node-failure":i=SimulateScenario.fromPartial({scenario:{$case:"nodeFailure",nodeFailure:!0}});break;case"server-leave":i=SimulateScenario.fromPartial({scenario:{$case:"serverLeave",serverLeave:!0}});break;case"migration":i=SimulateScenario.fromPartial({scenario:{$case:"migration",migration:!0}});break;case"resume-reconnect":this.engine.failNext(),await this.engine.client.close(),this.engine.client.onClose&&this.engine.client.onClose("simulate resume-reconnect");break;case"force-tcp":case"force-tls":i=SimulateScenario.fromPartial({scenario:{$case:"switchCandidateProtocol",switchCandidateProtocol:t==="force-tls"?2:1}}),n=async()=>{const a=this.engine.client.onLeave;a&&a({reason:DisconnectReason.CLIENT_INITIATED,canReconnect:!0})};break}i&&(this.engine.client.sendSimulateScenario(i),n())}async startAudio(){await this.acquireAudioContext();const t=[];this.participants.forEach(n=>{n.audioTracks.forEach(i=>{i.track&&i.track.attachedElements.forEach(a=>{t.push(a)})})});try{await Promise.all(t.map(n=>(n.muted=!1,n.play()))),this.handleAudioPlaybackStarted()}catch(n){throw this.handleAudioPlaybackFailed(n),n}}get canPlaybackAudio(){return this.audioEnabled}getActiveAudioOutputDevice(){var t,n;return(n=(t=this.options.audioOutput)===null||t===void 0?void 0:t.deviceId)!==null&&n!==void 0?n:""}async switchActiveDevice(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;var a,o;const c=i?{exact:n}:n;if(t==="audioinput"){const d=this.options.audioCaptureDefaults.deviceId;this.options.audioCaptureDefaults.deviceId=c;const u=Array.from(this.localParticipant.audioTracks.values()).filter(l=>l.source===Track.Source.Microphone);try{await Promise.all(u.map(l=>{var h;return(h=l.audioTrack)===null||h===void 0?void 0:h.setDeviceId(c)}))}catch(l){throw this.options.audioCaptureDefaults.deviceId=d,l}}else if(t==="videoinput"){const d=this.options.videoCaptureDefaults.deviceId;this.options.videoCaptureDefaults.deviceId=c;const u=Array.from(this.localParticipant.videoTracks.values()).filter(l=>l.source===Track.Source.Camera);try{await Promise.all(u.map(l=>{var h;return(h=l.videoTrack)===null||h===void 0?void 0:h.setDeviceId(c)}))}catch(l){throw this.options.videoCaptureDefaults.deviceId=d,l}}else if(t==="audiooutput"){if(!supportsSetSinkId())throw new Error("cannot switch audio output, setSinkId not supported");(a=(o=this.options).audioOutput)!==null&&a!==void 0||(o.audioOutput={});const d=this.options.audioOutput.deviceId;this.options.audioOutput.deviceId=n;try{await Promise.all(Array.from(this.participants.values()).map(u=>u.setAudioOutput({deviceId:n})))}catch(u){throw this.options.audioOutput.deviceId=d,u}}}setupLocalParticipantEvents(){this.localParticipant.on(ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ParticipantEvent.TrackMuted,this.onLocalTrackMuted).on(ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).on(ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).on(ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).on(ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var t;(t=this.engine)===null||t===void 0||t.close(),this.engine=void 0,this.participants.clear(),this.maybeCreateEngine()}onTrackAdded(t,n,i){if(this.state===ConnectionState.Connecting||this.state===ConnectionState.Reconnecting){const l=()=>{this.onTrackAdded(t,n,i),h()},h=()=>{this.off(RoomEvent.Reconnected,l),this.off(RoomEvent.Connected,l),this.off(RoomEvent.Disconnected,h)};this.once(RoomEvent.Reconnected,l),this.once(RoomEvent.Connected,l),this.once(RoomEvent.Disconnected,h);return}if(this.state===ConnectionState.Disconnected){livekitLogger.warn("skipping incoming track after Room disconnected");return}const a=unpackStreamId(n.id),o=a[0];let c=a[1];if((!c||c==="")&&(c=t.id),o===this.localParticipant.sid){livekitLogger.warn("tried to create RemoteParticipant for local participant");return}const d=this.getOrCreateParticipant(o);let u;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?u=this.options.adaptiveStream:u={}),d.addSubscribedMediaTrack(t,c,n,i,u)}handleDisconnect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;this.state!==ConnectionState.Disconnected&&(this.participants.forEach(a=>{a.tracks.forEach(o=>{a.unpublishTrack(o.trackSid)})}),this.localParticipant.tracks.forEach(a=>{var o,c;a.track&&this.localParticipant.unpublishTrack(a.track,t),t&&((o=a.track)===null||o===void 0||o.detach(),(c=a.track)===null||c===void 0||c.stop())}),this.localParticipant.off(ParticipantEvent.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ParticipantEvent.TrackMuted,this.onLocalTrackMuted).off(ParticipantEvent.TrackUnmuted,this.onLocalTrackUnmuted).off(ParticipantEvent.LocalTrackPublished,this.onLocalTrackPublished).off(ParticipantEvent.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ParticipantEvent.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ParticipantEvent.MediaDevicesError,this.onMediaDevicesError).off(ParticipantEvent.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.tracks.clear(),this.localParticipant.videoTracks.clear(),this.localParticipant.audioTracks.clear(),this.participants.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.expWebAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),isWeb()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange)),this.setAndEmitConnectionState(ConnectionState.Disconnected),this.emit(RoomEvent.Disconnected,n))}handleParticipantDisconnected(t,n){this.participants.delete(t),n&&(this.identityToSid.delete(n.identity),n.tracks.forEach(i=>{n.unpublishTrack(i.trackSid,!0)}),this.emit(RoomEvent.ParticipantDisconnected,n))}async acquireAudioContext(){var t,n;typeof this.options.expWebAudioMix!="boolean"&&this.options.expWebAudioMix.audioContext?(this.audioContext=this.options.expWebAudioMix.audioContext,await this.audioContext.resume()):this.audioContext=(t=getNewAudioContext())!==null&&t!==void 0?t:void 0,this.options.expWebAudioMix&&this.participants.forEach(a=>a.setAudioContext(this.audioContext));const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(RoomEvent.AudioPlaybackStatusChanged,i))}createParticipant(t,n){let i;return n?i=RemoteParticipant.fromParticipantInfo(this.engine.client,n):i=new RemoteParticipant(this.engine.client,t,"",void 0,void 0),this.options.expWebAudioMix&&i.setAudioContext(this.audioContext),i}getOrCreateParticipant(t,n){if(this.participants.has(t))return this.participants.get(t);const i=this.createParticipant(t,n);return this.participants.set(t,i),n&&(this.identityToSid.set(n.identity,n.sid),this.emitWhenConnected(RoomEvent.ParticipantConnected,i)),i.on(ParticipantEvent.TrackPublished,a=>{this.emitWhenConnected(RoomEvent.TrackPublished,a,i)}).on(ParticipantEvent.TrackSubscribed,(a,o)=>{a.kind===Track.Kind.Audio&&(a.on(TrackEvent.AudioPlaybackStarted,this.handleAudioPlaybackStarted),a.on(TrackEvent.AudioPlaybackFailed,this.handleAudioPlaybackFailed)),this.emit(RoomEvent.TrackSubscribed,a,o,i)}).on(ParticipantEvent.TrackUnpublished,a=>{this.emit(RoomEvent.TrackUnpublished,a,i)}).on(ParticipantEvent.TrackUnsubscribed,(a,o)=>{this.emit(RoomEvent.TrackUnsubscribed,a,o,i)}).on(ParticipantEvent.TrackSubscriptionFailed,a=>{this.emit(RoomEvent.TrackSubscriptionFailed,a,i)}).on(ParticipantEvent.TrackMuted,a=>{this.emitWhenConnected(RoomEvent.TrackMuted,a,i)}).on(ParticipantEvent.TrackUnmuted,a=>{this.emitWhenConnected(RoomEvent.TrackUnmuted,a,i)}).on(ParticipantEvent.ParticipantMetadataChanged,a=>{this.emitWhenConnected(RoomEvent.ParticipantMetadataChanged,a,i)}).on(ParticipantEvent.ConnectionQualityChanged,a=>{this.emitWhenConnected(RoomEvent.ConnectionQualityChanged,a,i)}).on(ParticipantEvent.ParticipantPermissionsChanged,a=>{this.emitWhenConnected(RoomEvent.ParticipantPermissionsChanged,a,i)}).on(ParticipantEvent.TrackSubscriptionStatusChanged,(a,o)=>{this.emitWhenConnected(RoomEvent.TrackSubscriptionStatusChanged,a,o,i)}).on(ParticipantEvent.TrackSubscriptionPermissionChanged,(a,o)=>{this.emitWhenConnected(RoomEvent.TrackSubscriptionPermissionChanged,a,o,i)}),n&&i.updateInfo(n),i}sendSyncState(){var t,n;if(this.engine.subscriber===void 0||this.engine.subscriber.pc.localDescription===null)return;const i=this.engine.subscriber.pc.localDescription,a=this.engine.subscriber.pc.remoteDescription,o=(n=(t=this.connOptions)===null||t===void 0?void 0:t.autoSubscribe)!==null&&n!==void 0?n:!0,c=new Array;this.participants.forEach(d=>{d.tracks.forEach(u=>{u.isDesired!==o&&c.push(u.trackSid)})}),this.engine.client.sendSyncState({answer:toProtoSessionDescription({sdp:i.sdp,type:i.type}),offer:a?toProtoSessionDescription({sdp:a.sdp,type:a.type}):void 0,subscription:{trackSids:c,subscribe:!o,participantTracks:[]},publishTracks:this.localParticipant.publishedTracksInfo(),dataChannels:this.localParticipant.dataChannelsInfo()})}updateSubscriptions(){for(const t of this.participants.values())for(const n of t.videoTracks.values())n.isSubscribed&&n instanceof RemoteTrackPublication&&n.emitTrackUpdate()}setAndEmitConnectionState(t){return t===this.state?!1:(this.state=t,this.emit(RoomEvent.ConnectionStateChanged,this.state),!0)}emitWhenConnected(t){if(this.state===ConnectionState.Connected){for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return this.emit(t,...i)}return!1}async simulateParticipants(t){var n,i;const a=_objectSpread2({audio:!0,video:!0,useRealTracks:!1},t.publish),o=_objectSpread2({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},t.participants);if(this.handleDisconnect(),this.name="simulated-room",this.localParticipant.updateInfo(ParticipantInfo.fromPartial({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(RoomEvent.SignalConnected),this.emit(RoomEvent.Connected),this.setAndEmitConnectionState(ConnectionState.Connected),a.video){const c=new LocalTrackPublication(Track.Kind.Video,TrackInfo.fromPartial({source:TrackSource.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO,name:"video-dummy"}),new LocalVideoTrack(a.useRealTracks?(await navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:createDummyVideoStreamTrack((n=160*o.aspectRatios[0])!==null&&n!==void 0?n:1,160,!0,!0)));this.localParticipant.addTrackPublication(c),this.localParticipant.emit(ParticipantEvent.LocalTrackPublished,c)}if(a.audio){const c=new LocalTrackPublication(Track.Kind.Audio,TrackInfo.fromPartial({source:TrackSource.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO}),new LocalAudioTrack(a.useRealTracks?(await navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:getEmptyAudioStreamTrack()));this.localParticipant.addTrackPublication(c),this.localParticipant.emit(ParticipantEvent.LocalTrackPublished,c)}for(let c=0;c<o.count-1;c+=1){let d=ParticipantInfo.fromPartial({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(c),state:ParticipantInfo_State.ACTIVE,tracks:[],joinedAt:Date.now()});const u=this.getOrCreateParticipant(d.identity,d);if(o.video){const l=createDummyVideoStreamTrack((i=160*o.aspectRatios[c%o.aspectRatios.length])!==null&&i!==void 0?i:1,160,!1,!0),h=TrackInfo.fromPartial({source:TrackSource.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO});u.addSubscribedMediaTrack(l,h.sid,new MediaStream([l])),d.tracks=[...d.tracks,h]}if(o.audio){const l=getEmptyAudioStreamTrack(),h=TrackInfo.fromPartial({source:TrackSource.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:TrackType.AUDIO});u.addSubscribedMediaTrack(l,h.sid,new MediaStream([l])),d.tracks=[...d.tracks,h]}u.updateInfo(d)}}emit(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return t!==RoomEvent.ActiveSpeakersChanged&&livekitLogger.debug("room event ".concat(t),{event:t,args:i}),super.emit(t,...i)}}var CheckStatus;(function(e){e[e.IDLE=0]="IDLE",e[e.RUNNING=1]="RUNNING",e[e.SKIPPED=2]="SKIPPED",e[e.SUCCESS=3]="SUCCESS",e[e.FAILED=4]="FAILED"})(CheckStatus||(CheckStatus={}));class Checker extends eventsExports.EventEmitter{constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=CheckStatus.IDLE,this.logs=[],this.errorsAsWarnings=!1,this.url=t,this.token=n,this.name=this.constructor.name,this.room=new Room(i.roomOptions),this.connectOptions=i.connectOptions,i.errorsAsWarnings&&(this.errorsAsWarnings=i.errorsAsWarnings)}async run(t){if(this.status!==CheckStatus.IDLE)throw Error("check is running already");this.setStatus(CheckStatus.RUNNING),this.appendMessage("".concat(this.name," started."));try{await this.perform()}catch(n){n instanceof Error&&(this.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return await this.disconnect(),await new Promise(n=>setTimeout(n,500)),this.status!==CheckStatus.SKIPPED&&this.setStatus(this.isSuccess()?CheckStatus.SUCCESS:CheckStatus.FAILED),t&&t(),this.getInfo()}isSuccess(){return!this.logs.some(t=>t.level==="error")}async connect(){return this.room.state===ConnectionState.Connected?this.room:(await this.room.connect(this.url,this.token),this.room)}async disconnect(){this.room&&this.room.state!==ConnectionState.Disconnected&&(await this.room.disconnect(),await new Promise(t=>setTimeout(t,500)))}skip(){this.setStatus(CheckStatus.SKIPPED)}appendMessage(t){this.logs.push({level:"info",message:t}),this.emit("update",this.getInfo())}appendWarning(t){this.logs.push({level:"warning",message:t}),this.emit("update",this.getInfo())}appendError(t){this.logs.push({level:"error",message:t}),this.emit("update",this.getInfo())}setStatus(t){this.status=t,this.emit("update",this.getInfo())}get engine(){var t;return(t=this.room)===null||t===void 0?void 0:t.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class LiveKitTransport extends Transport{constructor(n){super();pt(this,"url");pt(this,"token");pt(this,"room");pt(this,"onConnected",()=>{this.emit({$case:"connected"})});pt(this,"onDisconnected",n=>{this.emit({$case:"disconnected",reason:`${n}`})});pt(this,"onParticipantConnected",n=>{this.emit({$case:"connected",peer:n.identity})});pt(this,"onParticipantDisconnected",n=>{this.emit({$case:"disconnected",peer:n.identity})});pt(this,"onDataReceived",(n,i,a)=>{this.emit({$case:"message",peer:i==null?void 0:i.identity,message:this.decode(n)})});const i=new URL(n),a=i.searchParams.get("access_token");i.searchParams.delete("access_token"),this.url=i.toString(),this.token=a}async connect(){console.log("Connecting to",this.url),this.room=new Room({}),this.room.on(RoomEvent.Connected,this.onConnected).on(RoomEvent.Disconnected,this.onDisconnected).on(RoomEvent.ParticipantConnected,this.onParticipantConnected).on(RoomEvent.ParticipantDisconnected,this.onParticipantDisconnected).on(RoomEvent.DataReceived,this.onDataReceived),await this.room.connect(this.url,this.token)}async send(n){await this.room.localParticipant.publishData(this.encode(n),DataPacket_Kind.RELIABLE)}disconnect(){var n;(n=this.room)==null||n.disconnect()}}class ArchipelagoClient extends Emitter{constructor(n){super();pt(this,"transport");pt(this,"onTransportMessage",n=>{if(n.$case=="connected")this.emit({$case:"connected"});else if(n.$case=="disconnected")this.emit({$case:"disconnected"});else if(n.$case=="message"&&n.message.$case=="islandChanged"){const i=n.message.islandChanged,a=i.connStr.split(":",1)[0],o=i.connStr.slice(a.length+1),c=i.islandId,d=Object.keys(i.peers);this.emit({$case:"island_changed",island:{id:c,transport:a,uri:o,peers:d}})}});this.transport=new ArchipelagoTransport(n),this.transport.on("*",this.onTransportMessage)}async connect(){await this.transport.connect()}async requestChallenge(n){this.transport.send({$case:"challengeRequest",challengeRequest:{address:n}});const{challengeResponse:i}=(await this.transport.receive("challengeResponse")).message;return i.challengeToSign}async respondChallenge(n){this.transport.send({$case:"signedChallenge",signedChallenge:{authChainJson:JSON.stringify(n)}});const{welcome:i}=(await this.transport.receive("welcome")).message;return{id:i.peerId}}async sendHeartbeat(n,i){this.transport.send({$case:"heartbeat",heartbeat:{position:n,desiredRoom:i}})}}class ArchipelagoTransport extends WebSocketTransport{constructor(t){const n=`${t.url.replace(/^http/,"ws")}/archipelago/ws`,i="archipelago";super(n,i)}decode(t){return ServerPacket.decode(t).message}encode(t){return ClientPacket.encode({message:t}).finish()}}function voice_VoiceCodecFromJSON(e){switch(e){case 0:case"VC_OPUS":return 0;case-1:case"UNRECOGNIZED":default:return-1}}function voice_VoiceCodecToJSON(e){switch(e){case 0:return"VC_OPUS";case-1:default:return"UNRECOGNIZED"}}function createBasePacket(){return{message:void 0}}const Packet={encode(e,t=_m0$1.Writer.create()){var n;switch((n=e.message)==null?void 0:n.$case){case"position":Position.encode(e.message.position,t.uint32(10).fork()).ldelim();break;case"profileVersion":AnnounceProfileVersion.encode(e.message.profileVersion,t.uint32(18).fork()).ldelim();break;case"profileRequest":ProfileRequest.encode(e.message.profileRequest,t.uint32(26).fork()).ldelim();break;case"profileResponse":ProfileResponse.encode(e.message.profileResponse,t.uint32(34).fork()).ldelim();break;case"chat":Chat.encode(e.message.chat,t.uint32(42).fork()).ldelim();break;case"scene":Scene.encode(e.message.scene,t.uint32(50).fork()).ldelim();break;case"voice":Voice.encode(e.message.voice,t.uint32(58).fork()).ldelim();break}return t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBasePacket();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==10)break;a.message={$case:"position",position:Position.decode(n,n.uint32())};continue;case 2:if(o!==18)break;a.message={$case:"profileVersion",profileVersion:AnnounceProfileVersion.decode(n,n.uint32())};continue;case 3:if(o!==26)break;a.message={$case:"profileRequest",profileRequest:ProfileRequest.decode(n,n.uint32())};continue;case 4:if(o!==34)break;a.message={$case:"profileResponse",profileResponse:ProfileResponse.decode(n,n.uint32())};continue;case 5:if(o!==42)break;a.message={$case:"chat",chat:Chat.decode(n,n.uint32())};continue;case 6:if(o!==50)break;a.message={$case:"scene",scene:Scene.decode(n,n.uint32())};continue;case 7:if(o!==58)break;a.message={$case:"voice",voice:Voice.decode(n,n.uint32())};continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{message:isSet(e.position)?{$case:"position",position:Position.fromJSON(e.position)}:isSet(e.profileVersion)?{$case:"profileVersion",profileVersion:AnnounceProfileVersion.fromJSON(e.profileVersion)}:isSet(e.profileRequest)?{$case:"profileRequest",profileRequest:ProfileRequest.fromJSON(e.profileRequest)}:isSet(e.profileResponse)?{$case:"profileResponse",profileResponse:ProfileResponse.fromJSON(e.profileResponse)}:isSet(e.chat)?{$case:"chat",chat:Chat.fromJSON(e.chat)}:isSet(e.scene)?{$case:"scene",scene:Scene.fromJSON(e.scene)}:isSet(e.voice)?{$case:"voice",voice:Voice.fromJSON(e.voice)}:void 0}},toJSON(e){var n,i,a,o,c,d,u,l,h,p,y,E,x,S,k,T,L,q,U,ee,W;const t={};return((n=e.message)==null?void 0:n.$case)==="position"&&(t.position=(i=e.message)!=null&&i.position?Position.toJSON((a=e.message)==null?void 0:a.position):void 0),((o=e.message)==null?void 0:o.$case)==="profileVersion"&&(t.profileVersion=(c=e.message)!=null&&c.profileVersion?AnnounceProfileVersion.toJSON((d=e.message)==null?void 0:d.profileVersion):void 0),((u=e.message)==null?void 0:u.$case)==="profileRequest"&&(t.profileRequest=(l=e.message)!=null&&l.profileRequest?ProfileRequest.toJSON((h=e.message)==null?void 0:h.profileRequest):void 0),((p=e.message)==null?void 0:p.$case)==="profileResponse"&&(t.profileResponse=(y=e.message)!=null&&y.profileResponse?ProfileResponse.toJSON((E=e.message)==null?void 0:E.profileResponse):void 0),((x=e.message)==null?void 0:x.$case)==="chat"&&(t.chat=(S=e.message)!=null&&S.chat?Chat.toJSON((k=e.message)==null?void 0:k.chat):void 0),((T=e.message)==null?void 0:T.$case)==="scene"&&(t.scene=(L=e.message)!=null&&L.scene?Scene.toJSON((q=e.message)==null?void 0:q.scene):void 0),((U=e.message)==null?void 0:U.$case)==="voice"&&(t.voice=(ee=e.message)!=null&&ee.voice?Voice.toJSON((W=e.message)==null?void 0:W.voice):void 0),t},create(e){return Packet.fromPartial(e??{})},fromPartial(e){var n,i,a,o,c,d,u,l,h,p,y,E,x,S,k,T,L,q,U,ee,W;const t=createBasePacket();return((n=e.message)==null?void 0:n.$case)==="position"&&((i=e.message)==null?void 0:i.position)!==void 0&&((a=e.message)==null?void 0:a.position)!==null&&(t.message={$case:"position",position:Position.fromPartial(e.message.position)}),((o=e.message)==null?void 0:o.$case)==="profileVersion"&&((c=e.message)==null?void 0:c.profileVersion)!==void 0&&((d=e.message)==null?void 0:d.profileVersion)!==null&&(t.message={$case:"profileVersion",profileVersion:AnnounceProfileVersion.fromPartial(e.message.profileVersion)}),((u=e.message)==null?void 0:u.$case)==="profileRequest"&&((l=e.message)==null?void 0:l.profileRequest)!==void 0&&((h=e.message)==null?void 0:h.profileRequest)!==null&&(t.message={$case:"profileRequest",profileRequest:ProfileRequest.fromPartial(e.message.profileRequest)}),((p=e.message)==null?void 0:p.$case)==="profileResponse"&&((y=e.message)==null?void 0:y.profileResponse)!==void 0&&((E=e.message)==null?void 0:E.profileResponse)!==null&&(t.message={$case:"profileResponse",profileResponse:ProfileResponse.fromPartial(e.message.profileResponse)}),((x=e.message)==null?void 0:x.$case)==="chat"&&((S=e.message)==null?void 0:S.chat)!==void 0&&((k=e.message)==null?void 0:k.chat)!==null&&(t.message={$case:"chat",chat:Chat.fromPartial(e.message.chat)}),((T=e.message)==null?void 0:T.$case)==="scene"&&((L=e.message)==null?void 0:L.scene)!==void 0&&((q=e.message)==null?void 0:q.scene)!==null&&(t.message={$case:"scene",scene:Scene.fromPartial(e.message.scene)}),((U=e.message)==null?void 0:U.$case)==="voice"&&((ee=e.message)==null?void 0:ee.voice)!==void 0&&((W=e.message)==null?void 0:W.voice)!==null&&(t.message={$case:"voice",voice:Voice.fromPartial(e.message.voice)}),t}};function createBasePosition(){return{index:0,positionX:0,positionY:0,positionZ:0,rotationX:0,rotationY:0,rotationZ:0,rotationW:0}}const Position={encode(e,t=_m0$1.Writer.create()){return e.index!==0&&t.uint32(8).uint32(e.index),e.positionX!==0&&t.uint32(29).float(e.positionX),e.positionY!==0&&t.uint32(37).float(e.positionY),e.positionZ!==0&&t.uint32(45).float(e.positionZ),e.rotationX!==0&&t.uint32(53).float(e.rotationX),e.rotationY!==0&&t.uint32(61).float(e.rotationY),e.rotationZ!==0&&t.uint32(69).float(e.rotationZ),e.rotationW!==0&&t.uint32(77).float(e.rotationW),t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBasePosition();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==8)break;a.index=n.uint32();continue;case 3:if(o!==29)break;a.positionX=n.float();continue;case 4:if(o!==37)break;a.positionY=n.float();continue;case 5:if(o!==45)break;a.positionZ=n.float();continue;case 6:if(o!==53)break;a.rotationX=n.float();continue;case 7:if(o!==61)break;a.rotationY=n.float();continue;case 8:if(o!==69)break;a.rotationZ=n.float();continue;case 9:if(o!==77)break;a.rotationW=n.float();continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{index:isSet(e.index)?Number(e.index):0,positionX:isSet(e.positionX)?Number(e.positionX):0,positionY:isSet(e.positionY)?Number(e.positionY):0,positionZ:isSet(e.positionZ)?Number(e.positionZ):0,rotationX:isSet(e.rotationX)?Number(e.rotationX):0,rotationY:isSet(e.rotationY)?Number(e.rotationY):0,rotationZ:isSet(e.rotationZ)?Number(e.rotationZ):0,rotationW:isSet(e.rotationW)?Number(e.rotationW):0}},toJSON(e){const t={};return e.index!==void 0&&(t.index=Math.round(e.index)),e.positionX!==void 0&&(t.positionX=e.positionX),e.positionY!==void 0&&(t.positionY=e.positionY),e.positionZ!==void 0&&(t.positionZ=e.positionZ),e.rotationX!==void 0&&(t.rotationX=e.rotationX),e.rotationY!==void 0&&(t.rotationY=e.rotationY),e.rotationZ!==void 0&&(t.rotationZ=e.rotationZ),e.rotationW!==void 0&&(t.rotationW=e.rotationW),t},create(e){return Position.fromPartial(e??{})},fromPartial(e){const t=createBasePosition();return t.index=e.index??0,t.positionX=e.positionX??0,t.positionY=e.positionY??0,t.positionZ=e.positionZ??0,t.rotationX=e.rotationX??0,t.rotationY=e.rotationY??0,t.rotationZ=e.rotationZ??0,t.rotationW=e.rotationW??0,t}};function createBaseAnnounceProfileVersion(){return{profileVersion:0}}const AnnounceProfileVersion={encode(e,t=_m0$1.Writer.create()){return e.profileVersion!==0&&t.uint32(8).uint32(e.profileVersion),t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseAnnounceProfileVersion();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==8)break;a.profileVersion=n.uint32();continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{profileVersion:isSet(e.profileVersion)?Number(e.profileVersion):0}},toJSON(e){const t={};return e.profileVersion!==void 0&&(t.profileVersion=Math.round(e.profileVersion)),t},create(e){return AnnounceProfileVersion.fromPartial(e??{})},fromPartial(e){const t=createBaseAnnounceProfileVersion();return t.profileVersion=e.profileVersion??0,t}};function createBaseProfileRequest(){return{address:"",profileVersion:0}}const ProfileRequest={encode(e,t=_m0$1.Writer.create()){return e.address!==""&&t.uint32(34).string(e.address),e.profileVersion!==0&&t.uint32(24).uint32(e.profileVersion),t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseProfileRequest();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 4:if(o!==34)break;a.address=n.string();continue;case 3:if(o!==24)break;a.profileVersion=n.uint32();continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{address:isSet(e.address)?String(e.address):"",profileVersion:isSet(e.profileVersion)?Number(e.profileVersion):0}},toJSON(e){const t={};return e.address!==void 0&&(t.address=e.address),e.profileVersion!==void 0&&(t.profileVersion=Math.round(e.profileVersion)),t},create(e){return ProfileRequest.fromPartial(e??{})},fromPartial(e){const t=createBaseProfileRequest();return t.address=e.address??"",t.profileVersion=e.profileVersion??0,t}};function createBaseProfileResponse(){return{serializedProfile:"",baseUrl:""}}const ProfileResponse={encode(e,t=_m0$1.Writer.create()){return e.serializedProfile!==""&&t.uint32(10).string(e.serializedProfile),e.baseUrl!==""&&t.uint32(18).string(e.baseUrl),t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseProfileResponse();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==10)break;a.serializedProfile=n.string();continue;case 2:if(o!==18)break;a.baseUrl=n.string();continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{serializedProfile:isSet(e.serializedProfile)?String(e.serializedProfile):"",baseUrl:isSet(e.baseUrl)?String(e.baseUrl):""}},toJSON(e){const t={};return e.serializedProfile!==void 0&&(t.serializedProfile=e.serializedProfile),e.baseUrl!==void 0&&(t.baseUrl=e.baseUrl),t},create(e){return ProfileResponse.fromPartial(e??{})},fromPartial(e){const t=createBaseProfileResponse();return t.serializedProfile=e.serializedProfile??"",t.baseUrl=e.baseUrl??"",t}};function createBaseChat(){return{message:"",timestamp:0}}const Chat={encode(e,t=_m0$1.Writer.create()){return e.message!==""&&t.uint32(10).string(e.message),e.timestamp!==0&&t.uint32(17).double(e.timestamp),t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseChat();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==10)break;a.message=n.string();continue;case 2:if(o!==17)break;a.timestamp=n.double();continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{message:isSet(e.message)?String(e.message):"",timestamp:isSet(e.timestamp)?Number(e.timestamp):0}},toJSON(e){const t={};return e.message!==void 0&&(t.message=e.message),e.timestamp!==void 0&&(t.timestamp=e.timestamp),t},create(e){return Chat.fromPartial(e??{})},fromPartial(e){const t=createBaseChat();return t.message=e.message??"",t.timestamp=e.timestamp??0,t}};function createBaseScene(){return{sceneId:"",data:new Uint8Array}}const Scene={encode(e,t=_m0$1.Writer.create()){return e.sceneId!==""&&t.uint32(10).string(e.sceneId),e.data.length!==0&&t.uint32(18).bytes(e.data),t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseScene();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==10)break;a.sceneId=n.string();continue;case 2:if(o!==18)break;a.data=n.bytes();continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{sceneId:isSet(e.sceneId)?String(e.sceneId):"",data:isSet(e.data)?bytesFromBase64(e.data):new Uint8Array}},toJSON(e){const t={};return e.sceneId!==void 0&&(t.sceneId=e.sceneId),e.data!==void 0&&(t.data=base64FromBytes(e.data!==void 0?e.data:new Uint8Array)),t},create(e){return Scene.fromPartial(e??{})},fromPartial(e){const t=createBaseScene();return t.sceneId=e.sceneId??"",t.data=e.data??new Uint8Array,t}};function createBaseVoice(){return{encodedSamples:new Uint8Array,index:0,codec:0}}const Voice={encode(e,t=_m0$1.Writer.create()){return e.encodedSamples.length!==0&&t.uint32(10).bytes(e.encodedSamples),e.index!==0&&t.uint32(16).uint32(e.index),e.codec!==0&&t.uint32(24).int32(e.codec),t},decode(e,t){const n=e instanceof _m0$1.Reader?e:_m0$1.Reader.create(e);let i=t===void 0?n.len:n.pos+t;const a=createBaseVoice();for(;n.pos<i;){const o=n.uint32();switch(o>>>3){case 1:if(o!==10)break;a.encodedSamples=n.bytes();continue;case 2:if(o!==16)break;a.index=n.uint32();continue;case 3:if(o!==24)break;a.codec=n.int32();continue}if((o&7)===4||o===0)break;n.skipType(o&7)}return a},fromJSON(e){return{encodedSamples:isSet(e.encodedSamples)?bytesFromBase64(e.encodedSamples):new Uint8Array,index:isSet(e.index)?Number(e.index):0,codec:isSet(e.codec)?voice_VoiceCodecFromJSON(e.codec):0}},toJSON(e){const t={};return e.encodedSamples!==void 0&&(t.encodedSamples=base64FromBytes(e.encodedSamples!==void 0?e.encodedSamples:new Uint8Array)),e.index!==void 0&&(t.index=Math.round(e.index)),e.codec!==void 0&&(t.codec=voice_VoiceCodecToJSON(e.codec)),t},create(e){return Voice.fromPartial(e??{})},fromPartial(e){const t=createBaseVoice();return t.encodedSamples=e.encodedSamples??new Uint8Array,t.index=e.index??0,t.codec=e.codec??0,t}};var tsProtoGlobalThis=(()=>{if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw"Unable to locate global object"})();function bytesFromBase64(e){if(tsProtoGlobalThis.Buffer)return Uint8Array.from(tsProtoGlobalThis.Buffer.from(e,"base64"));{const t=tsProtoGlobalThis.atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;++i)n[i]=t.charCodeAt(i);return n}}function base64FromBytes(e){if(tsProtoGlobalThis.Buffer)return tsProtoGlobalThis.Buffer.from(e).toString("base64");{const t=[];return e.forEach(n=>{t.push(String.fromCharCode(n))}),tsProtoGlobalThis.btoa(t.join(""))}}function isSet(e){return e!=null}class LiveKitCommsTransport extends LiveKitTransport{encode(t){return Packet.encode({message:t}).finish()}decode(t){return Packet.decode(t).message}}async function findRealms(){return await(await fetch("https://peer.decentraland.org/lambdas/explore/realms")).json()}class View extends Emitter{query(t){return this.$root.querySelector(t)}queryAll(t){return Array.from(this.$root.querySelectorAll(t))}$ref(t){return this.$root.querySelector(`[data-ref=${t}]`)}}class StepView extends View{show(){this.$root.style.display="block",setTimeout(()=>this.$root.style.opacity="1",1),document.querySelector("#end").scrollIntoView({block:"end"})}disable(){}}function cloneTemplate(e){return document.getElementById(e).content.firstElementChild.cloneNode(!0)}class ChatRoomView extends StepView{constructor(){super();pt(this,"$root",cloneTemplate("template-chat-room"));pt(this,"stats",{nPeers:0,nPings:0,nPongs:0,nMovements:0});pt(this,"lastPosition");pt(this,"onSendClick",()=>{const n=this.$chatInput.value;this.addMessage("You",n),this.emit({$case:"send",text:n}),this.$chatInput.value="",this.scrollLogToBottom()});pt(this,"onTeleportClick",()=>{const n=parseInt(this.$xInput.value),i=parseInt(this.$yInput.value),a=this.$islandInput.value;this.addMessage("You",`* Teleporting to (${n}, ${i}) *`),this.emit({$case:"teleport",x:n,y:i,island:a}),this.scrollLogToBottom()});this.$send.addEventListener("click",this.onSendClick),this.$teleport.addEventListener("click",this.onTeleportClick),this.$chatInput.addEventListener("keypress",n=>{n.key==="Enter"&&this.$send.click()})}addPing(){this.$nPings.innerText=`${++this.stats.nPings}`}addPong(){this.$nPongs.innerText=`${++this.stats.nPongs}`}addMovement(){this.$nMovements.innerText=`${++this.stats.nMovements}`}addMessage(n,i){const a=new ChatMessageView;a.setSender(n),a.setText(i),n.startsWith("0x")&&a.on("click-sender",()=>{this.emit({$case:"request-profile",address:n})}),this.$log.appendChild(a.$root),this.$log.scrollTo(0,a.$root.scrollHeight)}addEmote(n,i){this.addMessage(n,`* emote/${i} *`)}setIsland(n){this.$island.innerText=n.id,this.$transport.innerText=n.transport,this.$nPeers.innerText=`${n.peers.length}`}setPosition(n,i){const a=this.lastPosition;(!a||a.x!=n.x||a.y!=n.y)&&(this.$xInput.value=`${n.x}`,this.$yInput.value=`${n.y}`,i&&(this.$islandInput.value=i),this.lastPosition=n)}scrollLogToBottom(){this.$log.lastChild instanceof HTMLElement&&this.$log.lastChild.scrollIntoView()}get $island(){return this.$ref("island")}get $transport(){return this.$ref("transport")}get $nPeers(){return this.$ref("npeers")}get $chatInput(){return this.$ref("chat-input")}get $xInput(){return this.$ref("x-input")}get $yInput(){return this.$ref("y-input")}get $islandInput(){return this.$ref("island-input")}get $send(){return this.$ref("send")}get $teleport(){return this.$ref("teleport")}get $log(){return this.$ref("log")}get $nPings(){return this.$ref("npings")}get $nPongs(){return this.$ref("npongs")}get $nMovements(){return this.$ref("nmovements")}}class ChatMessageView extends View{constructor(){super();pt(this,"$root",cloneTemplate("template-chat-room-message"));pt(this,"onSenderClick",()=>{this.emit({$case:"click-sender",address:this.$sender.innerText})});this.$sender.addEventListener("click",this.onSenderClick)}setSender(n){this.$sender.innerText=n}setText(n){this.$text.innerText=n}get $sender(){return this.$ref("sender")}get $text(){return this.$ref("text")}}class ModalView extends View{constructor(n){super();pt(this,"$root",cloneTemplate("template-modal"));pt(this,"onBackdropClick",()=>{this.emit({$case:"close"})});this.content=n,this.$backdrop.addEventListener("click",this.onBackdropClick),this.$content.appendChild(n.$root)}get $backdrop(){return this.$ref("backdrop")}get $content(){return this.$ref("content")}}class RequestProfileView extends View{constructor(){super();pt(this,"$root",cloneTemplate("template-request-profile"));pt(this,"onSendClick",()=>{this.emit({$case:"request",address:this.$address.innerText}),this.$send.classList.add("disabled"),this.$send.innerText="Waiting..."});this.$send.addEventListener("click",this.onSendClick)}setAddress(n){this.$address.innerText=n,this.$send.classList.remove("disabled"),this.$send.innerText="Request Profile"}setProfile(n){n.userId===this.$address.innerText&&(this.$profile.innerText=JSON.stringify(n,null,2),this.$send.style.display="none",this.$profile.style.display="block")}get $send(){return this.$ref("send")}get $address(){return this.$ref("address")}get $profile(){return this.$ref("profile")}}class WelcomeView extends StepView{constructor(){super();pt(this,"$root",cloneTemplate("template-welcome"));pt(this,"onStartClick",()=>{this.emit({$case:"start"}),this.$start.classList.add("disabled")});this.$start.addEventListener("click",this.onStartClick)}get $start(){return this.$ref("start")}}class CreateIdentityView extends StepView{constructor(){super();pt(this,"$root",cloneTemplate("template-create-identity"));pt(this,"onCreateClick",()=>{this.emit({$case:"create"}),this.$create.classList.add("disabled")});this.$create.addEventListener("click",this.onCreateClick)}get $create(){return this.$ref("create")}}class IdentityCreatedView extends StepView{constructor(){super(...arguments);pt(this,"$root",cloneTemplate("template-identity-created"))}setAddress(n){this.$address.innerText=n}get $address(){return this.$ref("address")}}class DiscoverRealmsView extends StepView{constructor(){super();pt(this,"$root",cloneTemplate("template-discover-realms"));pt(this,"onDiscoverClick",()=>{this.emit({$case:"discover"}),this.$discover.classList.add("disabled")});this.$discover.addEventListener("click",this.onDiscoverClick)}get $discover(){return this.$ref("discover")}}class SelectRealmView extends StepView{constructor(){super(...arguments);pt(this,"$root",cloneTemplate("template-select-realm"))}setRealms(n){const i=[...n];i.sort((a,o)=>o.usersCount-a.usersCount);for(let a of i){const o=new SelectRealmRowView;o.$name.innerText=a.serverName,o.$url.innerText=a.url,o.$users.innerText=`${a.usersCount}`,o.$connect.addEventListener("click",c=>{this.emit({$case:"select",realm:a}),this.queryAll("button").forEach(d=>d.classList.add("disabled"))}),this.$ref("realms").appendChild(o.$root)}}}class SelectRealmRowView extends View{constructor(){super(...arguments);pt(this,"$root",cloneTemplate("template-select-realm-row"))}get $name(){return this.$ref("name")}get $url(){return this.$ref("url")}get $users(){return this.$ref("users")}get $connect(){return this.$ref("connect")}}class RequestChallengeView extends StepView{constructor(){super();pt(this,"$root",cloneTemplate("template-request-challenge"));pt(this,"onRequestClick",()=>{this.emit({$case:"request"}),this.$request.classList.add("disabled")});this.$request.addEventListener("click",this.onRequestClick)}get $request(){return this.$ref("request")}}class RespondChallengeView extends StepView{constructor(){super();pt(this,"$root",cloneTemplate("template-respond-challenge"));pt(this,"onRequestClick",()=>{this.emit({$case:"respond"}),this.$respond.classList.add("disabled")});this.$respond.addEventListener("click",this.onRequestClick)}setChallenge(n){this.$challenge.innerText=n}get $respond(){return this.$ref("respond")}get $challenge(){return this.$ref("challenge")}}class StartHeartbeatView extends StepView{constructor(){super();pt(this,"$root",cloneTemplate("template-start-heartbeat"));pt(this,"onStartClick",()=>{this.emit({$case:"start"}),this.$start.classList.add("disabled")});this.$start.addEventListener("click",this.onStartClick)}get $start(){return this.$ref("start")}}class AwaitIslandView extends StepView{constructor(){super(...arguments);pt(this,"$root",cloneTemplate("template-await-island"))}}class JoinIslandView extends StepView{constructor(){super();pt(this,"$root",cloneTemplate("template-join-island"));pt(this,"onJoinClick",()=>{this.emit({$case:"join"})});this.$join.addEventListener("click",this.onJoinClick)}setIsland(n){this.$island.innerText=n.id,this.$transport.innerText=n.transport,this.$uri.innerText=this.formatUri(n.uri)}formatUri(n){const i=new URL(n);return`${i.origin}${i.pathname}`}get $uri(){return this.$ref("uri")}get $island(){return this.$ref("island")}get $transport(){return this.$ref("transport")}get $join(){return this.$ref("join")}}class AppView extends View{constructor(n=new WelcomeView,i=new DiscoverRealmsView,a=new SelectRealmView,o=new CreateIdentityView,c=new RequestChallengeView,d=new RespondChallengeView,u=new StartHeartbeatView,l=new AwaitIslandView,h=new Array,p=new Array){super();pt(this,"$root",cloneTemplate("template-app"));pt(this,"requestProfile");this.welcome=n,this.discoverRealms=i,this.selectRealm=a,this.createIdentity=o,this.requestChallenge=c,this.respondChallenge=d,this.startHeartbeat=u,this.awaitIsland=l,this.joinIslands=h,this.chatRooms=p}async askStart(){this.$root.appendChild(this.welcome.$root),this.welcome.show(),await Events.next(this.welcome,"start")}async askCreateIdentity(){this.$root.appendChild(this.createIdentity.$root),this.createIdentity.show(),await Events.next(this.createIdentity,"create")}async askDiscoverRealms(){this.$root.appendChild(this.discoverRealms.$root),this.discoverRealms.show(),await Events.next(this.discoverRealms,"discover")}async askSelectRealm(n){this.selectRealm.setRealms(n),this.$root.appendChild(this.selectRealm.$root),this.selectRealm.show();const{realm:i}=await Events.next(this.selectRealm,"select");return{realm:i}}async askRequestChallenge(){this.$root.appendChild(this.requestChallenge.$root),this.requestChallenge.show(),await Events.next(this.requestChallenge,"request")}async askRespondChallenge(n){this.respondChallenge.setChallenge(n),this.$root.appendChild(this.respondChallenge.$root),this.respondChallenge.show(),await Events.next(this.respondChallenge,"respond")}async askStartHeartbat(){this.$root.appendChild(this.startHeartbeat.$root),this.startHeartbeat.show(),await Events.next(this.startHeartbeat,"start")}showWaitingForIsland(){this.$root.appendChild(this.awaitIsland.$root),this.awaitIsland.show()}async askJoinIsland(n){const i=lastOf(this.joinIslands),a=new JoinIslandView;i==null||i.disable(),a.setIsland(n),this.joinIslands.push(a),this.$root.appendChild(a.$root),a.show(),await Events.next(a,"join")}showChat(n){const i=lastOf(this.chatRooms);i==null||i.disable();const a=new ChatRoomView;this.chatRooms.push(a),a.setIsland(n);for(let o of n.peers)a.addMessage(o,"was already here");a.on("send",({text:o})=>this.emit({$case:"send-chat",text:o})),a.on("teleport",({x:o,y:c,island:d})=>this.emit({$case:"teleport",position:{x:o,y:c,z:0},island:d})),a.on("request-profile",({address:o})=>{this.showRequestProfile(o)}),this.$root.appendChild(a.$root),a.show()}setCreatedAddress(n){const i=new IdentityCreatedView;i.setAddress(n),this.$root.appendChild(i.$root),i.show()}setPosition(n){var i;(i=lastOf(this.chatRooms))==null||i.setPosition(n)}setRequestedProfile(n){var i;(i=this.requestProfile)==null||i.setProfile(n)}showRequestProfile(n){this.requestProfile=new RequestProfileView;const i=new ModalView(this.requestProfile);this.requestProfile.setAddress(n),this.requestProfile.on("request",a=>{this.emit({$case:"request-profile",address:n})}),i.on("close",a=>{i.$root.remove()}),this.$root.prepend(i.$root)}handleMessage(n,i){const a=lastOf(this.chatRooms);if(a)switch(i.$case){case"chat":const o=i.chat.message;o.startsWith("␑")?a.addPing():o.startsWith("␆")?a.addPong():o.startsWith("␐")?a.addEmote(n,o.split(" ")[0].slice(1)):a.addMessage(n," : "+o);break;case"position":a.addMovement();break}}}async function start(){const e=new AppView;document.getElementById("container").appendChild(e.$root),await e.askStart(),await e.askCreateIdentity();const t=await createDisposableIdentity(),n=t.ephemeralIdentity.address;e.setCreatedAddress(n),await e.askDiscoverRealms();const i=await findRealms(),{realm:a}=await e.askSelectRealm(i),o=new ArchipelagoClient(a);await o.connect(),e.askRequestChallenge();const c=await o.requestChallenge(n);e.askRespondChallenge(c);const d=await dist$3.Authenticator.signPayload(t,c);await o.respondChallenge(d),await e.askStartHeartbat(),e.showWaitingForIsland();let u,l={x:1,y:0,z:0},h;await o.on("island_changed",async p=>{const{island:y}=p;e.offAll(),u&&(u.offAll(),u.disconnect()),await e.askJoinIsland(y),u=new LiveKitCommsTransport(y.uri),u.on("message",E=>{e.handleMessage(E.peer??"",E.message)}).on("disconnected",console.log).on("connected",console.log),await u.connect(),e.on("send-chat",E=>{u.send({$case:"chat",chat:{message:E.text,timestamp:Date.now()}})}),e.on("teleport",E=>{l=E.position,h=E.island}),e.on("request-profile",async({address:E})=>{u.send({$case:"profileRequest",profileRequest:{address:E,profileVersion:0}});for await(let x of u.receiveMany("profileResponse"))if(x.peer===E){e.setRequestedProfile(JSON.parse(x.message.profileResponse.serializedProfile));break}}),e.showChat(y),e.setPosition(l)}),setAsyncInterval(async()=>{e.setPosition(l),await o.sendHeartbeat(l,h)},1e3)}start();
